{
  "version": 3,
  "sources": ["../shared/models/auth.ts", "../shared/schema.ts", "../server/db.ts", "../server/lib/email.ts", "../server/lib/auth-service.ts", "../server/utils/encryption.ts", "../vite.config.ts", "../node_modules/nanoid/url-alphabet/index.js", "../node_modules/nanoid/index.js", "../server/vite.ts", "../server/index.ts", "../server/lib/custom-auth.ts", "../server/storage.ts", "../shared/routes.ts", "../server/routes.ts", "../server/static.ts"],
  "sourcesContent": ["import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar, boolean, text } from \"drizzle-orm/pg-core\";\n\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  passwordHash: varchar(\"password_hash\"),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  phone: varchar(\"phone\"),\n  address: text(\"address\"),\n  streetType: text(\"street_type\"),\n  city: text(\"city\"),\n  province: text(\"province\"),\n  postalCode: text(\"postal_code\"),\n  country: text(\"country\"),\n  businessActivity: text(\"business_activity\"),\n  idNumber: text(\"id_number\"),\n  idType: text(\"id_type\"),\n  birthDate: text(\"birth_date\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  accountStatus: text(\"account_status\").notNull().default(\"active\"), // active, pending, suspended, vip\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const userNotifications = pgTable(\"user_notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  type: text(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").notNull().default(false),\n  actionUrl: text(\"action_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: varchar(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  used: boolean(\"used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const emailVerificationTokens = pgTable(\"email_verification_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: varchar(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  used: boolean(\"used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\nexport type EmailVerificationToken = typeof emailVerificationTokens.$inferSelect;\nexport type UserNotification = typeof userNotifications.$inferSelect;\n", "export * from \"./models/auth\";\nimport { pgTable, text, serial, integer, boolean, timestamp, jsonb, varchar, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { users } from \"./models/auth\";\nimport { relations, sql } from \"drizzle-orm\";\n\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  price: integer(\"price\").notNull(), // in cents\n  features: jsonb(\"features\").$type<string[]>().notNull(),\n});\n\nexport const orders = pgTable(\"orders\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  productId: integer(\"product_id\").notNull().references(() => products.id),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, paid, cancelled\n  stripeSessionId: text(\"stripe_session_id\"),\n  amount: integer(\"amount\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userIdIdx: index(\"orders_user_id_idx\").on(table.userId),\n  statusIdx: index(\"orders_status_idx\").on(table.status),\n}));\n\nexport const llcApplications = pgTable(\"llc_applications\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  requestCode: text(\"request_code\").unique(),\n  ownerFullName: text(\"owner_full_name\"),\n  ownerEmail: text(\"owner_email\"),\n  ownerPhone: text(\"owner_phone\"),\n  ownerBirthDate: text(\"owner_birth_date\"),\n  ownerAddress: text(\"owner_address\"),\n  ownerStreetType: text(\"owner_street_type\"), // Calle, Avenida, Paseo\n  ownerCity: text(\"owner_city\"),\n  ownerCountry: text(\"owner_country\"),\n  ownerProvince: text(\"owner_province\"),\n  ownerPostalCode: text(\"owner_postal_code\"),\n  ownerIdNumber: text(\"owner_id_number\"), // DNI/Passport number\n  ownerIdType: text(\"owner_id_type\"), // DNI or Passport\n  idLater: boolean(\"id_later\").notNull().default(false),\n  dataProcessingConsent: boolean(\"data_processing_consent\").notNull().default(false),\n  termsConsent: boolean(\"terms_consent\").notNull().default(false),\n  ageConfirmation: boolean(\"age_confirmation\").notNull().default(false),\n  companyName: text(\"company_name\"),\n  companyNameOption2: text(\"company_name_option_2\"),\n  designator: text(\"designator\"), // LLC, L.L.C., Ltd.\n  companyDescription: text(\"company_description\"),\n  businessCategory: text(\"business_category\"),\n  businessActivity: text(\"business_activity\"),\n  businessCategoryOther: text(\"business_category_other\"),\n  ownerNamesAlternates: text(\"owner_names_alternates\"), // Plan B, C, D names\n  ownerCount: integer(\"owner_count\").default(1),\n  ownerCountryResidency: text(\"owner_country_residency\"),\n  idDocumentUrl: text(\"id_document_url\"),\n  isSellingOnline: text(\"is_selling_online\"), // Yes, No, Not sure\n  needsBankAccount: text(\"needs_bank_account\"), // Mercury, Relay, No, Yes\n  willUseStripe: text(\"will_use_stripe\"), // Stripe, PayPal, Both, Other, Not yet\n  wantsBoiReport: text(\"wants_boi_report\"), // Yes, No, Info\n  wantsMaintenancePack: text(\"wants_maintenance_pack\"), // Yes, No, Info\n  paymentStatus: text(\"payment_status\").notNull().default(\"unpaid\"), // unpaid, paid\n  notes: text(\"notes\"),\n  state: text(\"state\"),\n  status: text(\"status\").notNull().default(\"draft\"), // draft, submitted, filed, rejected\n  submittedAt: timestamp(\"submitted_at\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  emailOtp: text(\"email_otp\"),\n  emailOtpExpires: timestamp(\"email_otp_expires\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n}, (table) => ({\n  orderIdIdx: index(\"llc_apps_order_id_idx\").on(table.orderId),\n  requestCodeIdx: index(\"llc_apps_req_code_idx\").on(table.requestCode),\n  statusIdx: index(\"llc_apps_status_idx\").on(table.status),\n}));\n\nexport const applicationDocuments = pgTable(\"application_documents\", {\n  id: serial(\"id\").primaryKey(),\n  applicationId: integer(\"application_id\").notNull().references(() => llcApplications.id),\n  fileName: text(\"file_name\").notNull(),\n  fileType: text(\"file_type\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  documentType: text(\"document_type\").notNull(), // passport, id, other\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n});\n\nexport const newsletterSubscribers = pgTable(\"newsletter_subscribers\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  subscribedAt: timestamp(\"subscribed_at\").defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  name: text(\"name\"),\n  email: text(\"email\").notNull(),\n  subject: text(\"subject\"),\n  content: text(\"content\").notNull(),\n  encryptedContent: text(\"encrypted_content\"),\n  status: text(\"status\").notNull().default(\"unread\"), // unread, read, archived\n  type: text(\"type\").notNull().default(\"contact\"), // contact, support, system\n  requestCode: text(\"request_code\"),\n  messageId: text(\"message_id\").unique(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const contactOtps = pgTable(\"contact_otps\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull(),\n  otp: text(\"otp\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  verified: boolean(\"verified\").notNull().default(false),\n});\n\nexport const orderEvents = pgTable(\"order_events\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  eventType: text(\"event_type\").notNull(),\n  description: text(\"description\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n});\n\nexport const messageReplies = pgTable(\"message_replies\", {\n  id: serial(\"id\").primaryKey(),\n  messageId: integer(\"message_id\").notNull().references(() => messages.id),\n  content: text(\"content\").notNull(),\n  encryptedContent: text(\"encrypted_content\"),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n});\n\nexport const maintenanceApplications = pgTable(\"maintenance_applications\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  requestCode: text(\"request_code\").unique(),\n  ownerFullName: text(\"owner_full_name\"),\n  ownerEmail: text(\"owner_email\"),\n  ownerPhone: text(\"owner_phone\"),\n  companyName: text(\"company_name\"),\n  ein: text(\"ein\"),\n  state: text(\"state\"),\n  creationSource: text(\"creation_source\"),\n  creationYear: text(\"creation_year\"),\n  bankAccount: text(\"bank_account\"),\n  paymentGateway: text(\"payment_gateway\"),\n  businessActivity: text(\"business_activity\"),\n  expectedServices: text(\"expected_services\"),\n  status: text(\"status\").notNull().default(\"draft\"),\n  submittedAt: timestamp(\"submitted_at\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  emailOtp: text(\"email_otp\"),\n  emailOtpExpires: timestamp(\"email_otp_expires\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  notes: text(\"notes\"),\n  wantsDissolve: text(\"wants_dissolve\"),\n  authorizedManagement: boolean(\"authorized_management\").notNull().default(false),\n  termsConsent: boolean(\"terms_consent\").notNull().default(false),\n  dataProcessingConsent: boolean(\"data_processing_consent\").notNull().default(false),\n});\n\nexport const ordersRelations = relations(orders, ({ one, many }) => ({\n  user: one(users, { fields: [orders.userId], references: [users.id] }),\n  product: one(products, { fields: [orders.productId], references: [products.id] }),\n  application: one(llcApplications, { fields: [orders.id], references: [llcApplications.orderId] }),\n  events: many(orderEvents),\n}));\n\nexport const orderEventsRelations = relations(orderEvents, ({ one }) => ({\n  order: one(orders, { fields: [orderEvents.orderId], references: [orders.id] }),\n}));\n\nexport const messagesRelations = relations(messages, ({ many }) => ({\n  replies: many(messageReplies),\n}));\n\nexport const messageRepliesRelations = relations(messageReplies, ({ one }) => ({\n  message: one(messages, { fields: [messageReplies.messageId], references: [messages.id] }),\n}));\n\nexport const llcApplicationsRelations = relations(llcApplications, ({ one, many }) => ({\n  order: one(orders, { fields: [llcApplications.orderId], references: [orders.id] }),\n  documents: many(applicationDocuments),\n}));\n\nexport const applicationDocumentsRelations = relations(applicationDocuments, ({ one }) => ({\n  application: one(llcApplications, { fields: [applicationDocuments.applicationId], references: [llcApplications.id] }),\n}));\n\nexport const maintenanceApplicationsRelations = relations(maintenanceApplications, ({ one }) => ({\n  order: one(orders, { fields: [maintenanceApplications.orderId], references: [orders.id] }),\n}));\n\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true });\nexport const insertOrderSchema = createInsertSchema(orders).omit({ id: true, createdAt: true });\nexport const insertLlcApplicationSchema = createInsertSchema(llcApplications).omit({ id: true, lastUpdated: true });\nexport const insertApplicationDocumentSchema = createInsertSchema(applicationDocuments).omit({ id: true, uploadedAt: true });\nexport const insertMaintenanceApplicationSchema = createInsertSchema(maintenanceApplications).omit({ id: true, lastUpdated: true });\nexport const insertContactOtpSchema = createInsertSchema(contactOtps).omit({ id: true });\nexport const insertOrderEventSchema = createInsertSchema(orderEvents).omit({ id: true, createdAt: true });\nexport const insertMessageReplySchema = createInsertSchema(messageReplies).omit({ id: true, createdAt: true });\n\nexport type MaintenanceApplication = typeof maintenanceApplications.$inferSelect;\nexport type Product = typeof products.$inferSelect;\nexport type Order = typeof orders.$inferSelect;\nexport type LlcApplication = typeof llcApplications.$inferSelect;\nexport type ApplicationDocument = typeof applicationDocuments.$inferSelect;\nexport type OrderEvent = typeof orderEvents.$inferSelect;\nexport type Message = typeof messages.$inferSelect;\nexport type MessageReply = typeof messageReplies.$inferSelect;\n\nexport type CreateOrderRequest = {\n  productId: number;\n};\nexport type UpdateLlcApplicationRequest = Partial<z.infer<typeof insertLlcApplicationSchema>>;\nexport type CreateDocumentRequest = z.infer<typeof insertApplicationDocumentSchema>;\n", "import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n", "import nodemailer from \"nodemailer\";\n\nexport function getEmailHeader(title: string = \"Easy US LLC\") {\n  const domain = \"easyusllc.com\";\n  const protocol = 'https';\n  const logoUrl = `${protocol}://${domain}/logo-email.png?v=4`;\n  \n  return `\n    <div style=\"background-color: #ffffff; padding: 40px 20px; text-align: center; border-bottom: 3px solid #6EDC8A;\">\n      <div style=\"margin-bottom: 25px; display: block; width: 100%; text-align: center;\">\n        <a href=\"https://${domain}\" target=\"_blank\" style=\"text-decoration: none; display: inline-block;\">\n          <img src=\"${logoUrl}\" alt=\"Easy US LLC\" width=\"120\" height=\"120\" style=\"display: inline-block; margin: 0 auto; width: 120px; height: 120px; object-fit: contain; border: 0;\" />\n        </a>\n      </div>\n      <h1 style=\"color: #0E1215; margin: 0; font-family: 'Inter', Arial, sans-serif; font-weight: 900; text-transform: uppercase; letter-spacing: -1.5px; font-size: 28px; line-height: 1.1;\">\n        ${title}\n      </h1>\n    </div>\n  `;\n}\n\nexport function getEmailFooter() {\n  const year = new Date().getFullYear();\n  return `\n    <div style=\"background-color: #0E1215; padding: 40px 20px; text-align: center; color: #F7F7F5; font-family: 'Inter', Arial, sans-serif;\">\n      <p style=\"margin: 0 0 15px 0; font-weight: 800; color: #6EDC8A; text-transform: uppercase; font-size: 12px; letter-spacing: 1px;\">Expertos en formaci\u00F3n de LLC</p>\n      <p style=\"margin: 0; font-size: 13px; color: #F7F7F5; font-weight: 500;\">New Mexico, USA | <a href=\"mailto:info@easyusllc.com\" style=\"color: #6EDC8A; text-decoration: none; font-weight: 700;\">info@easyusllc.com</a></p>\n      <div style=\"margin-top: 20px;\">\n        <a href=\"https://wa.me/34614916910\" style=\"color: #F7F7F5; text-decoration: none; font-weight: 800; font-size: 11px; text-transform: uppercase; margin: 0 15px; border-bottom: 1px solid #6EDC8A;\">WhatsApp</a>\n        <a href=\"https://easyusllc.com\" style=\"color: #F7F7F5; text-decoration: none; font-weight: 800; font-size: 11px; text-transform: uppercase; margin: 0 15px; border-bottom: 1px solid #6EDC8A;\">Web Oficial</a>\n      </div>\n      <p style=\"margin-top: 30px; font-size: 10px; color: #6B7280; text-transform: uppercase; letter-spacing: 1px;\">\u00A9 ${year} Easy US LLC. Todos los derechos reservados.</p>\n    </div>\n  `;\n}\n\nexport function getAutoReplyTemplate(ticketId: string, name: string = \"Cliente\") {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Hemos recibido tu consulta</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Hola <strong>${name}</strong>, gracias por contactar con Easy US LLC. Tu consulta ha sido registrada correctamente con el identificador que ver\u00E1s a continuaci\u00F3n.</p>\n          \n          <div style=\"background: #f4f4f4; padding: 20px; border-radius: 8px; margin: 25px 0; border: 1px solid #6EDC8A; text-align: center;\">\n            <p style=\"margin: 0; font-size: 12px; color: #6B7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;\">Referencia de Seguimiento</p>\n            <p style=\"margin: 0; font-size: 24px; font-weight: 900; color: #0E1215;\">${ticketId}</p>\n          </div>\n\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 20px;\">Nuestro equipo de expertos revisar\u00E1 tu mensaje y te responder\u00E1 de forma personalizada en un plazo de <strong>24 a 48 horas h\u00E1biles</strong>.</p>\n          \n          <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Si necesitas a\u00F1adir informaci\u00F3n adicional, simplemente responde a este correo manteniendo el asunto intacto.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getOtpEmailTemplate(otp: string) {\n  return `\n    <div style=\"background-color: #F7F7F5; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #0E1215; background-color: #ffffff; border: 1px solid #E6E9EC;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #0E1215;\">Verificaci\u00F3n de Identidad</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #0E1215; margin-bottom: 25px;\">Verifica tu email con el siguiente c\u00F3digo de seguridad:</p>\n          \n          <div style=\"background: #F7F7F5; padding: 25px; border-radius: 8px; margin: 25px 0; text-align: center; border: 2px solid #6EDC8A;\">\n            <p style=\"margin: 0; font-size: 32px; font-weight: 900; color: #0E1215; letter-spacing: 8px;\">${otp}</p>\n          </div>\n\n          <p style=\"line-height: 1.6; font-size: 12px; color: #6B7280; margin-top: 20px;\">Este c\u00F3digo caducar\u00E1 en 10 minutos.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getWelcomeEmailTemplate(name: string) {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Bienvenido a Easy US LLC, ${name}</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 20px;\">Es un placer acompa\u00F1arte en la expansi\u00F3n de tu negocio hacia los Estados Unidos. Nuestra misi\u00F3n es simplificar cada paso administrativo para que t\u00FA puedas centrarte en crecer.</p>\n          \n          <div style=\"background: #fcfcfc; border-left: 3px solid #000; padding: 20px; margin: 25px 0;\">\n            <p style=\"margin: 0; font-size: 15px; font-weight: 700; color: #000;\">\u00BFQu\u00E9 esperar ahora?</p>\n            <ul style=\"margin: 15px 0 0 0; padding-left: 20px; color: #555; font-size: 14px; line-height: 1.6;\">\n              <li style=\"margin-bottom: 8px;\">Asignaci\u00F3n de un agente especializado a tu expediente.</li>\n              <li style=\"margin-bottom: 8px;\">Revisi\u00F3n de disponibilidad de nombres en el estado seleccionado.</li>\n              <li style=\"margin-bottom: 8px;\">Preparaci\u00F3n de documentos constitutivos oficiales.</li>\n            </ul>\n          </div>\n\n          <p style=\"line-height: 1.6; font-size: 14px; color: #666;\">Recibir\u00E1s actualizaciones peri\u00F3dicas sobre el estado de tu formaci\u00F3n. Si tienes cualquier consulta, nuestro equipo est\u00E1 a tu disposici\u00F3n v\u00EDa WhatsApp o email.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getConfirmationEmailTemplate(name: string, requestCode: string, details?: any) {\n  const now = new Date();\n  const dateStr = now.toLocaleDateString('es-ES', { timeZone: 'Europe/Madrid' });\n  const timeStr = now.toLocaleTimeString('es-ES', { timeZone: 'Europe/Madrid', hour: '2-digit', minute: '2-digit' });\n\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">\u00A1Gracias por tu solicitud, ${name}!</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Hemos recibido correctamente los datos para el registro de tu nueva LLC. Nuestro equipo de especialistas comenzar\u00E1 con la revisi\u00F3n t\u00E9cnica de inmediato.</p>\n          \n          <div style=\"background: #fcfcfc; padding: 25px; border-radius: 8px; margin: 25px 0; border: 1px solid #6EDC8A;\">\n            <p style=\"margin: 0 0 15px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; letter-spacing: 1px;\">Referencia de Solicitud</p>\n            <p style=\"margin: 0; font-size: 24px; font-weight: 900; color: #0E1215;\">${requestCode}</p>\n          </div>\n\n          <div style=\"margin-bottom: 25px;\">\n            <h3 style=\"margin: 0 0 15px 0; font-size: 13px; font-weight: 800; text-transform: uppercase; color: #000; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px;\">Resumen del Registro</h3>\n            <table style=\"width: 100%; font-size: 14px; border-collapse: collapse;\">\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Fecha y hora:</td>\n                <td style=\"padding: 8px 0; font-weight: 700; text-align: right;\">${dateStr} | ${timeStr}</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Nombre Propuesto:</td>\n                <td style=\"padding: 8px 0; font-weight: 700; text-align: right;\">${details?.companyName || 'Pendiente'}</td>\n              </tr>\n              <tr>\n                <td style=\"padding: 8px 0; color: #666;\">Estado de Pago:</td>\n                <td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #0d9488;\">Confirmado / Procesando</td>\n              </tr>\n            </table>\n          </div>\n\n          <div style=\"background: #FFF9E6; padding: 20px; border-radius: 8px; border: 1px solid #FFE4B3; margin: 25px 0;\">\n            <p style=\"margin: 0; font-size: 14px; color: #856404; line-height: 1.6;\"><strong>Pr\u00F3ximos Pasos:</strong> En las pr\u00F3ximas 24-48h recibir\u00E1s un email con los documentos constitutivos para tu firma electr\u00F3nica. Por favor, mantente atento a tu bandeja de entrada.</p>\n          </div>\n\n          <p style=\"line-height: 1.6; font-size: 14px; color: #666;\">Si necesitas realizar cualquier cambio en los datos suministrados, por favor contacta con nosotros respondiendo a este correo.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getNewsletterWelcomeTemplate() {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Suscripci\u00F3n Confirmada</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Ya formas parte de la comunidad de Easy US LLC. A partir de ahora, recibir\u00E1s informaci\u00F3n estrat\u00E9gica para optimizar tu negocio en EE.UU.</p>\n          \n          <div style=\"background: #fcfcfc; padding: 25px; border-radius: 8px; border: 1px solid #eee;\">\n            <p style=\"margin: 0 0 15px 0; font-weight: 800; font-size: 12px; text-transform: uppercase; color: #000;\">Lo que vas a recibir:</p>\n            <div style=\"margin-bottom: 15px;\">\n              <p style=\"margin: 0; font-weight: 700; font-size: 14px; color: #000;\">Gu\u00EDas de Cumplimiento</p>\n              <p style=\"margin: 3px 0 0 0; font-size: 13px; color: #666;\">Informaci\u00F3n clave sobre BOI Reports y declaraciones anuales.</p>\n            </div>\n            <div style=\"margin-bottom: 15px;\">\n              <p style=\"margin: 0; font-weight: 700; font-size: 14px; color: #000;\">Tips de Banca USA</p>\n              <p style=\"margin: 3px 0 0 0; font-size: 13px; color: #666;\">Novedades sobre Mercury, Relay y gesti\u00F3n de fondos en USD.</p>\n            </div>\n            <div>\n              <p style=\"margin: 0; font-weight: 700; font-size: 14px; color: #000;\">Estrategia Fiscal</p>\n              <p style=\"margin: 3px 0 0 0; font-size: 13px; color: #666;\">C\u00F3mo operar sin IVA y minimizar el impacto tributario legalmente.</p>\n            </div>\n          </div>\n\n          <p style=\"line-height: 1.6; font-size: 14px; color: #666; margin-top: 25px; text-align: center;\">Bienvenido al ecosistema global de emprendimiento.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getReminderEmailTemplate(name: string, requestCode: string) {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader()}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Termina tu registro</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444;\">Hola <strong>${name}</strong>, hemos notado que tu solicitud para una nueva LLC a\u00FAn no est\u00E1 completa.</p>\n          \n          <div style=\"background: #f1f5f9; padding: 25px; border-radius: 8px; margin: 35px 0; border: 1px dashed #cbd5e1; text-align: center;\">\n            <p style=\"margin: 0; font-size: 15px; color: #000;\"><strong>Solicitud pendiente:</strong> ${requestCode}</p>\n          </div>\n\n          <div style=\"text-align: center; margin-top: 30px;\">\n            <a href=\"https://easyusllc.com/seguimiento\" style=\"background-color: #000; color: #fff; padding: 15px 35px; text-decoration: none; border-radius: 6px; font-weight: 800; display: inline-block; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;\">Continuar Solicitud \u2192</a>\n          </div>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getActionRequiredTemplate(name: string, orderNumber: string, actionDescription: string) {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader(\"Acci\u00F3n Requerida\")}\n        <div style=\"padding: 40px;\">\n          <div style=\"background: #FEF2F2; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #EF4444;\">\n            <p style=\"margin: 0; font-size: 13px; font-weight: 700; color: #DC2626; text-transform: uppercase;\">Requiere tu atenci\u00F3n</p>\n          </div>\n          \n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Hola ${name},</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Necesitamos tu ayuda para continuar con el proceso de tu solicitud. Por favor, revisa la siguiente informaci\u00F3n:</p>\n          \n          <div style=\"background: #fcfcfc; padding: 25px; border-radius: 8px; margin: 25px 0; border: 1px solid #e5e5e5;\">\n            <p style=\"margin: 0 0 10px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; letter-spacing: 1px;\">Pedido</p>\n            <p style=\"margin: 0 0 20px 0; font-size: 20px; font-weight: 900; color: #0E1215;\">${orderNumber}</p>\n            <p style=\"margin: 0 0 10px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; letter-spacing: 1px;\">Acci\u00F3n Necesaria</p>\n            <p style=\"margin: 0; font-size: 15px; color: #444; line-height: 1.6;\">${actionDescription}</p>\n          </div>\n\n          <div style=\"text-align: center; margin-top: 30px;\">\n            <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #0E1215; color: #fff; padding: 15px 35px; text-decoration: none; border-radius: 6px; font-weight: 800; display: inline-block; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;\">Ir a Mi Panel \u2192</a>\n          </div>\n          \n          <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280; margin-top: 25px; text-align: center;\">Tambi\u00E9n puedes responder directamente a este correo si tienes alguna duda.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getNoteReceivedTemplate(name: string, noteContent: string, orderNumber?: string) {\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader(\"Nuevo Mensaje\")}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Hola ${name},</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Has recibido un nuevo mensaje de nuestro equipo${orderNumber ? ` relacionado con tu pedido <strong>${orderNumber}</strong>` : \"\"}:</p>\n          \n          <div style=\"background: #F0FDF4; padding: 25px; border-radius: 8px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n            <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.6; white-space: pre-wrap;\">${noteContent}</p>\n          </div>\n\n          <div style=\"text-align: center; margin-top: 30px;\">\n            <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #6EDC8A; color: #0E1215; padding: 15px 35px; text-decoration: none; border-radius: 6px; font-weight: 800; display: inline-block; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;\">Ver en Mi Panel \u2192</a>\n          </div>\n          \n          <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280; margin-top: 25px; text-align: center;\">Si tienes alguna pregunta, no dudes en contactarnos.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getOrderUpdateTemplate(name: string, orderNumber: string, newStatus: string, statusDescription: string) {\n  const statusColors: Record<string, { bg: string; border: string; text: string }> = {\n    pending: { bg: \"#FEF3C7\", border: \"#F59E0B\", text: \"#92400E\" },\n    processing: { bg: \"#DBEAFE\", border: \"#3B82F6\", text: \"#1E40AF\" },\n    documents_ready: { bg: \"#E0E7FF\", border: \"#6366F1\", text: \"#3730A3\" },\n    completed: { bg: \"#D1FAE5\", border: \"#10B981\", text: \"#065F46\" },\n    cancelled: { bg: \"#FEE2E2\", border: \"#EF4444\", text: \"#991B1B\" },\n  };\n  \n  const colors = statusColors[newStatus] || statusColors.processing;\n  \n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader(\"Actualizaci\u00F3n de Pedido\")}\n        <div style=\"padding: 40px;\">\n          <h2 style=\"font-size: 20px; font-weight: 800; margin-bottom: 20px; color: #000;\">Hola ${name},</h2>\n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">Tu pedido ha sido actualizado con un nuevo estado:</p>\n          \n          <div style=\"background: #fcfcfc; padding: 25px; border-radius: 8px; margin: 25px 0; border: 1px solid #e5e5e5;\">\n            <p style=\"margin: 0 0 10px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; letter-spacing: 1px;\">N\u00FAmero de Pedido</p>\n            <p style=\"margin: 0 0 20px 0; font-size: 20px; font-weight: 900; color: #0E1215;\">${orderNumber}</p>\n            \n            <div style=\"background: ${colors.bg}; padding: 15px 20px; border-radius: 8px; border-left: 4px solid ${colors.border};\">\n              <p style=\"margin: 0; font-size: 14px; font-weight: 800; color: ${colors.text}; text-transform: uppercase;\">${newStatus.replace(/_/g, \" \")}</p>\n            </div>\n          </div>\n          \n          <p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-bottom: 25px;\">${statusDescription}</p>\n\n          <div style=\"text-align: center; margin-top: 30px;\">\n            <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #0E1215; color: #fff; padding: 15px 35px; text-decoration: none; border-radius: 6px; font-weight: 800; display: inline-block; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;\">Ver Detalles \u2192</a>\n          </div>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nexport function getInvoiceEmailTemplate(name: string, orderNumber: string, invoiceDetails: {\n  items: Array<{ description: string; quantity: number; price: number }>;\n  subtotal: number;\n  tax?: number;\n  total: number;\n  invoiceNumber: string;\n  issueDate: string;\n}) {\n  const itemsHtml = invoiceDetails.items.map(item => `\n    <tr>\n      <td style=\"padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #444;\">${item.description}</td>\n      <td style=\"padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #444; text-align: center;\">${item.quantity}</td>\n      <td style=\"padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #444; text-align: right;\">$${item.price.toFixed(2)}</td>\n    </tr>\n  `).join(\"\");\n\n  return `\n    <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n      <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n        ${getEmailHeader(\"Factura\")}\n        <div style=\"padding: 40px;\">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 30px;\">\n            <div>\n              <p style=\"margin: 0 0 5px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280;\">Factura</p>\n              <p style=\"margin: 0; font-size: 18px; font-weight: 900; color: #0E1215;\">${invoiceDetails.invoiceNumber}</p>\n            </div>\n            <div style=\"text-align: right;\">\n              <p style=\"margin: 0 0 5px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280;\">Fecha</p>\n              <p style=\"margin: 0; font-size: 14px; color: #444;\">${invoiceDetails.issueDate}</p>\n            </div>\n          </div>\n          \n          <div style=\"margin-bottom: 25px;\">\n            <p style=\"margin: 0 0 5px 0; font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280;\">Cliente</p>\n            <p style=\"margin: 0; font-size: 16px; font-weight: 700; color: #0E1215;\">${name}</p>\n            <p style=\"margin: 5px 0 0 0; font-size: 14px; color: #6B7280;\">Pedido: ${orderNumber}</p>\n          </div>\n\n          <table style=\"width: 100%; border-collapse: collapse; margin: 25px 0;\">\n            <thead>\n              <tr style=\"background: #f9f9f9;\">\n                <th style=\"padding: 12px 0; text-align: left; font-size: 11px; font-weight: 800; text-transform: uppercase; color: #6B7280; border-bottom: 2px solid #e5e5e5;\">Descripci\u00F3n</th>\n                <th style=\"padding: 12px 0; text-align: center; font-size: 11px; font-weight: 800; text-transform: uppercase; color: #6B7280; border-bottom: 2px solid #e5e5e5;\">Cant.</th>\n                <th style=\"padding: 12px 0; text-align: right; font-size: 11px; font-weight: 800; text-transform: uppercase; color: #6B7280; border-bottom: 2px solid #e5e5e5;\">Precio</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${itemsHtml}\n            </tbody>\n          </table>\n\n          <div style=\"border-top: 2px solid #0E1215; padding-top: 15px; margin-top: 15px;\">\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\n              <span style=\"font-size: 14px; color: #6B7280;\">Subtotal</span>\n              <span style=\"font-size: 14px; color: #444;\">$${invoiceDetails.subtotal.toFixed(2)}</span>\n            </div>\n            ${invoiceDetails.tax ? `\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\n              <span style=\"font-size: 14px; color: #6B7280;\">Impuestos</span>\n              <span style=\"font-size: 14px; color: #444;\">$${invoiceDetails.tax.toFixed(2)}</span>\n            </div>\n            ` : \"\"}\n            <div style=\"display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #e5e5e5;\">\n              <span style=\"font-size: 16px; font-weight: 800; color: #0E1215;\">TOTAL</span>\n              <span style=\"font-size: 18px; font-weight: 900; color: #6EDC8A;\">$${invoiceDetails.total.toFixed(2)}</span>\n            </div>\n          </div>\n\n          <div style=\"background: #F0FDF4; padding: 20px; border-radius: 8px; margin-top: 30px; border: 1px solid #6EDC8A;\">\n            <p style=\"margin: 0; font-size: 14px; color: #065F46; text-align: center;\"><strong>Pago confirmado</strong> - Gracias por tu confianza</p>\n          </div>\n          \n          <p style=\"line-height: 1.6; font-size: 12px; color: #6B7280; margin-top: 25px; text-align: center;\">Este documento sirve como comprobante de pago. Para cualquier consulta sobre facturaci\u00F3n, contacta con nosotros.</p>\n        </div>\n        ${getEmailFooter()}\n      </div>\n    </div>\n  `;\n}\n\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST || \"smtp.ionos.es\",\n  port: parseInt(process.env.SMTP_PORT || \"587\"),\n  secure: false, // TLS\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASS,\n  },\n  tls: {\n    // do not fail on invalid certs\n    rejectUnauthorized: false\n  },\n  pool: true,\n  maxConnections: 5,\n  maxMessages: 100,\n});\n\nexport async function sendEmail({ to, subject, html }: { to: string; subject: string; html: string }) {\n  if (!process.env.SMTP_USER || !process.env.SMTP_PASS) {\n    console.warn(\"Email credentials missing. Email not sent.\");\n    return;\n  }\n\n  try {\n    const info = await transporter.sendMail({\n      from: `\"Easy US LLC\" <${process.env.SMTP_USER}>`,\n      to,\n      subject,\n      html,\n    });\n    console.log(\"Email sent: %s\", info.messageId);\n    return info;\n  } catch (error) {\n    console.error(\"Error sending email:\", error);\n    throw error;\n  }\n}\n", "import bcrypt from \"bcrypt\";\nimport crypto from \"crypto\";\nimport { db } from \"../db\";\nimport { users, passwordResetTokens, emailVerificationTokens } from \"@shared/models/auth\";\nimport { eq, and, gt } from \"drizzle-orm\";\nimport { sendEmail } from \"./email\";\n\nconst SALT_ROUNDS = 12;\nconst OTP_EXPIRY_MINUTES = 15;\nconst PASSWORD_RESET_EXPIRY_HOURS = 24;\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nexport function generateOtp(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport function generateToken(): string {\n  return crypto.randomBytes(32).toString(\"hex\");\n}\n\nexport function generateClientId(): string {\n  const prefix = \"CLI\";\n  const timestamp = Date.now().toString(36).toUpperCase();\n  const random = Math.random().toString(36).substring(2, 6).toUpperCase();\n  return `${prefix}-${timestamp}-${random}`;\n}\n\nexport async function createUser(data: {\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n  phone: string;\n  birthDate?: string;\n}): Promise<{ user: typeof users.$inferSelect; verificationToken: string }> {\n  const existingUser = await db.select().from(users).where(eq(users.email, data.email)).limit(1);\n  if (existingUser.length > 0) {\n    throw new Error(\"El email ya est\u00E1 registrado\");\n  }\n\n  const passwordHash = await hashPassword(data.password);\n  const clientId = generateClientId();\n  const isAdminEmail = data.email.toLowerCase() === process.env.ADMIN_EMAIL?.toLowerCase();\n\n  const [newUser] = await db.insert(users).values({\n    id: clientId,\n    email: data.email,\n    passwordHash,\n    firstName: data.firstName,\n    lastName: data.lastName,\n    phone: data.phone,\n    emailVerified: false,\n    isAdmin: isAdminEmail,\n  }).returning();\n\n  const verificationToken = generateOtp();\n  const expiresAt = new Date(Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000);\n\n  await db.insert(emailVerificationTokens).values({\n    userId: newUser.id,\n    token: verificationToken,\n    expiresAt,\n  });\n\n  // Send email but don't fail registration if email fails\n  try {\n    await sendEmail({\n      to: data.email,\n      subject: \"Bienvenido a Easy US LLC - Verifica tu cuenta\",\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #0E1215;\">\u00A1Bienvenido a Easy US LLC!</h1>\n          <p>Hola ${data.firstName},</p>\n          <p>Gracias por registrarte. Tu c\u00F3digo de verificaci\u00F3n es:</p>\n          <div style=\"background: #6EDC8A; color: #0E1215; font-size: 32px; font-weight: bold; padding: 20px; text-align: center; border-radius: 10px; margin: 20px 0;\">\n            ${verificationToken}\n          </div>\n          <p>Este c\u00F3digo expira en ${OTP_EXPIRY_MINUTES} minutos.</p>\n          <p>Tu ID de cliente es: <strong>${clientId}</strong></p>\n          <p>Saludos,<br>El equipo de Easy US LLC</p>\n        </div>\n      `,\n    });\n  } catch (emailError) {\n    console.error(\"Failed to send verification email:\", emailError);\n    // Continue with registration even if email fails\n  }\n\n  return { user: newUser, verificationToken };\n}\n\nexport async function verifyEmailToken(userId: string, token: string): Promise<boolean> {\n  const [tokenRecord] = await db\n    .select()\n    .from(emailVerificationTokens)\n    .where(\n      and(\n        eq(emailVerificationTokens.userId, userId),\n        eq(emailVerificationTokens.token, token),\n        eq(emailVerificationTokens.used, false),\n        gt(emailVerificationTokens.expiresAt, new Date())\n      )\n    )\n    .limit(1);\n\n  if (!tokenRecord) {\n    return false;\n  }\n\n  await db.update(emailVerificationTokens)\n    .set({ used: true })\n    .where(eq(emailVerificationTokens.id, tokenRecord.id));\n\n  await db.update(users)\n    .set({ emailVerified: true, updatedAt: new Date() })\n    .where(eq(users.id, userId));\n\n  return true;\n}\n\nexport async function loginUser(email: string, password: string): Promise<typeof users.$inferSelect | null> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  \n  if (!user || !user.passwordHash) {\n    return null;\n  }\n\n  // Check if user is deactivated\n  if (user.isActive === false) {\n    return null;\n  }\n\n  const isValid = await verifyPassword(password, user.passwordHash);\n  if (!isValid) {\n    return null;\n  }\n\n  return user;\n}\n\nexport async function createPasswordResetToken(email: string): Promise<string | null> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  \n  if (!user) {\n    return null;\n  }\n\n  const token = generateToken();\n  const expiresAt = new Date(Date.now() + PASSWORD_RESET_EXPIRY_HOURS * 60 * 60 * 1000);\n\n  await db.insert(passwordResetTokens).values({\n    userId: user.id,\n    token,\n    expiresAt,\n  });\n\n  const resetLink = `${process.env.BASE_URL || 'https://easyusllc.com'}/reset-password?token=${token}`;\n\n  try {\n    await sendEmail({\n      to: email,\n      subject: \"Easy US LLC - Recuperar contrase\u00F1a\",\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #0E1215;\">Recuperar contrase\u00F1a</h1>\n          <p>Hola ${user.firstName || ''},</p>\n          <p>Has solicitado restablecer tu contrase\u00F1a. Haz clic en el siguiente bot\u00F3n:</p>\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${resetLink}\" style=\"background: #6EDC8A; color: #0E1215; padding: 15px 30px; text-decoration: none; border-radius: 30px; font-weight: bold;\">\n              Restablecer contrase\u00F1a\n            </a>\n          </div>\n          <p>Este enlace expira en ${PASSWORD_RESET_EXPIRY_HOURS} horas.</p>\n          <p>Si no solicitaste este cambio, ignora este email.</p>\n          <p>Saludos,<br>El equipo de Easy US LLC</p>\n        </div>\n      `,\n    });\n  } catch (emailError) {\n    console.error(\"Failed to send password reset email:\", emailError);\n    // Still return token but email wasn't sent\n  }\n\n  return token;\n}\n\nexport async function resetPassword(token: string, newPassword: string): Promise<boolean> {\n  const [tokenRecord] = await db\n    .select()\n    .from(passwordResetTokens)\n    .where(\n      and(\n        eq(passwordResetTokens.token, token),\n        eq(passwordResetTokens.used, false),\n        gt(passwordResetTokens.expiresAt, new Date())\n      )\n    )\n    .limit(1);\n\n  if (!tokenRecord) {\n    return false;\n  }\n\n  const passwordHash = await hashPassword(newPassword);\n\n  await db.update(users)\n    .set({ passwordHash, updatedAt: new Date() })\n    .where(eq(users.id, tokenRecord.userId));\n\n  await db.update(passwordResetTokens)\n    .set({ used: true })\n    .where(eq(passwordResetTokens.id, tokenRecord.id));\n\n  return true;\n}\n\nexport async function resendVerificationEmail(userId: string): Promise<boolean> {\n  const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n  \n  if (!user || !user.email) {\n    return false;\n  }\n\n  const verificationToken = generateOtp();\n  const expiresAt = new Date(Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000);\n\n  await db.insert(emailVerificationTokens).values({\n    userId: user.id,\n    token: verificationToken,\n    expiresAt,\n  });\n\n  try {\n    await sendEmail({\n      to: user.email,\n      subject: \"Easy US LLC - C\u00F3digo de verificaci\u00F3n\",\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #0E1215;\">C\u00F3digo de verificaci\u00F3n</h1>\n          <p>Hola ${user.firstName || ''},</p>\n          <p>Tu nuevo c\u00F3digo de verificaci\u00F3n es:</p>\n          <div style=\"background: #6EDC8A; color: #0E1215; font-size: 32px; font-weight: bold; padding: 20px; text-align: center; border-radius: 10px; margin: 20px 0;\">\n            ${verificationToken}\n          </div>\n          <p>Este c\u00F3digo expira en ${OTP_EXPIRY_MINUTES} minutos.</p>\n          <p>Saludos,<br>El equipo de Easy US LLC</p>\n        </div>\n      `,\n    });\n  } catch (emailError) {\n    console.error(\"Failed to send verification email:\", emailError);\n    return false;\n  }\n\n  return true;\n}\n", "import crypto from \"crypto\";\n\nconst ALGORITHM = \"aes-256-cbc\";\nconst ENCRYPTION_KEY = process.env.ENCRYPTION_KEY || \"fallback_key_at_least_32_chars_long!!\"; \nconst IV_LENGTH = 16;\n\nexport function encrypt(text: string): string {\n  const iv = crypto.randomBytes(IV_LENGTH);\n  const cipher = crypto.createCipheriv(ALGORITHM, Buffer.from(ENCRYPTION_KEY.slice(0, 32)), iv);\n  let encrypted = cipher.update(text);\n  encrypted = Buffer.concat([encrypted, cipher.final()]);\n  return iv.toString(\"hex\") + \":\" + encrypted.toString(\"hex\");\n}\n\nexport function decrypt(text: string): string {\n  const textParts = text.split(\":\");\n  const iv = Buffer.from(textParts.shift()!, \"hex\");\n  const encryptedText = Buffer.from(textParts.join(\":\"), \"hex\");\n  const decipher = crypto.createDecipheriv(ALGORITHM, Buffer.from(ENCRYPTION_KEY.slice(0, 32)), iv);\n  let decrypted = decipher.update(encryptedText);\n  decrypted = Buffer.concat([decrypted, decipher.final()]);\n  return decrypted.toString();\n}\n", "import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\n\nconst rootDir = process.cwd();\n\nexport default defineConfig({\n  plugins: [\n    react(),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(rootDir, \"client\", \"src\"),\n      \"@shared\": path.resolve(rootDir, \"shared\"),\n      \"@assets\": path.resolve(rootDir, \"client\", \"src\", \"assets\"),\n    },\n  },\n  root: path.resolve(rootDir, \"client\"),\n  build: {\n    outDir: path.resolve(rootDir, \"dist/public\"),\n    emptyOutDir: true,\n    reportCompressedSize: false,\n    chunkSizeWarningLimit: 1000,\n    rollupOptions: {\n      output: {\n        manualChunks: {\n          vendor: ['react', 'react-dom', 'framer-motion'],\n          ui: ['lucide-react', '@radix-ui/react-dialog', '@radix-ui/react-select'],\n        }\n      }\n    }\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n    allowedHosts: true,\n  },\n});\n", "let urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\nexport { urlAlphabet }\n", "import crypto from 'crypto'\nimport { urlAlphabet } from './url-alphabet/index.js'\nconst POOL_SIZE_MULTIPLIER = 128\nlet pool, poolOffset\nlet fillPool = bytes => {\n  if (!pool || pool.length < bytes) {\n    pool = Buffer.allocUnsafe(bytes * POOL_SIZE_MULTIPLIER)\n    crypto.randomFillSync(pool)\n    poolOffset = 0\n  } else if (poolOffset + bytes > pool.length) {\n    crypto.randomFillSync(pool)\n    poolOffset = 0\n  }\n  poolOffset += bytes\n}\nlet random = bytes => {\n  fillPool((bytes |= 0))\n  return pool.subarray(poolOffset - bytes, poolOffset)\n}\nlet customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (31 - Math.clz32((alphabet.length - 1) | 1))) - 1\n  let step = Math.ceil((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let i = step\n      while (i--) {\n        id += alphabet[bytes[i] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nlet customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nlet nanoid = (size = 21) => {\n  fillPool((size |= 0))\n  let id = ''\n  for (let i = poolOffset - size; i < poolOffset; i++) {\n    id += urlAlphabet[pool[i] & 63]\n  }\n  return id\n}\nexport { nanoid, customAlphabet, customRandom, urlAlphabet, random }\n", "import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst rootDir = process.cwd();\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        rootDir,\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n", "import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport compression from \"compression\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\napp.use(compression());\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  res.setHeader(\"X-Content-Type-Options\", \"nosniff\");\n  res.setHeader(\"X-Frame-Options\", \"DENY\");\n  res.setHeader(\"X-XSS-Protection\", \"1; mode=block\");\n  res.setHeader(\"Strict-Transport-Security\", \"max-age=31536000; includeSubDomains\");\n  res.setHeader(\"Content-Security-Policy\", \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://*.stripe.com; connect-src 'self' https://api.stripe.com; frame-src 'self' https://js.stripe.com;\");\n  res.setHeader(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n  res.setHeader(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\");\n  // Performance Headers\n  if (req.method === 'GET') {\n    const isAsset = req.path.startsWith('/assets/') || req.path.match(/\\.(jpg|jpeg|png|gif|svg|webp|ico|css|js|woff2|woff)$/);\n    if (isAsset) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n    }\n  }\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    if (!res.headersSent) {\n      res.status(status).json({ message });\n    }\n    \n    // Log error for debugging but don't re-throw to prevent unhandled rejections\n    console.error(`[Error ${status}]`, message, err.stack || '');\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n", "import type { Express, RequestHandler } from \"express\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { db } from \"../db\";\nimport { users } from \"@shared/models/auth\";\nimport { eq } from \"drizzle-orm\";\nimport {\n  createUser,\n  loginUser,\n  verifyEmailToken,\n  createPasswordResetToken,\n  resetPassword,\n  resendVerificationEmail,\n} from \"./auth-service\";\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  const isProduction = process.env.NODE_ENV === \"production\" || process.env.REPLIT_ENVIRONMENT === \"production\";\n  \n  return session({\n    secret: process.env.SESSION_SECRET || \"easy-us-llc-secret-key-2024\",\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: isProduction,\n      maxAge: sessionTtl,\n      sameSite: isProduction ? \"none\" : \"lax\",\n    },\n  });\n}\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n    email: string;\n    isAdmin: boolean;\n  }\n}\n\nexport function setupCustomAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n\n  // Register endpoint\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, phone, birthDate } = req.body;\n\n      if (!email || !password || !firstName || !lastName || !phone) {\n        return res.status(400).json({ message: \"Todos los campos son obligatorios\" });\n      }\n\n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres\" });\n      }\n\n      const { user } = await createUser({\n        email,\n        password,\n        firstName,\n        lastName,\n        phone,\n        birthDate,\n      });\n\n      req.session.userId = user.id;\n      req.session.email = user.email!;\n      req.session.isAdmin = user.isAdmin;\n\n      // Save session explicitly before responding\n      req.session.save((err) => {\n        if (err) {\n          console.error(\"Session save error:\", err);\n          return res.status(500).json({ message: \"Error al guardar la sesi\u00F3n\" });\n        }\n        \n        res.json({\n          success: true,\n          user: {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            emailVerified: user.emailVerified,\n          },\n          message: \"Cuenta creada. Revisa tu email para verificar tu cuenta.\",\n        });\n      });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(400).json({ message: error.message || \"Error al crear la cuenta\" });\n    }\n  });\n\n  // Login endpoint\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ message: \"Email y contrase\u00F1a son obligatorios\" });\n      }\n\n      const user = await loginUser(email, password);\n\n      if (!user) {\n        return res.status(401).json({ message: \"Email o contrase\u00F1a incorrectos\" });\n      }\n\n      req.session.userId = user.id;\n      req.session.email = user.email!;\n      req.session.isAdmin = user.isAdmin;\n\n      // Save session explicitly before responding\n      req.session.save((err) => {\n        if (err) {\n          console.error(\"Session save error:\", err);\n          return res.status(500).json({ message: \"Error al guardar la sesi\u00F3n\" });\n        }\n        \n        res.json({\n          success: true,\n          user: {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            phone: user.phone,\n            emailVerified: user.emailVerified,\n            isAdmin: user.isAdmin,\n          },\n        });\n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Error al iniciar sesi\u00F3n\" });\n    }\n  });\n\n  // Logout endpoint\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ message: \"Error al cerrar sesi\u00F3n\" });\n      }\n      res.clearCookie(\"connect.sid\");\n      res.json({ success: true });\n    });\n  });\n\n  // Also support GET for logout redirect\n  app.get(\"/api/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      res.clearCookie(\"connect.sid\");\n      res.redirect(\"/\");\n    });\n  });\n\n  // Verify email endpoint\n  app.post(\"/api/auth/verify-email\", async (req, res) => {\n    try {\n      const { code } = req.body;\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const success = await verifyEmailToken(userId, code);\n\n      if (!success) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o expirado\" });\n      }\n\n      res.json({ success: true, message: \"Email verificado correctamente\" });\n    } catch (error) {\n      console.error(\"Verify email error:\", error);\n      res.status(500).json({ message: \"Error al verificar el email\" });\n    }\n  });\n\n  // Resend verification email\n  app.post(\"/api/auth/resend-verification\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const success = await resendVerificationEmail(userId);\n\n      if (!success) {\n        return res.status(400).json({ message: \"Error al enviar el c\u00F3digo\" });\n      }\n\n      res.json({ success: true, message: \"C\u00F3digo enviado\" });\n    } catch (error) {\n      console.error(\"Resend verification error:\", error);\n      res.status(500).json({ message: \"Error al enviar el c\u00F3digo\" });\n    }\n  });\n\n  // Request password reset\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ message: \"Email es obligatorio\" });\n      }\n\n      await createPasswordResetToken(email);\n\n      // Always return success to prevent email enumeration\n      res.json({\n        success: true,\n        message: \"Si el email existe en nuestro sistema, recibir\u00E1s instrucciones para restablecer tu contrase\u00F1a\",\n      });\n    } catch (error) {\n      console.error(\"Forgot password error:\", error);\n      res.status(500).json({ message: \"Error al procesar la solicitud\" });\n    }\n  });\n\n  // Reset password with token\n  app.post(\"/api/auth/reset-password\", async (req, res) => {\n    try {\n      const { token, password } = req.body;\n\n      if (!token || !password) {\n        return res.status(400).json({ message: \"Token y contrase\u00F1a son obligatorios\" });\n      }\n\n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres\" });\n      }\n\n      const success = await resetPassword(token, password);\n\n      if (!success) {\n        return res.status(400).json({ message: \"Token inv\u00E1lido o expirado\" });\n      }\n\n      res.json({ success: true, message: \"Contrase\u00F1a actualizada correctamente\" });\n    } catch (error) {\n      console.error(\"Reset password error:\", error);\n      res.status(500).json({ message: \"Error al actualizar la contrase\u00F1a\" });\n    }\n  });\n\n  // Get current user\n  app.get(\"/api/auth/user\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n\n      if (!user) {\n        req.session.destroy(() => {});\n        return res.status(401).json({ message: \"Usuario no encontrado\" });\n      }\n\n      res.json({\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        phone: user.phone,\n        address: user.address,\n        streetType: user.streetType,\n        city: user.city,\n        province: user.province,\n        postalCode: user.postalCode,\n        country: user.country,\n        businessActivity: user.businessActivity,\n        idNumber: user.idNumber,\n        idType: user.idType,\n        birthDate: user.birthDate,\n        emailVerified: user.emailVerified,\n        isAdmin: user.isAdmin,\n        accountStatus: user.accountStatus,\n        profileImageUrl: user.profileImageUrl,\n        createdAt: user.createdAt,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ message: \"Error al obtener el usuario\" });\n    }\n  });\n\n  // Update user profile\n  app.patch(\"/api/auth/user\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const { firstName, lastName, phone, address, businessActivity } = req.body;\n\n      await db.update(users)\n        .set({\n          firstName,\n          lastName,\n          phone,\n          address,\n          businessActivity,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, userId));\n\n      const [updatedUser] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n\n      res.json({\n        success: true,\n        user: {\n          id: updatedUser.id,\n          email: updatedUser.email,\n          firstName: updatedUser.firstName,\n          lastName: updatedUser.lastName,\n          phone: updatedUser.phone,\n          address: updatedUser.address,\n          businessActivity: updatedUser.businessActivity,\n          emailVerified: updatedUser.emailVerified,\n        },\n      });\n    } catch (error) {\n      console.error(\"Update user error:\", error);\n      res.status(500).json({ message: \"Error al actualizar el perfil\" });\n    }\n  });\n}\n\nexport const isAuthenticated: RequestHandler = (req, res, next) => {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"No autenticado\" });\n  }\n  next();\n};\n\nexport const isAdmin: RequestHandler = async (req, res, next) => {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"No autenticado\" });\n  }\n\n  const [user] = await db.select().from(users).where(eq(users.id, req.session.userId)).limit(1);\n\n  if (!user || !user.isAdmin) {\n    return res.status(403).json({ message: \"No autorizado\" });\n  }\n\n  next();\n};\n", "import { db } from \"./db\";\nimport { sql } from \"drizzle-orm\";\nimport {\n  products, orders, llcApplications, applicationDocuments, newsletterSubscribers,\n  maintenanceApplications, messages as messagesTable,\n  type Product, type Order, type LlcApplication, type ApplicationDocument,\n  insertLlcApplicationSchema, insertApplicationDocumentSchema, insertOrderSchema\n} from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\ntype InsertOrder = z.infer<typeof insertOrderSchema>;\ntype InsertLlcApplication = z.infer<typeof insertLlcApplicationSchema>;\ntype InsertApplicationDocument = z.infer<typeof insertApplicationDocumentSchema>;\n\nexport interface IStorage {\n  // Products\n  getProducts(): Promise<Product[]>;\n  getProduct(id: number): Promise<Product | undefined>;\n  createProduct(product: Omit<Product, \"id\">): Promise<Product>;\n\n  // Orders\n  createOrder(order: InsertOrder): Promise<Order>;\n  getOrders(userId: string): Promise<(Order & { product: Product; application: LlcApplication | null })[]>;\n  getOrder(id: number): Promise<(Order & { product?: Product; application?: LlcApplication; user?: any }) | undefined>;\n\n  // LLC Applications\n  createLlcApplication(app: InsertLlcApplication): Promise<LlcApplication>;\n  getLlcApplication(id: number): Promise<LlcApplication | undefined>;\n  getLlcApplicationByOrderId(orderId: number): Promise<LlcApplication | undefined>;\n  getLlcApplicationByRequestCode(code: string): Promise<(LlcApplication & { documents: ApplicationDocument[] }) | undefined>;\n  updateLlcApplication(id: number, updates: Partial<LlcApplication>): Promise<LlcApplication>;\n  setOtp(type: 'llc' | 'maintenance', id: number, otp: string, expires: Date): Promise<void>;\n  verifyOtp(type: 'llc' | 'maintenance', id: number, otp: string): Promise<boolean>;\n\n  // Documents\n  createDocument(doc: InsertApplicationDocument): Promise<ApplicationDocument>;\n  getDocumentsByApplicationId(applicationId: number): Promise<ApplicationDocument[]>;\n  deleteDocument(id: number): Promise<void>;\n\n  // Newsletter\n  subscribeToNewsletter(email: string): Promise<void>;\n  isSubscribedToNewsletter(email: string): Promise<boolean>;\n\n  // Admin\n  getAllOrders(): Promise<(Order & { product: Product; application: LlcApplication | null; user: any })[]>;\n  updateOrderStatus(orderId: number, status: string): Promise<Order>;\n\n  // Messages\n  createMessage(message: any): Promise<any>;\n  getMessagesByUserId(userId: string): Promise<any[]>;\n  getAllMessages(): Promise<any[]>;\n  updateMessageStatus(id: number, status: string): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Products\n  async getProducts(): Promise<Product[]> {\n    return await db.select().from(products).orderBy(products.price);\n  }\n\n  async getProduct(id: number): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product;\n  }\n\n  async createProduct(product: Omit<Product, \"id\">): Promise<Product> {\n    const [newProduct] = await db.insert(products).values(product).returning();\n    return newProduct;\n  }\n\n  // Orders\n  async createOrder(order: InsertOrder): Promise<Order> {\n    const [newOrder] = await db.insert(orders).values(order).returning();\n    return newOrder;\n  }\n\n  async getOrders(userId?: string): Promise<any[]> {\n    if (userId) {\n      return await db.query.orders.findMany({\n        where: eq(orders.userId, userId),\n        with: {\n          product: true,\n          application: true,\n        },\n        orderBy: desc(orders.createdAt),\n      });\n    }\n    return await db.query.orders.findMany({\n      with: {\n        product: true,\n        application: true,\n        user: true,\n      },\n      orderBy: desc(orders.createdAt),\n    });\n  }\n\n  async getOrder(id: number): Promise<(Order & { product?: Product; application?: LlcApplication; user?: any }) | undefined> {\n    const result = await db.query.orders.findFirst({\n      where: eq(orders.id, id),\n      with: {\n        product: true,\n        application: true,\n        user: true,\n      },\n    });\n    return result;\n  }\n\n  // LLC Applications\n  async createLlcApplication(app: z.infer<typeof insertLlcApplicationSchema>): Promise<LlcApplication> {\n    const [newApp] = await db.insert(llcApplications).values(app).returning();\n    return newApp;\n  }\n\n  async getLlcApplication(id: number): Promise<LlcApplication | undefined> {\n    const [app] = await db.select().from(llcApplications).where(eq(llcApplications.id, id));\n    return app;\n  }\n\n  async getLlcApplicationByOrderId(orderId: number): Promise<LlcApplication | undefined> {\n    const [app] = await db.select().from(llcApplications).where(eq(llcApplications.orderId, orderId));\n    return app;\n  }\n\n  async getLlcApplicationByRequestCode(code: string): Promise<(LlcApplication & { documents: ApplicationDocument[] }) | undefined> {\n    const result = await db.query.llcApplications.findFirst({\n      where: eq(llcApplications.requestCode, code),\n      with: {\n        documents: true,\n      },\n    });\n    return result as (LlcApplication & { documents: ApplicationDocument[] }) | undefined;\n  }\n\n  async updateLlcApplication(id: number, updates: Partial<LlcApplication>): Promise<LlcApplication> {\n    const [updated] = await db\n      .update(llcApplications)\n      .set({ ...updates, lastUpdated: new Date() })\n      .where(eq(llcApplications.id, id))\n      .returning();\n    return updated;\n  }\n\n  async setOtp(type: 'llc' | 'maintenance', id: number, otp: string, expires: Date): Promise<void> {\n    const table = type === 'llc' ? llcApplications : maintenanceApplications;\n    await db\n      .update(table)\n      .set({ emailOtp: otp, emailOtpExpires: expires })\n      .where(eq(table.id, id));\n  }\n\n  async verifyOtp(type: 'llc' | 'maintenance', id: number, otp: string): Promise<boolean> {\n    const table = type === 'llc' ? llcApplications : maintenanceApplications;\n    const [app] = await db\n      .select()\n      .from(table)\n      .where(eq(table.id, id));\n    \n    if (!app || !app.emailOtp || !app.emailOtpExpires) return false;\n    \n    if (app.emailOtp === otp && new Date() < app.emailOtpExpires) {\n      await db\n        .update(table)\n        .set({ emailVerified: true, emailOtp: null, emailOtpExpires: null })\n        .where(eq(table.id, id));\n      return true;\n    }\n    return false;\n  }\n\n  // Documents\n  async createDocument(doc: InsertApplicationDocument): Promise<ApplicationDocument> {\n    const [newDoc] = await db.insert(applicationDocuments).values(doc).returning();\n    return newDoc;\n  }\n\n  async getDocumentsByApplicationId(applicationId: number): Promise<ApplicationDocument[]> {\n    return await db.select().from(applicationDocuments).where(eq(applicationDocuments.applicationId, applicationId));\n  }\n\n  async deleteDocument(id: number): Promise<void> {\n    await db.delete(applicationDocuments).where(eq(applicationDocuments.id, id));\n  }\n\n  // Newsletter\n  async subscribeToNewsletter(email: string): Promise<void> {\n    const subscribed = await this.isSubscribedToNewsletter(email);\n    if (!subscribed) {\n      await db.insert(newsletterSubscribers).values({ email });\n    }\n  }\n\n  async isSubscribedToNewsletter(email: string): Promise<boolean> {\n    const [subscriber] = await db.select().from(newsletterSubscribers).where(eq(newsletterSubscribers.email, email));\n    return !!subscriber;\n  }\n\n  // Admin methods\n  async getAllOrders(): Promise<(Order & { product: Product; application: LlcApplication | null; user: any })[]> {\n    return await db.query.orders.findMany({\n      with: {\n        product: true,\n        application: true,\n        user: true,\n      },\n      orderBy: desc(orders.createdAt),\n    });\n  }\n\n  async updateOrderStatus(orderId: number, status: string): Promise<Order> {\n    const [updated] = await db\n      .update(orders)\n      .set({ status })\n      .where(eq(orders.id, orderId))\n      .returning();\n    return updated;\n  }\n\n  // Messages\n  async createMessage(message: any): Promise<any> {\n    const { encrypt } = await import(\"./utils/encryption\");\n    const year = new Date().getFullYear();\n    const count = await db.select({ count: sql<number>`count(*)` }).from(messagesTable);\n    const msgId = `MSG-${year}-${String(Number(count[0].count) + 1).padStart(4, '0')}`;\n    \n    const encryptedContent = encrypt(message.content);\n    const [newMessage] = await db.insert(messagesTable).values({\n      ...message,\n      messageId: msgId,\n      encryptedContent\n    }).returning();\n    return newMessage;\n  }\n\n  async getMessagesByUserId(userId: string): Promise<any[]> {\n    return await db.select().from(messagesTable)\n      .where(eq(messagesTable.userId, userId))\n      .orderBy(desc(messagesTable.createdAt));\n  }\n\n  async getAllMessages(): Promise<any[]> {\n    return await db.query.messages.findMany({\n      orderBy: desc(messagesTable.createdAt),\n      with: {\n        replies: true\n      }\n    });\n  }\n\n  async updateMessageStatus(id: number, status: string): Promise<any> {\n    const [updated] = await db.update(messagesTable)\n      .set({ status })\n      .where(eq(messagesTable.id, id))\n      .returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n", "import { z } from 'zod';\nimport { insertLlcApplicationSchema, insertApplicationDocumentSchema, products, orders, llcApplications, applicationDocuments } from './schema';\n\nexport const errorSchemas = {\n  validation: z.object({\n    message: z.string(),\n    field: z.string().optional(),\n  }),\n  notFound: z.object({\n    message: z.string(),\n  }),\n  internal: z.object({\n    message: z.string(),\n  }),\n  unauthorized: z.object({\n    message: z.string(),\n  }),\n};\n\nexport const api = {\n  products: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/products',\n      responses: {\n        200: z.array(z.custom<typeof products.$inferSelect>()),\n      },\n    },\n    get: {\n      method: 'GET' as const,\n      path: '/api/products/:id',\n      responses: {\n        200: z.custom<typeof products.$inferSelect>(),\n        404: errorSchemas.notFound,\n      },\n    }\n  },\n  orders: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/orders',\n      responses: {\n        200: z.array(z.custom<typeof orders.$inferSelect & { product: typeof products.$inferSelect; application: typeof llcApplications.$inferSelect | null }>()),\n        401: errorSchemas.unauthorized,\n      },\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/orders',\n      input: z.object({\n        productId: z.number(),\n      }),\n      responses: {\n        201: z.custom<typeof orders.$inferSelect>(),\n        400: errorSchemas.validation,\n        401: errorSchemas.unauthorized,\n      },\n    },\n  },\n  llc: {\n    get: {\n      method: 'GET' as const,\n      path: '/api/llc/:id',\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect>(),\n        404: errorSchemas.notFound,\n        401: errorSchemas.unauthorized,\n      },\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/llc/:id',\n      input: insertLlcApplicationSchema.partial(),\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect>(),\n        400: errorSchemas.validation,\n        401: errorSchemas.unauthorized,\n        404: errorSchemas.notFound,\n      },\n    },\n    getByCode: {\n      method: 'GET' as const,\n      path: '/api/llc/code/:code',\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect & { documents: (typeof applicationDocuments.$inferSelect)[] }>(),\n        404: errorSchemas.notFound,\n      },\n    },\n  },\n  documents: {\n    create: {\n      method: 'POST' as const,\n      path: '/api/documents',\n      input: insertApplicationDocumentSchema,\n      responses: {\n        201: z.custom<typeof applicationDocuments.$inferSelect>(),\n        400: errorSchemas.validation,\n        404: errorSchemas.notFound,\n      },\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/documents/:id',\n      responses: {\n        200: z.object({ success: z.boolean() }),\n        404: errorSchemas.notFound,\n      },\n    },\n  },\n};\n\nexport function buildUrl(path: string, params?: Record<string, string | number>): string {\n  let url = path;\n  if (params) {\n    Object.entries(params).forEach(([key, value]) => {\n      if (url.includes(`:${key}`)) {\n        url = url.replace(`:${key}`, String(value));\n      }\n    });\n  }\n  return url;\n}\n", "import type { Express } from \"express\";\nimport type { Server } from \"http\";\nimport { setupCustomAuth, isAuthenticated, isAdmin } from \"./lib/custom-auth\";\nimport { storage } from \"./storage\";\nimport { api } from \"@shared/routes\";\nimport { z } from \"zod\";\nimport { insertLlcApplicationSchema } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { sendEmail, getOtpEmailTemplate, getConfirmationEmailTemplate, getReminderEmailTemplate, getWelcomeEmailTemplate, getNewsletterWelcomeTemplate, getAutoReplyTemplate, getEmailFooter, getEmailHeader } from \"./lib/email\";\nimport { contactOtps, products as productsTable, users as usersTable, maintenanceApplications, newsletterSubscribers, messages as messagesTable, orderEvents, messageReplies, userNotifications, orders as ordersTable, llcApplications as llcApplicationsTable } from \"@shared/schema\";\nimport { and, eq, gt, desc, sql } from \"drizzle-orm\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Rate limiting simulation / protection\n  const rateLimit = new Map<string, number[]>();\n  app.use(\"/api/\", (req, res, next) => {\n    const now = Date.now();\n    const ip = req.ip || \"unknown\";\n    const windowMs = 60000;\n    const maxRequests = 100;\n    \n    const timestamps = rateLimit.get(ip) || [];\n    const validTimestamps = timestamps.filter(t => now - t < windowMs);\n    \n    if (validTimestamps.length >= maxRequests) {\n      return res.status(429).json({ message: \"Demasiadas peticiones. Por favor, espera un minuto.\" });\n    }\n    \n    validTimestamps.push(now);\n    rateLimit.set(ip, validTimestamps);\n    next();\n  });\n\n  // Set up Custom Auth\n  setupCustomAuth(app);\n\n    // Unified activity log helper\n    const logActivity = (title: string, data: any) => {\n      if (process.env.NODE_ENV === 'development') {\n        console.log(`[LOG] ${title}:`, data);\n      }\n      sendEmail({\n        to: \"afortuny07@gmail.com\",\n        subject: `[LOG] ${title}`,\n        html: `\n          <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n            <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n              ${getEmailHeader()}\n              <div style=\"padding: 40px;\">\n                <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">${title}</h2>\n                <div style=\"background: #f4f4f4; border-left: 4px solid #6EDC8A; padding: 20px; margin: 20px 0;\">\n                  ${Object.entries(data).map(([k, v]) => `<p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>${k}:</strong> ${v}</p>`).join('')}\n                </div>\n                <p style=\"font-size: 12px; color: #999;\">Fecha: ${new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid' })}</p>\n              </div>\n              ${getEmailFooter()}\n            </div>\n          </div>\n        `,\n      }).catch(e => console.error(\"Log error:\", e));\n    };\n\n    // === Activity Tracking ===\n    app.post(\"/api/activity/track\", async (req, res) => {\n      const { action, details } = req.body;\n      if (action === \"CLICK_ELEGIR_ESTADO\") {\n        logActivity(\"Selecci\u00F3n de Estado\", { \"Detalles\": details, \"IP\": req.ip });\n      }\n      res.json({ success: true });\n    });\n\n  // === API Routes ===\n\n  // Admin Orders\n  app.get(\"/api/admin/orders\", isAdmin, async (req, res) => {\n    try {\n      const allOrders = await storage.getAllOrders();\n      res.json(allOrders);\n    } catch (error) {\n      console.error(\"Admin orders error:\", error);\n      res.status(500).json({ message: \"Error fetching orders\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/status\", isAdmin, async (req, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const { status } = z.object({ status: z.string() }).parse(req.body);\n      const updatedOrder = await storage.updateOrderStatus(orderId, status);\n      \n      const order = await storage.getOrder(orderId);\n      if (order?.user?.email) {\n        sendEmail({\n          to: order.user.email,\n          subject: `Actualizaci\u00F3n de tu pedido ${order.application?.requestCode || `#${order.id}`}`,\n          html: getOrderUpdateTemplate(\n            order.user.firstName || \"Cliente\",\n            order.application?.requestCode || `#${order.id}`,\n            status,\n            `Tu pedido ha pasado a estado: ${status.replace(/_/g, \" \")}`\n          )\n        }).catch(console.error);\n      }\n      res.json(updatedOrder);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating status\" });\n    }\n  });\n\n  // Admin Users\n  app.get(\"/api/admin/users\", isAdmin, async (req, res) => {\n    try {\n      const users = await db.select().from(usersTable).orderBy(desc(usersTable.createdAt));\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching users\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id\", isAdmin, async (req, res) => {\n    try {\n      const { accountStatus, isAdmin: promoteAdmin } = req.body;\n      const [updatedUser] = await db.update(usersTable)\n        .set({ accountStatus, isAdmin: promoteAdmin, updatedAt: new Date() })\n        .where(eq(usersTable.id, req.params.id))\n        .returning();\n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating user\" });\n    }\n  });\n\n  // Admin Newsletter\n  app.get(\"/api/admin/newsletter\", isAdmin, async (req, res) => {\n    try {\n      const subscribers = await db.select().from(newsletterSubscribers).orderBy(desc(newsletterSubscribers.subscribedAt));\n      res.json(subscribers);\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  // Admin Messages\n  app.get(\"/api/admin/messages\", isAdmin, async (req, res) => {\n    try {\n      const allMessages = await storage.getAllMessages();\n      res.json(allMessages);\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  app.patch(\"/api/admin/messages/:id/status\", isAdmin, async (req, res) => {\n    try {\n      const updated = await storage.updateMessageStatus(Number(req.params.id), req.body.status);\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  // Document Requests\n  app.post(\"/api/admin/request-document\", isAdmin, async (req, res) => {\n    try {\n      const { email, documentType, message } = req.body;\n      const { getActionRequiredTemplate } = await import(\"./lib/email\");\n      \n      await sendEmail({\n        to: email,\n        subject: \"Acci\u00F3n Requerida: Documentaci\u00F3n para tu LLC\",\n        html: getActionRequiredTemplate(\"Cliente\", \"Solicitud de Documentos\", message || `Necesitamos tu ${documentType} para continuar.`)\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al solicitar documento\" });\n    }\n  });\n\n  // Custom Notes/Messages to Clients\n  app.post(\"/api/admin/send-note\", isAdmin, async (req, res) => {\n    try {\n      const { userId, title, message, type, sendEmail: shouldSendEmail } = req.body;\n      \n      await db.insert(userNotifications).values({\n        userId,\n        title,\n        message,\n        type: type || 'info',\n        isRead: false\n      });\n      \n      if (shouldSendEmail) {\n        const [targetUser] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n        if (targetUser?.email) {\n          const { getNoteReceivedTemplate } = await import(\"./lib/email\");\n          await sendEmail({\n            to: targetUser.email,\n            subject: `Nuevo mensaje de Easy US LLC: ${title}`,\n            html: getNoteReceivedTemplate(targetUser.firstName || \"Cliente\", message)\n          });\n        }\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Send note error:\", error);\n      res.status(500).json({ message: \"Error al enviar nota\" });\n    }\n  });\n\n  // Products\n  app.get(api.products.list.path, async (req, res) => {\n    const products = await storage.getProducts();\n    res.json(products);\n  });\n\n  // Secure Admin Seeding - Promotes ADMIN_EMAIL user to admin role (protected by secret token)\n  app.post(\"/api/seed-admin\", async (req, res) => {\n    try {\n      const adminEmail = process.env.ADMIN_EMAIL || \"afortuny07@gmail.com\";\n      \n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, adminEmail)).limit(1);\n      if (!existingUser) {\n        return res.status(404).json({ message: \"Admin user not found. Please register first.\" });\n      }\n      \n      await db.update(usersTable).set({ isAdmin: true, accountStatus: 'active' }).where(eq(usersTable.email, adminEmail));\n      res.json({ success: true, message: \"Admin role assigned successfully\" });\n    } catch (error) {\n      console.error(\"Seed admin error:\", error);\n      res.status(500).json({ message: \"Error seeding admin\" });\n    }\n  });\n\n  // Client Delete Account\n  app.delete(\"/api/user/account\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      await db.delete(usersTable).where(eq(usersTable.id, userId));\n      req.session.destroy(() => {});\n      res.json({ success: true, message: \"Cuenta eliminada correctamente\" });\n    } catch (error) {\n      console.error(\"Delete account error:\", error);\n      res.status(500).json({ message: \"Error deleting account\" });\n    }\n  });\n\n  // Client Update Profile\n  const updateProfileSchema = z.object({\n    firstName: z.string().optional(),\n    lastName: z.string().optional(),\n    phone: z.string().optional(),\n    businessActivity: z.string().optional(),\n    address: z.string().optional(),\n    streetType: z.string().optional(),\n    city: z.string().optional(),\n    province: z.string().optional(),\n    postalCode: z.string().optional(),\n    country: z.string().optional(),\n    idNumber: z.string().optional(),\n    idType: z.string().optional(),\n    birthDate: z.string().optional(),\n  });\n  \n  app.patch(\"/api/user/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      const validatedData = updateProfileSchema.parse(req.body);\n      \n      await db.update(usersTable).set(validatedData).where(eq(usersTable.id, userId));\n      \n      const [updatedUser] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      res.json(updatedUser);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      console.error(\"Update profile error:\", error);\n      res.status(500).json({ message: \"Error updating profile\" });\n    }\n  });\n\n  // User notifications\n  app.get(\"/api/user/notifications\", isAuthenticated, async (req: any, res) => {\n    try {\n      const notifications = await db.select().from(userNotifications)\n        .where(eq(userNotifications.userId, req.session.userId))\n        .orderBy(desc(userNotifications.createdAt));\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ message: \"Error al obtener notificaciones\" });\n    }\n  });\n\n  app.patch(\"/api/user/notifications/:id/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      await db.update(userNotifications)\n        .set({ isRead: true })\n        .where(and(eq(userNotifications.id, req.params.id), eq(userNotifications.userId, req.session.userId)));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  // Change password\n  app.post(\"/api/user/change-password\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { currentPassword, newPassword } = z.object({\n        currentPassword: z.string().min(1),\n        newPassword: z.string().min(8)\n      }).parse(req.body);\n      \n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId));\n      if (!user?.passwordHash) {\n        return res.status(400).json({ message: \"No se puede cambiar la contrase\u00F1a\" });\n      }\n      \n      const { verifyPassword, hashPassword } = await import(\"./lib/auth-service\");\n      const isValid = await verifyPassword(currentPassword, user.passwordHash);\n      if (!isValid) {\n        return res.status(400).json({ message: \"Contrase\u00F1a actual incorrecta\" });\n      }\n      \n      const newHash = await hashPassword(newPassword);\n      await db.update(usersTable).set({ passwordHash: newHash, updatedAt: new Date() }).where(eq(usersTable.id, req.session.userId));\n      \n      res.json({ success: true });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Datos inv\u00E1lidos\" });\n      }\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ message: \"Error al cambiar contrase\u00F1a\" });\n    }\n  });\n\n  app.get(api.products.get.path, async (req, res) => {\n    const product = await storage.getProduct(Number(req.params.id));\n    if (!product) return res.status(404).json({ message: \"Product not found\" });\n    res.json(product);\n  });\n\n  // Orders (Requires authentication)\n  app.get(api.orders.list.path, async (req: any, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    const orders = await storage.getOrders(req.session.userId);\n    res.json(orders);\n  });\n\n  app.post(api.orders.create.path, async (req: any, res) => {\n    try {\n      const { productId } = api.orders.create.input.parse(req.body);\n      \n      let userId: string;\n      \n      if (req.session?.userId) {\n        userId = req.session.userId;\n      } else {\n        // Create a guest user record\n        const guestId = `guest_${Date.now()}_${Math.random().toString(36).substring(7)}`;\n        await db.insert(usersTable).values({\n          id: guestId,\n          email: null,\n          firstName: \"Guest\",\n          lastName: \"User\",\n        });\n        userId = guestId;\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product) {\n        return res.status(400).json({ message: \"Invalid product\" });\n      }\n\n      // CRITICAL: Ensure pricing follows NM 639, WY 799, DE 999\n      let finalPrice = product.price;\n      if (product.name.includes(\"New Mexico\")) finalPrice = 63900;\n      else if (product.name.includes(\"Wyoming\")) finalPrice = 79900;\n      else if (product.name.includes(\"Delaware\")) finalPrice = 99900;\n\n      // Create the order\n      const order = await storage.createOrder({\n        userId,\n        productId,\n        amount: finalPrice,\n        status: \"pending\",\n        stripeSessionId: \"mock_session_\" + Date.now(),\n      });\n\n      // Create an empty application linked to the order\n      const application = await storage.createLlcApplication({\n        orderId: order.id,\n        status: \"draft\",\n        state: product.name.split(\" \")[0], // Extract state name correctly\n      });\n\n      // Generate unified request code: NM-YYXX-XXXX (year + sequential ID, no random)\n      let statePrefix = \"NM\";\n      if (product.name.includes(\"Wyoming\")) statePrefix = \"WY\";\n      else if (product.name.includes(\"Delaware\")) statePrefix = \"DE\";\n      else if (product.name.includes(\"Mantenimiento\") || product.name.includes(\"Maintenance\")) statePrefix = \"MN\";\n      \n      const year = new Date().getFullYear().toString().slice(-2);\n      const orderNum = String(order.id).padStart(6, '0');\n      const requestCode = `${statePrefix}-${year}${orderNum.slice(0, 2)}-${orderNum.slice(2)}`;\n\n      const updatedApplication = await storage.updateLlcApplication(application.id, { requestCode });\n\n      // Notification to admin about NEW ORDER\n      logActivity(\"Nuevo Pedido Recibido\", {\n        \"Referencia\": requestCode,\n        \"Producto\": product.name,\n        \"Importe\": `${(finalPrice / 100).toFixed(2)}\u20AC`,\n        \"Usuario\": userId,\n        \"IP\": req.ip\n      });\n\n      // Return order with application\n      res.status(201).json({ ...order, application: updatedApplication });\n\n      // Send welcome email if user is authenticated and has email\n      if (req.session?.email) {\n        const [userData] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId)).limit(1);\n        if (userData?.email) {\n          sendEmail({\n            to: userData.email,\n            subject: \"\u00A1Bienvenido a Easy US LLC! - Pr\u00F3ximos pasos\",\n            html: getWelcomeEmailTemplate(userData.firstName || \"Cliente\"),\n          }).catch(err => console.error(\"Error sending welcome email:\", err));\n        }\n      }\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      console.error(\"Error creating order:\", err);\n      return res.status(500).json({ message: \"Error creating order\" });\n    }\n  });\n\n  // Messages API\n  app.get(\"/api/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userMessages = await storage.getMessagesByUserId(req.session.userId);\n      res.json(userMessages);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", async (req: any, res) => {\n    try {\n      const { name, email, subject, content, requestCode } = req.body;\n      const userId = req.session?.userId || null;\n      \n      const message = await storage.createMessage({\n        userId,\n        name,\n        email,\n        subject,\n        content,\n        requestCode,\n        type: \"contact\"\n      });\n\n      // Send auto-reply\n      sendEmail({\n        to: email,\n        subject: `Recibimos tu mensaje: ${subject || \"Contacto\"}`,\n        html: getAutoReplyTemplate(name || \"Cliente\"),\n      }).catch(console.error);\n\n      // Notify admin\n      logActivity(\"Nuevo Mensaje de Contacto\", {\n        \"Nombre\": name,\n        \"Email\": email,\n        \"Asunto\": subject,\n        \"Mensaje\": content,\n        \"Referencia\": requestCode || \"N/A\"\n      });\n\n      res.status(201).json(message);\n    } catch (error) {\n      res.status(500).json({ message: \"Error sending message\" });\n    }\n  });\n\n  // Client Update Request Data\n  app.patch(\"/api/llc/:id/data\", isAuthenticated, async (req: any, res) => {\n    try {\n      const appId = Number(req.params.id);\n      const updates = req.body;\n      const [updated] = await db.update(messagesTable) // Fix: This was causing LSP errors if referencing non-existent table\n        .set({ ...updates, createdAt: new Date() })\n        .where(eq(messagesTable.id, appId))\n        .returning();\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating request\" });\n    }\n  });\n  app.get(api.llc.get.path, async (req: any, res) => {\n    const appId = Number(req.params.id);\n    \n    const application = await storage.getLlcApplication(appId);\n    if (!application) {\n      return res.status(404).json({ message: \"Application not found\" });\n    }\n\n    res.json(application);\n  });\n\n  app.put(api.llc.update.path, async (req: any, res) => {\n    try {\n      const appId = Number(req.params.id);\n      const updates = api.llc.update.input.parse(req.body);\n\n      const application = await storage.getLlcApplication(appId);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n\n      const updatedApp = await storage.updateLlcApplication(appId, updates);\n      \n      // If status is being updated to \"submitted\", send confirmation email\n      if (updates.status === \"submitted\" && updatedApp.ownerEmail) {\n        const orderIdentifier = updatedApp.requestCode || `#${updatedApp.id}`;\n        \n        // Unified Notification to admin\n        logActivity(\"Nueva Solicitud LLC\", {\n          \"Referencia\": orderIdentifier,\n          \"Estado Pago\": \"CONFIRMADO / COMPLETADO\",\n          \"Propietario\": updatedApp.ownerFullName,\n          \"DNI/Pasaporte\": updatedApp.ownerIdNumber || 'No proporcionado',\n          \"Email\": updatedApp.ownerEmail,\n          \"Tel\u00E9fono\": updatedApp.ownerPhone,\n          \"Empresa\": updatedApp.companyName,\n          \"Estado Registro\": updatedApp.state,\n          \"Categor\u00EDa\": updatedApp.businessCategory === \"Otra (especificar)\" ? updatedApp.businessCategoryOther : updatedApp.businessCategory,\n          \"Notas\": updatedApp.notes || \"Ninguna\"\n        });\n\n        // Confirmation to client with full info\n      sendEmail({\n        to: updatedApp.ownerEmail,\n        subject: `Confirmaci\u00F3n de Solicitud ${orderIdentifier} - Easy US LLC`,\n        html: getConfirmationEmailTemplate(updatedApp.ownerFullName || \"Cliente\", orderIdentifier, { companyName: updatedApp.companyName }),\n      }).catch(err => console.error(\"Error sending confirmation email:\", err));\n    }\n\n    res.json(updatedApp);\n  } catch (err) {\n    if (err instanceof z.ZodError) {\n      return res.status(400).json({ message: err.errors[0].message });\n    }\n    console.error(\"Error updating LLC application:\", err);\n    res.status(500).json({ message: \"Error updating request\" });\n  }\n});\n\n  // Lookup by request code\n  app.get(api.llc.getByCode.path, async (req: any, res) => {\n    const code = req.params.code;\n    \n    const application = await storage.getLlcApplicationByRequestCode(code);\n    if (!application) {\n      return res.status(404).json({ message: \"Solicitud no encontrada. Verifica el c\u00F3digo ingresado.\" });\n    }\n\n    res.json(application);\n  });\n\n  // Documents\n  app.post(api.documents.create.path, async (req: any, res) => {\n    try {\n      const docData = api.documents.create.input.parse(req.body);\n      \n      const application = await storage.getLlcApplication(docData.applicationId);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n\n      const document = await storage.createDocument(docData);\n      res.status(201).json(document);\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      throw err;\n    }\n  });\n\n  app.delete(api.documents.delete.path, async (req: any, res) => {\n    const docId = Number(req.params.id);\n    await storage.deleteDocument(docId);\n    res.json({ success: true });\n  });\n\n  // Payment simulation endpoint for LLC\n  app.post(\"/api/llc/:id/pay\", async (req, res) => {\n    try {\n      const appId = parseInt(req.params.id);\n      const application = await storage.getLlcApplication(appId);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n      \n      // Update order status to paid\n      if (application.orderId) {\n        await storage.updateOrderStatus(application.orderId, \"paid\");\n      }\n      \n      // Update application status to submitted\n      await storage.updateLlcApplication(appId, { status: \"submitted\", paymentStatus: \"paid\" });\n      \n      res.json({ success: true, message: \"Payment successful\" });\n    } catch (error) {\n      console.error(\"Payment error:\", error);\n      res.status(500).json({ message: \"Payment processing failed\" });\n    }\n  });\n\n  // OTP Endpoints\n  app.post(\"/api/:type(llc|maintenance)/:id/send-otp\", async (req, res) => {\n    try {\n      const type = req.params.type as 'llc' | 'maintenance';\n      const appId = Number(req.params.id);\n      const { email } = req.body;\n      \n      if (!email) return res.status(400).json({ message: \"Email is required\" });\n      \n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expires = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes\n      \n      await storage.setOtp(type, appId, otp, expires);\n      \n      await sendEmail({\n        to: email,\n        subject: \"C\u00F3digo de verificaci\u00F3n - Easy US LLC\",\n        html: getOtpEmailTemplate(otp),\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(`Error sending ${req.params.type} OTP:`, error);\n      res.status(500).json({ message: \"Error al enviar el c\u00F3digo de verificaci\u00F3n\" });\n    }\n  });\n\n  app.post(\"/api/:type(llc|maintenance)/:id/verify-otp\", async (req, res) => {\n    const type = req.params.type as 'llc' | 'maintenance';\n    const appId = Number(req.params.id);\n    const { otp } = req.body;\n    \n    if (!otp) return res.status(400).json({ message: \"OTP is required\" });\n    \n    const success = await storage.verifyOtp(type, appId, otp);\n    if (success) {\n      res.json({ success: true });\n    } else {\n      res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o caducado\" });\n    }\n  });\n\n  app.post(\"/api/maintenance/orders\", async (req: any, res) => {\n    try {\n      const { productId, state } = req.body;\n      \n      let userId: string;\n      if (req.session?.userId) {\n        userId = req.session.userId;\n      } else {\n        const guestId = `guest_${Date.now()}_${Math.random().toString(36).substring(7)}`;\n        await db.insert(usersTable).values({\n          id: guestId,\n          email: null,\n          firstName: \"Guest\",\n          lastName: \"User\",\n        });\n        userId = guestId;\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product) return res.status(400).json({ message: \"Invalid product\" });\n\n      const order = await storage.createOrder({\n        userId,\n        productId,\n        amount: product.price,\n        status: \"pending\",\n        stripeSessionId: \"mock_session_maint_\" + Date.now(),\n      });\n\n      const [application] = await db.insert(maintenanceApplications).values({\n        orderId: order.id,\n        status: \"draft\",\n        state: state || product.name.split(\" \")[0],\n      }).returning();\n\n      const timestamp = Date.now().toString();\n      const randomPart = Math.random().toString(36).substring(7).toUpperCase();\n      const requestCode = `MN-${timestamp.substring(timestamp.length - 4)}-${randomPart.substring(0, 3)}-${Math.floor(Math.random() * 9)}`;\n\n      await db.update(maintenanceApplications)\n        .set({ requestCode })\n        .where(eq(maintenanceApplications.id, application.id));\n\n      res.status(201).json({ ...order, application: { ...application, requestCode } });\n    } catch (err) {\n      console.error(\"Error creating maintenance order:\", err);\n      res.status(500).json({ message: \"Error creating maintenance order\" });\n    }\n  });\n\n  // Maintenance App Updates\n\n  // Newsletter\n  app.get(\"/api/newsletter/status\", isAuthenticated, async (req: any, res) => {\n    const isSubscribed = await storage.isSubscribedToNewsletter(req.session.email);\n    res.json({ isSubscribed });\n  });\n\n  app.post(\"/api/newsletter/unsubscribe\", isAuthenticated, async (req: any, res) => {\n    await db.delete(newsletterSubscribers).where(eq(newsletterSubscribers.email, req.session.email));\n    res.json({ success: true });\n  });\n\n  app.post(\"/api/newsletter/subscribe\", async (req: any, res) => {\n    try {\n      const { email } = z.object({ email: z.string().email().optional() }).parse(req.body);\n      \n      // If no email provided, try to use authenticated user's email\n      const targetEmail = email || req.session?.email || null;\n      \n      if (!targetEmail) {\n        return res.status(400).json({ message: \"Se requiere un email\" });\n      }\n\n      const isSubscribed = await storage.isSubscribedToNewsletter(targetEmail);\n      if (isSubscribed) {\n        // Silent success for already subscribed via dashboard toggle\n        return res.json({ success: true, message: \"Ya est\u00E1s suscrito\" });\n      }\n\n      await storage.subscribeToNewsletter(targetEmail);\n      \n      await sendEmail({\n        to: targetEmail,\n        subject: \"\u00A1Bienvenido a la Newsletter de Easy US LLC!\",\n        html: getNewsletterWelcomeTemplate(),\n      }).catch(err => console.error(\"Error sending newsletter welcome email:\", err));\n      \n      res.json({ success: true });\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Email inv\u00E1lido\" });\n      }\n      res.status(500).json({ message: \"Error al suscribirse\" });\n    }\n  });\n\n  // === Admin Routes ===\n  app.get(\"/api/admin/messages\", isAdmin, async (req, res) => {\n    try {\n      const messages = await storage.getAllMessages();\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching admin messages\" });\n    }\n  });\n\n  app.patch(\"/api/admin/messages/:id/status\", isAdmin, async (req, res) => {\n    try {\n      const { status } = req.body;\n      const message = await storage.updateMessageStatus(Number(req.params.id), status);\n      res.json(message);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating message status\" });\n    }\n  });\n\n  app.get(\"/api/admin/users\", isAdmin, async (req, res) => {\n    try {\n      const users = await db.select().from(usersTable);\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Error al obtener usuarios\" });\n    }\n  });\n\n  app.delete(\"/api/admin/users/:id\", isAdmin, async (req, res) => {\n    try {\n      const userId = req.params.id;\n      await db.delete(usersTable).where(eq(usersTable.id, userId));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Error al eliminar usuario\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id/password\", isAdmin, async (req, res) => {\n    const userId = req.params.id;\n    res.json({ success: true, message: \"Instrucciones de reinicio enviadas\" });\n  });\n\n  // Update user info (admin)\n  app.patch(\"/api/admin/users/:id\", isAdmin, async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const updateSchema = z.object({\n        firstName: z.string().min(1).max(100).optional(),\n        lastName: z.string().min(1).max(100).optional(),\n        email: z.string().email().optional(),\n        phone: z.string().max(30).optional().nullable(),\n        isActive: z.boolean().optional(),\n        accountStatus: z.enum(['active', 'pending', 'suspended', 'vip']).optional()\n      });\n      const data = updateSchema.parse(req.body);\n      const [updated] = await db.update(usersTable).set({\n        ...data,\n        updatedAt: new Date()\n      }).where(eq(usersTable.id, userId)).returning();\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating user:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Datos inv\u00E1lidos\" });\n      }\n      res.status(500).json({ message: \"Error al actualizar usuario\" });\n    }\n  });\n\n  // Newsletter subscribers (admin)\n  app.get(\"/api/admin/newsletter\", isAdmin, async (req, res) => {\n    try {\n      const subscribers = await db.select().from(newsletterSubscribers).orderBy(desc(newsletterSubscribers.subscribedAt));\n      res.json(subscribers);\n    } catch (error) {\n      console.error(\"Error fetching newsletter subscribers:\", error);\n      res.status(500).json({ message: \"Error al obtener suscriptores\" });\n    }\n  });\n\n  app.delete(\"/api/admin/newsletter/:id\", isAdmin, async (req, res) => {\n    try {\n      await db.delete(newsletterSubscribers).where(eq(newsletterSubscribers.id, Number(req.params.id)));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al eliminar suscriptor\" });\n    }\n  });\n\n  // Send email to user (admin)\n  // Helper to escape HTML\n  const escapeHtml = (text: string) => text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n\n  app.post(\"/api/admin/send-email\", isAdmin, async (req, res) => {\n    try {\n      const { to, subject, message } = z.object({\n        to: z.string().email(),\n        subject: z.string().min(1).max(200),\n        message: z.string().min(1).max(5000)\n      }).parse(req.body);\n      \n      const safeSubject = escapeHtml(subject);\n      const safeMessage = escapeHtml(message);\n      \n      await sendEmail({\n        to,\n        subject: `${safeSubject} - Easy US LLC`,\n        html: `\n          <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n            <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n              ${getEmailHeader(safeSubject)}\n              <div style=\"padding: 40px;\">\n                <div style=\"line-height: 1.6; font-size: 15px; color: #444; white-space: pre-wrap;\">${safeMessage}</div>\n              </div>\n              ${getEmailFooter()}\n            </div>\n          </div>\n        `,\n      });\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error sending email:\", error);\n      res.status(500).json({ message: \"Error al enviar email\" });\n    }\n  });\n\n  // Request document from user (admin)\n  app.post(\"/api/admin/request-document\", isAdmin, async (req, res) => {\n    try {\n      const { email, documentType, message } = z.object({\n        email: z.string().email(),\n        documentType: z.string().min(1).max(200),\n        message: z.string().max(2000).optional()\n      }).parse(req.body);\n      \n      const safeDocType = escapeHtml(documentType);\n      const safeMessage = message ? escapeHtml(message) : '';\n      \n      await sendEmail({\n        to: email,\n        subject: \"Solicitud de Documentos - Easy US LLC\",\n        html: `\n          <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n            <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n              ${getEmailHeader(\"Solicitud de Documentos\")}\n              <div style=\"padding: 40px;\">\n                <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Necesitamos documentaci\u00F3n adicional</h2>\n                <p style=\"line-height: 1.6; font-size: 15px; color: #444;\">Para continuar con tu solicitud, necesitamos que nos proporciones: <strong>${safeDocType}</strong></p>\n                ${safeMessage ? `<p style=\"line-height: 1.6; font-size: 15px; color: #444; margin-top: 15px;\">${safeMessage}</p>` : ''}\n                <div style=\"margin-top: 30px; text-align: center;\">\n                  <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #6EDC8A; color: #000; padding: 12px 25px; text-decoration: none; border-radius: 100px; font-weight: 900; font-size: 13px; text-transform: uppercase;\">Subir documentos \u2192</a>\n                </div>\n              </div>\n              ${getEmailFooter()}\n            </div>\n          </div>\n        `,\n      });\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error requesting document:\", error);\n      res.status(500).json({ message: \"Error al solicitar documento\" });\n    }\n  });\n\n  // Admin send note/notification to user\n  app.post(\"/api/admin/send-note\", isAdmin, async (req, res) => {\n    try {\n      const { userId, email, title, message, type, sendEmail: shouldSendEmail } = z.object({\n        userId: z.string(),\n        email: z.string().email(),\n        title: z.string().min(1).max(200),\n        message: z.string().min(1).max(5000),\n        type: z.enum(['info', 'action_required', 'update']).default('info'),\n        sendEmail: z.boolean().default(true)\n      }).parse(req.body);\n      \n      const safeTitle = escapeHtml(title);\n      const safeMessage = escapeHtml(message);\n      \n      // Create notification in database\n      await db.insert(userNotifications).values({\n        userId,\n        type,\n        title: safeTitle,\n        message: safeMessage,\n        actionUrl: '/dashboard'\n      });\n      \n      // Send email if requested\n      if (shouldSendEmail) {\n        await sendEmail({\n          to: email,\n          subject: `${safeTitle} - Easy US LLC`,\n          html: `\n            <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n              <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n                ${getEmailHeader(type === 'action_required' ? 'Acci\u00F3n Requerida' : 'Nueva Nota')}\n                <div style=\"padding: 40px;\">\n                  <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">${safeTitle}</h2>\n                  <div style=\"line-height: 1.6; font-size: 15px; color: #444; white-space: pre-wrap;\">${safeMessage}</div>\n                  <div style=\"margin-top: 30px; text-align: center;\">\n                    <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #6EDC8A; color: #000; padding: 12px 25px; text-decoration: none; border-radius: 100px; font-weight: 900; font-size: 13px; text-transform: uppercase;\">Ver en mi panel \u2192</a>\n                  </div>\n                </div>\n                ${getEmailFooter()}\n              </div>\n            </div>\n          `,\n        });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error sending note:\", error);\n      res.status(500).json({ message: \"Error al enviar nota\" });\n    }\n  });\n\n  // Get all orders (admin)\n  app.get(\"/api/admin/orders\", isAdmin, async (req, res) => {\n    try {\n      const orders = await db.select().from(ordersTable).orderBy(desc(ordersTable.createdAt));\n      \n      // Populate relations\n      const populatedOrders = await Promise.all(orders.map(async (order) => {\n        const [product] = order.productId ? await db.select().from(productsTable).where(eq(productsTable.id, order.productId)).limit(1) : [null];\n        const [user] = order.userId ? await db.select().from(usersTable).where(eq(usersTable.id, order.userId)).limit(1) : [null];\n        const [application] = await db.select().from(llcApplicationsTable).where(eq(llcApplicationsTable.orderId, order.id)).limit(1);\n        return { ...order, product, user, application };\n      }));\n      \n      res.json(populatedOrders);\n    } catch (error) {\n      console.error(\"Error fetching admin orders:\", error);\n      res.status(500).json({ message: \"Error al obtener pedidos\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/status\", isAdmin, async (req, res) => {\n    const { status } = req.body;\n    const order = await storage.updateOrderStatus(Number(req.params.id), status);\n    \n    // Notification for status change\n    const application = await storage.getLlcApplicationByOrderId(order.id);\n    if (application && application.ownerEmail) {\n      sendEmail({\n        to: application.ownerEmail,\n        subject: `Actualizaci\u00F3n de pedido ${application.requestCode || `#${order.id}`} - Easy US LLC`,\n        html: `\n          <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n            <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n              ${getEmailHeader(\"Actualizaci\u00F3n de Estado\")}\n              <div style=\"padding: 40px;\">\n                <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Tu pedido ha cambiado de estado</h2>\n                <p style=\"line-height: 1.6; font-size: 15px; color: #444;\">Tu solicitud <strong>${application.requestCode || `#${order.id}`}</strong> ahora se encuentra en estado: <strong style=\"text-transform: uppercase;\">${status}</strong>.</p>\n                <div style=\"margin-top: 30px; text-align: center;\">\n                  <a href=\"https://easyusllc.com/dashboard\" style=\"background-color: #6EDC8A; color: #000; padding: 12px 25px; text-decoration: none; border-radius: 100px; font-weight: 900; font-size: 13px; text-transform: uppercase;\">Ir a mi panel \u2192</a>\n                </div>\n              </div>\n              ${getEmailFooter()}\n            </div>\n          </div>\n        `,\n      }).catch(e => console.error(\"Update email error:\", e));\n    }\n    \n    res.json(order);\n  });\n\n  app.get(\"/api/admin/invoice/:id\", isAdmin, async (req, res) => {\n    const orderId = Number(req.params.id);\n    const order = await storage.getOrder(orderId);\n    if (!order) return res.status(404).json({ message: \"Order not found\" });\n    \n    res.setHeader('Content-Type', 'text/html');\n    res.send(generateInvoiceHtml(order));\n  });\n\n  // Client Invoice Route\n  app.get(\"/api/orders/:id/invoice\", isAuthenticated, async (req: any, res) => {\n    const orderId = Number(req.params.id);\n    const order = await storage.getOrder(orderId);\n    \n    if (!order) return res.status(404).json({ message: \"Pedido no encontrado\" });\n    if (order.userId !== req.session.userId && !req.session.isAdmin) {\n      return res.status(403).json({ message: \"No tienes permiso para ver esta factura\" });\n    }\n    \n    res.setHeader('Content-Type', 'text/html');\n    res.send(generateInvoiceHtml(order));\n  });\n\n  // Client Receipt/Resumen Route\n  app.get(\"/api/orders/:id/receipt\", isAuthenticated, async (req: any, res) => {\n    const orderId = Number(req.params.id);\n    const order = await storage.getOrder(orderId);\n    \n    if (!order) return res.status(404).json({ message: \"Pedido no encontrado\" });\n    if (order.userId !== req.session.userId && !req.session.isAdmin) {\n      return res.status(403).json({ message: \"Acceso denegado\" });\n    }\n    \n    res.setHeader('Content-Type', 'text/html');\n    res.send(generateReceiptHtml(order));\n  });\n\n  // Order Events Timeline\n  app.get(\"/api/orders/:id/events\", isAuthenticated, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order) return res.status(404).json({ message: \"Pedido no encontrado\" });\n      if (order.userId !== req.session.userId && !req.session.isAdmin) {\n        return res.status(403).json({ message: \"Acceso denegado\" });\n      }\n      \n      const events = await db.select().from(orderEvents)\n        .where(eq(orderEvents.orderId, orderId))\n        .orderBy(desc(orderEvents.createdAt));\n      \n      res.json(events);\n    } catch (error) {\n      console.error(\"Error fetching order events:\", error);\n      res.status(500).json({ message: \"Error al obtener eventos\" });\n    }\n  });\n\n  // Add order event (admin only)\n  app.post(\"/api/admin/orders/:id/events\", isAdmin, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const { eventType, description } = req.body;\n      \n      const [event] = await db.insert(orderEvents).values({\n        orderId,\n        eventType,\n        description,\n        createdBy: req.session.userId,\n      }).returning();\n      \n      // Get order and user info for email notification\n      const order = await storage.getOrder(orderId);\n      if (order) {\n        const [user] = await db.select().from(usersTable).where(eq(usersTable.id, order.userId)).limit(1);\n        if (user?.email) {\n          sendEmail({\n            to: user.email,\n            subject: \"Actualizaci\u00F3n de tu pedido - Easy US LLC\",\n            html: `\n              <div style=\"font-family: 'Inter', sans-serif; max-width: 600px; margin: auto; padding: 40px; background: #fff;\">\n                ${getEmailHeader()}\n                <div style=\"padding: 30px;\">\n                  <h2 style=\"color: #000; font-weight: 900;\">Actualizaci\u00F3n de Pedido #${orderId}</h2>\n                  <div style=\"background: #f4f4f4; border-left: 4px solid #6EDC8A; padding: 20px; margin: 20px 0;\">\n                    <p style=\"margin: 0; font-weight: 700;\">${eventType}</p>\n                    <p style=\"margin: 10px 0 0; color: #666;\">${description}</p>\n                  </div>\n                  <p style=\"color: #666; font-size: 14px;\">Fecha: ${new Date().toLocaleString('es-ES')}</p>\n                </div>\n                ${getEmailFooter()}\n              </div>\n            `,\n          }).catch(e => console.error(\"Error sending event email:\", e));\n        }\n      }\n      \n      res.json(event);\n    } catch (error) {\n      console.error(\"Error creating order event:\", error);\n      res.status(500).json({ message: \"Error al crear evento\" });\n    }\n  });\n\n  // Message replies\n  app.get(\"/api/messages/:id/replies\", isAuthenticated, async (req: any, res) => {\n    try {\n      const messageId = Number(req.params.id);\n      const replies = await db.select().from(messageReplies)\n        .where(eq(messageReplies.messageId, messageId))\n        .orderBy(messageReplies.createdAt);\n      \n      res.json(replies);\n    } catch (error) {\n      console.error(\"Error fetching message replies:\", error);\n      res.status(500).json({ message: \"Error al obtener respuestas\" });\n    }\n  });\n\n  // Add reply to message\n  app.post(\"/api/messages/:id/reply\", isAuthenticated, async (req: any, res) => {\n    try {\n      const messageId = Number(req.params.id);\n      const { content } = req.body;\n      \n      const [reply] = await db.insert(messageReplies).values({\n        messageId,\n        content,\n        isAdmin: req.session.isAdmin || false,\n        createdBy: req.session.userId,\n      }).returning();\n      \n      // Get message for email notification\n      const [message] = await db.select().from(messagesTable).where(eq(messagesTable.id, messageId)).limit(1);\n      if (message?.email && !req.session.isAdmin) {\n        // Admin reply - notify user\n        sendEmail({\n          to: message.email,\n          subject: \"Nueva respuesta a tu consulta - Easy US LLC\",\n          html: `\n            <div style=\"font-family: 'Inter', sans-serif; max-width: 600px; margin: auto; padding: 40px; background: #fff;\">\n              ${getEmailHeader()}\n              <div style=\"padding: 30px;\">\n                <h2 style=\"color: #000; font-weight: 900;\">Respuesta a tu consulta</h2>\n                <p style=\"color: #666;\">Ticket ID: MSG-${messageId}</p>\n                <div style=\"background: #f4f4f4; border-left: 4px solid #6EDC8A; padding: 20px; margin: 20px 0;\">\n                  <p style=\"margin: 0;\">${content}</p>\n                </div>\n                <p style=\"color: #666; font-size: 14px;\">Puedes responder accediendo a tu \u00E1rea de clientes.</p>\n              </div>\n              ${getEmailFooter()}\n            </div>\n          `,\n        }).catch(e => console.error(\"Error sending reply email:\", e));\n      }\n      \n      res.json(reply);\n    } catch (error) {\n      console.error(\"Error creating reply:\", error);\n      res.status(500).json({ message: \"Error al crear respuesta\" });\n    }\n  });\n\n  function generateInvoiceHtml(order: any) {\n    const requestCode = order.application?.requestCode || `ORD-${order.id}`;\n    const userName = order.user ? `${order.user.firstName || ''} ${order.user.lastName || ''}`.trim() : 'Cliente';\n    const userEmail = order.user?.email || '';\n    const userPhone = order.user?.phone || '';\n    const productName = order.product?.name || 'Servicio de Constituci\u00F3n LLC';\n    const invoiceNumber = `INV-${new Date(order.createdAt).getFullYear()}-${String(order.id).padStart(5, '0')}`;\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"es\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Factura ${invoiceNumber}</title>\n          <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap\" rel=\"stylesheet\">\n          <style>\n            @media print { \n              body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } \n              .no-print { display: none !important; }\n              @page { margin: 1cm; }\n            }\n            * { box-sizing: border-box; margin: 0; padding: 0; }\n            body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; color: #0E1215; line-height: 1.6; background: #fff; max-width: 800px; margin: 0 auto; }\n            .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 50px; padding-bottom: 30px; border-bottom: 3px solid #6EDC8A; }\n            .logo-section h1 { font-size: 28px; font-weight: 900; letter-spacing: -0.02em; }\n            .logo-section .subtitle { color: #6B7280; font-size: 13px; margin-top: 4px; }\n            .invoice-info { text-align: right; }\n            .invoice-badge { background: linear-gradient(135deg, #6EDC8A 0%, #4eca70 100%); color: #0E1215; padding: 10px 20px; border-radius: 100px; font-weight: 900; font-size: 13px; display: inline-block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }\n            .invoice-number { font-size: 20px; font-weight: 800; color: #0E1215; }\n            .invoice-date { font-size: 13px; color: #6B7280; margin-top: 4px; }\n            .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-bottom: 50px; }\n            .detail-box { background: #F7F7F5; padding: 25px; border-radius: 16px; }\n            .detail-label { font-size: 11px; font-weight: 800; text-transform: uppercase; color: #6EDC8A; margin-bottom: 12px; letter-spacing: 0.08em; }\n            .detail-content p { font-size: 14px; margin-bottom: 4px; }\n            .detail-content strong { font-weight: 700; }\n            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }\n            .items-table thead th { text-align: left; padding: 16px 12px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; border-bottom: 2px solid #E6E9EC; }\n            .items-table thead th:last-child { text-align: right; }\n            .items-table tbody td { padding: 20px 12px; font-size: 15px; border-bottom: 1px solid #F7F7F5; }\n            .items-table tbody td:last-child { text-align: right; font-weight: 600; }\n            .totals-section { display: flex; justify-content: flex-end; margin-bottom: 50px; }\n            .totals-box { background: linear-gradient(135deg, #F7F7F5 0%, #E6E9EC 100%); padding: 30px; border-radius: 20px; min-width: 280px; }\n            .totals-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }\n            .totals-row.final { border-top: 2px solid #0E1215; padding-top: 15px; margin-top: 15px; margin-bottom: 0; }\n            .totals-row.final .label { font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; }\n            .totals-row.final .amount { font-size: 28px; font-weight: 900; color: #0E1215; }\n            .footer { text-align: center; padding-top: 30px; border-top: 1px solid #E6E9EC; font-size: 12px; color: #6B7280; }\n            .footer p { margin-bottom: 4px; }\n            .print-controls { text-align: center; margin-bottom: 30px; }\n            .print-btn { background: #6EDC8A; color: #0E1215; padding: 14px 35px; border: none; border-radius: 100px; font-weight: 800; cursor: pointer; font-size: 14px; transition: transform 0.15s, box-shadow 0.15s; box-shadow: 0 4px 15px rgba(110, 220, 138, 0.3); }\n            .print-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(110, 220, 138, 0.4); }\n          </style>\n        </head>\n        <body>\n          <div class=\"print-controls no-print\">\n            <button class=\"print-btn\" onclick=\"window.print()\">Imprimir / Descargar PDF</button>\n          </div>\n          \n          <div class=\"header\">\n            <div class=\"logo-section\">\n              <h1>Easy US LLC</h1>\n              <p class=\"subtitle\">Servicios de Constituci\u00F3n Empresarial</p>\n            </div>\n            <div class=\"invoice-info\">\n              <div class=\"invoice-badge\">Factura</div>\n              <div class=\"invoice-number\">${invoiceNumber}</div>\n              <div class=\"invoice-date\">Fecha: ${new Date(order.createdAt).toLocaleDateString('es-ES', { day: '2-digit', month: 'long', year: 'numeric' })}</div>\n            </div>\n          </div>\n          \n          <div class=\"details-grid\">\n            <div class=\"detail-box\">\n              <div class=\"detail-label\">Datos del Emisor</div>\n              <div class=\"detail-content\">\n                <p><strong>EASY US LLC</strong></p>\n                <p>FORTUNY CONSULTING LLC</p>\n                <p>1209 Mountain Road Place NE, STE R</p>\n                <p>Albuquerque, NM 87110, USA</p>\n                <p style=\"margin-top: 10px;\">info@easyusllc.com</p>\n                <p>+34 614 91 69 10</p>\n              </div>\n            </div>\n            <div class=\"detail-box\">\n              <div class=\"detail-label\">Datos del Cliente</div>\n              <div class=\"detail-content\">\n                <p><strong>${userName}</strong></p>\n                <p>${userEmail}</p>\n                ${userPhone ? `<p>${userPhone}</p>` : ''}\n                <p style=\"margin-top: 10px;\"><strong>Ref. Pedido:</strong> ${requestCode}</p>\n              </div>\n            </div>\n          </div>\n          \n          <table class=\"items-table\">\n            <thead>\n              <tr>\n                <th>Descripci\u00F3n del Servicio</th>\n                <th>Importe</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td><strong>${productName}</strong><br><span style=\"color: #6B7280; font-size: 13px;\">Servicio completo de constituci\u00F3n empresarial en USA</span></td>\n                <td>${(order.amount / 100).toFixed(2)} \u20AC</td>\n              </tr>\n            </tbody>\n          </table>\n          \n          <div class=\"totals-section\">\n            <div class=\"totals-box\">\n              <div class=\"totals-row\">\n                <span>Subtotal</span>\n                <span>${(order.amount / 100).toFixed(2)} \u20AC</span>\n              </div>\n              <div class=\"totals-row\">\n                <span>IVA (0%)</span>\n                <span>0.00 \u20AC</span>\n              </div>\n              <div class=\"totals-row final\">\n                <span class=\"label\">Total</span>\n                <span class=\"amount\">${(order.amount / 100).toFixed(2)} \u20AC</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"footer\">\n            <p><strong>EASY US LLC</strong> \u2022 FORTUNY CONSULTING LLC</p>\n            <p>1209 Mountain Road Place NE, STE R, Albuquerque, NM 87110, USA</p>\n            <p>info@easyusllc.com \u2022 +34 614 91 69 10 \u2022 www.easyusllc.com</p>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  function generateReceiptHtml(order: any) {\n    const requestCode = order.application?.requestCode || `ORD-${order.id}`;\n    const userName = order.user ? `${order.user.firstName || ''} ${order.user.lastName || ''}`.trim() : 'Cliente';\n    const userEmail = order.user?.email || '';\n    const productName = order.product?.name || 'Servicio de Constituci\u00F3n LLC';\n    const receiptNumber = `REC-${new Date(order.createdAt).getFullYear()}-${String(order.id).padStart(5, '0')}`;\n    const statusLabels: Record<string, string> = {\n      'paid': 'Pagado',\n      'pending': 'Pendiente',\n      'processing': 'En Proceso',\n      'completed': 'Completado'\n    };\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"es\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Recibo ${receiptNumber}</title>\n          <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap\" rel=\"stylesheet\">\n          <style>\n            @media print { \n              body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: #fff !important; } \n              .no-print { display: none !important; }\n              .receipt-card { box-shadow: none !important; }\n              @page { margin: 1cm; }\n            }\n            * { box-sizing: border-box; margin: 0; padding: 0; }\n            body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; color: #0E1215; line-height: 1.6; background: #F7F7F5; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }\n            .print-controls { text-align: center; margin-bottom: 25px; }\n            .print-btn { background: #6EDC8A; color: #0E1215; padding: 14px 35px; border: none; border-radius: 100px; font-weight: 800; cursor: pointer; font-size: 14px; transition: transform 0.15s, box-shadow 0.15s; box-shadow: 0 4px 15px rgba(110, 220, 138, 0.3); }\n            .print-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(110, 220, 138, 0.4); }\n            .receipt-card { background: white; max-width: 500px; width: 100%; padding: 50px; border-radius: 32px; box-shadow: 0 25px 50px rgba(0,0,0,0.08); }\n            .receipt-header { text-align: center; margin-bottom: 35px; }\n            .success-icon { width: 70px; height: 70px; background: linear-gradient(135deg, #6EDC8A 0%, #4eca70 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }\n            .success-icon svg { width: 35px; height: 35px; color: #0E1215; }\n            .receipt-badge { background: #6EDC8A; color: #0E1215; padding: 8px 18px; border-radius: 100px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.08em; display: inline-block; margin-bottom: 15px; }\n            .receipt-title { font-size: 26px; font-weight: 900; letter-spacing: -0.02em; margin-bottom: 8px; }\n            .receipt-number { color: #6EDC8A; font-size: 18px; font-weight: 800; }\n            .receipt-message { color: #6B7280; font-size: 14px; margin-top: 15px; padding: 0 20px; }\n            .receipt-details { background: #F7F7F5; border-radius: 20px; padding: 25px; margin-bottom: 30px; }\n            .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #E6E9EC; }\n            .detail-row:last-child { border-bottom: none; }\n            .detail-label { font-size: 12px; font-weight: 700; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; }\n            .detail-value { font-size: 15px; font-weight: 600; color: #0E1215; text-align: right; }\n            .detail-value.highlight { font-size: 22px; font-weight: 900; color: #6EDC8A; }\n            .status-badge { background: #6EDC8A; color: #0E1215; padding: 6px 14px; border-radius: 100px; font-size: 12px; font-weight: 800; }\n            .status-badge.pending { background: #FEF3C7; color: #92400E; }\n            .receipt-footer { text-align: center; padding-top: 25px; border-top: 1px solid #E6E9EC; font-size: 12px; color: #6B7280; }\n            .receipt-footer p { margin-bottom: 4px; }\n            .receipt-footer .company { font-weight: 700; color: #0E1215; }\n          </style>\n        </head>\n        <body>\n          <div class=\"print-controls no-print\">\n            <button class=\"print-btn\" onclick=\"window.print()\">Imprimir / Descargar PDF</button>\n          </div>\n          \n          <div class=\"receipt-card\">\n            <div class=\"receipt-header\">\n              <div class=\"success-icon\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"3\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n                </svg>\n              </div>\n              <div class=\"receipt-badge\">Recibo de Solicitud</div>\n              <h1 class=\"receipt-title\">Pedido Confirmado</h1>\n              <div class=\"receipt-number\">${receiptNumber}</div>\n              <p class=\"receipt-message\">Hemos recibido correctamente tu solicitud. Tu proceso de constituci\u00F3n est\u00E1 en marcha.</p>\n            </div>\n            \n            <div class=\"receipt-details\">\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Cliente</span>\n                <span class=\"detail-value\">${userName}</span>\n              </div>\n              ${userEmail ? `<div class=\"detail-row\">\n                <span class=\"detail-label\">Email</span>\n                <span class=\"detail-value\">${userEmail}</span>\n              </div>` : ''}\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Servicio</span>\n                <span class=\"detail-value\">${productName}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Fecha</span>\n                <span class=\"detail-value\">${new Date(order.createdAt).toLocaleDateString('es-ES', { day: '2-digit', month: 'long', year: 'numeric' })}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Referencia</span>\n                <span class=\"detail-value\">${requestCode}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Estado</span>\n                <span class=\"status-badge ${order.status === 'pending' ? 'pending' : ''}\">${statusLabels[order.status] || order.status}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Total</span>\n                <span class=\"detail-value highlight\">${(order.amount / 100).toFixed(2)} \u20AC</span>\n              </div>\n            </div>\n            \n            <div class=\"receipt-footer\">\n              <p>Conserva este recibo para tus registros.</p>\n              <p class=\"company\">EASY US LLC \u2022 FORTUNY CONSULTING LLC</p>\n              <p>1209 Mountain Road Place NE, STE R, Albuquerque, NM 87110</p>\n              <p>info@easyusllc.com \u2022 +34 614 91 69 10</p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  // Contact form\n  app.post(\"/api/contact/send-otp\", async (req, res) => {\n    try {\n      const { email } = z.object({ email: z.string().email() }).parse(req.body);\n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 mins\n\n      await db.insert(contactOtps).values({\n        email,\n        otp,\n        expiresAt,\n      });\n\n      await sendEmail({\n        to: email,\n        subject: \"C\u00F3digo de verificaci\u00F3n - Easy US LLC\",\n        html: getOtpEmailTemplate(otp),\n      });\n\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error sending contact OTP:\", err);\n      res.status(400).json({ message: \"Error al enviar el c\u00F3digo de verificaci\u00F3n. Por favor, int\u00E9ntalo de nuevo en unos minutos.\" });\n    }\n  });\n\n  app.post(\"/api/contact/verify-otp\", async (req, res) => {\n    try {\n      const { email, otp } = z.object({ email: z.string().email(), otp: z.string() }).parse(req.body);\n      \n      const [record] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otp, otp),\n            gt(contactOtps.expiresAt, new Date())\n          )\n        )\n        .limit(1);\n\n      if (!record) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o caducado\" });\n      }\n\n      await db.update(contactOtps)\n        .set({ verified: true })\n        .where(eq(contactOtps.id, record.id));\n\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error verifying contact OTP:\", err);\n      res.status(400).json({ message: \"Error al verificar el c\u00F3digo\" });\n    }\n  });\n\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      const contactData = z.object({\n        nombre: z.string(),\n        apellido: z.string(),\n        email: z.string().email(),\n        telefono: z.string().optional(),\n        subject: z.string(),\n        mensaje: z.string(),\n        otp: z.string(),\n      }).parse(req.body);\n\n      const [otpRecord] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, contactData.email),\n            eq(contactOtps.otp, contactData.otp),\n            eq(contactOtps.verified, true)\n          )\n        )\n        .limit(1);\n\n      if (!otpRecord) {\n        return res.status(400).json({ message: \"Email no verificado\" });\n      }\n\n      const clientIp = req.headers['x-forwarded-for'] || req.socket.remoteAddress;\n      const ticketId = Math.floor(10000000 + Math.random() * 90000000).toString();\n      \n      // Notification to admin\n      logActivity(\"Acci\u00F3n Contacto\", {\n        \"ID Ticket\": `#${ticketId}`,\n        \"Nombre\": `${contactData.nombre} ${contactData.apellido}`,\n        \"Email\": contactData.email,\n        \"Tel\u00E9fono\": contactData.telefono || \"No proporcionado\",\n        \"Asunto\": contactData.subject,\n        \"Mensaje\": contactData.mensaje,\n        \"IP\": clientIp\n      });\n\n      await sendEmail({\n        to: contactData.email,\n        subject: `Confirmaci\u00F3n de mensaje - Easy US LLC #${ticketId}`,\n        html: getAutoReplyTemplate(ticketId, contactData.nombre),\n      });\n\n      res.json({ success: true, ticketId });\n    } catch (err) {\n      console.error(\"Error processing contact form:\", err);\n      res.status(400).json({ message: \"Error al procesar el mensaje\" });\n    }\n  });\n\n  // Maintenance Orders (second route - keeping for legacy support)\n  app.post(\"/api/maintenance/orders-legacy\", async (req: any, res) => {\n    try {\n      const { productId, state } = req.body;\n      let userId: string;\n      \n      if (req.session?.userId) {\n        userId = req.session.userId;\n      } else {\n        const guestId = `guest_${Date.now()}_${Math.random().toString(36).substring(7)}`;\n        await db.insert(usersTable).values({\n          id: guestId,\n          email: null,\n          firstName: \"Guest\",\n          lastName: \"User\",\n        });\n        userId = guestId;\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product) return res.status(400).json({ message: \"Invalid product\" });\n\n      // CRITICAL: Ensure pricing follows NM 349, WY 499, DE 599 for maintenance\n      let finalPrice = product.price;\n      if (state?.includes(\"New Mexico\")) finalPrice = 34900;\n      else if (state?.includes(\"Wyoming\")) finalPrice = 49900;\n      else if (state?.includes(\"Delaware\")) finalPrice = 59900;\n\n      const order = await storage.createOrder({\n        userId,\n        productId,\n        amount: finalPrice,\n        status: \"pending\",\n        stripeSessionId: \"mock_maintenance_\" + Date.now(),\n      });\n\n      const maintenanceResults = await db.insert(maintenanceApplications).values({\n        orderId: order.id,\n        status: \"draft\",\n        state: state || \"New Mexico\",\n      }).returning();\n      const application = maintenanceResults[0];\n\n      res.status(201).json({ ...order, application });\n    } catch (err) {\n      console.error(\"Error creating maintenance order:\", err);\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  app.post(\"/api/maintenance/:id/send-otp\", async (req, res) => {\n    const { email } = req.body;\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\n    const expires = new Date(Date.now() + 10 * 60 * 1000);\n    \n    await db.update(maintenanceApplications)\n      .set({ emailOtp: otp, emailOtpExpires: expires })\n      .where(eq(maintenanceApplications.id, Number(req.params.id)));\n    \n    await sendEmail({\n      to: email,\n      subject: \"C\u00F3digo de verificaci\u00F3n - Easy US LLC\",\n      html: getOtpEmailTemplate(otp),\n    });\n    res.json({ success: true });\n  });\n\n  app.post(\"/api/maintenance/:id/verify-otp\", async (req, res) => {\n    const appId = Number(req.params.id);\n    const { otp } = req.body;\n    \n    const [app] = await db.select().from(maintenanceApplications)\n      .where(and(\n        eq(maintenanceApplications.id, appId),\n        eq(maintenanceApplications.emailOtp, otp),\n        gt(maintenanceApplications.emailOtpExpires, new Date())\n      ));\n    \n    if (app) {\n      await db.update(require(\"@shared/schema\").maintenanceApplications)\n        .set({ emailVerified: true })\n        .where(eq(require(\"@shared/schema\").maintenanceApplications.id, appId));\n      res.json({ success: true });\n    } else {\n      res.status(400).json({ message: \"Invalid OTP\" });\n    }\n  });\n\n  app.put(\"/api/maintenance/:id\", async (req, res) => {\n    const appId = Number(req.params.id);\n    const updates = req.body;\n    \n    const [updatedApp] = await db.update(maintenanceApplications)\n      .set({ ...updates, lastUpdated: new Date() })\n      .where(eq(maintenanceApplications.id, appId))\n      .returning();\n    \n    if (updates.status === \"submitted\") {\n      logActivity(\"Nueva Solicitud Mantenimiento\", {\n        \"Propietario\": updatedApp.ownerFullName,\n        \"LLC\": updatedApp.companyName,\n        \"EIN\": updatedApp.ein,\n        \"Estado\": updatedApp.state,\n        \"Email\": updatedApp.ownerEmail,\n        \"Disolver\": updatedApp.wantsDissolve || \"No\",\n        \"Servicios\": updatedApp.expectedServices\n      });\n    }\n    res.json(updatedApp);\n  });\n\n  // Seed Data\n  await seedDatabase();\n\n  // === Test Email Route ===\n  app.post(\"/api/admin/test-emails\", async (req, res) => {\n    const { email } = req.body;\n    if (!email) return res.status(400).json({ message: \"Email is required\" });\n\n    try {\n      const ticketId = \"12345678\";\n      const otp = \"888999\";\n      const name = \"Cliente de Prueba\";\n      const requestCode = \"NM-9999-ABC-0\";\n\n      // Improved Admin Activity Notification (Elegir Estado)\n      const activityHtml = `\n        <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n          <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n            ${getEmailHeader()}\n            <div style=\"padding: 40px;\">\n              <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Log de Actividad: Selecci\u00F3n de Estado</h2>\n              <div style=\"background: #f4f4f4; border-left: 4px solid #000; padding: 20px; margin: 20px 0;\">\n                <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Acci\u00F3n:</strong> Clic en bot\u00F3n elegir</p>\n                <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Estado:</strong> New Mexico Pack</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Precio:</strong> 639\u20AC</p>\n        </div>\n        <p style=\"font-size: 12px; color: #999;\">IP Origen: 127.0.0.1 | Fecha: ${new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid' })}</p>\n      </div>\n      ${getEmailFooter()}\n    </div>\n  </div>\n`;\n\n      // Admin Activity Notification Logic (production)\n      app.post(\"/api/activity/track\", async (req, res) => {\n        const { action, details } = req.body;\n        if (action === \"CLICK_ELEGIR_ESTADO\") {\n          let price = \"639\u20AC\";\n          if (details.includes(\"Wyoming\")) price = \"799\u20AC\";\n          if (details.includes(\"Delaware\")) price = \"999\u20AC\";\n          \n          logActivity(\"Selecci\u00F3n de Estado\", { \n            \"Pack\": details, \n            \"Precio Base\": price,\n            \"IP\": req.ip \n          });\n        }\n        res.json({ success: true });\n      });\nconst orderHtml = `\n  <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n    <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n      ${getEmailHeader()}\n      <div style=\"padding: 40px;\">\n        <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Detalles de la Notificaci\u00F3n</h2>\n        <div style=\"margin-bottom: 25px;\">\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Estado de la Transacci\u00F3n</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Estado Pago:</strong> <span style=\"color: #0d9488; font-weight: 700;\">CONFIRMADO (MOCK)</span></p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Fecha/Hora:</strong> ${new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid' })}</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Aceptaci\u00F3n T\u00E9rminos:</strong> S\u00CD (Marcado en formulario)</p>\n        </div>\n\n        <div style=\"margin-bottom: 25px;\">\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Informaci\u00F3n del Propietario</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Nombre:</strong> ${name}</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>DNI / Pasaporte:</strong> 12345678X (Test)</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Email:</strong> ${email}</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Direcci\u00F3n:</strong> Calle Falsa 123, 28001 Madrid, Espa\u00F1a</p>\n        </div>\n\n        <div>\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Detalles de la Empresa</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Nombre LLC:</strong> Mi Nueva Empresa LLC</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Estado:</strong> New Mexico</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Actividad:</strong> Consultor\u00EDa de Software y Marketing Digital</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Notas:</strong> Necesito el EIN urgente para abrir cuenta en Mercury.</p>\n        </div>\n      </div>\n      ${getEmailFooter()}\n    </div>\n  </div>\n`;\n\n      // Send improved admin templates\n      await Promise.all([\n        sendEmail({ to: email, subject: \"TEST: OTP Verificaci\u00F3n de Identidad\", html: getOtpEmailTemplate(otp) }),\n        sendEmail({ to: email, subject: \"TEST: Log de Actividad (Admin)\", html: activityHtml }),\n        sendEmail({ to: email, subject: \"TEST: Nueva Solicitud LLC (Admin)\", html: orderHtml }),\n        sendEmail({ to: email, subject: \"TEST: Confirmaci\u00F3n de Pedido (Cliente)\", html: getConfirmationEmailTemplate(name, requestCode, { companyName: \"Mi Nueva Empresa LLC\" }) }),\n        sendEmail({ to: email, subject: \"TEST: Bienvenido a Easy US LLC\", html: getWelcomeEmailTemplate(name) }),\n        sendEmail({ to: email, subject: \"TEST: Newsletter Bienvenida\", html: getNewsletterWelcomeTemplate() }),\n        sendEmail({ to: email, subject: \"TEST: Confirmaci\u00F3n de Mensaje (Auto-reply)\", html: getAutoReplyTemplate(ticketId, name) }),\n        sendEmail({ to: email, subject: \"TEST: OTP Mensaje de Contacto\", html: getOtpEmailTemplate(otp) }),\n      ]);\n\n      res.json({ success: true, message: \"Emails de prueba administrativos mejorados enviados\" });\n    } catch (error) {\n      console.error(\"Error sending test emails:\", error);\n      res.status(500).json({ message: \"Error al enviar emails de prueba\" });\n    }\n  });\n\n  return httpServer;\n}\n\nasync function seedDatabase() {\n  const existingProducts = await storage.getProducts();\n  if (existingProducts.length === 0) {\n    await storage.createProduct({\n      name: \"New Mexico LLC\",\n      description: \"Constituci\u00F3n r\u00E1pida en el estado m\u00E1s eficiente. Ideal para bajo coste de mantenimiento.\",\n      price: 63900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"EIN del IRS\",\n        \"BOI Report presentado\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n    await storage.createProduct({\n      name: \"Wyoming LLC\",\n      description: \"Constituci\u00F3n premium en el estado m\u00E1s prestigioso de USA. M\u00E1xima privacidad y protecci\u00F3n.\",\n      price: 79900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"EIN del IRS garantizado\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"BOI Report presentado\",\n        \"Annual Report a\u00F1o 1\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n    await storage.createProduct({\n      name: \"Delaware LLC\",\n      description: \"El est\u00E1ndar para startups y empresas tecnol\u00F3gicas. Reconocimiento legal global.\",\n      price: 99900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"EIN del IRS\",\n        \"BOI Report presentado\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n  }\n}\n", "import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath, {\n    maxAge: '1y',\n    immutable: true,\n    index: false,\n    etag: true,\n    lastModified: true\n  }));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"), {\n      headers: {\n        'Cache-Control': 'no-cache, no-store, must-revalidate'\n      }\n    });\n  });\n}\n"],
  "mappings": "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",
  "names": ["import_pg_core", "import_drizzle_orm", "pg", "getOrderUpdateTemplate", "nodemailer", "bcrypt", "crypto", "timestamp", "import_drizzle_orm", "text", "crypto", "import_crypto", "import_path", "react", "path", "import_crypto", "pool", "crypto", "app", "createViteServer", "path", "rootDir", "fs", "import_vite", "import_fs", "import_path", "import_express", "import_drizzle_orm", "connectPg", "session", "app", "import_drizzle_orm", "app", "encrypt", "import_zod", "import_drizzle_orm", "httpServer", "app", "users", "getActionRequiredTemplate", "getNoteReceivedTemplate", "products", "verifyPassword", "hashPassword", "orders", "timestamp", "messages", "text", "req", "res", "app", "path", "fs", "express", "express", "compression", "setupVite"]
}
