{
  "version": 3,
  "sources": ["../shared/models/auth.ts", "../shared/schema.ts", "../server/db.ts", "../server/lib/email.ts", "../server/lib/auth-service.ts", "../server/utils/encryption.ts", "../server/lib/id-generator.ts", "../vite.config.ts", "../node_modules/nanoid/url-alphabet/index.js", "../node_modules/nanoid/index.js", "../server/vite.ts", "../server/index.ts", "../server/lib/custom-auth.ts", "../server/lib/security.ts", "../server/storage.ts", "../shared/routes.ts", "../server/routes.ts", "../server/lib/pdf-generator.ts", "../server/oauth.ts", "../server/calendar-service.ts", "../server/static.ts"],
  "sourcesContent": ["import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar, boolean, text, integer } from \"drizzle-orm/pg-core\";\n\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  clientId: varchar(\"client_id\", { length: 8 }).unique(), // 8-digit numeric ID\n  email: varchar(\"email\").unique(),\n  passwordHash: varchar(\"password_hash\"),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  phone: varchar(\"phone\"),\n  address: text(\"address\"),\n  streetType: text(\"street_type\"),\n  city: text(\"city\"),\n  province: text(\"province\"),\n  postalCode: text(\"postal_code\"),\n  country: text(\"country\"),\n  businessActivity: text(\"business_activity\"),\n  idNumber: text(\"id_number\"),\n  idType: text(\"id_type\"),\n  birthDate: text(\"birth_date\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  accountStatus: text(\"account_status\").notNull().default(\"active\"), // active (Verificado), pending (En revisi\u00F3n), deactivated (Desactivada), vip\n  loginAttempts: integer(\"login_attempts\").notNull().default(0),\n  lockUntil: timestamp(\"lock_until\"),\n  internalNotes: text(\"internal_notes\"),\n  googleId: varchar(\"google_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const userNotifications = pgTable(\"user_notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  orderId: integer(\"order_id\"),\n  orderCode: text(\"order_code\"),\n  ticketId: text(\"ticket_id\").unique(),\n  type: text(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").notNull().default(false),\n  actionUrl: text(\"action_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"user_notifications_user_id_idx\").on(table.userId),\n  index(\"user_notifications_is_read_idx\").on(table.isRead),\n  index(\"user_notifications_ticket_id_idx\").on(table.ticketId),\n]);\n\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: varchar(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  used: boolean(\"used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const emailVerificationTokens = pgTable(\"email_verification_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: varchar(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  used: boolean(\"used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\nexport type EmailVerificationToken = typeof emailVerificationTokens.$inferSelect;\nexport type UserNotification = typeof userNotifications.$inferSelect;\n", "export * from \"./models/auth\";\nimport { pgTable, text, serial, integer, boolean, timestamp, jsonb, varchar, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { users } from \"./models/auth\";\nimport { relations, sql } from \"drizzle-orm\";\n\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  price: integer(\"price\").notNull(), // in cents\n  features: jsonb(\"features\").$type<string[]>().notNull(),\n});\n\nexport const orders = pgTable(\"orders\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  productId: integer(\"product_id\").notNull().references(() => products.id),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, paid, processing, documents_ready, completed, cancelled\n  stripeSessionId: text(\"stripe_session_id\"),\n  amount: integer(\"amount\").notNull(),\n  originalAmount: integer(\"original_amount\"), // original amount before discount\n  discountCode: varchar(\"discount_code\", { length: 50 }),\n  discountAmount: integer(\"discount_amount\").default(0), // discount in cents\n  currency: varchar(\"currency\", { length: 3 }).notNull().default(\"EUR\"), // USD or EUR\n  isInvoiceGenerated: boolean(\"is_invoice_generated\").notNull().default(false),\n  invoiceNumber: text(\"invoice_number\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userIdIdx: index(\"orders_user_id_idx\").on(table.userId),\n  statusIdx: index(\"orders_status_idx\").on(table.status),\n}));\n\nexport const llcApplications = pgTable(\"llc_applications\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  requestCode: text(\"request_code\").unique(),\n  ownerFullName: text(\"owner_full_name\"),\n  ownerEmail: text(\"owner_email\"),\n  ownerPhone: text(\"owner_phone\"),\n  ownerBirthDate: text(\"owner_birth_date\"),\n  ownerAddress: text(\"owner_address\"),\n  ownerStreetType: text(\"owner_street_type\"), // Calle, Avenida, Paseo\n  ownerCity: text(\"owner_city\"),\n  ownerCountry: text(\"owner_country\"),\n  ownerProvince: text(\"owner_province\"),\n  ownerPostalCode: text(\"owner_postal_code\"),\n  ownerIdNumber: text(\"owner_id_number\"), // DNI/Passport number\n  ownerIdType: text(\"owner_id_type\"), // DNI or Passport\n  idLater: boolean(\"id_later\").notNull().default(false),\n  dataProcessingConsent: boolean(\"data_processing_consent\").notNull().default(false),\n  termsConsent: boolean(\"terms_consent\").notNull().default(false),\n  ageConfirmation: boolean(\"age_confirmation\").notNull().default(false),\n  companyName: text(\"company_name\"),\n  companyNameOption2: text(\"company_name_option_2\"),\n  designator: text(\"designator\"), // LLC, L.L.C., Ltd.\n  companyDescription: text(\"company_description\"),\n  businessCategory: text(\"business_category\"),\n  businessActivity: text(\"business_activity\"),\n  businessCategoryOther: text(\"business_category_other\"),\n  ownerNamesAlternates: text(\"owner_names_alternates\"), // Plan B, C, D names\n  ownerCount: integer(\"owner_count\").default(1),\n  ownerCountryResidency: text(\"owner_country_residency\"),\n  idDocumentUrl: text(\"id_document_url\"),\n  isSellingOnline: text(\"is_selling_online\"), // Yes, No, Not sure\n  needsBankAccount: text(\"needs_bank_account\"), // Mercury, Relay, No, Yes\n  willUseStripe: text(\"will_use_stripe\"), // Stripe, PayPal, Both, Other, Not yet\n  wantsBoiReport: text(\"wants_boi_report\"), // Yes, No, Info\n  wantsMaintenancePack: text(\"wants_maintenance_pack\"), // Yes, No, Info\n  paymentMethod: text(\"payment_method\"), // transfer, link\n  paymentStatus: text(\"payment_status\").notNull().default(\"unpaid\"), // unpaid, paid\n  notes: text(\"notes\"),\n  state: text(\"state\"),\n  status: text(\"status\").notNull().default(\"draft\"), // draft, submitted, filed, rejected\n  submittedAt: timestamp(\"submitted_at\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  emailOtp: text(\"email_otp\"),\n  emailOtpExpires: timestamp(\"email_otp_expires\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  // Important dates for calendar\n  llcCreatedDate: timestamp(\"llc_created_date\"),\n  agentRenewalDate: timestamp(\"agent_renewal_date\"),\n  irs1120DueDate: timestamp(\"irs_1120_due_date\"),\n  irs5472DueDate: timestamp(\"irs_5472_due_date\"),\n  annualReportDueDate: timestamp(\"annual_report_due_date\"),\n}, (table) => ({\n  orderIdIdx: index(\"llc_apps_order_id_idx\").on(table.orderId),\n  requestCodeIdx: index(\"llc_apps_req_code_idx\").on(table.requestCode),\n  statusIdx: index(\"llc_apps_status_idx\").on(table.status),\n}));\n\nexport const applicationDocuments = pgTable(\"application_documents\", {\n  id: serial(\"id\").primaryKey(),\n  applicationId: integer(\"application_id\").references(() => llcApplications.id),\n  orderId: integer(\"order_id\").references(() => orders.id),\n  fileName: text(\"file_name\").notNull(),\n  fileType: text(\"file_type\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  documentType: text(\"document_type\").notNull(), // passport, id, company_docs, tax_id, official_filing, other\n  reviewStatus: text(\"review_status\").notNull().default(\"pending\"), // pending, approved, rejected, action_required\n  uploadedBy: varchar(\"uploaded_by\").references(() => users.id),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n}, (table) => ({\n  applicationIdIdx: index(\"app_docs_application_id_idx\").on(table.applicationId),\n  orderIdIdx: index(\"app_docs_order_id_idx\").on(table.orderId),\n  uploadedByIdx: index(\"app_docs_uploaded_by_idx\").on(table.uploadedBy),\n}));\n\nexport const newsletterSubscribers = pgTable(\"newsletter_subscribers\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  subscribedAt: timestamp(\"subscribed_at\").defaultNow(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  name: text(\"name\"),\n  email: text(\"email\").notNull(),\n  subject: text(\"subject\"),\n  content: text(\"content\").notNull(),\n  encryptedContent: text(\"encrypted_content\"),\n  status: text(\"status\").notNull().default(\"unread\"), // unread, read, archived\n  type: text(\"type\").notNull().default(\"contact\"), // contact, support, system\n  requestCode: text(\"request_code\"),\n  messageId: text(\"message_id\").unique(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userIdIdx: index(\"messages_user_id_idx\").on(table.userId),\n  statusIdx: index(\"messages_status_idx\").on(table.status),\n  emailIdx: index(\"messages_email_idx\").on(table.email),\n}));\n\nexport const contactOtps = pgTable(\"contact_otps\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull(),\n  otp: text(\"otp\").notNull(),\n  otpType: text(\"otp_type\").notNull().default(\"contact\"), // contact, password_change\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  verified: boolean(\"verified\").notNull().default(false),\n}, (table) => ({\n  emailIdx: index(\"contact_otps_email_idx\").on(table.email),\n  expiresAtIdx: index(\"contact_otps_expires_at_idx\").on(table.expiresAt),\n}));\n\nexport const orderEvents = pgTable(\"order_events\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  eventType: text(\"event_type\").notNull(),\n  description: text(\"description\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n}, (table) => ({\n  orderIdIdx: index(\"order_events_order_id_idx\").on(table.orderId),\n}));\n\nexport const messageReplies = pgTable(\"message_replies\", {\n  id: serial(\"id\").primaryKey(),\n  messageId: integer(\"message_id\").notNull().references(() => messages.id),\n  content: text(\"content\").notNull(),\n  encryptedContent: text(\"encrypted_content\"),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n});\n\nexport const maintenanceApplications = pgTable(\"maintenance_applications\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  requestCode: text(\"request_code\").unique(),\n  ownerFullName: text(\"owner_full_name\"),\n  ownerEmail: text(\"owner_email\"),\n  ownerPhone: text(\"owner_phone\"),\n  companyName: text(\"company_name\"),\n  ein: text(\"ein\"),\n  state: text(\"state\"),\n  creationSource: text(\"creation_source\"),\n  creationYear: text(\"creation_year\"),\n  bankAccount: text(\"bank_account\"),\n  paymentGateway: text(\"payment_gateway\"),\n  businessActivity: text(\"business_activity\"),\n  expectedServices: text(\"expected_services\"),\n  status: text(\"status\").notNull().default(\"draft\"),\n  submittedAt: timestamp(\"submitted_at\"),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  emailOtp: text(\"email_otp\"),\n  emailOtpExpires: timestamp(\"email_otp_expires\"),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  notes: text(\"notes\"),\n  wantsDissolve: text(\"wants_dissolve\"),\n  paymentMethod: text(\"payment_method\"), // transfer, link\n  authorizedManagement: boolean(\"authorized_management\").notNull().default(false),\n  termsConsent: boolean(\"terms_consent\").notNull().default(false),\n  dataProcessingConsent: boolean(\"data_processing_consent\").notNull().default(false),\n}, (table) => ({\n  orderIdIdx: index(\"maint_apps_order_id_idx\").on(table.orderId),\n  requestCodeIdx: index(\"maint_apps_req_code_idx\").on(table.requestCode),\n  statusIdx: index(\"maint_apps_status_idx\").on(table.status),\n}));\n\nexport const ordersRelations = relations(orders, ({ one, many }) => ({\n  user: one(users, { fields: [orders.userId], references: [users.id] }),\n  product: one(products, { fields: [orders.productId], references: [products.id] }),\n  application: one(llcApplications, { fields: [orders.id], references: [llcApplications.orderId] }),\n  maintenanceApplication: one(maintenanceApplications, { fields: [orders.id], references: [maintenanceApplications.orderId] }),\n  events: many(orderEvents),\n}));\n\nexport const orderEventsRelations = relations(orderEvents, ({ one }) => ({\n  order: one(orders, { fields: [orderEvents.orderId], references: [orders.id] }),\n}));\n\nexport const messagesRelations = relations(messages, ({ many }) => ({\n  replies: many(messageReplies),\n}));\n\nexport const messageRepliesRelations = relations(messageReplies, ({ one }) => ({\n  message: one(messages, { fields: [messageReplies.messageId], references: [messages.id] }),\n}));\n\nexport const llcApplicationsRelations = relations(llcApplications, ({ one, many }) => ({\n  order: one(orders, { fields: [llcApplications.orderId], references: [orders.id] }),\n  documents: many(applicationDocuments),\n}));\n\nexport const applicationDocumentsRelations = relations(applicationDocuments, ({ one }) => ({\n  application: one(llcApplications, { fields: [applicationDocuments.applicationId], references: [llcApplications.id] }),\n}));\n\nexport const maintenanceApplicationsRelations = relations(maintenanceApplications, ({ one }) => ({\n  order: one(orders, { fields: [maintenanceApplications.orderId], references: [orders.id] }),\n}));\n\nexport const insertProductSchema = createInsertSchema(products).omit({ id: true });\nexport const insertOrderSchema = createInsertSchema(orders).omit({ id: true, createdAt: true });\nexport const insertLlcApplicationSchema = createInsertSchema(llcApplications).omit({ id: true, lastUpdated: true });\nexport const insertApplicationDocumentSchema = createInsertSchema(applicationDocuments).omit({ id: true, uploadedAt: true });\nexport const insertMaintenanceApplicationSchema = createInsertSchema(maintenanceApplications).omit({ id: true, lastUpdated: true });\nexport const insertContactOtpSchema = createInsertSchema(contactOtps).omit({ id: true });\nexport const insertOrderEventSchema = createInsertSchema(orderEvents).omit({ id: true, createdAt: true });\nexport const insertMessageReplySchema = createInsertSchema(messageReplies).omit({ id: true, createdAt: true });\n\n// Discount codes table\nexport const discountCodes = pgTable(\"discount_codes\", {\n  id: serial(\"id\").primaryKey(),\n  code: varchar(\"code\", { length: 50 }).notNull().unique(),\n  description: text(\"description\"),\n  discountType: varchar(\"discount_type\", { length: 20 }).notNull().default(\"percentage\"), // percentage or fixed\n  discountValue: integer(\"discount_value\").notNull(), // percentage (0-100) or fixed amount in cents\n  minOrderAmount: integer(\"min_order_amount\").default(0), // minimum order amount in cents\n  maxUses: integer(\"max_uses\"), // null = unlimited\n  usedCount: integer(\"used_count\").notNull().default(0),\n  validFrom: timestamp(\"valid_from\").defaultNow(),\n  validUntil: timestamp(\"valid_until\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertDiscountCodeSchema = createInsertSchema(discountCodes).omit({ id: true, createdAt: true, usedCount: true });\nexport type DiscountCode = typeof discountCodes.$inferSelect;\nexport type InsertDiscountCode = z.infer<typeof insertDiscountCodeSchema>;\n\nexport type MaintenanceApplication = typeof maintenanceApplications.$inferSelect;\nexport type Product = typeof products.$inferSelect;\nexport type Order = typeof orders.$inferSelect;\nexport type LlcApplication = typeof llcApplications.$inferSelect;\nexport type ApplicationDocument = typeof applicationDocuments.$inferSelect;\nexport type OrderEvent = typeof orderEvents.$inferSelect;\nexport type Message = typeof messages.$inferSelect;\nexport type MessageReply = typeof messageReplies.$inferSelect;\n\nexport type CreateOrderRequest = {\n  productId: number;\n};\nexport type UpdateLlcApplicationRequest = Partial<z.infer<typeof insertLlcApplicationSchema>>;\nexport type CreateDocumentRequest = z.infer<typeof insertApplicationDocumentSchema>;\n", "import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\n// Optimized connection string processing with simplified pool\nlet connectionString = process.env.DATABASE_URL!;\nif (!connectionString.includes(\"sslmode=\")) {\n  connectionString += (connectionString.includes(\"?\") ? \"&\" : \"?\") + \"sslmode=require\";\n}\n\nexport const pool = new Pool({ \n  connectionString,\n  ssl: {\n    rejectUnauthorized: false\n  },\n  connectionTimeoutMillis: 10000, // 10s is safer for production startup\n  idleTimeoutMillis: 10000,\n  max: 10, // Sufficient pool size\n});\nexport const db = drizzle(pool, { schema });\n", "import nodemailer from \"nodemailer\";\n\nconst domain = \"easyusllc.com\";\nconst companyAddress = `Easy US LLC\n1209 Mountain Road Place Northeast\nSTE R\nAlbuquerque, NM 87110`;\n\nfunction getSimpleHeader() {\n  return `\n    <div style=\"background: linear-gradient(180deg, #0E1215 0%, #1a1f25 100%); padding: 35px 20px; text-align: center;\">\n      <a href=\"https://${domain}\" target=\"_blank\" style=\"text-decoration: none; display: inline-block;\">\n        <img src=\"https://${domain}/logo-email.png\" alt=\"Easy US LLC\" width=\"60\" height=\"60\" style=\"display: block; margin: 0 auto 12px; border-radius: 50%;\" />\n        <span style=\"font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; font-size: 18px; font-weight: 800; color: #F7F7F5; letter-spacing: -0.5px;\">Easy US LLC</span>\n      </a>\n    </div>\n  `;\n}\n\nfunction getSimpleFooter() {\n  return `\n    <div style=\"background-color: #0E1215; padding: 35px 25px; text-align: center; color: #F7F7F5;\">\n      <div style=\"width: 40px; height: 3px; background: #6EDC8A; margin: 0 auto 20px; border-radius: 2px;\"></div>\n      <p style=\"margin: 0 0 15px 0; font-size: 12px; color: #9CA3AF; line-height: 1.7;\">1209 Mountain Road Place Northeast, STE R<br>Albuquerque, NM 87110</p>\n      <p style=\"margin: 0; font-size: 11px; color: #6B7280;\">\u00A9 ${new Date().getFullYear()} Easy US LLC</p>\n    </div>\n  `;\n}\n\nfunction getEmailWrapper(content: string) {\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\" rel=\"stylesheet\">\n    </head>\n    <body style=\"margin: 0; padding: 0; background-color: #F7F7F5;\">\n      <div style=\"background-color: #F7F7F5; padding: 40px 15px;\">\n        <div style=\"font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 560px; margin: auto; border-radius: 24px; overflow: hidden; color: #0E1215; background-color: #ffffff; box-shadow: 0 4px 24px rgba(0,0,0,0.06);\">\n          ${getSimpleHeader()}\n          <div style=\"padding: 40px 35px;\">\n            ${content}\n            <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280; margin-top: 35px; padding-top: 25px; border-top: 1px solid #E6E9EC;\">Si tienes cualquier duda, responde directamente a este correo.</p>\n          </div>\n          ${getSimpleFooter()}\n        </div>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\n// 1. OTP - C\u00F3digo de verificaci\u00F3n\nexport function getOtpEmailTemplate(otp: string, name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 20px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 10px;\">Gracias por continuar con tu proceso en Easy US LLC.</p>\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 30px;\">Para garantizar la seguridad de tu cuenta, utiliza el siguiente c\u00F3digo de verificaci\u00F3n:</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 30px; border-radius: 16px; margin: 25px 0; text-align: center; border: 2px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 10px 0; font-size: 14px; color: #059669; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;\">Tu c\u00F3digo OTP:</p>\n      <p style=\"margin: 0; font-size: 42px; font-weight: 900; color: #0E1215; letter-spacing: 12px; font-family: 'SF Mono', 'Consolas', monospace;\">${otp}</p>\n    </div>\n\n    <div style=\"background: #F9FAFB; padding: 20px 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 12px 0; font-size: 13px; font-weight: 800; color: #0E1215; text-transform: uppercase;\">Importante:</p>\n      <ul style=\"margin: 0; padding-left: 18px; color: #444; font-size: 14px; line-height: 1.8;\">\n        <li style=\"margin-bottom: 6px;\">Este c\u00F3digo es personal y confidencial</li>\n        <li style=\"margin-bottom: 6px;\">Tiene una validez limitada a <strong>15 minutos</strong> por motivos de seguridad</li>\n        <li>No lo compartas con nadie</li>\n      </ul>\n    </div>\n\n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280; margin-top: 25px;\">Si no has solicitado este c\u00F3digo, puedes ignorar este mensaje con total tranquilidad.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 2. Bienvenida - Cuenta creada\nexport function getWelcomeEmailTemplate(name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Gracias por registrarte en Easy US LLC.</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Tu cuenta ha sido creada correctamente. Desde tu panel podr\u00E1s gestionar solicitudes, documentaci\u00F3n y el estado de tus servicios en todo momento.</p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Acceder a Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 3. Cuenta en revisi\u00F3n\nexport function getAccountUnderReviewTemplate(name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Te informamos de que tu cuenta se encuentra actualmente en revisi\u00F3n.</p>\n    \n    <div style=\"background: #FEF3C7; padding: 20px 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #F59E0B;\">\n      <p style=\"margin: 0; font-size: 14px; color: #92400E; line-height: 1.7;\">Durante este proceso de validaci\u00F3n, no ser\u00E1 posible realizar nuevos pedidos ni modificar informaci\u00F3n existente en tu panel. Esta medida es temporal y forma parte de nuestros procedimientos de verificaci\u00F3n.</p>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Nuestro equipo est\u00E1 revisando la informaci\u00F3n proporcionada y te notificaremos por este mismo medio en cuanto el proceso haya finalizado o si fuera necesario aportar documentaci\u00F3n adicional.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 3b. Cuenta actualizada a VIP\nexport function getAccountVipTemplate(name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Tu cuenta ha sido actualizada al estado VIP.</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 25px; border-radius: 16px; margin: 25px 0; border: 2px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 15px 0; font-size: 15px; color: #0E1215; font-weight: 600;\">Beneficios VIP:</p>\n      <ul style=\"margin: 0; padding-left: 20px; font-size: 14px; color: #444; line-height: 1.8;\">\n        <li>Atenci\u00F3n prioritaria y gesti\u00F3n acelerada</li>\n        <li>Seguimiento preferente por nuestro equipo</li>\n        <li>Acceso completo a todos los servicios</li>\n      </ul>\n    </div>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Acceder a Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 3c. Cuenta reactivada\nexport function getAccountReactivatedTemplate(name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Tu cuenta ha sido reactivada correctamente.</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Ya puedes acceder a tu panel y utilizar todos nuestros servicios con normalidad.</p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Acceder a Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 4. Confirmaci\u00F3n de Solicitud (LLC / Mantenimiento)\nexport function getConfirmationEmailTemplate(name: string, requestCode: string, details?: { companyName?: string; state?: string; serviceType?: string }) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hemos recibido correctamente tu solicitud.</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 25px; border-radius: 16px; margin: 25px 0; border: 2px solid #6EDC8A;\">\n      <table style=\"width: 100%; font-size: 14px; border-collapse: collapse;\">\n        <tr>\n          <td style=\"padding: 8px 0; color: #6B7280;\">Referencia:</td>\n          <td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #0E1215;\">#${requestCode}</td>\n        </tr>\n        ${details?.serviceType ? `<tr><td style=\"padding: 8px 0; color: #6B7280;\">Servicio:</td><td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #0E1215;\">${details.serviceType}</td></tr>` : ''}\n        <tr>\n          <td style=\"padding: 8px 0; color: #6B7280;\">Estado actual:</td>\n          <td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #059669;\">En revisi\u00F3n</td>\n        </tr>\n      </table>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Nuestro equipo est\u00E1 validando la informaci\u00F3n y te notificaremos cualquier actualizaci\u00F3n directamente por email.</p>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Para cualquier duda relacionada con esta solicitud, responde a este correo indicando tu n\u00FAmero de referencia.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 5. Auto-respuesta de Contacto\nexport function getAutoReplyTemplate(ticketId: string, name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Tu mensaje ha sido recibido correctamente.</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 25px; border-radius: 16px; margin: 25px 0; border: 2px solid #6EDC8A; text-align: center;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 12px; color: #6B7280; text-transform: uppercase; letter-spacing: 1px;\">N\u00FAmero de ticket</p>\n      <p style=\"margin: 0; font-size: 24px; font-weight: 900; color: #0E1215;\">#${ticketId}</p>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Tiempo estimado de respuesta: <strong>24-48 horas laborables</strong></p>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Nuestro equipo revisar\u00E1 tu consulta y te responder\u00E1 lo antes posible. Si necesitas a\u00F1adir informaci\u00F3n adicional, responde directamente a este correo.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 6. Actualizaci\u00F3n de Pedido\nexport function getOrderUpdateTemplate(name: string, orderNumber: string, newStatus: string, statusDescription: string) {\n  const statusLabels: Record<string, string> = {\n    pending: \"Pendiente\",\n    processing: \"En proceso\",\n    paid: \"Pagado\",\n    filed: \"Presentado\",\n    documents_ready: \"Documentos listos\",\n    completed: \"Completado\",\n    cancelled: \"Cancelado\"\n  };\n  const statusLabel = statusLabels[newStatus] || newStatus.replace(/_/g, \" \");\n  \n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">El estado de tu pedido ha sido actualizado.</p>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <table style=\"width: 100%; font-size: 14px; border-collapse: collapse;\">\n        <tr>\n          <td style=\"padding: 8px 0; color: #6B7280;\">Pedido:</td>\n          <td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #0E1215;\">#${orderNumber}</td>\n        </tr>\n        <tr>\n          <td style=\"padding: 8px 0; color: #6B7280;\">Nuevo estado:</td>\n          <td style=\"padding: 8px 0; font-weight: 700; text-align: right; color: #059669;\">${statusLabel}</td>\n        </tr>\n      </table>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">${statusDescription}</p>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Para cualquier aclaraci\u00F3n sobre esta actualizaci\u00F3n, responde directamente a este correo.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 7. Pedido Completado + Trustpilot\nexport function getOrderCompletedTemplate(name: string, orderNumber: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Tu pedido ha sido completado correctamente.</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 25px; border-radius: 16px; margin: 25px 0; border: 2px solid #6EDC8A;\">\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.6;\">Ya puedes acceder a toda la documentaci\u00F3n desde tu panel de cliente.</p>\n    </div>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Acceder a documentos</a>\n    </div>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Tu experiencia es importante para nosotros. Si lo deseas, puedes valorar nuestro servicio cuando recibas la invitaci\u00F3n correspondiente.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8. Nuevo Mensaje (admin a cliente)\nexport function getNoteReceivedTemplate(name: string, noteContent: string, orderNumber?: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Tienes un nuevo mensaje de nuestro equipo${orderNumber ? ` relacionado con tu pedido <strong>#${orderNumber}</strong>` : ''}.</p>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.7; white-space: pre-wrap;\">${noteContent}</p>\n    </div>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Ver en Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8b. Nota con ticket (admin a cliente)\nexport function getAdminNoteTemplate(name: string, title: string, message: string, ticketId: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\n      <h2 style=\"margin: 0; font-size: 18px; font-weight: 700; color: #0E1215;\">${title}</h2>\n      <span style=\"font-size: 12px; color: #6B7280; background: #F3F4F6; padding: 6px 12px; border-radius: 20px;\">Ticket: ${ticketId}</span>\n    </div>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.7; white-space: pre-wrap;\">${message}</p>\n    </div>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Ver en Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8c. Solicitud de Pago\nexport function getPaymentRequestTemplate(name: string, message: string, paymentLink: string, amount?: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Se ha generado una solicitud de pago para continuar con tu tr\u00E1mite${amount ? ` por un valor de <strong>${amount}</strong>` : ''}.</p>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px; font-weight: 700; color: #6B7280; text-transform: uppercase;\">Mensaje:</p>\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.7;\">${message}</p>\n    </div>\n    \n    <div style=\"text-align: center; margin: 35px 0;\">\n      <a href=\"${paymentLink}\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 14px; text-transform: uppercase; padding: 16px 45px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Realizar Pago</a>\n    </div>\n    \n    <p style=\"line-height: 1.5; font-size: 12px; color: #9CA3AF; text-align: center; margin-top: 20px;\">Si el bot\u00F3n no funciona, copia y pega este enlace:<br><a href=\"${paymentLink}\" style=\"color: #6EDC8A; word-break: break-all;\">${paymentLink}</a></p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8d. Solicitud de Documentaci\u00F3n\nexport function getDocumentRequestTemplate(name: string, documentType: string, message: string, ticketId: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Nuestro equipo requiere que subas el siguiente documento:</p>\n    \n    <div style=\"background: linear-gradient(135deg, #FEF3C7 0%, #FEF9C3 100%); padding: 20px 25px; border-radius: 16px; margin: 25px 0; border: 2px solid #F59E0B; text-align: center;\">\n      <p style=\"margin: 0; font-size: 16px; font-weight: 700; color: #92400E;\">${documentType}</p>\n    </div>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px; font-weight: 700; color: #6B7280; text-transform: uppercase;\">Mensaje:</p>\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.7;\">${message}</p>\n    </div>\n    \n    <p style=\"line-height: 1.6; font-size: 13px; color: #6B7280; margin-bottom: 25px;\">Ticket de referencia: <strong>#${ticketId}</strong></p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Subir Documento</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8e. Respuesta a consulta (admin a cliente)\nexport function getMessageReplyTemplate(name: string, content: string, ticketId: string) {\n  const emailContent = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Hemos respondido a tu consulta (Ticket: <strong>#${ticketId}</strong>):</p>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0; font-size: 15px; color: #0E1215; line-height: 1.7; white-space: pre-wrap;\">${content}</p>\n    </div>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Ver en Mi Panel</a>\n    </div>\n  `;\n  return getEmailWrapper(emailContent);\n}\n\n// 8f. C\u00F3digo para cambio de contrase\u00F1a\nexport function getPasswordChangeOtpTemplate(name: string, otp: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Has solicitado cambiar tu contrase\u00F1a. Usa este c\u00F3digo para verificar tu identidad:</p>\n    \n    <div style=\"background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%); padding: 30px; border-radius: 16px; margin: 25px 0; text-align: center; border: 2px solid #6EDC8A;\">\n      <p style=\"margin: 0; font-size: 42px; font-weight: 900; color: #0E1215; letter-spacing: 12px; font-family: 'SF Mono', 'Consolas', monospace;\">${otp}</p>\n    </div>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Este c\u00F3digo expira en <strong>10 minutos</strong>.</p>\n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Si no solicitaste este cambio, ignora este mensaje.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 8g. Evento de timeline de pedido\nexport function getOrderEventTemplate(name: string, orderId: string, eventType: string, description: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Tu pedido <strong>#${orderId}</strong> tiene una actualizaci\u00F3n:</p>\n    \n    <div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #6EDC8A;\">\n      <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: 700; color: #0E1215;\">${eventType}</p>\n      <p style=\"margin: 0; font-size: 14px; color: #6B7280; line-height: 1.6;\">${description}</p>\n    </div>\n    \n    <p style=\"line-height: 1.5; font-size: 13px; color: #9CA3AF;\">Fecha: ${new Date().toLocaleString('es-ES')}</p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://${domain}/dashboard\" style=\"display: inline-block; background: #6EDC8A; color: #0E1215; text-decoration: none; font-weight: 800; font-size: 13px; text-transform: uppercase; padding: 14px 35px; border-radius: 50px; letter-spacing: 0.3px; box-shadow: 0 4px 14px rgba(110,220,138,0.35);\">Ver Detalles</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 9. Cuenta Desactivada\nexport function getAccountDeactivatedTemplate(name: string = \"Cliente\") {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 20px;\">Te informamos de que tu cuenta ha sido desactivada temporalmente.</p>\n    \n    <div style=\"background: #FEE2E2; padding: 20px 25px; border-radius: 16px; margin: 25px 0; border-left: 4px solid #EF4444;\">\n      <p style=\"margin: 0; font-size: 14px; color: #B91C1C; line-height: 1.7;\">Mientras la cuenta permanezca desactivada no ser\u00E1 posible realizar solicitudes ni acceder a formularios.</p>\n    </div>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Si consideras que se trata de un error o necesitas m\u00E1s informaci\u00F3n, responde directamente a este correo.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 10. Newsletter Bienvenida\nexport function getNewsletterWelcomeTemplate() {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Tu suscripci\u00F3n ha sido confirmada correctamente.</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Recibir\u00E1s informaci\u00F3n relevante sobre servicios, actualizaciones y novedades relacionadas con Easy US LLC.</p>\n    \n    <p style=\"line-height: 1.6; font-size: 14px; color: #6B7280;\">Puedes darte de baja en cualquier momento desde el enlace incluido en nuestros correos.</p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 17. Registro con c\u00F3digo de verificaci\u00F3n\nexport function getRegistrationOtpTemplate(name: string, otp: string, clientId: string, expiryMinutes: number = 15) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Gracias por registrarte en Easy US LLC. Tu c\u00F3digo de verificaci\u00F3n es:</p>\n    \n    <div style=\"background-color: #0E1215; padding: 25px; text-align: center; border-radius: 16px; margin: 25px 0;\">\n      <span style=\"color: #6EDC8A; font-size: 36px; font-weight: 900; letter-spacing: 8px; font-family: monospace;\">${otp}</span>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Este c\u00F3digo expira en ${expiryMinutes} minutos.</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Tu ID de cliente es: <strong>${clientId}</strong></p>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 18. Notificaci\u00F3n admin de nuevo registro\nexport function getAdminNewRegistrationTemplate(clientId: string, firstName: string, lastName: string, email: string, phone?: string) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\"><strong>Nueva cuenta creada en el sistema.</strong></p>\n    \n    <div style=\"background-color: #F7F7F5; padding: 20px; border-radius: 16px; border-left: 4px solid #6EDC8A; margin: 25px 0;\">\n      <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Cliente ID:</strong> ${clientId}</p>\n      <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Nombre:</strong> ${firstName} ${lastName}</p>\n      <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Email:</strong> ${email}</p>\n      ${phone ? `<p style=\"margin: 0; font-size: 14px;\"><strong>Tel\u00E9fono:</strong> ${phone}</p>` : ''}\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 19. Cuenta bloqueada por seguridad\nexport function getAccountLockedTemplate(name: string, ticketId: string) {\n  const baseUrl = process.env.BASE_URL || 'https://easyusllc.com';\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\">Hola ${name},</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Por su seguridad, su cuenta ha sido temporalmente bloqueada tras detectar m\u00FAltiples intentos de acceso fallidos.</p>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Para desbloquear su cuenta y verificar su identidad, necesitamos que nos env\u00EDe:</p>\n    \n    <div style=\"background-color: #FFF3E0; padding: 20px; border-radius: 16px; border-left: 4px solid #FF9800; margin: 25px 0;\">\n      <ul style=\"margin: 0; padding-left: 20px; color: #444;\">\n        <li style=\"margin-bottom: 8px;\">Imagen del DNI/Pasaporte de alta resoluci\u00F3n (ambas caras)</li>\n        <li>Su fecha de nacimiento confirmada</li>\n      </ul>\n    </div>\n    \n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin-bottom: 25px;\">Su Ticket ID de referencia es: <strong>#${ticketId}</strong></p>\n    \n    <div style=\"text-align: center; margin: 35px 0;\">\n      <a href=\"${baseUrl}/forgot-password\" style=\"background-color: #6EDC8A; color: #0E1215; font-weight: 700; font-size: 15px; padding: 16px 40px; border-radius: 50px; text-decoration: none; display: inline-block; box-shadow: 0 4px 15px rgba(110, 220, 138, 0.3);\">Restablecer contrase\u00F1a</a>\n    </div>\n  `;\n  return getEmailWrapper(content);\n}\n\n// 20. Notificaci\u00F3n admin de pedido LLC completado\nexport function getAdminLLCOrderTemplate(orderData: {\n  orderIdentifier: string;\n  amount: string;\n  paymentMethod: string;\n  ownerFullName?: string;\n  ownerEmail?: string;\n  ownerPhone?: string;\n  ownerBirthDate?: string;\n  ownerIdType?: string;\n  ownerIdNumber?: string;\n  ownerAddress?: string;\n  ownerCity?: string;\n  ownerProvince?: string;\n  ownerPostalCode?: string;\n  ownerCountry?: string;\n  companyName?: string;\n  companyNameOption2?: string;\n  designator?: string;\n  state?: string;\n  businessCategory?: string;\n  businessActivity?: string;\n  companyDescription?: string;\n  isSellingOnline?: string;\n  needsBankAccount?: string;\n  willUseStripe?: string;\n  wantsBoiReport?: string;\n  wantsMaintenancePack?: string;\n  notes?: string;\n}) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\"><strong>Nuevo pedido LLC completado.</strong></p>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Informaci\u00F3n del Propietario</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Nombre:</strong> ${orderData.ownerFullName || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Email:</strong> ${orderData.ownerEmail || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Tel\u00E9fono:</strong> ${orderData.ownerPhone || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Fecha nacimiento:</strong> ${orderData.ownerBirthDate || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Documento:</strong> ${orderData.ownerIdType || 'N/A'} - ${orderData.ownerIdNumber || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Direcci\u00F3n:</strong> ${orderData.ownerAddress || 'N/A'}, ${orderData.ownerCity || ''}, ${orderData.ownerProvince || ''} ${orderData.ownerPostalCode || ''}, ${orderData.ownerCountry || ''}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Informaci\u00F3n de la Empresa</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Empresa:</strong> ${orderData.companyName || 'N/A'} ${orderData.designator || ''}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Alternativo:</strong> ${orderData.companyNameOption2 || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Estado:</strong> ${orderData.state || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Categor\u00EDa:</strong> ${orderData.businessCategory || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Actividad:</strong> ${orderData.businessActivity || 'N/A'}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Servicios</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Vender\u00E1 online:</strong> ${orderData.isSellingOnline || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Cuenta bancaria:</strong> ${orderData.needsBankAccount || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Pasarela:</strong> ${orderData.willUseStripe || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>BOI Report:</strong> ${orderData.wantsBoiReport || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Mantenimiento:</strong> ${orderData.wantsMaintenancePack || 'N/A'}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 5px;\">Pago</h3>\n    <div style=\"background: #E8F5E9; border-left: 4px solid #4CAF50; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Referencia:</strong> ${orderData.orderIdentifier}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Importe:</strong> ${orderData.amount}\u20AC</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>M\u00E9todo:</strong> ${orderData.paymentMethod}</p>\n    </div>\n    \n    ${orderData.notes ? `\n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #FF9800; padding-bottom: 5px;\">Notas del Cliente</h3>\n    <div style=\"background: #FFF3E0; border-left: 4px solid #FF9800; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0; font-size: 13px;\">${orderData.notes}</p>\n    </div>\n    ` : ''}\n  `;\n  return getEmailWrapper(content);\n}\n\n// 21. Notificaci\u00F3n admin de pedido mantenimiento completado\nexport function getAdminMaintenanceOrderTemplate(orderData: {\n  orderIdentifier: string;\n  amount: string;\n  paymentMethod: string;\n  ownerFullName?: string;\n  ownerEmail?: string;\n  ownerPhone?: string;\n  companyName?: string;\n  ein?: string;\n  state?: string;\n  creationSource?: string;\n  creationYear?: string;\n  bankAccount?: string;\n  paymentGateway?: string;\n  businessActivity?: string;\n  expectedServices?: string;\n  wantsDissolve?: string;\n  notes?: string;\n}) {\n  const content = `\n    <p style=\"line-height: 1.7; font-size: 15px; color: #444; margin: 0 0 25px 0;\"><strong>Nuevo pedido de mantenimiento completado.</strong></p>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Informaci\u00F3n del Propietario</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Nombre:</strong> ${orderData.ownerFullName || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Email:</strong> ${orderData.ownerEmail || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Tel\u00E9fono:</strong> ${orderData.ownerPhone || 'N/A'}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Informaci\u00F3n de la Empresa</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Empresa:</strong> ${orderData.companyName || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>EIN:</strong> ${orderData.ein || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Estado:</strong> ${orderData.state || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Creado con:</strong> ${orderData.creationSource || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>A\u00F1o creaci\u00F3n:</strong> ${orderData.creationYear || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Cuenta bancaria:</strong> ${orderData.bankAccount || 'N/A'}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Pasarela:</strong> ${orderData.paymentGateway || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Actividad:</strong> ${orderData.businessActivity || 'N/A'}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #6EDC8A; padding-bottom: 5px;\">Servicios Solicitados</h3>\n    <div style=\"background: #F7F7F5; border-left: 4px solid #6EDC8A; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Servicios:</strong> ${orderData.expectedServices || 'N/A'}</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>Disolver empresa:</strong> ${orderData.wantsDissolve || 'No'}</p>\n    </div>\n    \n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 5px;\">Pago</h3>\n    <div style=\"background: #E8F5E9; border-left: 4px solid #4CAF50; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Referencia:</strong> ${orderData.orderIdentifier}</p>\n      <p style=\"margin: 0 0 8px 0; font-size: 13px;\"><strong>Importe:</strong> ${orderData.amount}\u20AC</p>\n      <p style=\"margin: 0; font-size: 13px;\"><strong>M\u00E9todo:</strong> ${orderData.paymentMethod}</p>\n    </div>\n    \n    ${orderData.notes ? `\n    <h3 style=\"font-size: 14px; font-weight: 700; margin: 20px 0 10px; color: #333; border-bottom: 2px solid #FF9800; padding-bottom: 5px;\">Notas del Cliente</h3>\n    <div style=\"background: #FFF3E0; border-left: 4px solid #FF9800; padding: 15px; margin: 10px 0; border-radius: 8px;\">\n      <p style=\"margin: 0; font-size: 13px;\">${orderData.notes}</p>\n    </div>\n    ` : ''}\n  `;\n  return getEmailWrapper(content);\n}\n\n// Legacy exports for compatibility\nexport interface EmailMetadata {\n  clientId?: string;\n  date?: Date;\n  reference?: string;\n  ip?: string;\n}\n\nexport function getEmailHeader(title: string = \"Easy US LLC\", metadata?: EmailMetadata) {\n  return getSimpleHeader();\n}\n\nexport function getEmailFooter() {\n  return getSimpleFooter();\n}\n\n// Transporter configuration\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST || \"smtp.ionos.es\",\n  port: parseInt(process.env.SMTP_PORT || \"587\"),\n  secure: false,\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASS,\n  },\n  tls: {\n    rejectUnauthorized: false\n  },\n  pool: true,\n  maxConnections: 5,\n  maxMessages: 100,\n});\n\nexport async function sendEmail({ to, subject, html, replyTo }: { to: string; subject: string; html: string; replyTo?: string }) {\n  if (!process.env.SMTP_USER || !process.env.SMTP_PASS) {\n    return;\n  }\n\n  const testEmail = \"afortuny07@gmail.com\";\n  const originalTo = to;\n\n  try {\n    const info = await transporter.sendMail({\n      from: `\"Easy US LLC\" <no-reply@easyusllc.com>`,\n      replyTo: replyTo || \"hola@easyusllc.com\",\n      to: testEmail,\n      subject: `[TEST - Para: ${originalTo}] ${subject}`,\n      html,\n    });\n    return info;\n  } catch (error: any) {\n    return null;\n  }\n}\n\nexport async function sendTrustpilotEmail({ to, name, orderNumber }: { to: string; name: string; orderNumber: string }) {\n  if (!process.env.SMTP_PASS) {\n    return;\n  }\n\n  const testEmail = \"afortuny07@gmail.com\";\n  const originalTo = to;\n  const trustpilotBcc = process.env.TRUSTPILOT_BCC_EMAIL || \"easyusllc.com+62fb280c0a@invite.trustpilot.com\";\n\n  const html = getOrderCompletedTemplate(name, orderNumber);\n\n  try {\n    const info = await transporter.sendMail({\n      from: `\"Easy US LLC\" <no-reply@easyusllc.com>`,\n      replyTo: \"hola@easyusllc.com\",\n      to: testEmail,\n      bcc: trustpilotBcc,\n      subject: `[TEST - Para: ${originalTo}] Pedido completado - Documentaci\u00F3n disponible`,\n      html,\n    });\n    return info;\n  } catch (error: any) {\n    return null;\n  }\n}\n", "import bcrypt from \"bcrypt\";\nimport crypto from \"crypto\";\nimport { db } from \"../db\";\nimport { users, passwordResetTokens, emailVerificationTokens, messages as messagesTable } from \"@shared/schema\";\nimport { eq, and, gt, sql } from \"drizzle-orm\";\nimport { sendEmail, getRegistrationOtpTemplate, getAdminNewRegistrationTemplate, getAccountLockedTemplate, getOtpEmailTemplate } from \"./email\";\n\nconst SALT_ROUNDS = 12;\nconst OTP_EXPIRY_MINUTES = 15;\nconst PASSWORD_RESET_EXPIRY_HOURS = 24;\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nexport function generateOtp(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport function generateToken(): string {\n  return crypto.randomBytes(32).toString(\"hex\");\n}\n\nexport function generateClientId(): string {\n  return Math.floor(10000000 + Math.random() * 90000000).toString();\n}\n\nexport async function generateUniqueClientId(): Promise<string> {\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (attempts < maxAttempts) {\n    const clientId = generateClientId();\n    const existing = await db.select({ id: users.id }).from(users).where(eq(users.clientId, clientId)).limit(1);\n    if (existing.length === 0) {\n      return clientId;\n    }\n    attempts++;\n  }\n  \n  return Date.now().toString().slice(-8);\n}\n\nexport async function createUser(data: {\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n  phone: string;\n  birthDate?: string;\n  businessActivity?: string;\n  clientId: string;\n}): Promise<{ user: typeof users.$inferSelect; verificationToken: string }> {\n  const existingUser = await db.select().from(users).where(eq(users.email, data.email)).limit(1);\n  if (existingUser.length > 0) {\n    throw new Error(\"El email ya est\u00E1 registrado\");\n  }\n\n  const passwordHash = await hashPassword(data.password);\n  const isAdminEmail = data.email.toLowerCase() === process.env.ADMIN_EMAIL?.toLowerCase();\n\n  const [newUser] = await db.insert(users).values({\n    id: data.clientId,\n    clientId: data.clientId,\n    email: data.email,\n    passwordHash,\n    firstName: data.firstName,\n    lastName: data.lastName,\n    phone: data.phone,\n    businessActivity: data.businessActivity || null,\n    emailVerified: false,\n    isAdmin: isAdminEmail,\n    accountStatus: \"active\",\n  }).returning();\n\n  const verificationToken = generateOtp();\n  const expiresAt = new Date(Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000);\n\n  await db.insert(emailVerificationTokens).values({\n    userId: newUser.id,\n    token: verificationToken,\n    expiresAt,\n  });\n\n  try {\n    await sendEmail({\n      to: data.email,\n      subject: \"Bienvenido a Easy US LLC - Verifica tu cuenta\",\n      html: getRegistrationOtpTemplate(data.firstName, verificationToken, data.clientId, OTP_EXPIRY_MINUTES)\n    });\n\n    // Email notification to admin about new registration\n    const adminEmail = process.env.ADMIN_EMAIL || \"afortuny07@gmail.com\";\n    await sendEmail({\n      to: adminEmail,\n      subject: `[NUEVA CUENTA] ${data.firstName} ${data.lastName}`,\n      html: getAdminNewRegistrationTemplate(data.clientId, data.firstName, data.lastName, data.email, data.phone)\n    }).catch(() => {});\n\n  } catch (emailError) {\n    // Email error silenced\n  }\n\n  return { user: newUser, verificationToken };\n}\n\nasync function logActivity(title: string, data: any) {\n  if (process.env.NODE_ENV === 'development') {\n    console.log(`[AUTH] ${title}:`, data);\n  }\n}\n\nexport async function verifyEmailToken(userId: string, token: string): Promise<boolean> {\n  const [tokenRecord] = await db\n    .select()\n    .from(emailVerificationTokens)\n    .where(\n      and(\n        eq(emailVerificationTokens.userId, userId),\n        eq(emailVerificationTokens.token, token),\n        eq(emailVerificationTokens.used, false),\n        gt(emailVerificationTokens.expiresAt, new Date())\n      )\n    )\n    .limit(1);\n\n  if (!tokenRecord) {\n    return false;\n  }\n\n  await db.update(emailVerificationTokens)\n    .set({ used: true })\n    .where(eq(emailVerificationTokens.id, tokenRecord.id));\n\n  await db.update(users)\n    .set({ \n      emailVerified: true, \n      accountStatus: \"active\",\n      updatedAt: new Date() \n    })\n    .where(eq(users.id, userId));\n\n  return true;\n}\n\nexport async function loginUser(email: string, password: string): Promise<typeof users.$inferSelect | null> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  \n  if (!user || !user.passwordHash) {\n    return null;\n  }\n\n  // Check if account is locked\n  if (user.lockUntil && user.lockUntil > new Date()) {\n    const error = new Error(\"CUENTA BLOQUEADA TEMPORALMENTE. Por su seguridad su cuenta ha sido temporalmente desactivada, porfavor contacte con nuestro equipo o revise su email para desbloquear su cuenta.\");\n    (error as any).locked = true;\n    throw error;\n  }\n\n  if (user.isActive === false || user.accountStatus === 'deactivated') {\n    const error = new Error(\"Tu cuenta ha sido desactivada. Contacta con nuestro equipo de soporte para m\u00E1s informaci\u00F3n.\");\n    (error as any).locked = true;\n    (error as any).status = 403;\n    logActivity(\"Intento de Login en Cuenta Desactivada\", { userId: user.id, email: user.email });\n    throw error;\n  }\n\n  const isValid = await verifyPassword(password, user.passwordHash);\n  \n  if (!isValid) {\n    // Increment login attempts\n    const newAttempts = (user.loginAttempts || 0) + 1;\n    const updates: any = { loginAttempts: newAttempts };\n    \n    if (newAttempts >= 5) {\n      // Lock account for 1 hour (temporary lock, not deactivation)\n      updates.lockUntil = new Date(Date.now() + 60 * 60 * 1000);\n      \n      const msgId = Math.floor(10000000 + Math.random() * 90000000).toString();\n\n      // Send lock email\n      try {\n        await sendEmail({\n          to: user.email!,\n          subject: \"Seguridad Easy US LLC - Cuenta Bloqueada Temporalmente\",\n          html: getAccountLockedTemplate(user.firstName || 'Cliente', msgId)\n        });\n\n        // Add to messages for admin visibility\n        await db.insert(messagesTable).values({\n          userId: user.id,\n          name: \"Claudia (Seguridad)\",\n          email: \"seguridad@easyusllc.com\",\n          subject: \"Cuenta Bloqueada - Verificaci\u00F3n Requerida\",\n          content: `Cuenta desactivada temporalmente por seguridad. Se ha solicitado DNI y fecha de nacimiento. Ticket ID: ${msgId}`,\n          status: \"unread\",\n          type: \"support\",\n          messageId: msgId\n        });\n\n      } catch (e) {\n        console.error(\"Error handling account lock:\", e);\n      }\n    }\n    \n    await db.update(users).set(updates).where(eq(users.id, user.id));\n    return null;\n  }\n\n  // Reset attempts on successful login\n  if (user.loginAttempts > 0 || user.lockUntil) {\n    await db.update(users).set({ \n      loginAttempts: 0, \n      lockUntil: null,\n      accountStatus: user.accountStatus,\n      updatedAt: new Date()\n    }).where(eq(users.id, user.id));\n  }\n\n  return user;\n}\n\nexport async function createPasswordResetOtp(email: string): Promise<{ success: boolean; userId?: string }> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  \n  if (!user) {\n    return { success: false };\n  }\n\n  // Generate 6-digit OTP\n  const otp = Math.floor(100000 + Math.random() * 900000).toString();\n  const expiresAt = new Date(Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000);\n\n  await db.insert(passwordResetTokens).values({\n    userId: user.id,\n    token: otp,\n    expiresAt,\n  });\n\n  try {\n    const { getEmailHeader, getEmailFooter, getOtpEmailTemplate } = await import(\"./email\");\n    await sendEmail({\n      to: email,\n      subject: \"C\u00F3digo de verificaci\u00F3n - Easy US LLC\",\n      html: getOtpEmailTemplate(otp),\n    });\n  } catch (emailError) {\n    // Email error silenced\n  }\n\n  return { success: true, userId: user.id };\n}\n\nexport async function verifyPasswordResetOtp(email: string, otp: string): Promise<boolean> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  if (!user) return false;\n\n  const [tokenRecord] = await db\n    .select()\n    .from(passwordResetTokens)\n    .where(\n      and(\n        eq(passwordResetTokens.userId, user.id),\n        eq(passwordResetTokens.token, otp),\n        eq(passwordResetTokens.used, false),\n        gt(passwordResetTokens.expiresAt, new Date())\n      )\n    )\n    .orderBy(sql`${passwordResetTokens.createdAt} DESC`)\n    .limit(1);\n\n  return !!tokenRecord;\n}\n\nexport async function resetPasswordWithOtp(email: string, otp: string, newPassword: string): Promise<boolean> {\n  const [user] = await db.select().from(users).where(eq(users.email, email)).limit(1);\n  if (!user) return false;\n\n  const [tokenRecord] = await db\n    .select()\n    .from(passwordResetTokens)\n    .where(\n      and(\n        eq(passwordResetTokens.userId, user.id),\n        eq(passwordResetTokens.token, otp),\n        eq(passwordResetTokens.used, false),\n        gt(passwordResetTokens.expiresAt, new Date())\n      )\n    )\n    .limit(1);\n\n  if (!tokenRecord) {\n    return false;\n  }\n\n  const passwordHash = await hashPassword(newPassword);\n\n  await db.update(passwordResetTokens)\n    .set({ used: true })\n    .where(eq(passwordResetTokens.id, tokenRecord.id));\n\n  // Also unlock account if it was locked due to too many attempts\n  await db.update(users)\n    .set({ \n      passwordHash, \n      updatedAt: new Date(),\n      loginAttempts: 0,\n      lockUntil: null,\n      accountStatus: 'active' \n    })\n    .where(eq(users.id, tokenRecord.userId));\n\n  return true;\n}\n\nexport async function resendVerificationEmail(userId: string): Promise<boolean> {\n  const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n  \n  if (!user || !user.email) {\n    return false;\n  }\n\n  const verificationToken = generateOtp();\n  const expiresAt = new Date(Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000);\n\n  await db.insert(emailVerificationTokens).values({\n    userId: user.id,\n    token: verificationToken,\n    expiresAt,\n  });\n\n  try {\n    await sendEmail({\n      to: user.email,\n      subject: \"Easy US LLC - C\u00F3digo de verificaci\u00F3n\",\n      html: getOtpEmailTemplate(verificationToken, user.firstName || 'Cliente')\n    });\n  } catch (emailError) {\n    // Email error silenced\n    return false;\n  }\n\n  return true;\n}\n", "import crypto from \"crypto\";\n\nconst ALGORITHM = \"aes-256-cbc\";\nconst ENCRYPTION_KEY = process.env.ENCRYPTION_KEY || \"fallback_key_at_least_32_chars_long!!\"; \nconst IV_LENGTH = 16;\n\nexport function encrypt(text: string): string {\n  const iv = crypto.randomBytes(IV_LENGTH);\n  const cipher = crypto.createCipheriv(ALGORITHM, Buffer.from(ENCRYPTION_KEY.slice(0, 32)), iv);\n  let encrypted = cipher.update(text);\n  encrypted = Buffer.concat([encrypted, cipher.final()]);\n  return iv.toString(\"hex\") + \":\" + encrypted.toString(\"hex\");\n}\n\nexport function decrypt(text: string): string {\n  const textParts = text.split(\":\");\n  const iv = Buffer.from(textParts.shift()!, \"hex\");\n  const encryptedText = Buffer.from(textParts.join(\":\"), \"hex\");\n  const decipher = crypto.createDecipheriv(ALGORITHM, Buffer.from(ENCRYPTION_KEY.slice(0, 32)), iv);\n  let decrypted = decipher.update(encryptedText);\n  decrypted = Buffer.concat([decrypted, decipher.final()]);\n  return decrypted.toString();\n}\n", "import { db } from \"../db\";\nimport { users, llcApplications, maintenanceApplications, messages, userNotifications, applicationDocuments } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\nexport function generate8DigitId(): string {\n  return Math.floor(10000000 + Math.random() * 90000000).toString();\n}\n\nexport async function generateUniqueClientId(): Promise<string> {\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (attempts < maxAttempts) {\n    const clientId = generate8DigitId();\n    const existing = await db.select({ id: users.id }).from(users).where(eq(users.clientId, clientId)).limit(1);\n    if (existing.length === 0) {\n      return clientId;\n    }\n    attempts++;\n  }\n  \n  return Date.now().toString().slice(-8);\n}\n\nexport function generateOrderCode(state: string): string {\n  const statePrefix = getStatePrefix(state);\n  const digits = generate8DigitId();\n  return `${statePrefix}-${digits}`;\n}\n\nexport function getStatePrefix(state: string): string {\n  const stateMap: Record<string, string> = {\n    'New Mexico': 'NM',\n    'new mexico': 'NM',\n    'nm': 'NM',\n    'Wyoming': 'WY',\n    'wyoming': 'WY',\n    'wy': 'WY',\n    'Delaware': 'DE',\n    'delaware': 'DE',\n    'de': 'DE',\n  };\n  return stateMap[state] || stateMap[state.toLowerCase()] || 'US';\n}\n\nexport async function generateUniqueOrderCode(state: string): Promise<string> {\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (attempts < maxAttempts) {\n    const code = generateOrderCode(state);\n    \n    const existingLlc = await db.select({ id: llcApplications.id })\n      .from(llcApplications)\n      .where(eq(llcApplications.requestCode, code))\n      .limit(1);\n    \n    const existingMaint = await db.select({ id: maintenanceApplications.id })\n      .from(maintenanceApplications)\n      .where(eq(maintenanceApplications.requestCode, code))\n      .limit(1);\n    \n    if (existingLlc.length === 0 && existingMaint.length === 0) {\n      return code;\n    }\n    attempts++;\n  }\n  \n  const timestamp = Date.now().toString().slice(-8);\n  return `${getStatePrefix(state)}-${timestamp}`;\n}\n\nexport async function generateUniqueTicketId(): Promise<string> {\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (attempts < maxAttempts) {\n    const ticketId = generate8DigitId();\n    \n    const existingNotif = await db.select({ id: userNotifications.id })\n      .from(userNotifications)\n      .where(eq(userNotifications.ticketId, ticketId))\n      .limit(1);\n    \n    if (existingNotif.length === 0) {\n      return ticketId;\n    }\n    attempts++;\n  }\n  \n  return Date.now().toString().slice(-8);\n}\n\nexport async function generateUniqueMessageId(): Promise<string> {\n  let attempts = 0;\n  const maxAttempts = 10;\n  \n  while (attempts < maxAttempts) {\n    const messageId = generate8DigitId();\n    \n    const existing = await db.select({ id: messages.id })\n      .from(messages)\n      .where(eq(messages.messageId, messageId))\n      .limit(1);\n    \n    if (existing.length === 0) {\n      return messageId;\n    }\n    attempts++;\n  }\n  \n  return Date.now().toString().slice(-8);\n}\n\nexport function generateDocumentId(): string {\n  return generate8DigitId();\n}\n\nexport function formatOrderDisplay(requestCode: string | null | undefined): string {\n  if (requestCode) {\n    return requestCode;\n  }\n  return 'N/A';\n}\n", "import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\n\nconst rootDir = process.cwd();\n\nexport default defineConfig({\n  plugins: [\n    react(),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(rootDir, \"client\", \"src\"),\n      \"@shared\": path.resolve(rootDir, \"shared\"),\n      \"@assets\": path.resolve(rootDir, \"client\", \"src\", \"assets\"),\n    },\n  },\n  root: path.resolve(rootDir, \"client\"),\n  build: {\n    outDir: path.resolve(rootDir, \"dist/public\"),\n    emptyOutDir: true,\n    reportCompressedSize: false,\n    chunkSizeWarningLimit: 1000,\n    rollupOptions: {\n      output: {\n        manualChunks(id) {\n          if (id.includes('node_modules')) {\n            if (id.includes('react-dom') || id.includes('react/') || id.includes('/react.')) return 'react-vendor';\n            if (id.includes('framer-motion')) return 'framer-motion';\n            if (id.includes('@radix-ui')) return 'radix-ui';\n            if (id.includes('lucide-react')) return 'lucide';\n            if (id.includes('@tanstack')) return 'tanstack';\n            if (id.includes('react-hook-form') || id.includes('@hookform')) return 'forms';\n            if (id.includes('zod') || id.includes('drizzle')) return 'validation';\n            if (id.includes('i18next')) return 'i18n';\n            if (id.includes('date-fns')) return 'date-utils';\n            return 'vendor';\n          }\n          if (id.includes('/components/ui/')) return 'ui-components';\n        }\n      }\n    }\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n    allowedHosts: true,\n  },\n});\n", "let urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\nexport { urlAlphabet }\n", "import crypto from 'crypto'\nimport { urlAlphabet } from './url-alphabet/index.js'\nconst POOL_SIZE_MULTIPLIER = 128\nlet pool, poolOffset\nlet fillPool = bytes => {\n  if (!pool || pool.length < bytes) {\n    pool = Buffer.allocUnsafe(bytes * POOL_SIZE_MULTIPLIER)\n    crypto.randomFillSync(pool)\n    poolOffset = 0\n  } else if (poolOffset + bytes > pool.length) {\n    crypto.randomFillSync(pool)\n    poolOffset = 0\n  }\n  poolOffset += bytes\n}\nlet random = bytes => {\n  fillPool((bytes |= 0))\n  return pool.subarray(poolOffset - bytes, poolOffset)\n}\nlet customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (31 - Math.clz32((alphabet.length - 1) | 1))) - 1\n  let step = Math.ceil((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let i = step\n      while (i--) {\n        id += alphabet[bytes[i] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nlet customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nlet nanoid = (size = 21) => {\n  fillPool((size |= 0))\n  let id = ''\n  for (let i = poolOffset - size; i < poolOffset; i++) {\n    id += urlAlphabet[pool[i] & 63]\n  }\n  return id\n}\nexport { nanoid, customAlphabet, customRandom, urlAlphabet, random }\n", "import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst rootDir = process.cwd();\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        rootDir,\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n", "import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport compression from \"compression\";\nimport path from \"path\";\n\nconst app = express();\n\n// Serve uploaded files statically\napp.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\nconst httpServer = createServer(app);\n\n\napp.use(compression());\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  // Security Headers\n  res.setHeader(\"X-Content-Type-Options\", \"nosniff\");\n  res.setHeader(\"X-Frame-Options\", \"SAMEORIGIN\");\n  res.setHeader(\"X-XSS-Protection\", \"1; mode=block\");\n  res.setHeader(\"Strict-Transport-Security\", \"max-age=31536000; includeSubDomains; preload\");\n  res.setHeader(\"Content-Security-Policy\", \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob: https://*.stripe.com; connect-src 'self' https://api.stripe.com wss://*.replit.dev; frame-src 'self' https://js.stripe.com; frame-ancestors 'self' https://*.replit.dev https://*.replit.app;\");\n  res.setHeader(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n  res.setHeader(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=(), payment=()\");\n  res.setHeader(\"Cross-Origin-Opener-Policy\", \"same-origin-allow-popups\");\n  res.setHeader(\"Cross-Origin-Resource-Policy\", \"same-origin\");\n  \n  // Performance Headers\n  if (req.method === 'GET') {\n    const isAsset = req.path.startsWith('/assets/') || req.path.match(/\\.(jpg|jpeg|png|gif|svg|webp|ico|css|js|woff2|woff)$/);\n    const isStaticFile = req.path.match(/\\.(png|jpg|jpeg|gif|svg|webp|ico|woff2|woff|ttf|eot)$/);\n    const isSeoFile = req.path === '/robots.txt' || req.path === '/sitemap.xml';\n    \n    if (isAsset) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n      res.setHeader('Vary', 'Accept-Encoding');\n    } else if (isStaticFile) {\n      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');\n    } else if (isSeoFile) {\n      res.setHeader('Cache-Control', 'public, max-age=86400');\n    }\n    \n    res.setHeader(\"X-DNS-Prefetch-Control\", \"on\");\n    res.setHeader(\"Link\", \"</logo-icon.png>; rel=preload; as=image\");\n  }\n  \n  // Prevent caching of API responses\n  if (req.path.startsWith('/api/')) {\n    res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n    res.setHeader('Pragma', 'no-cache');\n    res.setHeader('Expires', '0');\n  }\n  \n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  // Simple WebSocket logging for admin panel\n  const { WebSocketServer } = await import('ws');\n  const wss = new WebSocketServer({ noServer: true });\n\n  httpServer.on('upgrade', (request, socket, head) => {\n    const { pathname } = new URL(request.url!, `http://${request.headers.host}`);\n    if (pathname === '/ws/logs') {\n      wss.handleUpgrade(request, socket, head, (ws) => {\n        wss.emit('connection', ws, request);\n      });\n    }\n  });\n\n  const originalLog = console.log;\n  console.log = (...args) => {\n    originalLog(...args);\n    const msg = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' ');\n    wss.clients.forEach(client => {\n      if (client.readyState === 1) client.send(msg);\n    });\n  };\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    if (!res.headersSent) {\n      res.status(status).json({ message });\n    }\n    \n    // Log error for debugging but don't re-throw to prevent unhandled rejections\n    console.error(`[Error ${status}]`, message, err.stack || '');\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n", "import type { Express, RequestHandler } from \"express\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport express from \"express\";\nimport { db } from \"../db\";\nimport { users } from \"@shared/models/auth\";\nimport { userNotifications, messages as messagesTable } from \"@shared/schema\";\nimport { eq, sql } from \"drizzle-orm\";\nimport { sendEmail, getWelcomeEmailTemplate } from \"./email\";\nimport { checkRateLimit, logAudit, getClientIp } from \"./security\";\nimport {\n  createUser,\n  loginUser,\n  verifyEmailToken,\n  createPasswordResetOtp,\n  verifyPasswordResetOtp,\n  resetPasswordWithOtp,\n  resendVerificationEmail,\n} from \"./auth-service\";\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  const isProduction = process.env.NODE_ENV === \"production\" || process.env.REPLIT_ENVIRONMENT === \"production\";\n  \n  return session({\n    secret: process.env.SESSION_SECRET || \"easy-us-llc-secret-key-2024\",\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: isProduction,\n      maxAge: sessionTtl,\n      sameSite: isProduction ? \"none\" : \"lax\",\n    },\n  });\n}\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n    email: string;\n    isAdmin: boolean;\n  }\n}\n\nexport function setupCustomAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  \n  // JSON body parser must be before session and routes\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n  \n  app.use(getSession());\n\n  // Register endpoint\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, phone, birthDate, businessActivity } = req.body;\n\n      if (!email || !password || !firstName || !lastName || !phone) {\n        return res.status(400).json({ message: \"Todos los campos son obligatorios\" });\n      }\n\n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres\" });\n      }\n\n      const clientId = Math.floor(10000000 + Math.random() * 90000000).toString();\n      const { user } = await createUser({\n        email,\n        password,\n        firstName,\n        lastName,\n        phone,\n        birthDate,\n        businessActivity,\n        clientId,\n      });\n\n      // NOTIFICATION: Welcome\n      await db.insert(userNotifications).values({\n        userId: user.id,\n        title: \"\u00A1Bienvenido a Easy US LLC!\",\n        message: \"Gracias por confiar en nosotros para crear tu empresa en EE.UU. Explora tu panel para comenzar.\",\n        type: 'info',\n        isRead: false\n      });\n\n      // Send Welcome Email with Client ID\n      sendEmail({\n        to: user.email!,\n        subject: \"\u00A1Bienvenido a Easy US LLC!\",\n        html: getWelcomeEmailTemplate(user.firstName || \"Cliente\")\n      }).catch(() => {});\n\n      req.session.userId = user.id;\n      req.session.email = user.email!;\n      req.session.isAdmin = user.isAdmin;\n\n      // Save session explicitly before responding\n      req.session.save((err) => {\n        if (err) {\n          console.error(\"Session save error:\", err);\n          return res.status(500).json({ message: \"Error al guardar la sesi\u00F3n\" });\n        }\n        \n        res.json({\n          success: true,\n          user: {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            emailVerified: user.emailVerified,\n          },\n          message: \"Cuenta creada. Revisa tu email para verificar tu cuenta.\",\n        });\n      });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(400).json({ message: error.message || \"Error al crear la cuenta\" });\n    }\n  });\n\n  // Login endpoint with rate limiting\n  app.post(\"/api/auth/login\", async (req, res) => {\n      try {\n        const ip = getClientIp(req);\n        const rateCheck = checkRateLimit('login', ip);\n        if (!rateCheck.allowed) {\n          return res.status(429).json({ \n            message: `Demasiados intentos. Espera ${rateCheck.retryAfter} segundos.` \n          });\n        }\n\n        const { email, password } = req.body;\n\n        if (!email || !password) {\n          return res.status(400).json({ message: \"Email y contrase\u00F1a son obligatorios\" });\n        }\n\n        const user = await loginUser(email, password);\n\n        if (!user) {\n          logAudit({ action: 'user_login', ip, details: { email, success: false } });\n          return res.status(401).json({ message: \"Email o contrase\u00F1a incorrectos\" });\n        }\n\n        if (user.accountStatus === 'deactivated') {\n          return res.status(403).json({ message: \"Tu cuenta ha sido desactivada. Contacta a nuestro servicio de atenci\u00F3n al cliente para m\u00E1s informaci\u00F3n.\" });\n        }\n\n        req.session.userId = user.id;\n        req.session.email = user.email!;\n        req.session.isAdmin = user.isAdmin;\n\n        // Save session explicitly before responding\n        req.session.save((err) => {\n          if (err) {\n            console.error(\"Session save error:\", err);\n            return res.status(500).json({ message: \"Error al guardar la sesi\u00F3n\" });\n          }\n          \n          logAudit({ action: 'user_login', userId: user.id, ip, details: { email, success: true } });\n          res.json({\n            success: true,\n            user: {\n              id: user.id,\n              email: user.email,\n              firstName: user.firstName,\n              lastName: user.lastName,\n              phone: user.phone,\n              emailVerified: user.emailVerified,\n              isAdmin: user.isAdmin,\n            },\n          });\n        });\n      } catch (error: any) {\n        if (error.locked) {\n          logAudit({ action: 'account_locked', ip: getClientIp(req), details: { reason: 'too_many_attempts' } });\n          return res.status(403).json({ message: error.message });\n        }\n        console.error(\"Login error:\", error);\n        res.status(500).json({ message: \"Error al iniciar sesi\u00F3n\" });\n      }\n  });\n\n  // Logout endpoint\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ message: \"Error al cerrar sesi\u00F3n\" });\n      }\n      res.clearCookie(\"connect.sid\");\n      res.json({ success: true });\n    });\n  });\n\n  // Also support GET for logout redirect\n  app.get(\"/api/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      res.clearCookie(\"connect.sid\");\n      res.redirect(\"/\");\n    });\n  });\n\n  // Verify email endpoint\n  app.post(\"/api/auth/verify-email\", async (req, res) => {\n    try {\n      const { code } = req.body;\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const success = await verifyEmailToken(userId, code);\n\n      if (!success) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o expirado\" });\n      }\n\n      res.json({ success: true, message: \"Email verificado correctamente\" });\n    } catch (error) {\n      // Email error silenced\n      res.status(500).json({ message: \"Error al verificar el email\" });\n    }\n  });\n\n  // Resend verification email\n  app.post(\"/api/auth/resend-verification\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const success = await resendVerificationEmail(userId);\n\n      if (!success) {\n        return res.status(400).json({ message: \"Error al enviar el c\u00F3digo\" });\n      }\n\n      res.json({ success: true, message: \"C\u00F3digo enviado\" });\n    } catch (error) {\n      console.error(\"Resend verification error:\", error);\n      res.status(500).json({ message: \"Error al enviar el c\u00F3digo\" });\n    }\n  });\n\n  // Request password reset OTP\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ message: \"Email es obligatorio\" });\n      }\n\n      await createPasswordResetOtp(email);\n\n      // Always return success to prevent email enumeration\n      res.json({\n        success: true,\n        message: \"Si el email existe en nuestro sistema, recibir\u00E1s un c\u00F3digo de verificaci\u00F3n\",\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al procesar la solicitud\" });\n    }\n  });\n\n  // Verify password reset OTP\n  app.post(\"/api/auth/verify-reset-otp\", async (req, res) => {\n    try {\n      const { email, otp } = req.body;\n\n      if (!email || !otp) {\n        return res.status(400).json({ message: \"Email y c\u00F3digo son obligatorios\" });\n      }\n\n      const isValid = await verifyPasswordResetOtp(email, otp);\n\n      if (!isValid) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o expirado\" });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al verificar el c\u00F3digo\" });\n    }\n  });\n\n  // Reset password with OTP\n  app.post(\"/api/auth/reset-password\", async (req, res) => {\n    try {\n      const { email, otp, password } = req.body;\n\n      if (!email || !otp || !password) {\n        return res.status(400).json({ message: \"Email, c\u00F3digo y contrase\u00F1a son obligatorios\" });\n      }\n\n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres\" });\n      }\n\n      const success = await resetPasswordWithOtp(email, otp, password);\n\n      if (!success) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o expirado\" });\n      }\n\n      res.json({ success: true, message: \"Contrase\u00F1a actualizada correctamente\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al actualizar la contrase\u00F1a\" });\n    }\n  });\n\n  // Get current user\n  app.get(\"/api/auth/user\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n\n      if (!user) {\n        req.session.destroy(() => {});\n        return res.status(401).json({ message: \"Usuario no encontrado\" });\n      }\n\n      res.json({\n        id: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        phone: user.phone,\n        address: user.address,\n        streetType: user.streetType,\n        city: user.city,\n        province: user.province,\n        postalCode: user.postalCode,\n        country: user.country,\n        businessActivity: user.businessActivity,\n        idNumber: user.idNumber,\n        idType: user.idType,\n        birthDate: user.birthDate,\n        emailVerified: user.emailVerified,\n        isAdmin: user.isAdmin,\n        accountStatus: user.accountStatus,\n        profileImageUrl: user.profileImageUrl,\n        googleId: user.googleId ? true : false,\n        createdAt: user.createdAt,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ message: \"Error al obtener el usuario\" });\n    }\n  });\n\n  // Update user profile\n  app.patch(\"/api/auth/user\", async (req, res) => {\n    try {\n      const userId = req.session.userId;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const { firstName, lastName, phone, address, businessActivity } = req.body;\n\n      await db.update(users)\n        .set({\n          firstName,\n          lastName,\n          phone,\n          address,\n          businessActivity,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, userId));\n\n      const [updatedUser] = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n\n      res.json({\n        success: true,\n        user: {\n          id: updatedUser.id,\n          email: updatedUser.email,\n          firstName: updatedUser.firstName,\n          lastName: updatedUser.lastName,\n          phone: updatedUser.phone,\n          address: updatedUser.address,\n          businessActivity: updatedUser.businessActivity,\n          emailVerified: updatedUser.emailVerified,\n        },\n      });\n    } catch (error) {\n      console.error(\"Update user error:\", error);\n      res.status(500).json({ message: \"Error al actualizar el perfil\" });\n    }\n  });\n}\n\nexport const isAuthenticated: RequestHandler = (req, res, next) => {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"No autenticado\" });\n  }\n  next();\n};\n\nexport const isAdmin: RequestHandler = async (req, res, next) => {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"No autenticado\" });\n  }\n\n  const [user] = await db.select().from(users).where(eq(users.id, req.session.userId)).limit(1);\n\n  if (!user || !user.isAdmin) {\n    return res.status(403).json({ message: \"No autorizado\" });\n  }\n\n  next();\n};\n", "import { db } from \"../db\";\nimport { sql } from \"drizzle-orm\";\n\nconst RATE_LIMITS: Record<string, { windowMs: number; maxRequests: number }> = {\n  login: { windowMs: 900000, maxRequests: 5 },\n  otp: { windowMs: 300000, maxRequests: 3 },\n  register: { windowMs: 3600000, maxRequests: 3 },\n  passwordReset: { windowMs: 600000, maxRequests: 3 },\n  contact: { windowMs: 300000, maxRequests: 5 },\n  general: { windowMs: 60000, maxRequests: 100 },\n};\n\nconst rateLimitStore = new Map<string, Map<string, number[]>>();\n\nObject.keys(RATE_LIMITS).forEach(key => {\n  rateLimitStore.set(key, new Map());\n});\n\nexport function checkRateLimit(type: keyof typeof RATE_LIMITS, identifier: string): { allowed: boolean; retryAfter?: number } {\n  const config = RATE_LIMITS[type];\n  const store = rateLimitStore.get(type)!;\n  const now = Date.now();\n  \n  const timestamps = store.get(identifier) || [];\n  const validTimestamps = timestamps.filter(t => now - t < config.windowMs);\n  \n  if (validTimestamps.length >= config.maxRequests) {\n    const oldestValid = Math.min(...validTimestamps);\n    const retryAfter = Math.ceil((config.windowMs - (now - oldestValid)) / 1000);\n    return { allowed: false, retryAfter };\n  }\n  \n  validTimestamps.push(now);\n  store.set(identifier, validTimestamps);\n  return { allowed: true };\n}\n\nexport function cleanupRateLimits(): void {\n  const now = Date.now();\n  const storeEntries = Array.from(rateLimitStore.entries());\n  for (let i = 0; i < storeEntries.length; i++) {\n    const [type, store] = storeEntries[i];\n    const config = RATE_LIMITS[type as keyof typeof RATE_LIMITS];\n    const ipEntries = Array.from(store.entries());\n    for (let j = 0; j < ipEntries.length; j++) {\n      const [ip, timestamps] = ipEntries[j];\n      const valid = timestamps.filter((t: number) => now - t < config.windowMs);\n      if (valid.length === 0) {\n        store.delete(ip);\n      } else {\n        store.set(ip, valid);\n      }\n    }\n  }\n}\n\nsetInterval(cleanupRateLimits, 300000);\n\nexport function sanitizeHtml(input: string): string {\n  if (!input || typeof input !== 'string') return '';\n  \n  return input\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;')\n    .replace(/\\//g, '&#x2F;')\n    .replace(/`/g, '&#96;')\n    .trim();\n}\n\nexport function sanitizeObject<T extends Record<string, any>>(obj: T, fieldsToSanitize: (keyof T)[]): T {\n  const result = { ...obj };\n  for (const field of fieldsToSanitize) {\n    if (typeof result[field] === 'string') {\n      result[field] = sanitizeHtml(result[field] as string) as T[keyof T];\n    }\n  }\n  return result;\n}\n\nexport function validateEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email) && email.length <= 254;\n}\n\nexport function validatePhone(phone: string): boolean {\n  const phoneRegex = /^[\\d\\s+\\-().]{6,20}$/;\n  return phoneRegex.test(phone);\n}\n\nexport function validatePassword(password: string): { valid: boolean; message?: string } {\n  if (password.length < 8) {\n    return { valid: false, message: \"La contrase\u00F1a debe tener al menos 8 caracteres\" };\n  }\n  if (password.length > 128) {\n    return { valid: false, message: \"La contrase\u00F1a es demasiado larga\" };\n  }\n  return { valid: true };\n}\n\nexport type AuditAction = \n  | 'user_login'\n  | 'user_logout'\n  | 'user_register'\n  | 'password_change'\n  | 'password_reset'\n  | 'order_created'\n  | 'order_status_change'\n  | 'order_completed'\n  | 'payment_received'\n  | 'admin_user_update'\n  | 'admin_order_update'\n  | 'admin_send_email'\n  | 'document_upload'\n  | 'document_request'\n  | 'account_locked'\n  | 'account_unlocked'\n  | 'account_status_change';\n\ninterface AuditLogEntry {\n  action: AuditAction;\n  userId?: string;\n  targetId?: string;\n  ip?: string;\n  details?: Record<string, any>;\n  timestamp: Date;\n}\n\nconst auditLogs: AuditLogEntry[] = [];\nconst MAX_AUDIT_LOGS = 10000;\n\nexport function logAudit(entry: Omit<AuditLogEntry, 'timestamp'>): void {\n  const logEntry: AuditLogEntry = {\n    ...entry,\n    timestamp: new Date(),\n  };\n  \n  auditLogs.push(logEntry);\n  \n  if (auditLogs.length > MAX_AUDIT_LOGS) {\n    auditLogs.shift();\n  }\n  \n  if (process.env.NODE_ENV === 'development') {\n    console.log(`[AUDIT] ${entry.action}:`, {\n      userId: entry.userId,\n      targetId: entry.targetId,\n      details: entry.details\n    });\n  }\n}\n\nexport function getRecentAuditLogs(limit: number = 100): AuditLogEntry[] {\n  return auditLogs.slice(-limit).reverse();\n}\n\nexport async function checkDatabaseHealth(): Promise<{ healthy: boolean; latencyMs: number; error?: string }> {\n  const start = Date.now();\n  try {\n    await db.execute(sql`SELECT 1`);\n    return { healthy: true, latencyMs: Date.now() - start };\n  } catch (error) {\n    return { \n      healthy: false, \n      latencyMs: Date.now() - start, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n}\n\nexport async function getSystemHealth(): Promise<{\n  status: 'healthy' | 'degraded' | 'unhealthy';\n  database: { healthy: boolean; latencyMs: number };\n  memory: { usedMB: number; totalMB: number; percentUsed: number };\n  uptime: number;\n}> {\n  const dbHealth = await checkDatabaseHealth();\n  \n  const memUsage = process.memoryUsage();\n  const usedMB = Math.round(memUsage.heapUsed / 1024 / 1024);\n  const totalMB = Math.round(memUsage.heapTotal / 1024 / 1024);\n  const percentUsed = Math.round((memUsage.heapUsed / memUsage.heapTotal) * 100);\n  \n  let status: 'healthy' | 'degraded' | 'unhealthy' = 'healthy';\n  if (!dbHealth.healthy) {\n    status = 'unhealthy';\n  } else if (dbHealth.latencyMs > 1000 || percentUsed > 90) {\n    status = 'degraded';\n  }\n  \n  return {\n    status,\n    database: { healthy: dbHealth.healthy, latencyMs: dbHealth.latencyMs },\n    memory: { usedMB, totalMB, percentUsed },\n    uptime: process.uptime(),\n  };\n}\n\nexport function getClientIp(req: { ip?: string; headers: Record<string, string | string[] | undefined> }): string {\n  const forwarded = req.headers['x-forwarded-for'];\n  if (forwarded) {\n    const ip = Array.isArray(forwarded) ? forwarded[0] : forwarded.split(',')[0];\n    return ip.trim();\n  }\n  return req.ip || 'unknown';\n}\n", "import { db } from \"./db\";\nimport { sql } from \"drizzle-orm\";\nimport {\n  products, orders, llcApplications, applicationDocuments, newsletterSubscribers,\n  maintenanceApplications, messages as messagesTable, users,\n  type Product, type Order, type LlcApplication, type ApplicationDocument,\n  insertLlcApplicationSchema, insertApplicationDocumentSchema, insertOrderSchema\n} from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\ntype InsertOrder = z.infer<typeof insertOrderSchema>;\ntype InsertLlcApplication = z.infer<typeof insertLlcApplicationSchema>;\ntype InsertApplicationDocument = z.infer<typeof insertApplicationDocumentSchema>;\n\nexport interface IStorage {\n  // Products\n  getProducts(): Promise<Product[]>;\n  getProduct(id: number): Promise<Product | undefined>;\n  createProduct(product: Omit<Product, \"id\">): Promise<Product>;\n\n  // Orders\n  createOrder(order: InsertOrder): Promise<Order>;\n  getOrders(userId: string): Promise<(Order & { product: Product; application: LlcApplication | null })[]>;\n  getOrder(id: number): Promise<(Order & { product?: Product; application?: LlcApplication; user?: any }) | undefined>;\n\n  // LLC Applications\n  createLlcApplication(app: InsertLlcApplication): Promise<LlcApplication>;\n  getLlcApplication(id: number): Promise<LlcApplication | undefined>;\n  getLlcApplicationByOrderId(orderId: number): Promise<LlcApplication | undefined>;\n  getLlcApplicationByRequestCode(code: string): Promise<(LlcApplication & { documents: ApplicationDocument[] }) | undefined>;\n  updateLlcApplication(id: number, updates: Partial<LlcApplication>): Promise<LlcApplication>;\n\n  // Documents\n  createDocument(doc: InsertApplicationDocument): Promise<ApplicationDocument>;\n  getDocumentsByApplicationId(applicationId: number): Promise<ApplicationDocument[]>;\n  getDocumentsByOrderIds(orderIds: number[]): Promise<ApplicationDocument[]>;\n  deleteDocument(id: number): Promise<void>;\n\n  // Newsletter\n  subscribeToNewsletter(email: string): Promise<void>;\n  isSubscribedToNewsletter(email: string): Promise<boolean>;\n\n  // Admin\n  getAllOrders(): Promise<(Order & { product: Product; application: LlcApplication | null; maintenanceApplication: any; user: any })[]>;\n  updateOrderStatus(orderId: number, status: string): Promise<Order>;\n\n  // Messages\n  createMessage(message: any): Promise<any>;\n  getMessagesByUserId(userId: string): Promise<any[]>;\n  getAllMessages(): Promise<any[]>;\n  updateMessageStatus(id: number, status: string): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Products\n  async getProducts(): Promise<Product[]> {\n    return await db.select().from(products).orderBy(products.price);\n  }\n\n  async getProduct(id: number): Promise<Product | undefined> {\n    const [product] = await db.select().from(products).where(eq(products.id, id));\n    return product;\n  }\n\n  async createProduct(product: Omit<Product, \"id\">): Promise<Product> {\n    const [newProduct] = await db.insert(products).values(product).returning();\n    return newProduct;\n  }\n\n  // Orders\n  async createOrder(order: InsertOrder): Promise<Order> {\n    const [newOrder] = await db.insert(orders).values(order).returning();\n    return newOrder;\n  }\n\n  async getOrders(userId?: string): Promise<any[]> {\n    if (userId) {\n      return await db.query.orders.findMany({\n        where: eq(orders.userId, userId),\n        with: {\n          product: true,\n          application: true,\n          maintenanceApplication: true,\n        },\n        orderBy: desc(orders.createdAt),\n      });\n    }\n    return await db.query.orders.findMany({\n      with: {\n        product: true,\n        application: true,\n        maintenanceApplication: true,\n        user: true,\n      },\n      orderBy: desc(orders.createdAt),\n    });\n  }\n\n  async getOrder(id: number): Promise<(Order & { product?: Product; application?: LlcApplication; maintenanceApplication?: any; user?: any }) | undefined> {\n    const result = await db.query.orders.findFirst({\n      where: eq(orders.id, id),\n      with: {\n        product: true,\n        application: true,\n        maintenanceApplication: true,\n        user: true,\n      },\n    });\n    return result;\n  }\n\n  // LLC Applications\n  async createLlcApplication(app: z.infer<typeof insertLlcApplicationSchema>): Promise<LlcApplication> {\n    const [newApp] = await db.insert(llcApplications).values(app).returning();\n    return newApp;\n  }\n\n  async getLlcApplication(id: number): Promise<LlcApplication | undefined> {\n    const [app] = await db.select().from(llcApplications).where(eq(llcApplications.id, id));\n    return app;\n  }\n\n  async getLlcApplicationByOrderId(orderId: number): Promise<LlcApplication | undefined> {\n    const [app] = await db.select().from(llcApplications).where(eq(llcApplications.orderId, orderId));\n    return app;\n  }\n\n  async getLlcApplicationByRequestCode(code: string): Promise<(LlcApplication & { documents: ApplicationDocument[] }) | undefined> {\n    const result = await db.query.llcApplications.findFirst({\n      where: eq(llcApplications.requestCode, code),\n      with: {\n        documents: true,\n      },\n    });\n    return result as (LlcApplication & { documents: ApplicationDocument[] }) | undefined;\n  }\n\n  async updateLlcApplication(id: number, updates: Partial<LlcApplication>): Promise<LlcApplication> {\n    const [updated] = await db\n      .update(llcApplications)\n      .set({ ...updates, lastUpdated: new Date() })\n      .where(eq(llcApplications.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Documents\n  async createDocument(doc: InsertApplicationDocument): Promise<ApplicationDocument> {\n    const [newDoc] = await db.insert(applicationDocuments).values(doc).returning();\n    return newDoc;\n  }\n\n  async getDocumentsByApplicationId(applicationId: number): Promise<ApplicationDocument[]> {\n    return await db.select().from(applicationDocuments).where(eq(applicationDocuments.applicationId, applicationId));\n  }\n\n  async getDocumentsByOrderIds(orderIds: number[]): Promise<ApplicationDocument[]> {\n    const { inArray } = await import(\"drizzle-orm\");\n    if (orderIds.length === 0) return [];\n    return await db.select().from(applicationDocuments).where(inArray(applicationDocuments.orderId, orderIds));\n  }\n\n  async deleteDocument(id: number): Promise<void> {\n    await db.delete(applicationDocuments).where(eq(applicationDocuments.id, id));\n  }\n\n  // Newsletter\n  async subscribeToNewsletter(email: string): Promise<void> {\n    const subscribed = await this.isSubscribedToNewsletter(email);\n    if (!subscribed) {\n      await db.insert(newsletterSubscribers).values({ email });\n    }\n  }\n\n  async isSubscribedToNewsletter(email: string): Promise<boolean> {\n    const [subscriber] = await db.select().from(newsletterSubscribers).where(eq(newsletterSubscribers.email, email));\n    return !!subscriber;\n  }\n\n  // Admin methods\n  async getAllOrders(): Promise<(Order & { product: Product; application: LlcApplication | null; maintenanceApplication: any; user: any })[]> {\n    return await db.query.orders.findMany({\n      with: {\n        product: true,\n        application: true,\n        maintenanceApplication: true,\n        user: true,\n      },\n      orderBy: desc(orders.createdAt),\n    });\n  }\n\n  async updateOrderStatus(orderId: number, status: string): Promise<Order> {\n    const [updated] = await db\n      .update(orders)\n      .set({ status })\n      .where(eq(orders.id, orderId))\n      .returning();\n    return updated;\n  }\n\n  // Messages\n  async createMessage(message: any): Promise<any> {\n    const { encrypt } = await import(\"./utils/encryption\");\n    // Generate 8-digit message ID (purely numeric for tickets)\n    const msgId = Math.floor(10000000 + Math.random() * 90000000).toString();\n    \n    const encryptedContent = encrypt(message.content);\n    const [newMessage] = await db.insert(messagesTable).values({\n      ...message,\n      messageId: msgId,\n      encryptedContent\n    }).returning();\n    return newMessage;\n  }\n\n  async getMessagesByUserId(userId: string): Promise<any[]> {\n    return await db.select().from(messagesTable)\n      .where(eq(messagesTable.userId, userId))\n      .orderBy(desc(messagesTable.createdAt));\n  }\n\n  async getAllMessages(): Promise<any[]> {\n    return await db.query.messages.findMany({\n      orderBy: desc(messagesTable.createdAt),\n      with: {\n        replies: true\n      }\n    });\n  }\n\n  async updateMessageStatus(id: number, status: string): Promise<any> {\n    const [updated] = await db.update(messagesTable)\n      .set({ status })\n      .where(eq(messagesTable.id, id))\n      .returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n", "import { z } from 'zod';\nimport { insertLlcApplicationSchema, insertApplicationDocumentSchema, products, orders, llcApplications, applicationDocuments } from './schema';\n\nexport const errorSchemas = {\n  validation: z.object({\n    message: z.string(),\n    field: z.string().optional(),\n  }),\n  notFound: z.object({\n    message: z.string(),\n  }),\n  internal: z.object({\n    message: z.string(),\n  }),\n  unauthorized: z.object({\n    message: z.string(),\n  }),\n};\n\nexport const api = {\n  products: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/products',\n      responses: {\n        200: z.array(z.custom<typeof products.$inferSelect>()),\n      },\n    },\n    get: {\n      method: 'GET' as const,\n      path: '/api/products/:id',\n      responses: {\n        200: z.custom<typeof products.$inferSelect>(),\n        404: errorSchemas.notFound,\n      },\n    }\n  },\n  orders: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/orders',\n      responses: {\n        200: z.array(z.custom<typeof orders.$inferSelect & { product: typeof products.$inferSelect; application: typeof llcApplications.$inferSelect | null }>()),\n        401: errorSchemas.unauthorized,\n      },\n    },\n    create: {\n      method: 'POST' as const,\n      path: '/api/orders',\n      input: z.object({\n        productId: z.number(),\n      }),\n      responses: {\n        201: z.custom<typeof orders.$inferSelect>(),\n        400: errorSchemas.validation,\n        401: errorSchemas.unauthorized,\n      },\n    },\n  },\n  llc: {\n    get: {\n      method: 'GET' as const,\n      path: '/api/llc/:id',\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect>(),\n        404: errorSchemas.notFound,\n        401: errorSchemas.unauthorized,\n      },\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/llc/:id',\n      input: insertLlcApplicationSchema.partial(),\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect>(),\n        400: errorSchemas.validation,\n        401: errorSchemas.unauthorized,\n        404: errorSchemas.notFound,\n      },\n    },\n    getByCode: {\n      method: 'GET' as const,\n      path: '/api/llc/code/:code',\n      responses: {\n        200: z.custom<typeof llcApplications.$inferSelect & { documents: (typeof applicationDocuments.$inferSelect)[] }>(),\n        404: errorSchemas.notFound,\n      },\n    },\n  },\n  documents: {\n    create: {\n      method: 'POST' as const,\n      path: '/api/documents',\n      input: insertApplicationDocumentSchema,\n      responses: {\n        201: z.custom<typeof applicationDocuments.$inferSelect>(),\n        400: errorSchemas.validation,\n        404: errorSchemas.notFound,\n      },\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/documents/:id',\n      responses: {\n        200: z.object({ success: z.boolean() }),\n        404: errorSchemas.notFound,\n      },\n    },\n  },\n};\n\nexport function buildUrl(path: string, params?: Record<string, string | number>): string {\n  let url = path;\n  if (params) {\n    Object.entries(params).forEach(([key, value]) => {\n      if (url.includes(`:${key}`)) {\n        url = url.replace(`:${key}`, String(value));\n      }\n    });\n  }\n  return url;\n}\n", "import type { Express } from \"express\";\nimport type { Server } from \"http\";\nimport { setupCustomAuth, isAuthenticated, isAdmin } from \"./lib/custom-auth\";\nimport { storage } from \"./storage\";\nimport { api } from \"@shared/routes\";\nimport { z } from \"zod\";\nimport { insertLlcApplicationSchema, insertApplicationDocumentSchema } from \"@shared/schema\";\nimport type { Request, Response } from \"express\";\nimport { db } from \"./db\";\nimport { sendEmail, sendTrustpilotEmail, getOtpEmailTemplate, getConfirmationEmailTemplate, getWelcomeEmailTemplate, getNewsletterWelcomeTemplate, getAutoReplyTemplate, getEmailFooter, getEmailHeader, getOrderUpdateTemplate, getNoteReceivedTemplate, getAccountDeactivatedTemplate, getAccountUnderReviewTemplate, getOrderCompletedTemplate, getAccountVipTemplate, getAccountReactivatedTemplate, getAdminNoteTemplate, getPaymentRequestTemplate, getDocumentRequestTemplate, getMessageReplyTemplate, getPasswordChangeOtpTemplate, getOrderEventTemplate, getAdminLLCOrderTemplate, getAdminMaintenanceOrderTemplate } from \"./lib/email\";\nimport { contactOtps, products as productsTable, users as usersTable, maintenanceApplications, newsletterSubscribers, messages as messagesTable, orderEvents, messageReplies, userNotifications, orders as ordersTable, llcApplications as llcApplicationsTable, applicationDocuments as applicationDocumentsTable, discountCodes } from \"@shared/schema\";\nimport { and, eq, gt, desc, sql, isNotNull } from \"drizzle-orm\";\nimport { checkRateLimit, sanitizeHtml, logAudit, getSystemHealth, getClientIp, getRecentAuditLogs } from \"./lib/security\";\nimport { generateInvoicePdf, generateReceiptPdf } from \"./lib/pdf-generator\";\nimport { setupOAuth } from \"./oauth\";\nimport { checkAndSendReminders, updateApplicationDeadlines, getUpcomingDeadlinesForUser } from \"./calendar-service\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Enhanced Rate limiting with automatic cleanup\n  const rateLimit = new Map<string, number[]>();\n  const WINDOW_MS = 60000;\n  const MAX_REQUESTS = 100;\n  const CLEANUP_INTERVAL = 300000; // Clean up every 5 minutes\n  \n  // Periodic cleanup of stale IPs to prevent memory leak\n  setInterval(() => {\n    const now = Date.now();\n    const entries = Array.from(rateLimit.entries());\n    for (let i = 0; i < entries.length; i++) {\n      const [ip, timestamps] = entries[i];\n      const valid = timestamps.filter((t: number) => now - t < WINDOW_MS);\n      if (valid.length === 0) {\n        rateLimit.delete(ip);\n      } else {\n        rateLimit.set(ip, valid);\n      }\n    }\n  }, CLEANUP_INTERVAL);\n  \n  // Cleanup expired OTPs every 10 minutes\n  setInterval(async () => {\n    try {\n      await db.delete(contactOtps).where(\n        sql`${contactOtps.expiresAt} < NOW()`\n      );\n    } catch (e) {\n      console.error(\"OTP cleanup error:\", e);\n    }\n  }, 600000);\n  \n  app.use(\"/api/\", (req, res, next) => {\n    const now = Date.now();\n    const ip = req.ip || req.headers['x-forwarded-for']?.toString().split(',')[0] || \"unknown\";\n    \n    const timestamps = rateLimit.get(ip) || [];\n    const validTimestamps = timestamps.filter(t => now - t < WINDOW_MS);\n    \n    if (validTimestamps.length >= MAX_REQUESTS) {\n      res.setHeader('Retry-After', '60');\n      return res.status(429).json({ message: \"Demasiadas peticiones. Por favor, espera un minuto.\" });\n    }\n    \n    validTimestamps.push(now);\n    rateLimit.set(ip, validTimestamps);\n    next();\n  });\n\n  // Set up Custom Auth\n  setupCustomAuth(app);\n\n  // Set up Google OAuth\n  setupOAuth(app);\n\n  // Schedule compliance reminder checks every hour\n  setInterval(async () => {\n    try {\n      await checkAndSendReminders();\n    } catch (e) {\n      console.error(\"Compliance reminder check error:\", e);\n    }\n  }, 3600000);\n\n  // Run initial reminder check on startup (after 30 seconds to allow DB to be ready)\n  setTimeout(async () => {\n    try {\n      await checkAndSendReminders();\n      console.log(\"Initial compliance reminder check completed\");\n    } catch (e) {\n      console.error(\"Initial compliance reminder check error:\", e);\n    }\n  }, 30000);\n\n  // Health check endpoint for deployment with database verification\n  app.get(\"/api/healthz\", async (_req, res) => {\n    try {\n      const health = await getSystemHealth();\n      if (health.status === 'unhealthy') {\n        return res.status(503).json(health);\n      }\n      res.status(200).json(health);\n    } catch (error) {\n      res.status(503).json({ status: 'unhealthy', error: 'Health check failed' });\n    }\n  });\n\n  // Admin endpoint for audit logs\n  app.get(\"/api/admin/audit-logs\", isAdmin, async (_req, res) => {\n    const logs = getRecentAuditLogs(500);\n    res.json(logs);\n  });\n\n    // Unified activity log helper (console only - no email spam)\n    const logActivity = async (title: string, data: any, _req?: any) => {\n      if (process.env.NODE_ENV === 'development') {\n        console.log(`[LOG] ${title}:`, data);\n      }\n    };\n\n    // Error handler wrapper for routes\n    const asyncHandler = (fn: any) => (req: any, res: any, next: any) => {\n      Promise.resolve(fn(req, res, next)).catch(next);\n    };\n\n    // === Activity Tracking ===\n    app.post(\"/api/activity/track\", async (req, res) => {\n      const { action, details } = req.body;\n      if (action === \"CLICK_ELEGIR_ESTADO\") {\n        logActivity(\"Selecci\u00F3n de Estado\", { \"Detalles\": details }, req);\n      }\n      res.json({ success: true });\n    });\n\n  // === API Routes ===\n\n  // Admin Orders\n  app.get(\"/api/admin/orders\", isAdmin, async (req, res) => {\n    try {\n      const allOrders = await storage.getAllOrders();\n      res.json(allOrders);\n    } catch (error) {\n      console.error(\"Admin orders error:\", error);\n      res.status(500).json({ message: \"Error fetching orders\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/status\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const orderId = Number(req.params.id);\n    const { status } = z.object({ status: z.string() }).parse(req.body);\n    \n    const [updatedOrder] = await db.update(ordersTable)\n      .set({ status })\n      .where(eq(ordersTable.id, orderId))\n      .returning();\n    \n    // Audit log for order status change\n    logAudit({ \n      action: 'order_status_change', \n      userId: req.session?.userId, \n      targetId: String(orderId),\n      details: { newStatus: status } \n    });\n    \n    const order = await storage.getOrder(orderId);\n    if (order?.user?.email) {\n      const statusLabels: Record<string, string> = {\n        pending: \"Pendiente\",\n        processing: \"En proceso\",\n        paid: \"Pagado\",\n        filed: \"Presentado\",\n        documents_ready: \"Documentos listos\",\n        completed: \"Completado\",\n        cancelled: \"Cancelado\"\n      };\n      const statusLabel = statusLabels[status] || status.replace(/_/g, \" \");\n\n      // If order completed, upgrade user to VIP status and send Trustpilot email\n      if (status === 'completed' && order.userId) {\n        await db.update(usersTable)\n          .set({ accountStatus: 'vip' })\n          .where(eq(usersTable.id, order.userId));\n        \n        // Send Trustpilot review request email\n        const orderCode = order.application?.requestCode || order.maintenanceApplication?.requestCode || order.invoiceNumber || `#${order.id}`;\n        sendTrustpilotEmail({\n          to: order.user.email,\n          name: order.user.firstName || \"Cliente\",\n          orderNumber: orderCode\n        }).catch(() => {});\n      }\n\n      // Auto-calculate compliance deadlines when order is filed\n      if (status === 'filed' && order.application) {\n        const formationDate = new Date();\n        const state = order.application.state || \"new_mexico\";\n        await updateApplicationDeadlines(order.application.id, formationDate, state);\n      }\n\n      // Create Notification in Dashboard\n      const orderCode = order.application?.requestCode || order.maintenanceApplication?.requestCode || order.invoiceNumber || `#${order.id}`;\n      await db.insert(userNotifications).values({\n        userId: order.userId,\n        orderId: order.id,\n        orderCode,\n        title: `Actualizaci\u00F3n de pedido: ${statusLabel}`,\n        message: `Tu pedido ${orderCode} ha cambiado a: ${statusLabel}.${status === 'completed' ? ' \u00A1Enhorabuena, ahora eres cliente VIP!' : ''}`,\n        type: 'update',\n        isRead: false\n      });\n\n      // Add Order Event for Timeline\n      await db.insert(orderEvents).values({\n        orderId: order.id,\n        eventType: statusLabel,\n        description: `El estado del pedido ha sido actualizado a ${statusLabel}.`,\n        createdBy: req.session.userId\n      });\n\n      sendEmail({\n        to: order.user.email,\n        subject: `Actualizaci\u00F3n de estado - Pedido ${order.invoiceNumber || `#${order.id}`}`,\n        html: getOrderUpdateTemplate(\n          order.user.firstName || \"Cliente\",\n          order.invoiceNumber || `#${order.id}`,\n          status,\n          `Tu pedido ha pasado a estado: ${statusLabels[status] || status}. Puedes ver los detalles en tu panel de control.`\n        )\n      }).catch(() => {});\n    }\n    res.json(updatedOrder);\n  }));\n\n  // Delete order (admin only) - Full cascade deletion\n  app.delete(\"/api/admin/orders/:id\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const orderId = Number(req.params.id);\n    \n    // Get order details before deletion for logging\n    const order = await storage.getOrder(orderId);\n    if (!order) {\n      return res.status(404).json({ message: \"Pedido no encontrado\" });\n    }\n    \n    // Use transaction for safe cascade deletion\n    await db.transaction(async (tx) => {\n      // Delete order events\n      await tx.delete(orderEvents).where(eq(orderEvents.orderId, orderId));\n      \n      // Delete application documents\n      await tx.delete(applicationDocumentsTable).where(eq(applicationDocumentsTable.orderId, orderId));\n      \n      // Delete user notifications related to this order\n      if (order.userId) {\n        await tx.delete(userNotifications).where(\n          and(\n            eq(userNotifications.userId, order.userId),\n            sql`${userNotifications.message} LIKE ${'%' + (order.invoiceNumber || `#${orderId}`) + '%'}`\n          )\n        );\n      }\n      \n      // Delete the LLC application if exists\n      if (order.application?.id) {\n        await tx.delete(llcApplicationsTable).where(eq(llcApplicationsTable.id, order.application.id));\n      }\n      \n      // Finally delete the order\n      await tx.delete(ordersTable).where(eq(ordersTable.id, orderId));\n    });\n    \n    res.json({ success: true, message: \"Pedido eliminado correctamente\" });\n  }));\n\n  // Update LLC important dates with automatic calculation\n  app.patch(\"/api/admin/llc/:appId/dates\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const appId = Number(req.params.appId);\n    const { field, value } = z.object({ \n      field: z.enum(['llcCreatedDate', 'agentRenewalDate', 'irs1120DueDate', 'irs5472DueDate', 'annualReportDueDate']),\n      value: z.string()\n    }).parse(req.body);\n    \n    const dateValue = value ? new Date(value) : null;\n    const updateData: Record<string, Date | null> = {};\n    updateData[field] = dateValue;\n    \n    // Auto-calculate other fiscal dates when llcCreatedDate is set\n    if (field === 'llcCreatedDate' && dateValue) {\n      const creationDate = new Date(dateValue);\n      const creationYear = creationDate.getFullYear();\n      const nextYear = creationYear + 1;\n      \n      // Agent renewal: 1 year after creation\n      const agentRenewal = new Date(creationDate);\n      agentRenewal.setFullYear(agentRenewal.getFullYear() + 1);\n      updateData.agentRenewalDate = agentRenewal;\n      \n      // IRS 1120: March 15 of next year\n      updateData.irs1120DueDate = new Date(nextYear, 2, 15);\n      \n      // IRS 5472: April 15 of next year\n      updateData.irs5472DueDate = new Date(nextYear, 3, 15);\n      \n      // Annual Report: Get the LLC state to determine date\n      const [app] = await db.select({ state: llcApplicationsTable.state })\n        .from(llcApplicationsTable)\n        .where(eq(llcApplicationsTable.id, appId))\n        .limit(1);\n      \n      if (app?.state) {\n        // Annual report dates by state\n        // New Mexico: No annual report required\n        // Wyoming: First day of anniversary month\n        // Delaware: March 1\n        if (app.state === 'Wyoming') {\n          const wyomingDate = new Date(creationDate);\n          wyomingDate.setFullYear(wyomingDate.getFullYear() + 1);\n          wyomingDate.setDate(1);\n          updateData.annualReportDueDate = wyomingDate;\n        } else if (app.state === 'Delaware') {\n          updateData.annualReportDueDate = new Date(nextYear, 2, 1); // March 1\n        }\n        // New Mexico: no annual report, leave as null\n      }\n    }\n    \n    await db.update(llcApplicationsTable)\n      .set(updateData)\n      .where(eq(llcApplicationsTable.id, appId));\n    \n    res.json({ success: true });\n  }));\n\n  // Admin Users\n  app.get(\"/api/admin/users\", isAdmin, async (req, res) => {\n    try {\n      const users = await db.select().from(usersTable).orderBy(desc(usersTable.createdAt));\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching users\" });\n    }\n  });\n\n  app.patch(\"/api/admin/users/:id\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const userId = req.params.id;\n    const updateSchema = z.object({\n      firstName: z.string().min(1).max(100).optional(),\n      lastName: z.string().min(1).max(100).optional(),\n      email: z.string().email().optional(),\n      phone: z.string().max(30).optional().nullable(),\n      address: z.string().optional().nullable(),\n      streetType: z.string().optional().nullable(),\n      city: z.string().optional().nullable(),\n      province: z.string().optional().nullable(),\n      postalCode: z.string().optional().nullable(),\n      country: z.string().optional().nullable(),\n      idNumber: z.string().optional().nullable(),\n      idType: z.enum(['dni', 'nie', 'passport']).optional().nullable(),\n      birthDate: z.string().optional().nullable(),\n      businessActivity: z.string().optional().nullable(),\n      isActive: z.boolean().optional(),\n      isAdmin: z.boolean().optional(),\n      accountStatus: z.enum(['active', 'pending', 'deactivated', 'vip']).optional(),\n      internalNotes: z.string().optional()\n    });\n    const data = updateSchema.parse(req.body);\n    \n    const [updated] = await db.update(usersTable).set({\n      ...data,\n      updatedAt: new Date()\n    }).where(eq(usersTable.id, userId)).returning();\n\n    // Audit log for user update\n    logAudit({ \n      action: 'admin_user_update', \n      userId: req.session?.userId, \n      targetId: userId,\n      details: { changes: Object.keys(data) } \n    });\n\n    // Trigger emails based on account status change\n    if (data.accountStatus) {\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      if (user && user.email) {\n        if (data.accountStatus === 'deactivated') {\n          await sendEmail({\n            to: user.email,\n            subject: \"Notificaci\u00F3n de estado de cuenta\",\n            html: getAccountDeactivatedTemplate(user.firstName || \"Cliente\")\n          }).catch(() => {});\n          await db.insert(userNotifications).values({\n            userId,\n            title: \"Cuenta desactivada\",\n            message: \"Tu cuenta ha sido desactivada. Contacta con soporte si tienes dudas.\",\n            type: 'action_required',\n            isRead: false\n          });\n        } else if (data.accountStatus === 'vip') {\n          await sendEmail({\n            to: user.email,\n            subject: \"Tu cuenta ha sido actualizada a estado VIP\",\n            html: getAccountVipTemplate(user.firstName || \"Cliente\")\n          }).catch(() => {});\n          await db.insert(userNotifications).values({\n            userId,\n            title: \"Estado VIP activado\",\n            message: \"Tu cuenta ha sido actualizada al estado VIP con beneficios prioritarios.\",\n            type: 'update',\n            isRead: false\n          });\n        } else if (data.accountStatus === 'active') {\n          await sendEmail({\n            to: user.email,\n            subject: \"Tu cuenta ha sido reactivada\",\n            html: getAccountReactivatedTemplate(user.firstName || \"Cliente\")\n          }).catch(() => {});\n          await db.insert(userNotifications).values({\n            userId,\n            title: \"Cuenta reactivada\",\n            message: \"Tu cuenta ha sido reactivada y ya puedes acceder a todos los servicios.\",\n            type: 'update',\n            isRead: false\n          });\n        }\n      }\n    }\n\n    // Log account changes to admin\n    if (data.accountStatus || data.isActive !== undefined) {\n      logActivity(\"Cambio Cr\u00EDtico de Cuenta\", { \n        userId, \n        \"Nuevo Estado\": data.accountStatus, \n        \"Activo\": data.isActive,\n        adminId: (req as any).session.userId \n      }, req);\n    }\n\n    res.json(updated);\n  }));\n\n  app.delete(\"/api/admin/users/:id\", isAdmin, async (req, res) => {\n    try {\n      const userId = req.params.id;\n      await db.delete(usersTable).where(eq(usersTable.id, userId));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Error al eliminar usuario\" });\n    }\n  });\n\n  app.post(\"/api/admin/users/create\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const schema = z.object({\n      firstName: z.string().optional(),\n      lastName: z.string().optional(),\n      email: z.string().email(),\n      phone: z.string().optional(),\n      password: z.string().min(6)\n    });\n    const { firstName, lastName, email, phone, password } = schema.parse(req.body);\n    \n    const existing = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n    if (existing.length > 0) {\n      return res.status(400).json({ message: \"El email ya est\u00E1 registrado\" });\n    }\n    \n    const bcrypt = await import(\"bcrypt\");\n    const hashedPassword = await bcrypt.hash(password, 10);\n    \n    const [newUser] = await db.insert(usersTable).values({\n      email,\n      firstName: firstName || null,\n      lastName: lastName || null,\n      phone: phone || null,\n      passwordHash: hashedPassword,\n      emailVerified: true,\n      accountStatus: 'active'\n    }).returning();\n    \n    res.json({ success: true, userId: newUser.id });\n  }));\n\n  app.post(\"/api/admin/orders/create\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const validStates = [\"New Mexico\", \"Wyoming\", \"Delaware\"] as const;\n    const schema = z.object({\n      userId: z.string().uuid(),\n      state: z.enum(validStates),\n      amount: z.string().or(z.number()).refine(val => Number(val) > 0, { message: \"El importe debe ser mayor que 0\" })\n    });\n    const { userId, state, amount } = schema.parse(req.body);\n    \n    const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n    if (!user) {\n      return res.status(404).json({ message: \"Usuario no encontrado\" });\n    }\n    \n    const productMap: Record<string, { id: number; name: string }> = {\n      \"New Mexico\": { id: 1, name: \"LLC New Mexico\" },\n      \"Wyoming\": { id: 2, name: \"LLC Wyoming\" },\n      \"Delaware\": { id: 3, name: \"LLC Delaware\" }\n    };\n    const product = productMap[state];\n    const amountCents = Math.round(Number(amount) * 100);\n    \n    const statePrefix = state === \"Wyoming\" ? \"WY\" : state === \"Delaware\" ? \"DE\" : \"NM\";\n    const year = new Date().getFullYear().toString().slice(-2);\n    const timestamp = Date.now().toString(36).toUpperCase().slice(-4);\n    const randomSuffix = Math.random().toString(36).substring(2, 6).toUpperCase();\n    const invoiceNumber = `${statePrefix}-${year}${timestamp}-${randomSuffix}`;\n    \n    const [order] = await db.insert(ordersTable).values({\n      userId,\n      productId: product.id,\n      amount: amountCents,\n      status: 'pending',\n      invoiceNumber\n    }).returning();\n    \n    await db.insert(orderEvents).values({\n      orderId: order.id,\n      eventType: 'order_created',\n      description: `Pedido ${invoiceNumber} creado por administrador`\n    });\n    \n    await db.insert(userNotifications).values({\n      userId,\n      orderId: order.id,\n      orderCode: invoiceNumber,\n      title: 'Nuevo pedido registrado',\n      message: `Se ha registrado el pedido ${invoiceNumber} para ${product.name}`,\n      type: 'info',\n      isRead: false\n    });\n    \n    res.json({ success: true, orderId: order.id, invoiceNumber });\n  }));\n\n  app.get(\"/api/admin/system-stats\", isAdmin, async (req, res) => {\n    try {\n      // Core metrics - parallel queries for performance\n      const [\n        salesResult,\n        pendingSalesResult,\n        userResult,\n        orderResult,\n        pendingOrdersResult,\n        completedOrdersResult,\n        processingOrdersResult,\n        subscriberResult,\n        pendingAccountsResult,\n        activeAccountsResult,\n        vipAccountsResult,\n        deactivatedAccountsResult,\n        messagesResult,\n        pendingMessagesResult,\n        docsResult,\n        pendingDocsResult\n      ] = await Promise.all([\n        db.select({ total: sql<number>`COALESCE(sum(amount), 0)` }).from(ordersTable).where(eq(ordersTable.status, 'completed')),\n        db.select({ total: sql<number>`COALESCE(sum(amount), 0)` }).from(ordersTable).where(eq(ordersTable.status, 'pending')),\n        db.select({ count: sql<number>`count(*)` }).from(usersTable),\n        db.select({ count: sql<number>`count(*)` }).from(ordersTable),\n        db.select({ count: sql<number>`count(*)` }).from(ordersTable).where(eq(ordersTable.status, 'pending')),\n        db.select({ count: sql<number>`count(*)` }).from(ordersTable).where(eq(ordersTable.status, 'completed')),\n        db.select({ count: sql<number>`count(*)` }).from(ordersTable).where(eq(ordersTable.status, 'processing')),\n        db.select({ count: sql<number>`count(*)` }).from(newsletterSubscribers),\n        db.select({ count: sql<number>`count(*)` }).from(usersTable).where(eq(usersTable.accountStatus, 'pending')),\n        db.select({ count: sql<number>`count(*)` }).from(usersTable).where(eq(usersTable.accountStatus, 'active')),\n        db.select({ count: sql<number>`count(*)` }).from(usersTable).where(eq(usersTable.accountStatus, 'vip')),\n        db.select({ count: sql<number>`count(*)` }).from(usersTable).where(eq(usersTable.accountStatus, 'deactivated')),\n        db.select({ count: sql<number>`count(*)` }).from(messagesTable),\n        db.select({ count: sql<number>`count(*)` }).from(messagesTable).where(eq(messagesTable.status, 'pending')),\n        db.select({ count: sql<number>`count(*)` }).from(applicationDocumentsTable),\n        db.select({ count: sql<number>`count(*)` }).from(applicationDocumentsTable).where(eq(applicationDocumentsTable.reviewStatus, 'pending'))\n      ]);\n\n      const totalSales = Number(salesResult[0]?.total || 0);\n      const pendingSales = Number(pendingSalesResult[0]?.total || 0);\n      const userCount = Number(userResult[0]?.count || 0);\n      const orderCount = Number(orderResult[0]?.count || 0);\n      const pendingOrders = Number(pendingOrdersResult[0]?.count || 0);\n      const completedOrders = Number(completedOrdersResult[0]?.count || 0);\n      const processingOrders = Number(processingOrdersResult[0]?.count || 0);\n      const subscriberCount = Number(subscriberResult[0]?.count || 0);\n      const pendingAccounts = Number(pendingAccountsResult[0]?.count || 0);\n      const activeAccounts = Number(activeAccountsResult[0]?.count || 0);\n      const vipAccounts = Number(vipAccountsResult[0]?.count || 0);\n      const deactivatedAccounts = Number(deactivatedAccountsResult[0]?.count || 0);\n      const totalMessages = Number(messagesResult[0]?.count || 0);\n      const pendingMessages = Number(pendingMessagesResult[0]?.count || 0);\n      const totalDocs = Number(docsResult[0]?.count || 0);\n      const pendingDocs = Number(pendingDocsResult[0]?.count || 0);\n\n      // Conversion rate\n      const conversionRate = userCount > 0 ? (orderCount / userCount) * 100 : 0;\n\n      res.json({ \n        // Sales\n        totalSales,\n        pendingSales,\n        // Orders\n        orderCount,\n        pendingOrders,\n        completedOrders,\n        processingOrders,\n        // Users\n        userCount,\n        pendingAccounts,\n        activeAccounts,\n        vipAccounts,\n        deactivatedAccounts,\n        // Newsletter\n        subscriberCount,\n        // Messages\n        totalMessages,\n        pendingMessages,\n        // Documents\n        totalDocs,\n        pendingDocs,\n        // Metrics\n        conversionRate: Number(conversionRate.toFixed(2))\n      });\n    } catch (error) {\n      console.error(\"System stats error:\", error);\n      res.status(500).json({ message: \"Error fetching system stats\" });\n    }\n  });\n\n  app.get(\"/api/admin/stats\", isAdmin, async (req, res) => {\n    try {\n      const result = await db.select({ total: sql<number>`sum(amount)` }).from(ordersTable).where(eq(ordersTable.status, 'completed'));\n      res.json({ totalSales: Number(result[0]?.total || 0) });\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching stats\" });\n    }\n  });\n\n  // ============== DISCOUNT CODES ==============\n  \n  // Get all discount codes (admin)\n  app.get(\"/api/admin/discount-codes\", isAdmin, async (req, res) => {\n    try {\n      const codes = await db.select().from(discountCodes).orderBy(desc(discountCodes.createdAt));\n      res.json(codes);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching discount codes\" });\n    }\n  });\n\n  // Create discount code (admin)\n  app.post(\"/api/admin/discount-codes\", isAdmin, async (req, res) => {\n    try {\n      const { code, description, discountType, discountValue, minOrderAmount, maxUses, validFrom, validUntil, isActive } = req.body;\n      \n      if (!code || !discountValue) {\n        return res.status(400).json({ message: \"C\u00F3digo y valor de descuento son requeridos\" });\n      }\n\n      const [existing] = await db.select().from(discountCodes).where(eq(discountCodes.code, code.toUpperCase())).limit(1);\n      if (existing) {\n        return res.status(400).json({ message: \"Este c\u00F3digo ya existe\" });\n      }\n\n      const [newCode] = await db.insert(discountCodes).values({\n        code: code.toUpperCase(),\n        description,\n        discountType: discountType || 'percentage',\n        discountValue: parseInt(discountValue),\n        minOrderAmount: minOrderAmount ? parseInt(minOrderAmount) : 0,\n        maxUses: maxUses ? parseInt(maxUses) : null,\n        validFrom: validFrom ? new Date(validFrom) : new Date(),\n        validUntil: validUntil ? new Date(validUntil) : null,\n        isActive: isActive !== false,\n      }).returning();\n\n      res.status(201).json(newCode);\n    } catch (error) {\n      res.status(500).json({ message: \"Error creating discount code\" });\n    }\n  });\n\n  // Update discount code (admin)\n  app.patch(\"/api/admin/discount-codes/:id\", isAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { code, description, discountType, discountValue, minOrderAmount, maxUses, validFrom, validUntil, isActive } = req.body;\n\n      const updateData: any = {};\n      if (code) updateData.code = code.toUpperCase();\n      if (description !== undefined) updateData.description = description;\n      if (discountType) updateData.discountType = discountType;\n      if (discountValue !== undefined) updateData.discountValue = parseInt(discountValue);\n      if (minOrderAmount !== undefined) updateData.minOrderAmount = parseInt(minOrderAmount);\n      if (maxUses !== undefined) updateData.maxUses = maxUses ? parseInt(maxUses) : null;\n      if (validFrom) updateData.validFrom = new Date(validFrom);\n      if (validUntil !== undefined) updateData.validUntil = validUntil ? new Date(validUntil) : null;\n      if (isActive !== undefined) updateData.isActive = isActive;\n\n      const [updated] = await db.update(discountCodes).set(updateData).where(eq(discountCodes.id, id)).returning();\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating discount code\" });\n    }\n  });\n\n  // Delete discount code (admin)\n  app.delete(\"/api/admin/discount-codes/:id\", isAdmin, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await db.delete(discountCodes).where(eq(discountCodes.id, id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error deleting discount code\" });\n    }\n  });\n\n  // Validate discount code (public - for checkout)\n  app.post(\"/api/discount-codes/validate\", async (req, res) => {\n    try {\n      const { code, orderAmount } = req.body;\n      \n      if (!code) {\n        return res.status(400).json({ valid: false, message: \"C\u00F3digo requerido\" });\n      }\n\n      const [discountCode] = await db.select().from(discountCodes).where(eq(discountCodes.code, code.toUpperCase())).limit(1);\n      \n      if (!discountCode) {\n        return res.status(404).json({ valid: false, message: \"C\u00F3digo no encontrado\" });\n      }\n\n      if (!discountCode.isActive) {\n        return res.status(400).json({ valid: false, message: \"C\u00F3digo inactivo\" });\n      }\n\n      const now = new Date();\n      if (discountCode.validFrom && new Date(discountCode.validFrom) > now) {\n        return res.status(400).json({ valid: false, message: \"C\u00F3digo a\u00FAn no v\u00E1lido\" });\n      }\n      if (discountCode.validUntil && new Date(discountCode.validUntil) < now) {\n        return res.status(400).json({ valid: false, message: \"C\u00F3digo expirado\" });\n      }\n\n      if (discountCode.maxUses && discountCode.usedCount >= discountCode.maxUses) {\n        return res.status(400).json({ valid: false, message: \"C\u00F3digo agotado\" });\n      }\n\n      if (discountCode.minOrderAmount && orderAmount && orderAmount < discountCode.minOrderAmount) {\n        return res.status(400).json({ valid: false, message: `Pedido m\u00EDnimo: ${(discountCode.minOrderAmount / 100).toFixed(2)}\u20AC` });\n      }\n\n      // Calculate discount\n      let discountAmount = 0;\n      if (orderAmount) {\n        if (discountCode.discountType === 'percentage') {\n          discountAmount = Math.round((orderAmount * discountCode.discountValue) / 100);\n        } else {\n          discountAmount = discountCode.discountValue;\n        }\n      }\n\n      res.json({\n        valid: true,\n        code: discountCode.code,\n        discountType: discountCode.discountType,\n        discountValue: discountCode.discountValue,\n        discountAmount,\n        description: discountCode.description,\n      });\n    } catch (error) {\n      res.status(500).json({ valid: false, message: \"Error validating code\" });\n    }\n  });\n\n  // Admin Newsletter\n  app.get(\"/api/admin/newsletter\", isAdmin, async (req, res) => {\n    try {\n      const subscribers = await db.select().from(newsletterSubscribers).orderBy(desc(newsletterSubscribers.subscribedAt));\n      res.json(subscribers);\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  // Broadcast to all newsletter subscribers\n  app.post(\"/api/admin/newsletter/broadcast\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const { subject, message } = z.object({\n      subject: z.string().min(1),\n      message: z.string().min(1)\n    }).parse(req.body);\n\n    const subscribers = await db.select().from(newsletterSubscribers);\n    \n    const html = `\n      <div style=\"font-family: Inter, sans-serif; max-width: 600px; margin: 0 auto; padding: 40px 20px; background: #f7f7f5;\">\n        <div style=\"background: white; padding: 32px; border-radius: 16px;\">\n          <h1 style=\"font-size: 24px; font-weight: 900; color: #0E1215; margin: 0 0 24px 0;\">${subject}</h1>\n          <div style=\"font-size: 15px; line-height: 1.6; color: #333;\">${message.replace(/\\n/g, '<br>')}</div>\n          <hr style=\"border: none; border-top: 1px solid #E6E9EC; margin: 32px 0;\" />\n          <p style=\"font-size: 12px; color: #6B7280; margin: 0;\">Easy US LLC - Formaci\u00F3n de empresas en USA</p>\n        </div>\n      </div>\n    `;\n\n    let sent = 0;\n    for (const sub of subscribers) {\n      try {\n        await sendEmail({ to: sub.email, subject, html });\n        sent++;\n      } catch (e) {\n        // Email error silenced\n      }\n    }\n\n    res.json({ success: true, sent, total: subscribers.length });\n  }));\n\n  // Admin Messages\n  app.get(\"/api/admin/messages\", isAdmin, async (req, res) => {\n    try {\n      const allMessages = await storage.getAllMessages();\n      res.json(allMessages);\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  app.patch(\"/api/admin/messages/:id/archive\", isAdmin, async (req, res) => {\n    try {\n      const updated = await storage.updateMessageStatus(Number(req.params.id), 'archived');\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error al archivar mensaje\" });\n    }\n  });\n\n  // Document Management - Upload official docs by Admin\n  app.post(\"/api/admin/documents\", isAdmin, async (req, res) => {\n    try {\n      const { orderId, fileName, fileUrl, documentType, applicationId } = req.body;\n      const [doc] = await db.insert(applicationDocumentsTable).values({\n        orderId,\n        applicationId,\n        fileName,\n        fileType: \"application/pdf\",\n        fileUrl,\n        documentType: documentType || \"official_filing\",\n        reviewStatus: \"approved\",\n        uploadedBy: (req as any).session.userId\n      }).returning();\n      \n      res.json(doc);\n    } catch (error) {\n      console.error(\"Upload doc error:\", error);\n      res.status(500).json({ message: \"Error uploading document\" });\n    }\n  });\n\n  app.get(\"/api/user/documents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const docs = await db.select().from(applicationDocumentsTable)\n        .leftJoin(ordersTable, eq(applicationDocumentsTable.orderId, ordersTable.id))\n        .where(eq(ordersTable.userId, req.session.userId))\n        .orderBy(desc(applicationDocumentsTable.uploadedAt));\n      res.json(docs.map(d => d.application_documents));\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching documents\" });\n    }\n  });\n\n  app.delete(\"/api/user/documents/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      const docId = parseInt(req.params.id);\n      \n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      if (!user || user.accountStatus === 'pending') {\n        return res.status(403).json({ message: \"No puedes eliminar documentos mientras tu cuenta est\u00E1 en revisi\u00F3n\" });\n      }\n      \n      const docs = await db.select().from(applicationDocumentsTable)\n        .leftJoin(ordersTable, eq(applicationDocumentsTable.orderId, ordersTable.id))\n        .where(and(\n          eq(applicationDocumentsTable.id, docId),\n          eq(ordersTable.userId, userId)\n        ));\n      \n      if (!docs.length) {\n        return res.status(404).json({ message: \"Documento no encontrado\" });\n      }\n      \n      await db.delete(applicationDocumentsTable).where(eq(applicationDocumentsTable.id, docId));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting document:\", error);\n      res.status(500).json({ message: \"Error al eliminar documento\" });\n    }\n  });\n\n\n  // Client document upload\n  app.post(\"/api/documents/upload\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { orderId, fileName, fileUrl, documentType, applicationId } = z.object({\n        orderId: z.number(),\n        applicationId: z.number(),\n        fileName: z.string(),\n        fileUrl: z.string(),\n        documentType: z.string()\n      }).parse(req.body);\n\n      const [doc] = await db.insert(applicationDocumentsTable).values({\n        orderId,\n        applicationId,\n        fileName,\n        fileType: \"application/pdf\",\n        fileUrl,\n        documentType,\n        reviewStatus: \"pending\",\n        uploadedBy: req.session.userId\n      }).returning();\n\n      logActivity(\"Documento Subido por Cliente\", { \n        \"Cliente ID\": req.session.userId,\n        \"Pedido ID\": orderId,\n        \"Tipo\": documentType\n      });\n\n      res.json(doc);\n    } catch (error) {\n      res.status(500).json({ message: \"Error al subir documento\" });\n    }\n  });\n\n  app.get(\"/api/products\", async (req, res) => {\n    const products = await storage.getProducts();\n    res.json(products);\n  });\n\n  // Protected admin seeding - requires existing admin authentication\n  app.post(\"/api/seed-admin\", isAdmin, async (req, res) => {\n    try {\n      const { email } = req.body;\n      const adminEmail = email || process.env.ADMIN_EMAIL || \"afortuny07@gmail.com\";\n      \n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, adminEmail)).limit(1);\n      if (!existingUser) {\n        return res.status(404).json({ message: \"Usuario no encontrado.\" });\n      }\n      \n      await db.update(usersTable).set({ isAdmin: true, accountStatus: 'active' }).where(eq(usersTable.email, adminEmail));\n      res.json({ success: true, message: \"Rol de administrador asignado correctamente\" });\n    } catch (error) {\n      console.error(\"Seed admin error:\", error);\n      res.status(500).json({ message: \"Error al asignar rol de administrador\" });\n    }\n  });\n\n  // Client Delete Account\n  app.delete(\"/api/user/account\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      const { mode } = req.body; // 'hard' for 100% delete, 'soft' to keep data but disable email\n\n      if (mode === 'hard') {\n        await db.delete(usersTable).where(eq(usersTable.id, userId));\n      } else {\n        // Soft delete: Keep record but mark as deactivated and change email to prevent reuse\n        const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n        await db.update(usersTable).set({ \n          accountStatus: 'deactivated',\n          isActive: false,\n          email: `deleted_${userId}_${user.email}`,\n          updatedAt: new Date()\n        }).where(eq(usersTable.id, userId));\n      }\n\n      req.session.destroy(() => {});\n      res.json({ success: true, message: \"Cuenta procesada correctamente\" });\n    } catch (error) {\n      console.error(\"Delete account error:\", error);\n      res.status(500).json({ message: \"Error al procesar la eliminaci\u00F3n de cuenta\" });\n    }\n  });\n\n  // Client Update Profile\n  const updateProfileSchema = z.object({\n    firstName: z.string().optional(),\n    lastName: z.string().optional(),\n    phone: z.string().optional(),\n    businessActivity: z.string().optional(),\n    address: z.string().optional(),\n    streetType: z.string().optional(),\n    city: z.string().optional(),\n    province: z.string().optional(),\n    postalCode: z.string().optional(),\n    country: z.string().optional(),\n    idNumber: z.string().optional(),\n    idType: z.string().optional(),\n    birthDate: z.string().optional(),\n  });\n  \n  app.patch(\"/api/user/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      const validatedData = updateProfileSchema.parse(req.body);\n      \n      await db.update(usersTable).set(validatedData).where(eq(usersTable.id, userId));\n      \n      const [updatedUser] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      res.json(updatedUser);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      console.error(\"Update profile error:\", error);\n      res.status(500).json({ message: \"Error updating profile\" });\n    }\n  });\n\n  // User Compliance Deadlines - Calendar API\n  app.get(\"/api/user/deadlines\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      \n      // Get all user orders with applications\n      const userOrders = await db.select({\n        order: ordersTable,\n        application: llcApplicationsTable,\n      })\n      .from(ordersTable)\n      .leftJoin(llcApplicationsTable, eq(ordersTable.id, llcApplicationsTable.orderId))\n      .where(eq(ordersTable.userId, userId));\n\n      const applications = userOrders\n        .filter(o => o.application)\n        .map(o => o.application);\n\n      const deadlines = getUpcomingDeadlinesForUser(applications);\n      res.json(deadlines);\n    } catch (error) {\n      console.error(\"Error fetching deadlines:\", error);\n      res.status(500).json({ message: \"Error al obtener fechas de cumplimiento\" });\n    }\n  });\n\n  // Admin: Set formation date for an application (triggers auto-calculation)\n  app.post(\"/api/admin/applications/:id/set-formation-date\", isAdmin, async (req, res) => {\n    try {\n      const applicationId = parseInt(req.params.id);\n      const { formationDate, state } = z.object({\n        formationDate: z.string(),\n        state: z.string().optional()\n      }).parse(req.body);\n\n      const [app] = await db.select().from(llcApplicationsTable).where(eq(llcApplicationsTable.id, applicationId)).limit(1);\n      if (!app) {\n        return res.status(404).json({ message: \"Aplicaci\u00F3n no encontrada\" });\n      }\n\n      const deadlines = await updateApplicationDeadlines(\n        applicationId, \n        new Date(formationDate), \n        state || app.state || \"new_mexico\"\n      );\n\n      res.json({ \n        success: true, \n        message: \"Fechas de cumplimiento calculadas exitosamente\",\n        deadlines \n      });\n    } catch (error) {\n      console.error(\"Error setting formation date:\", error);\n      res.status(500).json({ message: \"Error al establecer fecha de constituci\u00F3n\" });\n    }\n  });\n\n  // User notifications - Unified Note + Email System\n  app.post(\"/api/admin/send-note\", isAdmin, async (req, res) => {\n    try {\n      const { userId, title, message, type } = z.object({\n        userId: z.string(),\n        title: z.string().min(1, \"T\u00EDtulo requerido\"),\n        message: z.string().min(1, \"Mensaje requerido\"),\n        type: z.enum(['update', 'info', 'action_required'])\n      }).parse(req.body);\n\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      if (!user) return res.status(404).json({ message: \"Usuario no encontrado\" });\n\n      // Generate unique ticket ID (8-digit numeric format)\n      const { generateUniqueTicketId } = await import(\"./lib/id-generator\");\n      const ticketId = await generateUniqueTicketId();\n\n      // Create Notification in system with ticketId\n      await db.insert(userNotifications).values({\n        userId,\n        title,\n        message,\n        type,\n        ticketId,\n        isRead: false\n      });\n\n      // Always send email notification with ticket reference\n      if (user.email) {\n        await sendEmail({\n          to: user.email,\n          subject: `${title} - Ticket #${ticketId}`,\n          html: getAdminNoteTemplate(user.firstName || 'Cliente', title, message, ticketId)\n        });\n      }\n\n      res.json({ success: true, emailSent: !!user.email, ticketId });\n    } catch (error) {\n      console.error(\"Error sending note:\", error);\n      res.status(500).json({ message: \"Error al enviar nota\" });\n    }\n  });\n\n  // Admin Payment Link system\n  app.post(\"/api/admin/send-payment-link\", isAdmin, async (req, res) => {\n    try {\n      const { userId, paymentLink, message, amount } = z.object({\n        userId: z.string(),\n        paymentLink: z.string().url(),\n        message: z.string(),\n        amount: z.string().optional()\n      }).parse(req.body);\n\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n      if (!user || !user.email) return res.status(404).json({ message: \"Usuario o email no encontrado\" });\n\n      await sendEmail({\n        to: user.email,\n        subject: \"Pago pendiente - Easy US LLC\",\n        html: getPaymentRequestTemplate(user.firstName || 'Cliente', message, paymentLink, amount)\n      });\n\n      // Create internal notification\n      await db.insert(userNotifications).values({\n        userId,\n        title: \"Pago Pendiente Solicitado\",\n        message: `Se ha enviado un enlace de pago por ${amount || 'el tr\u00E1mite'}. Revisa tu email.`,\n        type: 'action_required',\n        isRead: false\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Send payment link error:\", error);\n      res.status(500).json({ message: \"Error al enviar enlace de pago\" });\n    }\n  });\n\n  // Client update order (allowed fields before processing)\n  app.patch(\"/api/orders/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order || order.userId !== req.session.userId) {\n        return res.status(403).json({ message: \"No autorizado\" });\n      }\n\n      if (order.status !== 'pending') {\n        return res.status(400).json({ message: \"El pedido ya est\u00E1 en tr\u00E1mite y no puede modificarse.\" });\n      }\n\n      const updateSchema = z.object({\n        companyNameOption2: z.string().optional(),\n        designator: z.string().optional(),\n        companyDescription: z.string().optional(),\n        ownerNamesAlternates: z.string().optional(),\n        notes: z.string().optional()\n      });\n\n      const validatedData = updateSchema.parse(req.body);\n      \n      await db.update(llcApplicationsTable)\n        .set({ ...validatedData, lastUpdated: new Date() })\n        .where(eq(llcApplicationsTable.orderId, orderId));\n\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al actualizar pedido\" });\n    }\n  });\n\n  // Get user notifications\n  app.get(\"/api/user/notifications\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      const notifs = await db.select()\n        .from(userNotifications)\n        .where(eq(userNotifications.userId, userId))\n        .orderBy(desc(userNotifications.createdAt))\n        .limit(50);\n      res.json(notifs);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      res.status(500).json({ message: \"Error fetching notifications\" });\n    }\n  });\n\n  app.patch(\"/api/user/notifications/:id/read\", isAuthenticated, async (req: any, res) => {\n    try {\n      await db.update(userNotifications)\n        .set({ isRead: true })\n        .where(and(eq(userNotifications.id, req.params.id), eq(userNotifications.userId, req.session.userId)));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error\" });\n    }\n  });\n\n  // Request OTP for password change\n  app.post(\"/api/user/request-password-otp\", isAuthenticated, async (req: any, res) => {\n    try {\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId));\n      if (!user?.email) {\n        return res.status(400).json({ message: \"Usuario no encontrado\" });\n      }\n      \n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expires = new Date(Date.now() + 10 * 60 * 1000); // 10 min\n      \n      // Store OTP in database\n      await db.insert(contactOtps).values({\n        email: user.email,\n        otp,\n        otpType: \"password_change\",\n        expiresAt: expires,\n        verified: false\n      });\n      \n      await sendEmail({\n        to: user.email,\n        subject: \"C\u00F3digo de verificaci\u00F3n - Cambio de contrase\u00F1a\",\n        html: getPasswordChangeOtpTemplate(user.firstName || 'Cliente', otp)\n      });\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Request password OTP error:\", error);\n      res.status(500).json({ message: \"Error al enviar c\u00F3digo\" });\n    }\n  });\n\n  // Change password with OTP verification\n  app.post(\"/api/user/change-password\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { currentPassword, newPassword, otp } = z.object({\n        currentPassword: z.string().min(1),\n        newPassword: z.string().min(8),\n        otp: z.string().length(6)\n      }).parse(req.body);\n      \n      const [user] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId));\n      if (!user?.email || !user?.passwordHash) {\n        return res.status(400).json({ message: \"No se puede cambiar la contrase\u00F1a\" });\n      }\n      \n      // Verify OTP from database\n      const [otpRecord] = await db.select()\n        .from(contactOtps)\n        .where(and(\n          eq(contactOtps.email, user.email),\n          eq(contactOtps.otp, otp),\n          eq(contactOtps.otpType, \"password_change\"),\n          gt(contactOtps.expiresAt, new Date())\n        ));\n      \n      if (!otpRecord) {\n        return res.status(400).json({ message: \"C\u00F3digo de verificaci\u00F3n inv\u00E1lido o expirado\" });\n      }\n      \n      // Delete used OTP\n      await db.delete(contactOtps).where(eq(contactOtps.id, otpRecord.id));\n      \n      const { verifyPassword, hashPassword } = await import(\"./lib/auth-service\");\n      const isValid = await verifyPassword(currentPassword, user.passwordHash);\n      if (!isValid) {\n        return res.status(400).json({ message: \"Contrase\u00F1a actual incorrecta\" });\n      }\n      \n      const newHash = await hashPassword(newPassword);\n      await db.update(usersTable).set({ passwordHash: newHash, updatedAt: new Date() }).where(eq(usersTable.id, req.session.userId));\n      \n      res.json({ success: true });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Datos inv\u00E1lidos\" });\n      }\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ message: \"Error al cambiar contrase\u00F1a\" });\n    }\n  });\n\n  // Request document from client\n  app.post(\"/api/admin/request-document\", isAdmin, async (req, res) => {\n    try {\n      const { email, documentType, message, userId } = z.object({\n        email: z.string().email(),\n        documentType: z.string(),\n        message: z.string(),\n        userId: z.string().optional()\n      }).parse(req.body);\n\n      const msgId = Math.floor(10000000 + Math.random() * 90000000).toString();\n      \n      const docTypeLabels: Record<string, string> = {\n        'passport': 'Pasaporte / Documento de Identidad',\n        'address_proof': 'Comprobante de Domicilio',\n        'tax_id': 'Identificaci\u00F3n Fiscal',\n        'other': 'Otro Documento'\n      };\n      const docTypeLabel = docTypeLabels[documentType] || documentType;\n      \n      await sendEmail({\n        to: email,\n        subject: `Acci\u00F3n Requerida: Solicitud de Documentaci\u00F3n`,\n        html: getDocumentRequestTemplate('Cliente', docTypeLabel, message, msgId)\n      });\n\n      if (userId) {\n        await db.insert(userNotifications).values({\n          userId,\n          title: \"Acci\u00F3n Requerida: Subir Documento\",\n          message: `Se ha solicitado el documento: ${docTypeLabel}. Revisa tu email para m\u00E1s detalles.`,\n          type: 'action_required',\n          isRead: false\n        });\n\n        const { encrypt } = await import(\"./utils/encryption\");\n        await db.insert(messagesTable).values({\n          userId,\n          name: \"Easy US LLC (Soporte)\",\n          email: \"soporte@easyusllc.com\",\n          subject: `Solicitud de Documento: ${docTypeLabel}`,\n          content: message,\n          encryptedContent: encrypt(message),\n          type: \"support\",\n          status: \"unread\",\n          messageId: msgId\n        });\n      }\n\n      res.json({ success: true, messageId: msgId });\n    } catch (error) {\n      console.error(\"Request doc error:\", error);\n      res.status(500).json({ message: \"Error al solicitar documento\" });\n    }\n  });\n\n  // Orders (Requires authentication)\n  app.get(api.orders.list.path, async (req: any, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    const orders = await storage.getOrders(req.session.userId);\n    res.json(orders);\n  });\n\n  // Invoices\n  app.get(\"/api/orders/:id/invoice\", isAuthenticated, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order || (order.userId !== req.session.userId && !req.session.isAdmin)) {\n        return res.status(403).json({ message: \"No autorizado\" });\n      }\n\n      // Get application requestCode (LLC or Maintenance)\n      const [llcApp] = await db.select().from(llcApplicationsTable).where(eq(llcApplicationsTable.orderId, orderId)).limit(1);\n      const [maintApp] = await db.select().from(maintenanceApplications).where(eq(maintenanceApplications.orderId, orderId)).limit(1);\n      const invoiceNumber = llcApp?.requestCode || maintApp?.requestCode || order.invoiceNumber;\n\n      // Generate PDF using lightweight PDFKit\n      const pdfBuffer = await generateInvoicePdf({\n        invoiceNumber: invoiceNumber || `INV-${orderId}`,\n        date: new Date(order.createdAt || Date.now()).toLocaleDateString('es-ES'),\n        customerName: `${order.user?.firstName || ''} ${order.user?.lastName || ''}`.trim() || 'Cliente',\n        customerEmail: order.user?.email || '',\n        productName: order.product?.name || 'Servicio LLC',\n        amount: order.amount,\n        currency: order.currency || 'EUR',\n        status: order.status,\n        originalAmount: order.originalAmount || undefined,\n        discountAmount: order.discountAmount || undefined,\n        discountCode: order.discountCode || undefined\n      });\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `inline; filename=\"Factura-${invoiceNumber}.pdf\"`);\n      res.send(pdfBuffer);\n    } catch (error) {\n      console.error(\"Invoice Error:\", error);\n      res.status(500).send(\"Error al generar factura\");\n    }\n  });\n  app.post(\"/api/admin/orders/:id/generate-invoice\", isAdmin, async (req, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      \n      // Get existing order data\n      const [order] = await db.select().from(ordersTable).where(eq(ordersTable.id, orderId)).limit(1);\n      if (!order) {\n        return res.status(404).json({ message: \"Pedido no encontrado\" });\n      }\n      \n      // Optional: update amount/currency if provided\n      const updateData: any = { isInvoiceGenerated: true };\n      if (req.body.amount) updateData.amount = req.body.amount;\n      if (req.body.currency) updateData.currency = req.body.currency;\n      \n      const [updatedOrder] = await db.update(ordersTable)\n        .set(updateData)\n        .where(eq(ordersTable.id, orderId))\n        .returning();\n\n      // Automatically make invoice available in documentation center\n      const [llcAppInv] = await db.select().from(llcApplicationsTable).where(eq(llcApplicationsTable.orderId, orderId)).limit(1);\n      const [maintAppInv] = await db.select().from(maintenanceApplications).where(eq(maintenanceApplications.orderId, orderId)).limit(1);\n      const displayInvoiceNumber = llcAppInv?.requestCode || maintAppInv?.requestCode || order.invoiceNumber;\n      \n      // Check if invoice already exists to avoid duplicates\n      const existingDoc = await db.select().from(applicationDocumentsTable)\n        .where(and(eq(applicationDocumentsTable.orderId, orderId), eq(applicationDocumentsTable.documentType, \"invoice\")))\n        .limit(1);\n      \n      if (existingDoc.length === 0) {\n        await db.insert(applicationDocumentsTable).values({\n          orderId,\n          fileName: `Factura ${displayInvoiceNumber}`,\n          fileType: \"application/pdf\",\n          fileUrl: `/api/orders/${orderId}/invoice`,\n          documentType: \"invoice\",\n          reviewStatus: \"approved\",\n          uploadedBy: (req as any).session.userId\n        });\n      }\n      \n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Error generating invoice:\", error);\n      res.status(500).json({ message: \"Error generating invoice\" });\n    }\n  });\n\n  // Create standalone invoice for user (not tied to order)\n  app.post(\"/api/admin/invoices/create\", isAdmin, asyncHandler(async (req: Request, res: Response) => {\n    const { userId, concept, amount, currency } = z.object({\n      userId: z.string(),\n      concept: z.string().min(1),\n      amount: z.number().min(1),\n      currency: z.enum([\"EUR\", \"USD\"]).default(\"EUR\")\n    }).parse(req.body);\n    \n    const currencySymbol = currency === \"USD\" ? \"$\" : \"\u20AC\";\n\n    const [user] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n    if (!user) {\n      return res.status(404).json({ message: \"Usuario no encontrado\" });\n    }\n\n    const invoiceNumber = `INV-${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`;\n    \n    // Generate invoice HTML\n    const invoiceHtml = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>Factura ${invoiceNumber}</title>\n  <style>\n    body { font-family: 'Inter', Arial, sans-serif; margin: 0; padding: 40px; color: #0E1215; }\n    .header { display: flex; justify-content: space-between; margin-bottom: 40px; }\n    .logo { font-size: 24px; font-weight: 900; color: #0E1215; }\n    .logo span { color: #6EDC8A; }\n    .invoice-title { font-size: 32px; font-weight: 900; text-align: right; }\n    .invoice-number { font-size: 14px; color: #6B7280; text-align: right; }\n    .details { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px; }\n    .section-title { font-size: 12px; color: #6B7280; text-transform: uppercase; margin-bottom: 8px; }\n    .section-content { font-size: 14px; line-height: 1.6; }\n    .items { margin: 40px 0; }\n    .items-header { display: grid; grid-template-columns: 3fr 1fr 1fr; padding: 12px 0; border-bottom: 2px solid #0E1215; font-weight: 700; font-size: 12px; text-transform: uppercase; }\n    .items-row { display: grid; grid-template-columns: 3fr 1fr 1fr; padding: 16px 0; border-bottom: 1px solid #E6E9EC; font-size: 14px; }\n    .total-section { text-align: right; margin-top: 24px; }\n    .total-row { font-size: 14px; margin-bottom: 8px; }\n    .total-final { font-size: 24px; font-weight: 900; color: #0E1215; }\n    .footer { margin-top: 60px; padding-top: 20px; border-top: 1px solid #E6E9EC; font-size: 11px; color: #6B7280; text-align: center; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <div>\n      <div class=\"logo\">EASY<span>US</span></div>\n      <p style=\"font-size: 11px; color: #6B7280;\">Fortuny Consulting LLC</p>\n    </div>\n    <div>\n      <div class=\"invoice-title\">FACTURA</div>\n      <div class=\"invoice-number\">${invoiceNumber}</div>\n      <div class=\"invoice-number\">${new Date().toLocaleDateString('es-ES')}</div>\n    </div>\n  </div>\n  <div class=\"details\">\n    <div>\n      <div class=\"section-title\">Facturado a</div>\n      <div class=\"section-content\">\n        <strong>${user.firstName} ${user.lastName}</strong><br>\n        ${user.email}<br>\n        ${user.phone || ''}\n      </div>\n    </div>\n    <div>\n      <div class=\"section-title\">Emitido por</div>\n      <div class=\"section-content\">\n        <strong>Fortuny Consulting LLC</strong><br>\n        1209 Mountain Road Pl NE Ste R<br>\n        Albuquerque, NM 87110\n      </div>\n    </div>\n  </div>\n  <div class=\"items\">\n    <div class=\"items-header\">\n      <span>Concepto</span>\n      <span style=\"text-align:right;\">Cantidad</span>\n      <span style=\"text-align:right;\">Importe</span>\n    </div>\n    <div class=\"items-row\">\n      <span>${concept}</span>\n      <span style=\"text-align:right;\">1</span>\n      <span style=\"text-align:right;\">${(amount / 100).toFixed(2)} ${currencySymbol}</span>\n    </div>\n  </div>\n  <div class=\"total-section\">\n    <div class=\"total-row\">Subtotal: ${(amount / 100).toFixed(2)} ${currencySymbol}</div>\n    <div class=\"total-row\">IVA (0%): 0.00 ${currencySymbol}</div>\n    <div class=\"total-final\">Total: ${(amount / 100).toFixed(2)} ${currencySymbol}</div>\n  </div>\n  <div class=\"footer\">\n    <p>Fortuny Consulting LLC - EIN: 99-1877254</p>\n    <p>1209 Mountain Road Pl NE Ste R, Albuquerque, NM 87110, USA</p>\n    <p>info@easyusllc.com | www.easyusllc.com</p>\n  </div>\n</body>\n</html>`;\n\n    // Store as document for user\n    const [userOrder] = await db.select().from(ordersTable).where(eq(ordersTable.userId, userId)).limit(1);\n    if (userOrder) {\n      await db.insert(applicationDocumentsTable).values({\n        orderId: userOrder.id,\n        fileName: `Factura ${invoiceNumber} - ${concept}`,\n        fileType: \"text/html\",\n        fileUrl: `data:text/html;base64,${Buffer.from(invoiceHtml).toString('base64')}`,\n        documentType: \"invoice\",\n        reviewStatus: \"approved\",\n        uploadedBy: req.session.userId\n      });\n    }\n\n    res.json({ success: true, invoiceNumber });\n  }));\n\n  app.post(api.orders.create.path, async (req: any, res) => {\n    try {\n      const { productId, email, password, ownerFullName, paymentMethod, discountCode, discountAmount } = req.body;\n      \n      // Parse productId\n      const parsedInput = api.orders.create.input.parse({ productId });\n      \n      let userId: string;\n      let isNewUser = false;\n      \n      if (req.session?.userId) {\n        // User already authenticated\n        const [currentUser] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId)).limit(1);\n        if (currentUser && (currentUser.accountStatus === 'pending' || currentUser.accountStatus === 'deactivated')) {\n          return res.status(403).json({ message: \"Tu cuenta est\u00E1 en revisi\u00F3n o desactivada. No puedes realizar nuevos pedidos en este momento.\" });\n        }\n        userId = req.session.userId;\n      } else {\n        // Require email, password and OTP verification for new users\n        if (!email || !password) {\n          return res.status(400).json({ message: \"Se requiere email y contrase\u00F1a para realizar un pedido.\" });\n        }\n        \n        if (password.length < 8) {\n          return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres.\" });\n        }\n        \n        // Check if email already exists\n        const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n        if (existingUser) {\n          return res.status(400).json({ message: \"Este email ya est\u00E1 registrado. Por favor inicia sesi\u00F3n.\" });\n        }\n        \n        // Verify that email has been verified via OTP\n        const [otpRecord] = await db.select()\n          .from(contactOtps)\n          .where(\n            and(\n              eq(contactOtps.email, email),\n              eq(contactOtps.otpType, \"account_verification\"),\n              eq(contactOtps.verified, true),\n              gt(contactOtps.expiresAt, new Date(Date.now() - 30 * 60 * 1000)) // Allow 30 min window after verification\n            )\n          )\n          .orderBy(sql`${contactOtps.expiresAt} DESC`)\n          .limit(1);\n        \n        if (!otpRecord) {\n          return res.status(400).json({ message: \"Por favor verifica tu email antes de continuar.\" });\n        }\n        \n        // Create new user with verified email and password\n        const { hashPassword, generateUniqueClientId } = await import(\"./lib/auth-service\");\n        const passwordHash = await hashPassword(password);\n        const clientId = await generateUniqueClientId();\n        const nameParts = ownerFullName?.split(' ') || ['Cliente'];\n        \n        const [newUser] = await db.insert(usersTable).values({\n          email,\n          passwordHash,\n          clientId,\n          firstName: nameParts[0] || 'Cliente',\n          lastName: nameParts.slice(1).join(' ') || '',\n          emailVerified: true,\n          accountStatus: 'active',\n        }).returning();\n        \n        userId = newUser.id;\n        isNewUser = true;\n        \n        // Set session for the new user\n        req.session.userId = userId;\n        \n        // Send welcome email\n        sendEmail({\n          to: email,\n          subject: \"Bienvenido a Easy US LLC - Acceso a tu panel\",\n          html: getWelcomeEmailTemplate(nameParts[0] || 'Cliente')\n        }).catch(console.error);\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product) {\n        return res.status(400).json({ message: \"Invalid product\" });\n      }\n\n      // CRITICAL: Ensure pricing follows NM 739\u20AC, WY 899\u20AC, DE 1199\u20AC\n      let finalPrice = product.price;\n      if (product.name.includes(\"New Mexico\")) finalPrice = 73900;\n      else if (product.name.includes(\"Wyoming\")) finalPrice = 89900;\n      else if (product.name.includes(\"Delaware\")) finalPrice = 119900;\n\n      // Calculate final amount with discount\n      let originalAmount = finalPrice;\n      let appliedDiscountAmount = 0;\n      let appliedDiscountCode: string | null = null;\n      \n      if (discountCode && discountAmount) {\n        appliedDiscountCode = discountCode;\n        appliedDiscountAmount = discountAmount;\n        finalPrice = Math.max(0, finalPrice - discountAmount);\n        \n        // Increment used count for the discount code\n        await db.update(discountCodes)\n          .set({ usedCount: sql`${discountCodes.usedCount} + 1` })\n          .where(eq(discountCodes.code, discountCode.toUpperCase()));\n      }\n\n      // Create the order\n      const order = await storage.createOrder({\n        userId,\n        productId,\n        amount: finalPrice,\n        originalAmount: appliedDiscountCode ? originalAmount : null,\n        discountCode: appliedDiscountCode,\n        discountAmount: appliedDiscountAmount || null,\n        status: \"pending\",\n        stripeSessionId: \"mock_session_\" + Date.now(),\n      });\n\n      // Add Order Event for Timeline\n      await db.insert(orderEvents).values({\n        orderId: order.id,\n        eventType: \"Pedido Recibido\",\n        description: `Se ha registrado un nuevo pedido para ${product.name}.`,\n        createdBy: userId\n      });\n\n      // Create an empty application linked to the order\n      const application = await storage.createLlcApplication({\n        orderId: order.id,\n        status: \"draft\",\n        state: product.name.split(\" \")[0], // Extract state name correctly\n      });\n\n      // NOTIFICATION: New order created (after application so we have requestCode)\n      if (userId && !userId.startsWith('guest_')) {\n        await db.insert(userNotifications).values({\n          userId,\n          orderId: order.id,\n          orderCode: application.requestCode || order.invoiceNumber,\n          title: \"Nuevo pedido registrado\",\n          message: `Tu pedido de ${product.name} ha sido registrado correctamente. Te mantendremos informado del progreso.`,\n          type: 'info',\n          isRead: false\n        });\n      }\n\n      // Generate unified request code: STATE-8digits (e.g., NM-12345678)\n      const { generateUniqueOrderCode } = await import(\"./lib/id-generator\");\n      const appState = product.name.split(\" \")[0] || 'New Mexico';\n      const requestCode = await generateUniqueOrderCode(appState);\n\n      const updatedApplication = await storage.updateLlcApplication(application.id, { requestCode });\n\n      // Notification to admin about NEW ORDER\n      logActivity(\"Nuevo Pedido Recibido\", {\n        \"Referencia\": requestCode,\n        \"Producto\": product.name,\n        \"Importe\": `${(finalPrice / 100).toFixed(2)}\u20AC`,\n        \"Usuario\": userId,\n        \"IP\": req.ip\n      });\n\n      // Return order with application\n      res.status(201).json({ ...order, application: updatedApplication });\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      console.error(\"Error creating order:\", err);\n      return res.status(500).json({ message: \"Error creating order\" });\n    }\n  });\n\n  // Messages API\n  app.get(\"/api/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userMessages = await storage.getMessagesByUserId(req.session.userId);\n      res.json(userMessages);\n    } catch (error) {\n      res.status(500).json({ message: \"Error fetching messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", async (req: any, res) => {\n    try {\n      const { name, email, subject, content, requestCode } = req.body;\n      const userId = req.session?.userId || null;\n      \n      // Restrict suspended accounts from sending messages\n      if (userId) {\n        const [currentUser] = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n        if (currentUser?.accountStatus === 'deactivated') {\n          return res.status(403).json({ message: \"Tu cuenta est\u00E1 suspendida. No puedes enviar mensajes.\" });\n        }\n      }\n      \n      const message = await storage.createMessage({\n        userId,\n        name,\n        email,\n        subject,\n        content,\n        requestCode,\n        type: \"contact\"\n      });\n\n      // Send auto-reply\n      sendEmail({\n        to: email,\n        subject: `Recibimos tu mensaje: ${subject || \"Contacto\"}`,\n        html: getAutoReplyTemplate(name || \"Cliente\"),\n      }).catch(() => {});\n\n      // Notify admin\n      logActivity(\"Nuevo Mensaje de Contacto\", {\n        \"Nombre\": name,\n        \"Email\": email,\n        \"Asunto\": subject,\n        \"Mensaje\": content,\n        \"Referencia\": requestCode || \"N/A\"\n      });\n\n      res.status(201).json(message);\n    } catch (error) {\n      res.status(500).json({ message: \"Error sending message\" });\n    }\n  });\n\n  // Claim order endpoint - creates account and associates with existing order\n  app.post(\"/api/llc/claim-order\", async (req: any, res) => {\n    try {\n      const { applicationId, email, password, ownerFullName, paymentMethod } = req.body;\n      \n      if (!applicationId || !email || !password) {\n        return res.status(400).json({ message: \"Se requiere email y contrase\u00F1a.\" });\n      }\n      \n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres.\" });\n      }\n      \n      // Check if email already exists\n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Este email ya est\u00E1 registrado. Por favor inicia sesi\u00F3n.\" });\n      }\n      \n      // Verify that email has been verified via OTP\n      const [otpRecord] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otpType, \"account_verification\"),\n            eq(contactOtps.verified, true),\n            gt(contactOtps.expiresAt, new Date(Date.now() - 30 * 60 * 1000))\n          )\n        )\n        .orderBy(sql`${contactOtps.expiresAt} DESC`)\n        .limit(1);\n      \n      if (!otpRecord) {\n        return res.status(400).json({ message: \"Por favor verifica tu email antes de continuar.\" });\n      }\n      \n      // Get the application to find the order\n      const application = await storage.getLlcApplication(applicationId);\n      if (!application) {\n        return res.status(404).json({ message: \"Solicitud no encontrada.\" });\n      }\n      \n      // Create new user with verified email\n      const { hashPassword, generateUniqueClientId } = await import(\"./lib/auth-service\");\n      const passwordHash = await hashPassword(password);\n      const clientId = await generateUniqueClientId();\n      const nameParts = ownerFullName?.split(' ') || ['Cliente'];\n      \n      const [newUser] = await db.insert(usersTable).values({\n        email,\n        passwordHash,\n        clientId,\n        firstName: nameParts[0] || 'Cliente',\n        lastName: nameParts.slice(1).join(' ') || '',\n        emailVerified: true,\n        accountStatus: 'active',\n      }).returning();\n      \n      // Update the order to associate with the new user\n      await db.update(ordersTable)\n        .set({ userId: newUser.id })\n        .where(eq(ordersTable.id, application.orderId));\n      \n      // Update LLC application with paymentMethod if provided\n      if (paymentMethod) {\n        await storage.updateLlcApplication(applicationId, { paymentMethod });\n      }\n      \n      // Set session for the new user\n      req.session.userId = newUser.id;\n      \n      // Send welcome email\n      sendEmail({\n        to: email,\n        subject: \"Bienvenido a Easy US LLC - Acceso a tu panel\",\n        html: getWelcomeEmailTemplate(nameParts[0] || 'Cliente')\n      }).catch(console.error);\n      \n      res.json({ success: true, userId: newUser.id });\n    } catch (error) {\n      console.error(\"Error claiming order:\", error);\n      res.status(500).json({ message: \"Error al crear la cuenta.\" });\n    }\n  });\n\n  // Claim maintenance order endpoint\n  app.post(\"/api/maintenance/claim-order\", async (req: any, res) => {\n    try {\n      const { applicationId, email, password, ownerFullName, paymentMethod } = req.body;\n      \n      if (!applicationId || !email || !password) {\n        return res.status(400).json({ message: \"Se requiere email y contrase\u00F1a.\" });\n      }\n      \n      if (password.length < 8) {\n        return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres.\" });\n      }\n      \n      // Check if email already exists\n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Este email ya est\u00E1 registrado. Por favor inicia sesi\u00F3n.\" });\n      }\n      \n      // Verify that email has been verified via OTP\n      const [otpRecord] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otpType, \"account_verification\"),\n            eq(contactOtps.verified, true),\n            gt(contactOtps.expiresAt, new Date(Date.now() - 30 * 60 * 1000))\n          )\n        )\n        .orderBy(sql`${contactOtps.expiresAt} DESC`)\n        .limit(1);\n      \n      if (!otpRecord) {\n        return res.status(400).json({ message: \"Por favor verifica tu email antes de continuar.\" });\n      }\n      \n      // Get the maintenance application to find the order\n      const [application] = await db.select().from(maintenanceApplications).where(eq(maintenanceApplications.id, applicationId)).limit(1);\n      if (!application) {\n        return res.status(404).json({ message: \"Solicitud no encontrada.\" });\n      }\n      \n      // Create new user with verified email\n      const { hashPassword, generateUniqueClientId } = await import(\"./lib/auth-service\");\n      const passwordHash = await hashPassword(password);\n      const clientId = await generateUniqueClientId();\n      const nameParts = ownerFullName?.split(' ') || ['Cliente'];\n      \n      const [newUser] = await db.insert(usersTable).values({\n        email,\n        passwordHash,\n        clientId,\n        firstName: nameParts[0] || 'Cliente',\n        lastName: nameParts.slice(1).join(' ') || '',\n        emailVerified: true,\n        accountStatus: 'active',\n      }).returning();\n      \n      // Update the order to associate with the new user\n      await db.update(ordersTable)\n        .set({ userId: newUser.id })\n        .where(eq(ordersTable.id, application.orderId));\n      \n      // Update maintenance application with paymentMethod if provided\n      if (paymentMethod) {\n        await db.update(maintenanceApplications)\n          .set({ paymentMethod })\n          .where(eq(maintenanceApplications.id, applicationId));\n      }\n      \n      // Set session for the new user\n      req.session.userId = newUser.id;\n      \n      // Send welcome email\n      sendEmail({\n        to: email,\n        subject: \"Bienvenido a Easy US LLC - Acceso a tu panel\",\n        html: getWelcomeEmailTemplate(nameParts[0] || 'Cliente')\n      }).catch(console.error);\n      \n      res.json({ success: true, userId: newUser.id });\n    } catch (error) {\n      console.error(\"Error claiming maintenance order:\", error);\n      res.status(500).json({ message: \"Error al crear la cuenta.\" });\n    }\n  });\n\n  // Client Update LLC Application Data\n  app.patch(\"/api/llc/:id/data\", isAuthenticated, async (req: any, res) => {\n    try {\n      const appId = Number(req.params.id);\n      const updates = req.body;\n      const [updated] = await db.update(llcApplicationsTable)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(llcApplicationsTable.id, appId))\n        .returning();\n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating application\" });\n    }\n  });\n  app.get(api.llc.get.path, async (req: any, res) => {\n    const appId = Number(req.params.id);\n    \n    const application = await storage.getLlcApplication(appId);\n    if (!application) {\n      return res.status(404).json({ message: \"Application not found\" });\n    }\n\n    res.json(application);\n  });\n\n  app.put(api.llc.update.path, async (req: any, res) => {\n    try {\n      const appId = Number(req.params.id);\n      const updates = api.llc.update.input.parse(req.body);\n\n      const application = await storage.getLlcApplication(appId);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n\n      const updatedApp = await storage.updateLlcApplication(appId, updates);\n      \n      // If status is being updated to \"submitted\", send confirmation email\n      if (updates.status === \"submitted\" && updatedApp.ownerEmail) {\n        const orderIdentifier = updatedApp.requestCode || `#${updatedApp.id}`;\n        \n        // Get order info for price\n        const [order] = await db.select().from(ordersTable).where(eq(ordersTable.id, updatedApp.orderId)).limit(1);\n        const orderAmount = order ? (order.amount / 100).toFixed(2) : 'N/A';\n        \n        // Email notification to admin about completed order\n        const adminEmail = process.env.ADMIN_EMAIL || \"afortuny07@gmail.com\";\n        const paymentMethodLabel = updatedApp.paymentMethod === 'transfer' ? 'Transferencia Bancaria' : updatedApp.paymentMethod === 'link' ? 'Link de Pago' : 'No especificado';\n        \n        sendEmail({\n          to: adminEmail,\n          subject: `[PEDIDO REALIZADO] ${orderIdentifier} - ${updatedApp.companyName}`,\n          html: getAdminLLCOrderTemplate({\n            orderIdentifier,\n            amount: orderAmount,\n            paymentMethod: paymentMethodLabel,\n            ownerFullName: updatedApp.ownerFullName || undefined,\n            ownerEmail: updatedApp.ownerEmail || undefined,\n            ownerPhone: updatedApp.ownerPhone || undefined,\n            ownerBirthDate: updatedApp.ownerBirthDate || undefined,\n            ownerIdType: updatedApp.ownerIdType || undefined,\n            ownerIdNumber: updatedApp.ownerIdNumber || undefined,\n            ownerAddress: `${updatedApp.ownerStreetType || ''} ${updatedApp.ownerAddress || ''}`.trim() || undefined,\n            ownerCity: updatedApp.ownerCity || undefined,\n            ownerProvince: updatedApp.ownerProvince || undefined,\n            ownerPostalCode: updatedApp.ownerPostalCode || undefined,\n            ownerCountry: updatedApp.ownerCountry || undefined,\n            companyName: updatedApp.companyName || undefined,\n            companyNameOption2: updatedApp.companyNameOption2 || undefined,\n            designator: updatedApp.designator || undefined,\n            state: updatedApp.state || undefined,\n            businessCategory: updatedApp.businessCategory === \"Otra (especificar)\" ? (updatedApp.businessCategoryOther || undefined) : (updatedApp.businessCategory || undefined),\n            businessActivity: updatedApp.businessActivity || undefined,\n            companyDescription: updatedApp.companyDescription || undefined,\n            isSellingOnline: updatedApp.isSellingOnline || undefined,\n            needsBankAccount: updatedApp.needsBankAccount || undefined,\n            willUseStripe: updatedApp.willUseStripe || undefined,\n            wantsBoiReport: updatedApp.wantsBoiReport || undefined,\n            wantsMaintenancePack: updatedApp.wantsMaintenancePack || undefined,\n            notes: updatedApp.notes || undefined\n          })\n        }).catch(() => {});\n\n        // Confirmation to client with full info\n        sendEmail({\n          to: updatedApp.ownerEmail,\n          subject: `Solicitud recibida - Referencia ${orderIdentifier}`,\n          html: getConfirmationEmailTemplate(updatedApp.ownerFullName || \"Cliente\", orderIdentifier, { companyName: updatedApp.companyName || undefined }),\n        }).catch(() => {});\n    }\n\n    res.json(updatedApp);\n  } catch (err) {\n    if (err instanceof z.ZodError) {\n      return res.status(400).json({ message: err.errors[0].message });\n    }\n    console.error(\"Error updating LLC application:\", err);\n    res.status(500).json({ message: \"Error updating request\" });\n  }\n});\n\n  // Lookup by request code\n  app.get(api.llc.getByCode.path, async (req: any, res) => {\n    const code = req.params.code;\n    \n    const application = await storage.getLlcApplicationByRequestCode(code);\n    if (!application) {\n      return res.status(404).json({ message: \"Solicitud no encontrada. Verifica el c\u00F3digo ingresado.\" });\n    }\n\n    res.json(application);\n  });\n\n  // Documents\n  app.post(api.documents.create.path, async (req: any, res) => {\n    try {\n      const docData = api.documents.create.input.parse(req.body);\n      \n      if (docData.applicationId) {\n        const application = await storage.getLlcApplication(docData.applicationId);\n        if (!application) {\n          return res.status(404).json({ message: \"Application not found\" });\n        }\n      }\n\n      const document = await storage.createDocument(docData);\n      res.status(201).json(document);\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      throw err;\n    }\n  });\n\n  app.patch(\"/api/admin/documents/:id/review\", isAdmin, async (req, res) => {\n    try {\n      const docId = Number(req.params.id);\n      const { reviewStatus } = z.object({ reviewStatus: z.enum([\"pending\", \"approved\", \"rejected\", \"action_required\"]) }).parse(req.body);\n      \n      const [updated] = await db.update(applicationDocumentsTable)\n        .set({ reviewStatus })\n        .where(eq(applicationDocumentsTable.id, docId))\n        .returning();\n      \n      res.json(updated);\n    } catch (error) {\n      res.status(500).json({ message: \"Error updating document review status\" });\n    }\n  });\n\n  // Client document upload endpoint\n  const MAX_FILE_SIZE_MB = 5;\n  const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;\n  \n  app.post(\"/api/user/documents/upload\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.session.userId;\n      if (!userId) {\n        return res.status(401).json({ message: \"No autorizado\" });\n      }\n\n      // Get user's orders to attach document\n      const userOrders = await storage.getOrders(userId);\n      if (!userOrders.length) {\n        return res.status(400).json({ message: \"No tienes pedidos activos\" });\n      }\n\n      // Use busboy for file handling with size limit\n      const busboy = (await import('busboy')).default;\n      const bb = busboy({ \n        headers: req.headers,\n        limits: { fileSize: MAX_FILE_SIZE_BYTES }\n      });\n      \n      let fileName = '';\n      let fileBuffer: Buffer | null = null;\n      let fileTruncated = false;\n      let documentType = 'passport';\n      let notes = '';\n      \n      bb.on('field', (name: string, val: string) => {\n        if (name === 'documentType') documentType = val;\n        if (name === 'notes') notes = val;\n      });\n      \n      bb.on('file', (name: string, file: any, info: any) => {\n        fileName = info.filename || `documento_${Date.now()}`;\n        const chunks: Buffer[] = [];\n        file.on('data', (data: Buffer) => chunks.push(data));\n        file.on('limit', () => { fileTruncated = true; });\n        file.on('end', () => { fileBuffer = Buffer.concat(chunks); });\n      });\n\n      bb.on('finish', async () => {\n        if (fileTruncated) {\n          return res.status(413).json({ message: `El archivo excede el l\u00EDmite de ${MAX_FILE_SIZE_MB}MB` });\n        }\n        \n        if (!fileBuffer) {\n          return res.status(400).json({ message: \"No se recibi\u00F3 ning\u00FAn archivo\" });\n        }\n\n        // Save file (in production, use cloud storage)\n        const fs = await import('fs/promises');\n        const path = await import('path');\n        const uploadDir = path.join(process.cwd(), 'uploads', 'client-docs');\n        await fs.mkdir(uploadDir, { recursive: true });\n        \n        const safeFileName = `${userId}_${Date.now()}_${fileName.replace(/[^a-zA-Z0-9.-]/g, '_')}`;\n        const filePath = path.join(uploadDir, safeFileName);\n        await fs.writeFile(filePath, fileBuffer);\n        \n        // Generate ticket ID for this document upload (8-digit format)\n        const { generateUniqueMessageId } = await import(\"./lib/id-generator\");\n        const ticketId = await generateUniqueMessageId();\n        \n        // Translate document type for display\n        const docTypeLabelsUpload: Record<string, string> = {\n          'passport': 'Pasaporte / Documento de Identidad',\n          'address_proof': 'Comprobante de Domicilio',\n          'tax_id': 'Identificaci\u00F3n Fiscal',\n          'other': 'Otro Documento'\n        };\n        const docTypeLabel = docTypeLabelsUpload[documentType] || documentType;\n        \n        // Create document record\n        const doc = await db.insert(applicationDocumentsTable).values({\n          orderId: userOrders[0].id,\n          fileName: fileName,\n          fileType: fileName.endsWith('.pdf') ? 'application/pdf' : 'image/jpeg',\n          fileUrl: `/uploads/client-docs/${safeFileName}`,\n          documentType: documentType,\n          reviewStatus: 'pending',\n          uploadedBy: userId\n        }).returning();\n\n        // Get user data for admin notification\n        const userData = await db.select().from(usersTable).where(eq(usersTable.id, userId)).limit(1);\n        const user = userData[0];\n        \n        if (user) {\n          // Create message in admin panel as support ticket\n          const { encrypt } = await import(\"./utils/encryption\");\n          const notesText = documentType === 'other' && notes ? `\\n\\nNotas del cliente: ${notes}` : '';\n          const messageContent = `El cliente ha subido un nuevo documento.\\n\\nTipo: ${docTypeLabel}\\nArchivo: ${fileName}${notesText}\\n\\nArchivo disponible en: ${doc[0].fileUrl}`;\n          \n          await db.insert(messagesTable).values({\n            userId,\n            name: `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'Cliente',\n            email: user.email || 'sin-email@cliente.com',\n            subject: `Documento Recibido: ${docTypeLabel}`,\n            content: messageContent,\n            encryptedContent: encrypt(messageContent),\n            type: 'support',\n            status: 'unread',\n            messageId: ticketId\n          });\n          \n        }\n\n        res.json({ success: true, document: doc[0], ticketId });\n      });\n\n      req.pipe(bb);\n    } catch (error: any) {\n      console.error(\"Client upload error:\", error);\n      res.status(500).json({ message: \"Error al subir documento\" });\n    }\n  });\n\n  app.delete(\"/api/admin/documents/:id\", isAdmin, async (req, res) => {\n    try {\n      const docId = Number(req.params.id);\n      await db.delete(applicationDocumentsTable).where(eq(applicationDocumentsTable.id, docId));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Error deleting document\" });\n    }\n  });\n\n  // Payment simulation endpoint for LLC\n  app.post(\"/api/llc/:id/pay\", async (req, res) => {\n    try {\n      const appId = parseInt(req.params.id);\n      const application = await storage.getLlcApplication(appId);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n      \n      // Update order status to paid\n      if (application.orderId) {\n        await storage.updateOrderStatus(application.orderId, \"paid\");\n      }\n      \n      // Update application status to submitted\n      await storage.updateLlcApplication(appId, { status: \"submitted\", paymentStatus: \"paid\" });\n      \n      res.json({ success: true, message: \"Payment successful\" });\n    } catch (error) {\n      console.error(\"Payment error:\", error);\n      res.status(500).json({ message: \"Payment processing failed\" });\n    }\n  });\n\n  app.post(\"/api/maintenance/orders\", async (req: any, res) => {\n    try {\n      const { productId, state, email, password, ownerFullName, paymentMethod, discountCode, discountAmount } = req.body;\n      \n      let userId: string;\n      let isNewUser = false;\n      \n      if (req.session?.userId) {\n        const [currentUser] = await db.select().from(usersTable).where(eq(usersTable.id, req.session.userId)).limit(1);\n        if (currentUser && (currentUser.accountStatus === 'pending' || currentUser.accountStatus === 'deactivated')) {\n          return res.status(403).json({ message: \"Tu cuenta est\u00E1 en revisi\u00F3n o desactivada. No puedes realizar nuevos pedidos en este momento.\" });\n        }\n        userId = req.session.userId;\n      } else {\n        if (!email || !password) {\n          return res.status(400).json({ message: \"Se requiere email y contrase\u00F1a para realizar un pedido.\" });\n        }\n        \n        if (password.length < 8) {\n          return res.status(400).json({ message: \"La contrase\u00F1a debe tener al menos 8 caracteres.\" });\n        }\n        \n        const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n        if (existingUser) {\n          return res.status(400).json({ message: \"Este email ya est\u00E1 registrado. Por favor inicia sesi\u00F3n.\" });\n        }\n        \n        const { hashPassword, generateUniqueClientId } = await import(\"./lib/auth-service\");\n        const passwordHash = await hashPassword(password);\n        const clientId = await generateUniqueClientId();\n        const nameParts = ownerFullName?.split(' ') || ['Cliente'];\n        \n        const [newUser] = await db.insert(usersTable).values({\n          email,\n          passwordHash,\n          clientId,\n          firstName: nameParts[0] || 'Cliente',\n          lastName: nameParts.slice(1).join(' ') || '',\n          emailVerified: true,\n          accountStatus: 'active',\n        }).returning();\n        \n        userId = newUser.id;\n        isNewUser = true;\n        req.session.userId = userId;\n        \n        sendEmail({\n          to: email,\n          subject: \"Bienvenido a Easy US LLC - Acceso a tu panel\",\n          html: getWelcomeEmailTemplate(nameParts[0] || 'Cliente')\n        }).catch(console.error);\n      }\n\n      const product = await storage.getProduct(productId);\n      if (!product) return res.status(400).json({ message: \"Invalid product\" });\n\n      // State-specific pricing for maintenance: NM 539\u20AC, WY 699\u20AC, DE 899\u20AC\n      let finalPrice = product.price;\n      if (state?.includes(\"New Mexico\")) finalPrice = 53900;\n      else if (state?.includes(\"Wyoming\")) finalPrice = 69900;\n      else if (state?.includes(\"Delaware\")) finalPrice = 89900;\n\n      // Calculate final amount with discount\n      let originalAmount = finalPrice;\n      let appliedDiscountAmount = 0;\n      let appliedDiscountCode: string | null = null;\n      \n      if (discountCode && discountAmount) {\n        appliedDiscountCode = discountCode;\n        appliedDiscountAmount = discountAmount;\n        finalPrice = Math.max(0, finalPrice - discountAmount);\n        \n        // Increment used count for the discount code\n        await db.update(discountCodes)\n          .set({ usedCount: sql`${discountCodes.usedCount} + 1` })\n          .where(eq(discountCodes.code, discountCode.toUpperCase()));\n      }\n\n      const order = await storage.createOrder({\n        userId,\n        productId,\n        amount: finalPrice,\n        originalAmount: appliedDiscountCode ? originalAmount : null,\n        discountCode: appliedDiscountCode,\n        discountAmount: appliedDiscountAmount || null,\n        status: \"pending\",\n        stripeSessionId: \"mock_session_maint_\" + Date.now(),\n      });\n\n      const [application] = await db.insert(maintenanceApplications).values({\n        orderId: order.id,\n        status: \"draft\",\n        state: state || product.name.split(\" \")[0],\n      }).returning();\n\n      // Generate unified request code: STATE-8digits (e.g., NM-12345678)\n      const { generateUniqueOrderCode } = await import(\"./lib/id-generator\");\n      const appState = state || product.name.split(\" \")[0] || 'New Mexico';\n      const requestCode = await generateUniqueOrderCode(appState);\n\n      await db.update(maintenanceApplications)\n        .set({ requestCode })\n        .where(eq(maintenanceApplications.id, application.id));\n\n      // NOTIFICATION: New maintenance order\n      if (userId && !userId.startsWith('guest_')) {\n        await db.insert(userNotifications).values({\n          userId,\n          orderId: order.id,\n          orderCode: requestCode,\n          title: \"Nuevo pedido de mantenimiento\",\n          message: `Tu pedido de mantenimiento anual (${requestCode}) ha sido registrado. Te mantendremos informado del progreso.`,\n          type: 'info',\n          isRead: false\n        });\n      }\n\n      res.status(201).json({ ...order, application: { ...application, requestCode } });\n    } catch (err) {\n      console.error(\"Error creating maintenance order:\", err);\n      res.status(500).json({ message: \"Error creating maintenance order\" });\n    }\n  });\n\n  // Maintenance App Updates\n  app.put(\"/api/maintenance/:id\", async (req, res) => {\n    try {\n      const appId = Number(req.params.id);\n      const updates = req.body;\n      \n      const [updatedApp] = await db.update(maintenanceApplications)\n        .set({ ...updates, lastUpdated: new Date() })\n        .where(eq(maintenanceApplications.id, appId))\n        .returning();\n      \n      if (!updatedApp) {\n        return res.status(404).json({ message: \"Solicitud no encontrada\" });\n      }\n      \n      if (updates.status === \"submitted\") {\n        const orderIdentifier = updatedApp.requestCode || `MN-${updatedApp.id}`;\n        \n        // Get order info for price\n        const [order] = await db.select().from(ordersTable).where(eq(ordersTable.id, updatedApp.orderId)).limit(1);\n        const orderAmount = order ? (order.amount / 100).toFixed(2) : 'N/A';\n        \n        // Email notification to admin about completed maintenance order\n        const adminEmail = process.env.ADMIN_EMAIL || \"afortuny07@gmail.com\";\n        const maintPaymentMethodLabel = updatedApp.paymentMethod === 'transfer' ? 'Transferencia Bancaria' : updatedApp.paymentMethod === 'link' ? 'Link de Pago' : 'No especificado';\n        \n        sendEmail({\n          to: adminEmail,\n          subject: `[PEDIDO REALIZADO] ${orderIdentifier} - Mantenimiento ${updatedApp.companyName}`,\n          html: getAdminMaintenanceOrderTemplate({\n            orderIdentifier,\n            amount: orderAmount,\n            paymentMethod: maintPaymentMethodLabel,\n            ownerFullName: updatedApp.ownerFullName || undefined,\n            ownerEmail: updatedApp.ownerEmail || undefined,\n            ownerPhone: updatedApp.ownerPhone || undefined,\n            companyName: updatedApp.companyName || undefined,\n            ein: updatedApp.ein || undefined,\n            state: updatedApp.state || undefined,\n            creationSource: updatedApp.creationSource || undefined,\n            creationYear: updatedApp.creationYear || undefined,\n            bankAccount: updatedApp.bankAccount || undefined,\n            paymentGateway: updatedApp.paymentGateway || undefined,\n            businessActivity: updatedApp.businessActivity || undefined,\n            expectedServices: updatedApp.expectedServices || undefined,\n            wantsDissolve: updatedApp.wantsDissolve || undefined,\n            notes: updatedApp.notes || undefined\n          })\n        }).catch(() => {});\n        \n        // Confirmation to client\n        if (updatedApp.ownerEmail) {\n          sendEmail({\n            to: updatedApp.ownerEmail,\n            subject: `Solicitud recibida - Referencia ${orderIdentifier}`,\n            html: getConfirmationEmailTemplate(updatedApp.ownerFullName || \"Cliente\", orderIdentifier, { companyName: updatedApp.companyName || undefined, serviceType: \"Mantenimiento Anual\" }),\n          }).catch(() => {});\n        }\n      }\n      \n      res.json(updatedApp);\n    } catch (error) {\n      res.status(500).json({ message: \"Error al actualizar la solicitud\" });\n    }\n  });\n\n  // Newsletter\n  app.get(\"/api/newsletter/status\", isAuthenticated, async (req: any, res) => {\n    const isSubscribed = await storage.isSubscribedToNewsletter(req.session.email);\n    res.json({ isSubscribed });\n  });\n\n  app.post(\"/api/newsletter/unsubscribe\", isAuthenticated, async (req: any, res) => {\n    await db.delete(newsletterSubscribers).where(eq(newsletterSubscribers.email, req.session.email));\n    res.json({ success: true });\n  });\n\n  // Newsletter Subscription\n  app.post(\"/api/newsletter/subscribe\", async (req: any, res) => {\n    try {\n      const { email } = z.object({ email: z.string().email().optional() }).parse(req.body);\n      \n      // If no email provided, try to use authenticated user's email\n      const targetEmail = email || req.session?.email || null;\n      \n      if (!targetEmail) {\n        return res.status(400).json({ message: \"Se requiere un email\" });\n      }\n\n      const isSubscribed = await storage.isSubscribedToNewsletter(targetEmail);\n      if (isSubscribed) {\n        // Silent success for already subscribed via dashboard toggle\n        return res.json({ success: true, message: \"Ya est\u00E1s suscrito\" });\n      }\n\n      await storage.subscribeToNewsletter(targetEmail);\n\n      // NOTIFICATION: Newsletter subscription\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.email, targetEmail)).limit(1);\n      if (user) {\n        await db.insert(userNotifications).values({\n          userId: user.id,\n          title: \"Suscripci\u00F3n confirmada\",\n          message: \"Te has suscrito correctamente a nuestra newsletter. Recibir\u00E1s las \u00FAltimas noticias y ofertas.\",\n          type: 'info',\n          isRead: false\n        });\n      }\n      \n      await sendEmail({\n        to: targetEmail,\n        subject: \"Confirmaci\u00F3n de suscripci\u00F3n a Easy US LLC\",\n        html: getNewsletterWelcomeTemplate(),\n      }).catch(() => {});\n      \n      res.json({ success: true });\n    } catch (err) {\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Email inv\u00E1lido\" });\n      }\n      res.status(500).json({ message: \"Error al suscribirse\" });\n    }\n  });\n\n  // Admin Invoice (unique route - not duplicated)\n  app.get(\"/api/admin/invoice/:id\", isAdmin, async (req, res) => {\n    const orderId = Number(req.params.id);\n    const order = await storage.getOrder(orderId);\n    if (!order) return res.status(404).json({ message: \"Order not found\" });\n    \n    res.setHeader('Content-Type', 'text/html');\n    res.send(generateInvoiceHtml(order));\n  });\n\n  // Client Receipt/Resumen Route (PDF)\n  app.get(\"/api/orders/:id/receipt\", isAuthenticated, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order) return res.status(404).json({ message: \"Pedido no encontrado\" });\n      if (order.userId !== req.session.userId && !req.session.isAdmin) {\n        return res.status(403).json({ message: \"Acceso denegado\" });\n      }\n      \n      // Get application requestCode (LLC or Maintenance)\n      const [llcApp] = await db.select().from(llcApplicationsTable).where(eq(llcApplicationsTable.orderId, orderId)).limit(1);\n      const [maintApp] = await db.select().from(maintenanceApplications).where(eq(maintenanceApplications.orderId, orderId)).limit(1);\n      const requestCode = llcApp?.requestCode || maintApp?.requestCode || order.invoiceNumber || '';\n      \n      // Generate PDF using lightweight PDFKit\n      const pdfBuffer = await generateReceiptPdf({\n        requestCode: requestCode || `REC-${orderId}`,\n        date: new Date(order.createdAt || Date.now()).toLocaleDateString('es-ES'),\n        customerName: `${order.user?.firstName || ''} ${order.user?.lastName || ''}`.trim() || 'Cliente',\n        productName: order.product?.name || 'Servicio LLC',\n        amount: order.amount,\n        currency: order.currency || 'EUR',\n        status: order.status\n      });\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `inline; filename=\"Recibo-${requestCode}.pdf\"`);\n      res.send(pdfBuffer);\n    } catch (error) {\n      console.error(\"Receipt Error:\", error);\n      res.status(500).send(\"Error al generar recibo\");\n    }\n  });\n\n  // Order Events Timeline\n  app.get(\"/api/orders/:id/events\", isAuthenticated, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order) return res.status(404).json({ message: \"Pedido no encontrado\" });\n      if (order.userId !== req.session.userId && !req.session.isAdmin) {\n        return res.status(403).json({ message: \"Acceso denegado\" });\n      }\n      \n      const events = await db.select().from(orderEvents)\n        .where(eq(orderEvents.orderId, orderId))\n        .orderBy(desc(orderEvents.createdAt));\n      \n      res.json(events);\n    } catch (error) {\n      console.error(\"Error fetching order events:\", error);\n      res.status(500).json({ message: \"Error al obtener eventos\" });\n    }\n  });\n\n  // Add order event (admin only)\n  app.post(\"/api/admin/orders/:id/events\", isAdmin, async (req: any, res) => {\n    try {\n      const orderId = Number(req.params.id);\n      const { eventType, description } = req.body;\n      \n      const [event] = await db.insert(orderEvents).values({\n        orderId,\n        eventType,\n        description,\n        createdBy: req.session.userId,\n      }).returning();\n      \n      // Get order and user info for email notification\n      const order = await storage.getOrder(orderId);\n      if (order) {\n        const [user] = await db.select().from(usersTable).where(eq(usersTable.id, order.userId)).limit(1);\n        if (user?.email) {\n          sendEmail({\n            to: user.email,\n            subject: \"Actualizaci\u00F3n de tu pedido\",\n            html: getOrderEventTemplate(user.firstName || 'Cliente', String(orderId), eventType, description)\n          }).catch(() => {});\n        }\n      }\n      \n      res.json(event);\n    } catch (error) {\n      console.error(\"Error creating order event:\", error);\n      res.status(500).json({ message: \"Error al crear evento\" });\n    }\n  });\n\n  // Message replies\n  app.get(\"/api/messages/:id/replies\", isAuthenticated, async (req: any, res) => {\n    try {\n      const messageId = Number(req.params.id);\n      const replies = await db.select().from(messageReplies)\n        .where(eq(messageReplies.messageId, messageId))\n        .orderBy(messageReplies.createdAt);\n      \n      res.json(replies);\n    } catch (error) {\n      console.error(\"Error fetching message replies:\", error);\n      res.status(500).json({ message: \"Error al obtener respuestas\" });\n    }\n  });\n\n  // Add reply to message\n  app.post(\"/api/messages/:id/reply\", isAuthenticated, async (req: any, res) => {\n    try {\n      const messageId = Number(req.params.id);\n      const { content } = req.body;\n      \n      if (!content || typeof content !== 'string' || !content.trim()) {\n        return res.status(400).json({ message: \"El contenido de la respuesta es requerido\" });\n      }\n      \n      const [reply] = await db.insert(messageReplies).values({\n        messageId,\n        content,\n        isAdmin: req.session.isAdmin || false,\n        createdBy: req.session.userId,\n      }).returning();\n      \n      // Get message for email notification\n      const [message] = await db.select().from(messagesTable).where(eq(messagesTable.id, messageId)).limit(1);\n      if (message?.email && req.session.isAdmin) {\n        // Admin reply - notify client by email\n        const ticketId = message.messageId || String(messageId);\n        sendEmail({\n          to: message.email,\n          subject: `Nueva respuesta a tu consulta - Ticket #${ticketId}`,\n          html: getMessageReplyTemplate(message.name?.split(' ')[0] || 'Cliente', content, ticketId)\n        }).catch(() => {});\n        \n        // Create notification for client if they have a user account\n        if (message.userId) {\n          await db.insert(userNotifications).values({\n            userId: message.userId,\n            title: \"Nueva respuesta a tu consulta\",\n            message: `Hemos respondido a tu mensaje (Ticket: #${ticketId}). Revisa tu email o tu \u00E1rea de mensajes.`,\n            type: 'info',\n            isRead: false\n          });\n        }\n      }\n      \n      res.json(reply);\n    } catch (error) {\n      console.error(\"Error creating reply:\", error);\n      res.status(500).json({ message: \"Error al crear respuesta\" });\n    }\n  });\n\n  function generateInvoiceHtml(order: any) {\n    const requestCode = order.application?.requestCode || order.maintenanceApplication?.requestCode || order.invoiceNumber;\n    const userName = order.user ? `${order.user.firstName || ''} ${order.user.lastName || ''}`.trim() : 'Cliente';\n    const userEmail = order.user?.email || '';\n    const userPhone = order.user?.phone || '';\n    const userClientId = order.user?.clientId || '';\n    const userAddress = order.user ? [\n      order.user.streetType,\n      order.user.address,\n      order.user.city,\n      order.user.province,\n      order.user.postalCode,\n      order.user.country\n    ].filter(Boolean).join(', ') : '';\n    const userIdNumber = order.user?.idNumber ? `${order.user.idType?.toUpperCase() || 'ID'}: ${order.user.idNumber}` : '';\n    const productName = order.product?.name || 'Servicio de Constituci\u00F3n LLC';\n    const invoiceNumber = requestCode || order.invoiceNumber;\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"es\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Factura ${invoiceNumber}</title>\n          <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap\" rel=\"stylesheet\">\n          <style>\n            @media print { \n              body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } \n              .no-print { display: none !important; }\n              @page { margin: 1cm; }\n            }\n            * { box-sizing: border-box; margin: 0; padding: 0; }\n            body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; color: #0E1215; line-height: 1.6; background: #fff; max-width: 800px; margin: 0 auto; }\n            .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 50px; padding-bottom: 30px; border-bottom: 3px solid #6EDC8A; }\n            .logo-section h1 { font-size: 28px; font-weight: 900; letter-spacing: -0.02em; }\n            .logo-section .subtitle { color: #6B7280; font-size: 13px; margin-top: 4px; }\n            .invoice-info { text-align: right; }\n            .invoice-badge { background: linear-gradient(135deg, #6EDC8A 0%, #4eca70 100%); color: #0E1215; padding: 10px 20px; border-radius: 100px; font-weight: 900; font-size: 13px; display: inline-block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }\n            .invoice-number { font-size: 20px; font-weight: 800; color: #0E1215; }\n            .invoice-date { font-size: 13px; color: #6B7280; margin-top: 4px; }\n            .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-bottom: 50px; }\n            .detail-box { background: #F7F7F5; padding: 25px; border-radius: 16px; }\n            .detail-label { font-size: 11px; font-weight: 800; text-transform: uppercase; color: #6EDC8A; margin-bottom: 12px; letter-spacing: 0.08em; }\n            .detail-content p { font-size: 14px; margin-bottom: 4px; }\n            .detail-content strong { font-weight: 700; }\n            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }\n            .items-table thead th { text-align: left; padding: 16px 12px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; color: #6B7280; border-bottom: 2px solid #E6E9EC; }\n            .items-table thead th:last-child { text-align: right; }\n            .items-table tbody td { padding: 20px 12px; font-size: 15px; border-bottom: 1px solid #F7F7F5; }\n            .items-table tbody td:last-child { text-align: right; font-weight: 600; }\n            .totals-section { display: flex; justify-content: flex-end; margin-bottom: 50px; }\n            .totals-box { background: linear-gradient(135deg, #F7F7F5 0%, #E6E9EC 100%); padding: 30px; border-radius: 20px; min-width: 280px; }\n            .totals-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }\n            .totals-row.final { border-top: 2px solid #0E1215; padding-top: 15px; margin-top: 15px; margin-bottom: 0; }\n            .totals-row.final .label { font-size: 12px; font-weight: 800; text-transform: uppercase; color: #6B7280; }\n            .totals-row.final .amount { font-size: 28px; font-weight: 900; color: #0E1215; }\n            .footer { text-align: center; padding-top: 30px; border-top: 1px solid #E6E9EC; font-size: 12px; color: #6B7280; }\n            .footer p { margin-bottom: 4px; }\n            .print-controls { text-align: center; margin-bottom: 30px; }\n            .print-btn { background: #6EDC8A; color: #0E1215; padding: 14px 35px; border: none; border-radius: 100px; font-weight: 800; cursor: pointer; font-size: 14px; transition: transform 0.15s, box-shadow 0.15s; box-shadow: 0 4px 15px rgba(110, 220, 138, 0.3); }\n            .print-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(110, 220, 138, 0.4); }\n          </style>\n        </head>\n        <body>\n          <div class=\"print-controls no-print\">\n            <button class=\"print-btn\" onclick=\"window.print()\">Imprimir / Descargar PDF</button>\n          </div>\n          \n          <div class=\"header\">\n            <div class=\"logo-section\">\n              <img src=\"https://easyusllc.com/logo-icon.png\" alt=\"Easy US LLC\" style=\"width: 60px; height: 60px; margin-bottom: 10px; border-radius: 12px;\">\n              <h1>Easy US LLC</h1>\n              <p class=\"subtitle\">Servicios de Constituci\u00F3n Empresarial</p>\n            </div>\n            <div class=\"invoice-info\">\n              <div class=\"invoice-badge\">Factura</div>\n              <div class=\"invoice-number\">${invoiceNumber}</div>\n              <div class=\"invoice-date\">Fecha: ${new Date(order.createdAt).toLocaleDateString('es-ES', { day: '2-digit', month: 'long', year: 'numeric' })}</div>\n            </div>\n          </div>\n          \n          <div class=\"details-grid\">\n            <div class=\"detail-box\">\n              <div class=\"detail-label\">Datos del Emisor</div>\n              <div class=\"detail-content\">\n                <p><strong>EASY US LLC</strong></p>\n                <p>FORTUNY CONSULTING LLC</p>\n                <p>1209 Mountain Road Place NE, STE R</p>\n                <p>Albuquerque, NM 87110, USA</p>\n                <p style=\"margin-top: 10px;\">info@easyusllc.com</p>\n                <p>+34 614 91 69 10</p>\n              </div>\n            </div>\n            <div class=\"detail-box\">\n              <div class=\"detail-label\">Datos del Cliente</div>\n              <div class=\"detail-content\">\n                <p><strong>${userName}</strong></p>\n                ${userClientId ? `<p style=\"font-size: 12px; color: #6B7280;\"><strong>ID Cliente:</strong> ${userClientId}</p>` : ''}\n                ${userIdNumber ? `<p>${userIdNumber}</p>` : ''}\n                <p>${userEmail}</p>\n                ${userPhone ? `<p>${userPhone}</p>` : ''}\n                ${userAddress ? `<p style=\"margin-top: 6px;\">${userAddress}</p>` : ''}\n                <p style=\"margin-top: 10px;\"><strong>Ref. Pedido:</strong> ${requestCode}</p>\n              </div>\n            </div>\n          </div>\n          \n          <table class=\"items-table\">\n            <thead>\n              <tr>\n                <th>Descripci\u00F3n del Servicio</th>\n                <th>Importe</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td><strong>${productName}</strong><br><span style=\"color: #6B7280; font-size: 13px;\">Servicio completo de constituci\u00F3n empresarial en USA</span></td>\n                <td>${((order.originalAmount || order.amount) / 100).toFixed(2)} \u20AC</td>\n              </tr>\n            </tbody>\n          </table>\n          \n          <div class=\"totals-section\">\n            <div class=\"totals-box\">\n              <div class=\"totals-row\">\n                <span>Subtotal</span>\n                <span>${((order.originalAmount || order.amount) / 100).toFixed(2)} \u20AC</span>\n              </div>\n              ${order.discountCode ? `\n              <div class=\"totals-row\" style=\"color: #16a34a;\">\n                <span>Descuento (${order.discountCode})</span>\n                <span>-${(order.discountAmount / 100).toFixed(2)} \u20AC</span>\n              </div>\n              ` : ''}\n              <div class=\"totals-row\">\n                <span>IVA (0%)</span>\n                <span>0.00 \u20AC</span>\n              </div>\n              <div class=\"totals-row final\">\n                <span class=\"label\">Total</span>\n                <span class=\"amount\">${(order.amount / 100).toFixed(2)} \u20AC</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"footer\">\n            <p><strong>EASY US LLC</strong> \u2022 FORTUNY CONSULTING LLC</p>\n            <p>1209 Mountain Road Place NE, STE R, Albuquerque, NM 87110, USA</p>\n            <p>info@easyusllc.com \u2022 +34 614 91 69 10 \u2022 www.easyusllc.com</p>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  function generateReceiptHtml(order: any, requestCode?: string) {\n    const receiptNumber = requestCode || order.application?.requestCode || order.maintenanceApplication?.requestCode || order.invoiceNumber;\n    const userName = order.user ? `${order.user.firstName || ''} ${order.user.lastName || ''}`.trim() : 'Cliente';\n    const userEmail = order.user?.email || '';\n    const productName = order.product?.name || 'Servicio de Constituci\u00F3n LLC';\n    const statusLabels: Record<string, string> = {\n      'paid': 'Pagado',\n      'pending': 'Pendiente',\n      'processing': 'En Proceso',\n      'completed': 'Completado'\n    };\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"es\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Recibo ${receiptNumber}</title>\n          <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap\" rel=\"stylesheet\">\n          <style>\n            @media print { \n              body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: #fff !important; } \n              .no-print { display: none !important; }\n              .receipt-card { box-shadow: none !important; }\n              @page { margin: 1cm; }\n            }\n            * { box-sizing: border-box; margin: 0; padding: 0; }\n            body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; padding: 40px; color: #0E1215; line-height: 1.6; background: #F7F7F5; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }\n            .print-controls { text-align: center; margin-bottom: 25px; }\n            .print-btn { background: #6EDC8A; color: #0E1215; padding: 14px 35px; border: none; border-radius: 100px; font-weight: 800; cursor: pointer; font-size: 14px; transition: transform 0.15s, box-shadow 0.15s; box-shadow: 0 4px 15px rgba(110, 220, 138, 0.3); }\n            .print-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(110, 220, 138, 0.4); }\n            .receipt-card { background: white; max-width: 500px; width: 100%; padding: 50px; border-radius: 32px; box-shadow: 0 25px 50px rgba(0,0,0,0.08); }\n            .receipt-header { text-align: center; margin-bottom: 35px; }\n            .success-icon { width: 70px; height: 70px; background: linear-gradient(135deg, #6EDC8A 0%, #4eca70 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }\n            .success-icon svg { width: 35px; height: 35px; color: #0E1215; }\n            .receipt-badge { background: #6EDC8A; color: #0E1215; padding: 8px 18px; border-radius: 100px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.08em; display: inline-block; margin-bottom: 15px; }\n            .receipt-title { font-size: 26px; font-weight: 900; letter-spacing: -0.02em; margin-bottom: 8px; }\n            .receipt-number { color: #6EDC8A; font-size: 18px; font-weight: 800; }\n            .receipt-message { color: #6B7280; font-size: 14px; margin-top: 15px; padding: 0 20px; }\n            .receipt-details { background: #F7F7F5; border-radius: 20px; padding: 25px; margin-bottom: 30px; }\n            .detail-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #E6E9EC; }\n            .detail-row:last-child { border-bottom: none; }\n            .detail-label { font-size: 12px; font-weight: 700; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; }\n            .detail-value { font-size: 15px; font-weight: 600; color: #0E1215; text-align: right; }\n            .detail-value.highlight { font-size: 22px; font-weight: 900; color: #6EDC8A; }\n            .status-badge { background: #6EDC8A; color: #0E1215; padding: 6px 14px; border-radius: 100px; font-size: 12px; font-weight: 800; }\n            .status-badge.pending { background: #FEF3C7; color: #92400E; }\n            .receipt-footer { text-align: center; padding-top: 25px; border-top: 1px solid #E6E9EC; font-size: 12px; color: #6B7280; }\n            .receipt-footer p { margin-bottom: 4px; }\n            .receipt-footer .company { font-weight: 700; color: #0E1215; }\n          </style>\n        </head>\n        <body>\n          <div class=\"print-controls no-print\">\n            <button class=\"print-btn\" onclick=\"window.print()\">Imprimir / Descargar PDF</button>\n          </div>\n          \n          <div class=\"receipt-card\">\n            <div class=\"receipt-header\">\n              <img src=\"https://easyusllc.com/logo-icon.png\" alt=\"Easy US LLC\" style=\"width: 70px; height: 70px; margin: 0 auto 20px; display: block; border-radius: 12px;\">\n              <div class=\"receipt-badge\">Recibo de Solicitud</div>\n              <h1 class=\"receipt-title\">Pedido Confirmado</h1>\n              <div class=\"receipt-number\">${receiptNumber}</div>\n              <p class=\"receipt-message\">Hemos recibido correctamente tu solicitud. Tu proceso de constituci\u00F3n est\u00E1 en marcha.</p>\n            </div>\n            \n            <div class=\"receipt-details\">\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Cliente</span>\n                <span class=\"detail-value\">${userName}</span>\n              </div>\n              ${userEmail ? `<div class=\"detail-row\">\n                <span class=\"detail-label\">Email</span>\n                <span class=\"detail-value\">${userEmail}</span>\n              </div>` : ''}\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Servicio</span>\n                <span class=\"detail-value\">${productName}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Fecha</span>\n                <span class=\"detail-value\">${new Date(order.createdAt).toLocaleDateString('es-ES', { day: '2-digit', month: 'long', year: 'numeric' })}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Referencia</span>\n                <span class=\"detail-value\">${requestCode}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Estado</span>\n                <span class=\"status-badge ${order.status === 'pending' ? 'pending' : ''}\">${statusLabels[order.status] || order.status}</span>\n              </div>\n              ${order.discountCode ? `\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Subtotal</span>\n                <span class=\"detail-value\">${((order.originalAmount || order.amount) / 100).toFixed(2)} \u20AC</span>\n              </div>\n              <div class=\"detail-row\" style=\"color: #16a34a;\">\n                <span class=\"detail-label\">Descuento (${order.discountCode})</span>\n                <span class=\"detail-value\" style=\"color: #16a34a;\">-${(order.discountAmount / 100).toFixed(2)} \u20AC</span>\n              </div>\n              ` : ''}\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Total</span>\n                <span class=\"detail-value highlight\">${(order.amount / 100).toFixed(2)} \u20AC</span>\n              </div>\n            </div>\n            \n            <div class=\"receipt-footer\">\n              <p>Conserva este recibo para tus registros.</p>\n              <p class=\"company\">EASY US LLC \u2022 FORTUNY CONSULTING LLC</p>\n              <p>1209 Mountain Road Place NE, STE R, Albuquerque, NM 87110</p>\n              <p>info@easyusllc.com \u2022 +34 614 91 69 10</p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n\n  // Contact form\n  app.post(\"/api/contact/send-otp\", async (req, res) => {\n    try {\n      const ip = getClientIp(req);\n      const rateCheck = checkRateLimit('contact', ip);\n      if (!rateCheck.allowed) {\n        return res.status(429).json({ \n          message: `Demasiados intentos. Espera ${rateCheck.retryAfter} segundos.` \n        });\n      }\n\n      const { email } = z.object({ email: z.string().email() }).parse(req.body);\n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 mins\n\n      await db.insert(contactOtps).values({\n        email,\n        otp,\n        expiresAt,\n      });\n\n      await sendEmail({\n        to: email,\n        subject: \"Tu c\u00F3digo de verificaci\u00F3n | Easy US LLC\",\n        html: getOtpEmailTemplate(otp, \"Cliente\"),\n      });\n\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error sending contact OTP:\", err);\n      res.status(400).json({ message: \"Error al enviar el c\u00F3digo de verificaci\u00F3n. Por favor, int\u00E9ntalo de nuevo en unos minutos.\" });\n    }\n  });\n\n  app.post(\"/api/contact/verify-otp\", async (req, res) => {\n    try {\n      const { email, otp } = z.object({ email: z.string().email(), otp: z.string() }).parse(req.body);\n      \n      const [record] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otp, otp),\n            gt(contactOtps.expiresAt, new Date())\n          )\n        )\n        .limit(1);\n\n      if (!record) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o caducado\" });\n      }\n\n      await db.update(contactOtps)\n        .set({ verified: true })\n        .where(eq(contactOtps.id, record.id));\n\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error verifying contact OTP:\", err);\n      res.status(400).json({ message: \"Error al verificar el c\u00F3digo\" });\n    }\n  });\n\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      const contactData = z.object({\n        nombre: z.string(),\n        apellido: z.string(),\n        email: z.string().email(),\n        telefono: z.string().optional(),\n        subject: z.string(),\n        mensaje: z.string(),\n        otp: z.string(),\n      }).parse(req.body);\n\n      // Sanitize user input\n      const sanitizedData = {\n        nombre: sanitizeHtml(contactData.nombre),\n        apellido: sanitizeHtml(contactData.apellido),\n        subject: sanitizeHtml(contactData.subject),\n        mensaje: sanitizeHtml(contactData.mensaje),\n        telefono: contactData.telefono ? sanitizeHtml(contactData.telefono) : undefined,\n      };\n\n      const [otpRecord] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, contactData.email),\n            eq(contactOtps.otp, contactData.otp),\n            eq(contactOtps.verified, true)\n          )\n        )\n        .limit(1);\n\n      if (!otpRecord) {\n        return res.status(400).json({ message: \"Email no verificado\" });\n      }\n\n      const clientIp = getClientIp(req);\n      const { generateUniqueMessageId } = await import(\"./lib/id-generator\");\n      const ticketId = await generateUniqueMessageId();\n      \n      // Notification to admin with sanitized data\n      logActivity(\"Acci\u00F3n Contacto\", {\n        \"ID Ticket\": ticketId,\n        \"Nombre\": `${sanitizedData.nombre} ${sanitizedData.apellido}`,\n        \"Email\": contactData.email,\n        \"Tel\u00E9fono\": sanitizedData.telefono || \"No proporcionado\",\n        \"Asunto\": sanitizedData.subject,\n        \"Mensaje\": sanitizedData.mensaje,\n        \"IP\": clientIp\n      });\n\n      await sendEmail({\n        to: contactData.email,\n        subject: `Hemos recibido tu mensaje - Ticket #${ticketId}`,\n        html: getAutoReplyTemplate(ticketId, sanitizedData.nombre),\n      });\n\n      logAudit({ action: 'order_created', ip: clientIp, details: { ticketId, type: 'contact' } });\n      res.json({ success: true, ticketId });\n    } catch (err) {\n      console.error(\"Error processing contact form:\", err);\n      res.status(400).json({ message: \"Error al procesar el mensaje\" });\n    }\n  });\n\n  // =============================================\n  // OTP endpoints for registration and password reset\n  // =============================================\n  \n  // Check if email already exists (for form flow to detect existing users)\n  app.post(\"/api/auth/check-email\", async (req, res) => {\n    try {\n      const { email } = z.object({ email: z.string().email() }).parse(req.body);\n      \n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      \n      res.json({ \n        exists: !!existingUser,\n        firstName: existingUser?.firstName || null\n      });\n    } catch (err) {\n      res.status(400).json({ message: \"Email inv\u00E1lido\" });\n    }\n  });\n  \n  // Send OTP for account registration (email verification before creating account)\n  app.post(\"/api/register/send-otp\", async (req, res) => {\n    try {\n      const ip = getClientIp(req);\n      const rateCheck = checkRateLimit('register', ip);\n      if (!rateCheck.allowed) {\n        return res.status(429).json({ \n          message: `Demasiados intentos. Espera ${rateCheck.retryAfter} segundos.` \n        });\n      }\n\n      const { email } = z.object({ email: z.string().email() }).parse(req.body);\n      \n      // Check if email is already registered\n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Este email ya est\u00E1 registrado. Por favor inicia sesi\u00F3n.\" });\n      }\n      \n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 mins\n\n      await db.insert(contactOtps).values({\n        email,\n        otp,\n        otpType: \"account_verification\",\n        expiresAt,\n      });\n\n      await sendEmail({\n        to: email,\n        subject: \"Tu c\u00F3digo de verificaci\u00F3n | Easy US LLC\",\n        html: getOtpEmailTemplate(otp, \"Cliente\"),\n      });\n\n      logAudit({ action: 'user_register', ip, details: { email, step: 'otp_sent' } });\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error sending registration OTP:\", err);\n      res.status(400).json({ message: \"Error al enviar el c\u00F3digo de verificaci\u00F3n.\" });\n    }\n  });\n\n  // Verify OTP for account registration\n  app.post(\"/api/register/verify-otp\", async (req, res) => {\n    try {\n      const { email, otp } = z.object({ email: z.string().email(), otp: z.string() }).parse(req.body);\n      \n      const [record] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otp, otp),\n            eq(contactOtps.otpType, \"account_verification\"),\n            gt(contactOtps.expiresAt, new Date())\n          )\n        )\n        .limit(1);\n\n      if (!record) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o caducado\" });\n      }\n\n      await db.update(contactOtps)\n        .set({ verified: true })\n        .where(eq(contactOtps.id, record.id));\n\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error verifying registration OTP:\", err);\n      res.status(400).json({ message: \"Error al verificar el c\u00F3digo\" });\n    }\n  });\n\n  // Send OTP for password reset (forgot password)\n  app.post(\"/api/password-reset/send-otp\", async (req, res) => {\n    try {\n      const ip = getClientIp(req);\n      const rateCheck = checkRateLimit('passwordReset', ip);\n      if (!rateCheck.allowed) {\n        return res.status(429).json({ \n          message: `Demasiados intentos. Espera ${rateCheck.retryAfter} segundos.` \n        });\n      }\n\n      const { email } = z.object({ email: z.string().email() }).parse(req.body);\n      \n      // Check if user exists (but don't reveal this to prevent enumeration)\n      const [existingUser] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      \n      // Always return success to prevent email enumeration attacks\n      if (!existingUser) {\n        return res.json({ success: true });\n      }\n      \n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 mins\n\n      await db.insert(contactOtps).values({\n        email,\n        otp,\n        otpType: \"password_reset\",\n        expiresAt,\n      });\n\n      await sendEmail({\n        to: email,\n        subject: \"Tu c\u00F3digo de verificaci\u00F3n | Easy US LLC\",\n        html: getOtpEmailTemplate(otp, existingUser?.firstName || \"Cliente\"),\n      });\n\n      logAudit({ action: 'password_reset', ip, details: { email } });\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Error sending password reset OTP:\", err);\n      res.status(400).json({ message: \"Error al enviar el c\u00F3digo de verificaci\u00F3n.\" });\n    }\n  });\n\n  // Verify OTP and reset password\n  app.post(\"/api/password-reset/confirm\", async (req, res) => {\n    try {\n      const { email, otp, newPassword } = z.object({ \n        email: z.string().email(), \n        otp: z.string(),\n        newPassword: z.string().min(8, \"La contrase\u00F1a debe tener al menos 8 caracteres\")\n      }).parse(req.body);\n      \n      const [record] = await db.select()\n        .from(contactOtps)\n        .where(\n          and(\n            eq(contactOtps.email, email),\n            eq(contactOtps.otp, otp),\n            eq(contactOtps.otpType, \"password_reset\"),\n            gt(contactOtps.expiresAt, new Date()),\n            eq(contactOtps.verified, false)\n          )\n        )\n        .limit(1);\n\n      if (!record) {\n        return res.status(400).json({ message: \"C\u00F3digo inv\u00E1lido o caducado\" });\n      }\n\n      // Find the user\n      const [user] = await db.select().from(usersTable).where(eq(usersTable.email, email)).limit(1);\n      if (!user) {\n        return res.status(400).json({ message: \"Usuario no encontrado\" });\n      }\n\n      // Hash new password and update\n      const { hashPassword } = await import(\"./lib/auth-service\");\n      const passwordHash = await hashPassword(newPassword);\n      \n      await db.update(usersTable)\n        .set({ passwordHash, updatedAt: new Date() })\n        .where(eq(usersTable.id, user.id));\n\n      // Mark OTP as used\n      await db.update(contactOtps)\n        .set({ verified: true })\n        .where(eq(contactOtps.id, record.id));\n\n      res.json({ success: true, message: \"Contrase\u00F1a actualizada correctamente\" });\n    } catch (err: any) {\n      console.error(\"Error resetting password:\", err);\n      if (err.errors) {\n        return res.status(400).json({ message: err.errors[0]?.message || \"Error al restablecer la contrase\u00F1a\" });\n      }\n      res.status(400).json({ message: \"Error al restablecer la contrase\u00F1a\" });\n    }\n  });\n\n  // Seed Data\n  await seedDatabase();\n\n  // === Test Email Route ===\n  app.post(\"/api/admin/test-emails\", isAdmin, async (req, res) => {\n    const { email } = req.body;\n    if (!email) return res.status(400).json({ message: \"Email requerido\" });\n\n    try {\n      const ticketId = \"12345678\";\n      const otp = \"888999\";\n      const name = \"Cliente de Prueba\";\n      const requestCode = \"NM-12345678\";\n\n      // Improved Admin Activity Notification (Elegir Estado)\n      const activityHtml = `\n        <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n          <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n            ${getEmailHeader()}\n            <div style=\"padding: 40px;\">\n              <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Log de Actividad: Selecci\u00F3n de Estado</h2>\n              <div style=\"background: #f4f4f4; border-left: 4px solid #000; padding: 20px; margin: 20px 0;\">\n                <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Acci\u00F3n:</strong> Clic en bot\u00F3n elegir</p>\n                <p style=\"margin: 0 0 10px 0; font-size: 14px;\"><strong>Estado:</strong> New Mexico Pack</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Precio:</strong> 739\u20AC</p>\n        </div>\n        <p style=\"font-size: 12px; color: #999;\">IP Origen: 127.0.0.1 | Fecha: ${new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid' })}</p>\n      </div>\n      ${getEmailFooter()}\n    </div>\n  </div>\n`;\n\nconst orderHtml = `\n  <div style=\"background-color: #f9f9f9; padding: 20px 0;\">\n    <div style=\"font-family: 'Inter', Arial, sans-serif; max-width: 600px; margin: auto; border-radius: 8px; overflow: hidden; color: #1a1a1a; background-color: #ffffff; border: 1px solid #e5e5e5;\">\n      ${getEmailHeader()}\n      <div style=\"padding: 40px;\">\n        <h2 style=\"font-size: 18px; font-weight: 800; margin-bottom: 20px; color: #000;\">Detalles de la Notificaci\u00F3n</h2>\n        <div style=\"margin-bottom: 25px;\">\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Estado de la Transacci\u00F3n</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Estado Pago:</strong> <span style=\"color: #0d9488; font-weight: 700;\">CONFIRMADO (MOCK)</span></p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Fecha/Hora:</strong> ${new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid' })}</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Aceptaci\u00F3n T\u00E9rminos:</strong> S\u00CD (Marcado en formulario)</p>\n        </div>\n\n        <div style=\"margin-bottom: 25px;\">\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Informaci\u00F3n del Propietario</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Nombre:</strong> ${name}</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>DNI / Pasaporte:</strong> 12345678X (Test)</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Email:</strong> ${email}</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Direcci\u00F3n:</strong> Calle Falsa 123, 28001 Madrid, Espa\u00F1a</p>\n        </div>\n\n        <div>\n          <h3 style=\"font-size: 11px; text-transform: uppercase; color: #999; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-weight: 800;\">Detalles de la Empresa</h3>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Nombre LLC:</strong> Mi Nueva Empresa LLC</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Estado:</strong> New Mexico</p>\n          <p style=\"margin: 0 0 8px 0; font-size: 14px;\"><strong>Actividad:</strong> Consultor\u00EDa de Software y Marketing Digital</p>\n          <p style=\"margin: 0; font-size: 14px;\"><strong>Notas:</strong> Necesito el EIN urgente para abrir cuenta en Mercury.</p>\n        </div>\n      </div>\n      ${getEmailFooter()}\n    </div>\n  </div>\n`;\n\n      // Send improved admin templates\n      await Promise.all([\n        sendEmail({ to: email, subject: \"TEST: Tu c\u00F3digo de verificaci\u00F3n\", html: getOtpEmailTemplate(otp, name) }),\n        sendEmail({ to: email, subject: \"TEST: Log de Actividad (Admin)\", html: activityHtml }),\n        sendEmail({ to: email, subject: \"TEST: Nueva Solicitud LLC (Admin)\", html: orderHtml }),\n        sendEmail({ to: email, subject: \"TEST: Confirmaci\u00F3n de Pedido (Cliente)\", html: getConfirmationEmailTemplate(name, requestCode, { companyName: \"Mi Nueva Empresa LLC\" }) }),\n        sendEmail({ to: email, subject: \"TEST: Bienvenido a Easy US LLC\", html: getWelcomeEmailTemplate(name) }),\n        sendEmail({ to: email, subject: \"TEST: Newsletter Bienvenida\", html: getNewsletterWelcomeTemplate() }),\n        sendEmail({ to: email, subject: \"TEST: Confirmaci\u00F3n de Mensaje (Auto-reply)\", html: getAutoReplyTemplate(ticketId, name) }),\n      ]);\n\n      res.json({ success: true, message: \"Emails de prueba administrativos mejorados enviados\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Error al enviar emails de prueba\" });\n    }\n  });\n\n  return httpServer;\n}\n\nasync function seedDatabase() {\n  const existingProducts = await storage.getProducts();\n  if (existingProducts.length === 0) {\n    await storage.createProduct({\n      name: \"New Mexico LLC\",\n      description: \"Constituci\u00F3n r\u00E1pida en el estado m\u00E1s eficiente. Ideal para bajo coste de mantenimiento.\",\n      price: 73900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"EIN del IRS\",\n        \"BOI Report presentado\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n    await storage.createProduct({\n      name: \"Wyoming LLC\",\n      description: \"Constituci\u00F3n premium en el estado m\u00E1s prestigioso de USA. M\u00E1xima privacidad y protecci\u00F3n.\",\n      price: 89900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"EIN del IRS garantizado\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"BOI Report presentado\",\n        \"Annual Report a\u00F1o 1\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n    await storage.createProduct({\n      name: \"Delaware LLC\",\n      description: \"El est\u00E1ndar para startups y empresas tecnol\u00F3gicas. Reconocimiento legal global.\",\n      price: 119900,\n      features: [\n        \"Tasas del estado pagadas\",\n        \"Registered Agent (12 meses)\",\n        \"Articles of Organization oficiales\",\n        \"Operating Agreement profesional\",\n        \"EIN del IRS\",\n        \"BOI Report presentado\",\n        \"Declaraciones fiscales a\u00F1o 1\",\n        \"Soporte completo 12 meses\"\n      ],\n    });\n  }\n}\n", "import PDFDocument from 'pdfkit';\nimport path from 'path';\nimport fs from 'fs';\n\n// Logo path - try multiple locations\nconst getLogoPath = (): string | null => {\n  const possiblePaths = [\n    path.join(process.cwd(), 'client/public/logo-icon.png'),\n    path.join(process.cwd(), 'dist/public/logo-icon.png'),\n    path.join(__dirname, '../../client/public/logo-icon.png'),\n  ];\n  \n  for (const logoPath of possiblePaths) {\n    if (fs.existsSync(logoPath)) {\n      return logoPath;\n    }\n  }\n  return null;\n};\n\ninterface InvoiceData {\n  invoiceNumber: string;\n  date: string;\n  customerName: string;\n  customerEmail: string;\n  productName: string;\n  amount: number;\n  currency: string;\n  status: string;\n  originalAmount?: number;\n  discountAmount?: number;\n  discountCode?: string;\n}\n\ninterface ReceiptData {\n  requestCode: string;\n  date: string;\n  customerName: string;\n  productName: string;\n  amount: number;\n  currency: string;\n  status: string;\n}\n\nconst BRAND_GREEN = '#6EDC8A';\nconst BRAND_DARK = '#0E1215';\nconst BRAND_GRAY = '#6B7280';\n\nexport function generateInvoicePdf(data: InvoiceData): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    try {\n      const doc = new PDFDocument({ \n        size: 'A4', \n        margin: 50,\n        info: {\n          Title: `Factura ${data.invoiceNumber}`,\n          Author: 'Easy US LLC',\n        }\n      });\n      \n      const chunks: Buffer[] = [];\n      doc.on('data', (chunk: Buffer) => chunks.push(chunk));\n      doc.on('end', () => resolve(Buffer.concat(chunks)));\n      doc.on('error', reject);\n\n      // Header with logo\n      doc.rect(0, 0, 595, 90).fill(BRAND_DARK);\n      \n      // Try to add logo\n      const logoPath = getLogoPath();\n      if (logoPath) {\n        try {\n          doc.image(logoPath, 50, 15, { width: 55, height: 55 });\n          doc.font('Helvetica-Bold').fontSize(22).fillColor('#FFFFFF')\n            .text('Easy US LLC', 115, 28);\n          doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n            .text('Tu socio para formar LLC en USA', 115, 52);\n        } catch {\n          // Fallback to text-only header\n          doc.font('Helvetica-Bold').fontSize(24).fillColor('#FFFFFF')\n            .text('Easy US LLC', 50, 30);\n          doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n            .text('Tu socio para formar LLC en USA', 50, 55);\n        }\n      } else {\n        doc.font('Helvetica-Bold').fontSize(24).fillColor('#FFFFFF')\n          .text('Easy US LLC', 50, 30);\n        doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n          .text('Tu socio para formar LLC en USA', 50, 55);\n      }\n\n      // Invoice title\n      doc.moveDown(3);\n      doc.font('Helvetica-Bold').fontSize(28).fillColor(BRAND_DARK)\n        .text('FACTURA', 50, 130, { align: 'center' });\n      \n      // Invoice number badge\n      doc.rect(220, 165, 155, 30).fill(BRAND_GREEN);\n      doc.font('Helvetica-Bold').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.invoiceNumber, 220, 173, { width: 155, align: 'center' });\n\n      // Invoice details\n      doc.moveDown(4);\n      const detailsY = 220;\n      \n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_GRAY)\n        .text('FECHA DE EMISI\u00D3N', 50, detailsY);\n      doc.font('Helvetica').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.date, 50, detailsY + 15);\n\n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_GRAY)\n        .text('CLIENTE', 300, detailsY);\n      doc.font('Helvetica').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.customerName, 300, detailsY + 15);\n      doc.font('Helvetica').fontSize(10).fillColor(BRAND_GRAY)\n        .text(data.customerEmail, 300, detailsY + 30);\n\n      // Company info\n      const companyY = 300;\n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_GRAY)\n        .text('EMISOR', 50, companyY);\n      doc.font('Helvetica').fontSize(11).fillColor(BRAND_DARK)\n        .text('Easy US LLC (Fortuny Consulting LLC)', 50, companyY + 15);\n      doc.font('Helvetica').fontSize(10).fillColor(BRAND_GRAY)\n        .text('1209 Mountain Road Place NE, STE R', 50, companyY + 30);\n      doc.font('Helvetica').fontSize(10).fillColor(BRAND_GRAY)\n        .text('Albuquerque, NM 87110, USA', 50, companyY + 43);\n\n      // Line separator\n      doc.moveTo(50, 380).lineTo(545, 380).stroke(BRAND_GRAY);\n\n      // Product table header\n      const tableY = 400;\n      doc.rect(50, tableY, 495, 30).fill('#F3F4F6');\n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_DARK)\n        .text('CONCEPTO', 60, tableY + 10);\n      doc.text('ESTADO', 300, tableY + 10);\n      doc.text('IMPORTE', 450, tableY + 10);\n\n      // Product row\n      doc.font('Helvetica').fontSize(11).fillColor(BRAND_DARK)\n        .text(data.productName, 60, tableY + 45);\n      \n      // Status badge\n      const statusColor = data.status === 'paid' || data.status === 'completed' ? BRAND_GREEN : '#F59E0B';\n      const statusText = data.status === 'paid' ? 'PAGADO' : \n                         data.status === 'completed' ? 'COMPLETADO' : \n                         data.status.toUpperCase();\n      doc.rect(295, tableY + 40, 70, 20).fill(statusColor);\n      doc.font('Helvetica-Bold').fontSize(8).fillColor(BRAND_DARK)\n        .text(statusText, 295, tableY + 46, { width: 70, align: 'center' });\n\n      doc.font('Helvetica').fontSize(12).fillColor(BRAND_DARK)\n        .text(`${(data.amount / 100).toFixed(2)} ${data.currency}`, 450, tableY + 45);\n\n      // Discount info if applicable\n      let totalY = tableY + 100;\n      if (data.discountAmount && data.discountAmount > 0) {\n        doc.font('Helvetica').fontSize(10).fillColor(BRAND_GRAY)\n          .text(`Subtotal: ${((data.originalAmount || data.amount) / 100).toFixed(2)} ${data.currency}`, 400, totalY);\n        doc.font('Helvetica').fontSize(10).fillColor(BRAND_GREEN)\n          .text(`Descuento${data.discountCode ? ` (${data.discountCode})` : ''}: -${(data.discountAmount / 100).toFixed(2)} ${data.currency}`, 400, totalY + 15);\n        totalY += 40;\n      }\n\n      // Total box\n      doc.rect(350, totalY, 195, 50).fill(BRAND_DARK);\n      doc.font('Helvetica-Bold').fontSize(10).fillColor('#9CA3AF')\n        .text('TOTAL FACTURADO', 360, totalY + 10);\n      doc.font('Helvetica-Bold').fontSize(18).fillColor('#FFFFFF')\n        .text(`${(data.amount / 100).toFixed(2)} ${data.currency}`, 360, totalY + 25);\n\n      // Footer\n      const footerY = 720;\n      doc.moveTo(50, footerY).lineTo(545, footerY).stroke('#E5E7EB');\n      doc.font('Helvetica').fontSize(9).fillColor(BRAND_GRAY)\n        .text('Este documento es un comprobante oficial de pago emitido por Easy US LLC.', 50, footerY + 15, { align: 'center', width: 495 });\n      doc.text('Para cualquier duda, contacte con soporte@easyusllc.com', 50, footerY + 28, { align: 'center', width: 495 });\n      doc.font('Helvetica-Bold').fontSize(9).fillColor(BRAND_DARK)\n        .text(`\u00A9 ${new Date().getFullYear()} Easy US LLC. Todos los derechos reservados.`, 50, footerY + 45, { align: 'center', width: 495 });\n\n      doc.end();\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n\nexport function generateReceiptPdf(data: ReceiptData): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    try {\n      const doc = new PDFDocument({ \n        size: 'A4', \n        margin: 50,\n        info: {\n          Title: `Recibo ${data.requestCode}`,\n          Author: 'Easy US LLC',\n        }\n      });\n      \n      const chunks: Buffer[] = [];\n      doc.on('data', (chunk: Buffer) => chunks.push(chunk));\n      doc.on('end', () => resolve(Buffer.concat(chunks)));\n      doc.on('error', reject);\n\n      // Header with logo\n      doc.rect(0, 0, 595, 90).fill(BRAND_DARK);\n      \n      // Try to add logo\n      const logoPath = getLogoPath();\n      if (logoPath) {\n        try {\n          doc.image(logoPath, 50, 15, { width: 55, height: 55 });\n          doc.font('Helvetica-Bold').fontSize(22).fillColor('#FFFFFF')\n            .text('Easy US LLC', 115, 28);\n          doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n            .text('Recibo de Servicio', 115, 52);\n        } catch {\n          doc.font('Helvetica-Bold').fontSize(24).fillColor('#FFFFFF')\n            .text('Easy US LLC', 50, 30);\n          doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n            .text('Recibo de Servicio', 50, 55);\n        }\n      } else {\n        doc.font('Helvetica-Bold').fontSize(24).fillColor('#FFFFFF')\n          .text('Easy US LLC', 50, 30);\n        doc.font('Helvetica').fontSize(10).fillColor('#9CA3AF')\n          .text('Recibo de Servicio', 50, 55);\n      }\n\n      // Receipt title\n      doc.moveDown(3);\n      doc.font('Helvetica-Bold').fontSize(24).fillColor(BRAND_DARK)\n        .text('RECIBO DE PEDIDO', 50, 120, { align: 'center' });\n      \n      // Request code badge\n      doc.rect(200, 155, 195, 30).fill(BRAND_GREEN);\n      doc.font('Helvetica-Bold').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.requestCode, 200, 163, { width: 195, align: 'center' });\n\n      // Details section\n      const detailsY = 220;\n      \n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_GRAY)\n        .text('FECHA', 50, detailsY);\n      doc.font('Helvetica').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.date, 50, detailsY + 15);\n\n      doc.font('Helvetica-Bold').fontSize(10).fillColor(BRAND_GRAY)\n        .text('CLIENTE', 300, detailsY);\n      doc.font('Helvetica').fontSize(12).fillColor(BRAND_DARK)\n        .text(data.customerName, 300, detailsY + 15);\n\n      // Service details\n      const serviceY = 300;\n      doc.rect(50, serviceY, 495, 100).stroke(BRAND_GRAY);\n      \n      doc.font('Helvetica-Bold').fontSize(11).fillColor(BRAND_DARK)\n        .text('SERVICIO CONTRATADO', 70, serviceY + 20);\n      doc.font('Helvetica').fontSize(14).fillColor(BRAND_DARK)\n        .text(data.productName, 70, serviceY + 40);\n\n      // Status\n      const statusColor = data.status === 'paid' || data.status === 'completed' ? BRAND_GREEN : '#F59E0B';\n      const statusText = data.status === 'paid' ? 'PAGADO' : \n                         data.status === 'completed' ? 'COMPLETADO' : \n                         data.status.toUpperCase();\n      doc.rect(70, serviceY + 65, 80, 22).fill(statusColor);\n      doc.font('Helvetica-Bold').fontSize(9).fillColor(BRAND_DARK)\n        .text(statusText, 70, serviceY + 71, { width: 80, align: 'center' });\n\n      // Amount\n      doc.font('Helvetica-Bold').fontSize(20).fillColor(BRAND_DARK)\n        .text(`${(data.amount / 100).toFixed(2)} ${data.currency}`, 350, serviceY + 50);\n\n      // Thank you message\n      doc.moveDown(8);\n      doc.font('Helvetica-Bold').fontSize(14).fillColor(BRAND_GREEN)\n        .text('Gracias por confiar en Easy US LLC', 50, 450, { align: 'center', width: 495 });\n      doc.font('Helvetica').fontSize(11).fillColor(BRAND_GRAY)\n        .text('Estamos procesando tu solicitud. Te mantendremos informado del progreso.', 50, 475, { align: 'center', width: 495 });\n\n      // Footer\n      const footerY = 720;\n      doc.moveTo(50, footerY).lineTo(545, footerY).stroke('#E5E7EB');\n      doc.font('Helvetica').fontSize(9).fillColor(BRAND_GRAY)\n        .text('Easy US LLC - 1209 Mountain Road Place NE, STE R, Albuquerque, NM 87110', 50, footerY + 15, { align: 'center', width: 495 });\n      doc.font('Helvetica-Bold').fontSize(9).fillColor(BRAND_DARK)\n        .text(`\u00A9 ${new Date().getFullYear()} Easy US LLC`, 50, footerY + 30, { align: 'center', width: 495 });\n\n      doc.end();\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n", "import { OAuth2Client } from \"google-auth-library\";\nimport { db } from \"./db\";\nimport { users } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport type { Express, Request, Response } from \"express\";\nimport crypto from \"crypto\";\n\nconst GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID;\nconst GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\n\nconst googleClient = GOOGLE_CLIENT_ID ? new OAuth2Client(GOOGLE_CLIENT_ID) : null;\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    oauthState?: string;\n    oauthAction?: \"login\" | \"connect\";\n  }\n}\n\nfunction generateClientId(): string {\n  return Math.floor(10000000 + Math.random() * 90000000).toString();\n}\n\nasync function findOrCreateUserByGoogle(profile: {\n  googleId: string;\n  email: string;\n  firstName?: string;\n  lastName?: string;\n  profileImageUrl?: string;\n}) {\n  const existingByGoogle = await db.select().from(users).where(eq(users.googleId, profile.googleId)).limit(1);\n  if (existingByGoogle.length > 0) {\n    return existingByGoogle[0];\n  }\n\n  const existingByEmail = await db.select().from(users).where(eq(users.email, profile.email)).limit(1);\n  if (existingByEmail.length > 0) {\n    await db.update(users).set({ \n      googleId: profile.googleId,\n      emailVerified: true,\n      profileImageUrl: profile.profileImageUrl || existingByEmail[0].profileImageUrl,\n      updatedAt: new Date()\n    }).where(eq(users.id, existingByEmail[0].id));\n    return { ...existingByEmail[0], googleId: profile.googleId, emailVerified: true };\n  }\n\n  const newUser = await db.insert(users).values({\n    email: profile.email,\n    firstName: profile.firstName,\n    lastName: profile.lastName,\n    profileImageUrl: profile.profileImageUrl,\n    googleId: profile.googleId,\n    emailVerified: true,\n    clientId: generateClientId(),\n    isActive: true,\n    accountStatus: \"active\",\n  }).returning();\n\n  return newUser[0];\n}\n\nexport function setupOAuth(app: Express) {\n  app.get(\"/api/auth/google\", async (req: Request, res: Response) => {\n    const isConnect = req.query.connect === \"true\";\n    \n    if (isConnect && !req.session.userId) {\n      return res.redirect(\"/login?error=login_required\");\n    }\n    \n    if (!GOOGLE_CLIENT_ID || !GOOGLE_CLIENT_SECRET) {\n      return res.redirect(\"/login?error=google_not_configured\");\n    }\n\n    const protocol = req.headers[\"x-forwarded-proto\"] || req.protocol;\n    const host = req.headers.host || \"localhost:5000\";\n    const redirectUri = `${protocol}://${host}/api/auth/google/callback`;\n\n    const oauthState = crypto.randomBytes(32).toString(\"hex\");\n    req.session.oauthState = oauthState;\n    req.session.oauthAction = isConnect ? \"connect\" : \"login\";\n    \n    await new Promise<void>((resolve, reject) => {\n      req.session.save((err) => {\n        if (err) reject(err);\n        else resolve();\n      });\n    });\n    \n    const authUrl = new URL(\"https://accounts.google.com/o/oauth2/v2/auth\");\n    authUrl.searchParams.set(\"client_id\", GOOGLE_CLIENT_ID);\n    authUrl.searchParams.set(\"redirect_uri\", redirectUri);\n    authUrl.searchParams.set(\"response_type\", \"code\");\n    authUrl.searchParams.set(\"scope\", \"openid email profile\");\n    authUrl.searchParams.set(\"state\", oauthState);\n    authUrl.searchParams.set(\"access_type\", \"offline\");\n    authUrl.searchParams.set(\"prompt\", \"select_account\");\n\n    return res.redirect(authUrl.toString());\n  });\n\n  app.get(\"/api/auth/google/callback\", async (req: Request, res: Response) => {\n    try {\n      const { code, state, error } = req.query;\n      \n      const expectedState = req.session.oauthState;\n      const action = req.session.oauthAction;\n      \n      delete req.session.oauthState;\n      delete req.session.oauthAction;\n      \n      if (error) {\n        console.error(\"Google OAuth error:\", error);\n        return res.redirect(\"/login?error=oauth_denied\");\n      }\n\n      if (!state || state !== expectedState) {\n        console.error(\"OAuth state mismatch:\", { state, expectedState });\n        return res.redirect(\"/login?error=invalid_state\");\n      }\n\n      if (!code || typeof code !== \"string\") {\n        return res.redirect(\"/login?error=no_code\");\n      }\n\n      if (!GOOGLE_CLIENT_ID || !GOOGLE_CLIENT_SECRET) {\n        return res.redirect(\"/login?error=google_not_configured\");\n      }\n\n      const protocol = req.headers[\"x-forwarded-proto\"] || req.protocol;\n      const host = req.headers.host || \"localhost:5000\";\n      const redirectUri = `${protocol}://${host}/api/auth/google/callback`;\n\n      const tokenResponse = await fetch(\"https://oauth2.googleapis.com/token\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n        body: new URLSearchParams({\n          client_id: GOOGLE_CLIENT_ID,\n          client_secret: GOOGLE_CLIENT_SECRET,\n          code,\n          grant_type: \"authorization_code\",\n          redirect_uri: redirectUri,\n        }),\n      });\n\n      if (!tokenResponse.ok) {\n        const errorData = await tokenResponse.text();\n        console.error(\"Token exchange failed:\", errorData);\n        return res.redirect(\"/login?error=token_exchange_failed\");\n      }\n\n      const tokens = await tokenResponse.json();\n      const idToken = tokens.id_token;\n\n      if (!idToken) {\n        return res.redirect(\"/login?error=no_id_token\");\n      }\n\n      const ticket = await googleClient!.verifyIdToken({\n        idToken,\n        audience: GOOGLE_CLIENT_ID,\n      });\n\n      const payload = ticket.getPayload();\n      if (!payload || !payload.email) {\n        return res.redirect(\"/login?error=invalid_token\");\n      }\n\n      const isConnect = action === \"connect\";\n\n      if (isConnect && req.session.userId) {\n        const [existingUser] = await db.select().from(users).where(eq(users.id, req.session.userId)).limit(1);\n        if (existingUser) {\n          await db.update(users).set({ \n            googleId: payload.sub, \n            updatedAt: new Date() \n          }).where(eq(users.id, existingUser.id));\n          return res.redirect(\"/dashboard?connected=google\");\n        }\n      }\n\n      const user = await findOrCreateUserByGoogle({\n        googleId: payload.sub,\n        email: payload.email,\n        firstName: payload.given_name,\n        lastName: payload.family_name,\n        profileImageUrl: payload.picture,\n      });\n\n      if (!user.isActive || user.accountStatus === \"deactivated\") {\n        return res.redirect(\"/login?error=account_deactivated\");\n      }\n\n      req.session.userId = user.id;\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) reject(err);\n          else resolve();\n        });\n      });\n\n      return res.redirect(\"/dashboard\");\n    } catch (error) {\n      console.error(\"Google OAuth callback error:\", error);\n      return res.redirect(\"/login?error=auth_failed\");\n    }\n  });\n\n  app.post(\"/api/auth/google\", async (req: Request, res: Response) => {\n    try {\n      const { credential } = req.body;\n\n      if (!credential) {\n        return res.status(400).json({ message: \"Credencial de Google requerida\" });\n      }\n\n      if (!googleClient || !GOOGLE_CLIENT_ID) {\n        return res.status(503).json({ message: \"Google OAuth no esta configurado\" });\n      }\n\n      const ticket = await googleClient.verifyIdToken({\n        idToken: credential,\n        audience: GOOGLE_CLIENT_ID,\n      });\n\n      const payload = ticket.getPayload();\n      if (!payload || !payload.email) {\n        return res.status(400).json({ message: \"Token de Google invalido\" });\n      }\n\n      const user = await findOrCreateUserByGoogle({\n        googleId: payload.sub,\n        email: payload.email,\n        firstName: payload.given_name,\n        lastName: payload.family_name,\n        profileImageUrl: payload.picture,\n      });\n\n      if (!user.isActive || user.accountStatus === \"deactivated\") {\n        return res.status(403).json({ message: \"Cuenta desactivada\" });\n      }\n\n      req.login(user, (err) => {\n        if (err) {\n          console.error(\"Error en login de Google:\", err);\n          return res.status(500).json({ message: \"Error al iniciar sesion\" });\n        }\n        return res.json({\n          message: \"Inicio de sesion exitoso\",\n          user: {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            profileImageUrl: user.profileImageUrl,\n            clientId: user.clientId,\n            isAdmin: user.isAdmin,\n            emailVerified: user.emailVerified,\n            googleId: user.googleId ? true : false,\n          }\n        });\n      });\n    } catch (error) {\n      console.error(\"Error en autenticacion de Google:\", error);\n      return res.status(401).json({ message: \"Error al verificar credencial de Google\" });\n    }\n  });\n\n  app.post(\"/api/auth/connect/google\", async (req: Request, res: Response) => {\n    try {\n      if (!req.isAuthenticated() || !req.user) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const { credential } = req.body;\n      if (!credential || !googleClient || !GOOGLE_CLIENT_ID) {\n        return res.status(400).json({ message: \"Credencial de Google requerida\" });\n      }\n\n      const ticket = await googleClient.verifyIdToken({\n        idToken: credential,\n        audience: GOOGLE_CLIENT_ID,\n      });\n\n      const payload = ticket.getPayload();\n      if (!payload) {\n        return res.status(400).json({ message: \"Token invalido\" });\n      }\n\n      const existingUser = await db.select().from(users).where(eq(users.googleId, payload.sub)).limit(1);\n      if (existingUser.length > 0 && existingUser[0].id !== (req.user as any).id) {\n        return res.status(409).json({ message: \"Esta cuenta de Google ya esta vinculada a otro usuario\" });\n      }\n\n      await db.update(users).set({ \n        googleId: payload.sub,\n        updatedAt: new Date()\n      }).where(eq(users.id, (req.user as any).id));\n\n      return res.json({ message: \"Cuenta de Google vinculada exitosamente\" });\n    } catch (error) {\n      console.error(\"Error conectando Google:\", error);\n      return res.status(500).json({ message: \"Error al vincular cuenta de Google\" });\n    }\n  });\n\n  app.post(\"/api/auth/disconnect/google\", async (req: Request, res: Response) => {\n    try {\n      if (!req.isAuthenticated() || !req.user) {\n        return res.status(401).json({ message: \"No autenticado\" });\n      }\n\n      const userId = (req.user as any).id;\n      const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n\n      if (user.length === 0) {\n        return res.status(404).json({ message: \"Usuario no encontrado\" });\n      }\n\n      if (!user[0].passwordHash) {\n        return res.status(400).json({ \n          message: \"Debes tener una contrasena configurada antes de desvincular Google\" \n        });\n      }\n\n      await db.update(users).set({ \n        googleId: null,\n        updatedAt: new Date()\n      }).where(eq(users.id, userId));\n\n      return res.json({ message: \"Cuenta de Google desvinculada exitosamente\" });\n    } catch (error) {\n      console.error(\"Error desconectando Google:\", error);\n      return res.status(500).json({ message: \"Error al desvincular cuenta de Google\" });\n    }\n  });\n}\n", "import { db } from \"./db\";\nimport { llcApplications, orders, userNotifications, users } from \"@shared/schema\";\nimport { eq, and, lte, gte, isNotNull, sql } from \"drizzle-orm\";\n\nexport interface ComplianceDeadline {\n  type: \"irs_1120\" | \"irs_5472\" | \"annual_report\" | \"agent_renewal\";\n  dueDate: Date;\n  reminderDate: Date;\n  description: string;\n  state?: string;\n}\n\nexport function calculateComplianceDeadlines(formationDate: Date, state: string): ComplianceDeadline[] {\n  const deadlines: ComplianceDeadline[] = [];\n  const formationYear = formationDate.getFullYear();\n\n  const irs1120DueDate = new Date(formationYear + 1, 3, 15);\n  const irs1120ReminderDate = new Date(irs1120DueDate);\n  irs1120ReminderDate.setDate(irs1120ReminderDate.getDate() - 60);\n\n  deadlines.push({\n    type: \"irs_1120\",\n    dueDate: irs1120DueDate,\n    reminderDate: irs1120ReminderDate,\n    description: \"Presentaci\u00F3n del formulario IRS 1120 (Declaraci\u00F3n de impuestos corporativos)\",\n  });\n\n  const irs5472DueDate = new Date(formationYear + 1, 3, 15);\n  const irs5472ReminderDate = new Date(irs5472DueDate);\n  irs5472ReminderDate.setDate(irs5472ReminderDate.getDate() - 60);\n\n  deadlines.push({\n    type: \"irs_5472\",\n    dueDate: irs5472DueDate,\n    reminderDate: irs5472ReminderDate,\n    description: \"Presentaci\u00F3n del formulario IRS 5472 (Declaraci\u00F3n de transacciones con propietarios extranjeros)\",\n  });\n\n  if (state === \"wyoming\" || state === \"delaware\" || state === \"WY\" || state === \"DE\") {\n    const annualReportDueDate = new Date(formationDate);\n    annualReportDueDate.setFullYear(annualReportDueDate.getFullYear() + 1);\n    const annualReportReminderDate = new Date(annualReportDueDate);\n    annualReportReminderDate.setDate(annualReportReminderDate.getDate() - 60);\n\n    const stateLabel = (state === \"wyoming\" || state === \"WY\") ? \"Wyoming\" : \"Delaware\";\n    deadlines.push({\n      type: \"annual_report\",\n      dueDate: annualReportDueDate,\n      reminderDate: annualReportReminderDate,\n      description: `Informe Anual del estado de ${stateLabel}`,\n      state: stateLabel,\n    });\n  }\n\n  const agentRenewalDate = new Date(formationDate);\n  agentRenewalDate.setFullYear(agentRenewalDate.getFullYear() + 1);\n  const agentRenewalReminderDate = new Date(agentRenewalDate);\n  agentRenewalReminderDate.setDate(agentRenewalReminderDate.getDate() - 60);\n\n  deadlines.push({\n    type: \"agent_renewal\",\n    dueDate: agentRenewalDate,\n    reminderDate: agentRenewalReminderDate,\n    description: \"Renovaci\u00F3n del Agente Registrado\",\n  });\n\n  return deadlines;\n}\n\nexport async function updateApplicationDeadlines(applicationId: number, formationDate: Date, state: string) {\n  const deadlines = calculateComplianceDeadlines(formationDate, state);\n\n  const irs1120Deadline = deadlines.find(d => d.type === \"irs_1120\");\n  const irs5472Deadline = deadlines.find(d => d.type === \"irs_5472\");\n  const annualReportDeadline = deadlines.find(d => d.type === \"annual_report\");\n  const agentRenewalDeadline = deadlines.find(d => d.type === \"agent_renewal\");\n\n  await db.update(llcApplications).set({\n    llcCreatedDate: formationDate,\n    irs1120DueDate: irs1120Deadline?.dueDate,\n    irs5472DueDate: irs5472Deadline?.dueDate,\n    annualReportDueDate: annualReportDeadline?.dueDate,\n    agentRenewalDate: agentRenewalDeadline?.dueDate,\n    lastUpdated: new Date(),\n  }).where(eq(llcApplications.id, applicationId));\n\n  return deadlines;\n}\n\nexport async function checkAndSendReminders() {\n  const today = new Date();\n  const reminderWindowStart = new Date(today);\n  reminderWindowStart.setDate(reminderWindowStart.getDate() + 55);\n  const reminderWindowEnd = new Date(today);\n  reminderWindowEnd.setDate(reminderWindowEnd.getDate() + 65);\n\n  const applicationsWithIRS1120 = await db.select({\n    application: llcApplications,\n    order: orders,\n  })\n  .from(llcApplications)\n  .innerJoin(orders, eq(llcApplications.orderId, orders.id))\n  .where(\n    and(\n      isNotNull(llcApplications.irs1120DueDate),\n      gte(llcApplications.irs1120DueDate, reminderWindowStart),\n      lte(llcApplications.irs1120DueDate, reminderWindowEnd)\n    )\n  );\n\n  for (const { application, order } of applicationsWithIRS1120) {\n    const daysUntilDue = Math.ceil((application.irs1120DueDate!.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    await createComplianceNotification(\n      order.userId,\n      order.id,\n      application.requestCode || `LLC-${application.id}`,\n      \"irs_1120\",\n      `Recordatorio: Formulario IRS 1120 vence en ${daysUntilDue} d\u00EDas`,\n      `Tu declaraci\u00F3n de impuestos corporativos (Form 1120) para ${application.companyName} vence el ${formatDate(application.irs1120DueDate!)}. No olvides presentarlo a tiempo.`\n    );\n  }\n\n  const applicationsWithIRS5472 = await db.select({\n    application: llcApplications,\n    order: orders,\n  })\n  .from(llcApplications)\n  .innerJoin(orders, eq(llcApplications.orderId, orders.id))\n  .where(\n    and(\n      isNotNull(llcApplications.irs5472DueDate),\n      gte(llcApplications.irs5472DueDate, reminderWindowStart),\n      lte(llcApplications.irs5472DueDate, reminderWindowEnd)\n    )\n  );\n\n  for (const { application, order } of applicationsWithIRS5472) {\n    const daysUntilDue = Math.ceil((application.irs5472DueDate!.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    await createComplianceNotification(\n      order.userId,\n      order.id,\n      application.requestCode || `LLC-${application.id}`,\n      \"irs_5472\",\n      `Recordatorio: Formulario IRS 5472 vence en ${daysUntilDue} d\u00EDas`,\n      `Tu declaraci\u00F3n de transacciones (Form 5472) para ${application.companyName} vence el ${formatDate(application.irs5472DueDate!)}. Es obligatorio para propietarios extranjeros.`\n    );\n  }\n\n  const applicationsWithAnnualReport = await db.select({\n    application: llcApplications,\n    order: orders,\n  })\n  .from(llcApplications)\n  .innerJoin(orders, eq(llcApplications.orderId, orders.id))\n  .where(\n    and(\n      isNotNull(llcApplications.annualReportDueDate),\n      gte(llcApplications.annualReportDueDate, reminderWindowStart),\n      lte(llcApplications.annualReportDueDate, reminderWindowEnd)\n    )\n  );\n\n  for (const { application, order } of applicationsWithAnnualReport) {\n    const daysUntilDue = Math.ceil((application.annualReportDueDate!.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    const stateLabel = application.state === \"wyoming\" || application.state === \"WY\" ? \"Wyoming\" : \"Nuevo M\u00E9xico\";\n    await createComplianceNotification(\n      order.userId,\n      order.id,\n      application.requestCode || `LLC-${application.id}`,\n      \"annual_report\",\n      `Recordatorio: Informe Anual de ${stateLabel} vence en ${daysUntilDue} d\u00EDas`,\n      `El informe anual de tu empresa ${application.companyName} en ${stateLabel} vence el ${formatDate(application.annualReportDueDate!)}. Presentar tarde puede resultar en multas.`\n    );\n  }\n\n  const applicationsWithAgentRenewal = await db.select({\n    application: llcApplications,\n    order: orders,\n  })\n  .from(llcApplications)\n  .innerJoin(orders, eq(llcApplications.orderId, orders.id))\n  .where(\n    and(\n      isNotNull(llcApplications.agentRenewalDate),\n      gte(llcApplications.agentRenewalDate, reminderWindowStart),\n      lte(llcApplications.agentRenewalDate, reminderWindowEnd)\n    )\n  );\n\n  for (const { application, order } of applicationsWithAgentRenewal) {\n    const daysUntilDue = Math.ceil((application.agentRenewalDate!.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    await createComplianceNotification(\n      order.userId,\n      order.id,\n      application.requestCode || `LLC-${application.id}`,\n      \"agent_renewal\",\n      `Recordatorio: Renovaci\u00F3n de Agente Registrado en ${daysUntilDue} d\u00EDas`,\n      `La renovaci\u00F3n del agente registrado para ${application.companyName} vence el ${formatDate(application.agentRenewalDate!)}. Sin agente registrado activo, tu LLC puede perder su buen estado legal.`\n    );\n  }\n\n  return { checked: true, timestamp: today };\n}\n\nasync function createComplianceNotification(\n  userId: string,\n  orderId: number,\n  orderCode: string,\n  type: string,\n  title: string,\n  message: string\n) {\n  const ticketId = `COMP-${type.toUpperCase()}-${orderId}-${Date.now()}`;\n\n  const existing = await db.select().from(userNotifications).where(\n    and(\n      eq(userNotifications.userId, userId),\n      eq(userNotifications.orderId, orderId),\n      sql`${userNotifications.type} = ${'compliance_' + type}`,\n      sql`${userNotifications.createdAt} > NOW() - INTERVAL '30 days'`\n    )\n  ).limit(1);\n\n  if (existing.length > 0) {\n    return null;\n  }\n\n  await db.insert(userNotifications).values({\n    userId,\n    orderId,\n    orderCode,\n    ticketId,\n    type: `compliance_${type}`,\n    title,\n    message,\n    isRead: false,\n    actionUrl: `/dashboard/orders/${orderId}`,\n  });\n\n  return ticketId;\n}\n\nfunction formatDate(date: Date): string {\n  return date.toLocaleDateString(\"es-ES\", {\n    day: \"numeric\",\n    month: \"long\",\n    year: \"numeric\"\n  });\n}\n\nexport function getUpcomingDeadlinesForUser(applications: any[]): any[] {\n  const today = new Date();\n  const deadlines: any[] = [];\n\n  for (const app of applications) {\n    if (app.llcCreatedDate) {\n      const companyName = app.companyName || \"Tu LLC\";\n\n      if (app.irs1120DueDate) {\n        const daysUntil = Math.ceil((new Date(app.irs1120DueDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysUntil > 0 && daysUntil <= 365) {\n          deadlines.push({\n            type: \"irs_1120\",\n            title: \"IRS Form 1120\",\n            description: `Declaraci\u00F3n de impuestos para ${companyName}`,\n            dueDate: app.irs1120DueDate,\n            daysUntil,\n            urgency: daysUntil <= 30 ? \"urgent\" : daysUntil <= 60 ? \"warning\" : \"normal\",\n            applicationId: app.id,\n          });\n        }\n      }\n\n      if (app.irs5472DueDate) {\n        const daysUntil = Math.ceil((new Date(app.irs5472DueDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysUntil > 0 && daysUntil <= 365) {\n          deadlines.push({\n            type: \"irs_5472\",\n            title: \"IRS Form 5472\",\n            description: `Declaraci\u00F3n de transacciones para ${companyName}`,\n            dueDate: app.irs5472DueDate,\n            daysUntil,\n            urgency: daysUntil <= 30 ? \"urgent\" : daysUntil <= 60 ? \"warning\" : \"normal\",\n            applicationId: app.id,\n          });\n        }\n      }\n\n      if (app.annualReportDueDate) {\n        const daysUntil = Math.ceil((new Date(app.annualReportDueDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysUntil > 0 && daysUntil <= 365) {\n          const stateLabel = app.state === \"wyoming\" || app.state === \"WY\" ? \"Wyoming\" : \"Nuevo M\u00E9xico\";\n          deadlines.push({\n            type: \"annual_report\",\n            title: `Informe Anual (${stateLabel})`,\n            description: `Informe anual del estado para ${companyName}`,\n            dueDate: app.annualReportDueDate,\n            daysUntil,\n            urgency: daysUntil <= 30 ? \"urgent\" : daysUntil <= 60 ? \"warning\" : \"normal\",\n            applicationId: app.id,\n            state: stateLabel,\n          });\n        }\n      }\n\n      if (app.agentRenewalDate) {\n        const daysUntil = Math.ceil((new Date(app.agentRenewalDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysUntil > 0 && daysUntil <= 365) {\n          deadlines.push({\n            type: \"agent_renewal\",\n            title: \"Renovaci\u00F3n Agente Registrado\",\n            description: `Renovaci\u00F3n anual del agente para ${companyName}`,\n            dueDate: app.agentRenewalDate,\n            daysUntil,\n            urgency: daysUntil <= 30 ? \"urgent\" : daysUntil <= 60 ? \"warning\" : \"normal\",\n            applicationId: app.id,\n          });\n        }\n      }\n    }\n  }\n\n  return deadlines.sort((a, b) => a.daysUntil - b.daysUntil);\n}\n", "import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath, {\n    maxAge: '1y',\n    immutable: true,\n    index: false,\n    etag: true,\n    lastModified: true\n  }));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"), {\n      headers: {\n        'Cache-Control': 'no-cache, no-store, must-revalidate'\n      }\n    });\n  });\n}\n"],
  "mappings": "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",
  "names": ["import_pg_core", "import_drizzle_orm", "pg", "nodemailer", "bcrypt", "crypto", "getEmailHeader", "getEmailFooter", "getOtpEmailTemplate", "import_drizzle_orm", "text", "crypto", "import_crypto", "generateUniqueClientId", "timestamp", "import_drizzle_orm", "import_path", "react", "path", "import_crypto", "pool", "crypto", "app", "createViteServer", "path", "rootDir", "fs", "import_vite", "import_fs", "import_path", "import_express", "import_drizzle_orm", "import_drizzle_orm", "connectPg", "session", "app", "express", "import_drizzle_orm", "app", "encrypt", "import_zod", "import_drizzle_orm", "path", "fs", "PDFDocument", "import_drizzle_orm", "import_crypto", "generateClientId", "app", "crypto", "import_drizzle_orm", "app", "httpServer", "app", "logActivity", "orderCode", "users", "bcrypt", "timestamp", "products", "generateUniqueTicketId", "verifyPassword", "hashPassword", "encrypt", "orders", "generateUniqueClientId", "generateUniqueOrderCode", "fs", "path", "generateUniqueMessageId", "import_express", "import_fs", "import_path", "app", "path", "fs", "express", "import_path", "express", "path", "compression", "setupVite"]
}
