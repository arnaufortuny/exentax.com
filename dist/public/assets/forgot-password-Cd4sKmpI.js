import{a as c,j as e,o as V,k as g,Z as q,E as A,m as B}from"./react-core-CoXVuRuN.js";import{a as w,t as N}from"./forms-CBid_O5E.js";import{N as y,L as k,F as C,b}from"./index-D0uNKl9J.js";import{u as G,B as p,F as S,G as z,H,J as o}from"./ui-components-elp02Hq4.js";import{F as j}from"./form-input-20r0t_Sa.js";import{o as E,s as v}from"./validation-D376FIhw.js";import"./react-dom-RP0EX8KY.js";import"./i18n-DoDnFGHd.js";import"./tanstack-DmlugzsV.js";import"./radix-ui-B9Yx-JBw.js";const J=E({email:v().email("Email inválido")}),M=E({password:v().min(8,"La contraseña debe tener al menos 8 caracteres"),confirmPassword:v()}).refine(s=>s.password===s.confirmPassword,{message:"Las contraseñas no coinciden",path:["confirmPassword"]});function ee(){const[s,i]=c.useState(!1),[r,l]=c.useState("email"),[h,P]=c.useState(""),[d,O]=c.useState(""),[m,T]=c.useState(!1),{toast:t}=G(),f=w({resolver:N(J),defaultValues:{email:""}}),x=w({resolver:N(M),defaultValues:{password:"",confirmPassword:""}}),F=async n=>{i(!0);try{const a=await b("POST","/api/password-reset/send-otp",n);if(a.ok)P(n.email),l("otp"),t({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación"});else{const u=await a.json();t({title:"Error",description:u.message||"No se pudo enviar el código",variant:"destructive"})}}catch{t({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{i(!1)}},L=async()=>{if(d.length!==6){t({title:"Error",description:"Ingresa el código de 6 dígitos",variant:"destructive"});return}l("password")},R=async n=>{i(!0);try{const a=await b("POST","/api/password-reset/confirm",{email:h,otp:d,newPassword:n.password}),u=await a.json();a.ok&&u.success?l("success"):t({title:"Error",description:u.message||"Código inválido o expirado",variant:"destructive"})}catch(a){t({title:"Error",description:a.message||"No se pudo restablecer la contraseña",variant:"destructive"})}finally{i(!1)}},I=async()=>{i(!0);try{(await b("POST","/api/password-reset/send-otp",{email:h})).ok?t({title:"Código reenviado",description:"Revisa tu email"}):t({title:"Error",description:"No se pudo reenviar el código",variant:"destructive"})}catch{t({title:"Error",description:"No se pudo reenviar el código",variant:"destructive"})}finally{i(!1)}};return r==="success"?e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(y,{}),e.jsx("main",{className:"pt-24 pb-16 px-5 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(V,{className:"w-8 h-8 text-primary"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-black text-primary tracking-tight mb-4",children:["Contraseña ",e.jsx("span",{className:"text-accent",children:"Actualizada"})]}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Tu contraseña ha sido restablecida correctamente."}),e.jsx(k,{href:"/auth/login",children:e.jsx(p,{className:"rounded-full px-8 font-black bg-accent text-primary","data-testid":"button-go-to-login",children:"Iniciar Sesión"})})]})}),e.jsx(C,{})]}):e.jsxs("div",{className:"min-h-screen bg-background bg-green-gradient-subtle font-sans",children:[e.jsx(y,{}),e.jsx("main",{className:"pt-20 md:pt-24 pb-12 md:pb-16 px-4 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-sm md:max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 mx-auto",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-black text-primary tracking-tight text-center",children:["Recuperar ",e.jsx("span",{className:"text-accent",children:"Contraseña"})]}),e.jsxs("p",{className:"text-muted-foreground mt-3 text-sm md:text-base text-center max-w-xs mx-auto",children:[r==="email"&&"Te enviaremos un código para restablecer el acceso a tu cuenta",r==="otp"&&"Ingresa el código de 6 dígitos que enviamos a tu email",r==="password"&&"Crea una nueva contraseña segura para tu cuenta"]})]}),r==="email"&&e.jsx(S,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(F),className:"space-y-6",children:[e.jsx(j,{control:f.control,name:"email",label:"Email",type:"email",inputMode:"email"}),e.jsx(p,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-send-otp",children:s?e.jsx(g,{className:"animate-spin w-4 h-4"}):"Enviar Código"})]})}),r==="otp"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Código enviado a: ",e.jsx("strong",{children:h})]}),e.jsx(z,{maxLength:6,value:d,onChange:O,"data-testid":"input-otp",children:e.jsxs(H,{children:[e.jsx(o,{index:0}),e.jsx(o,{index:1}),e.jsx(o,{index:2}),e.jsx(o,{index:3}),e.jsx(o,{index:4}),e.jsx(o,{index:5})]})})]}),e.jsx(p,{onClick:L,disabled:s||d.length!==6,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-verify-otp",children:s?e.jsx(g,{className:"animate-spin w-4 h-4"}):"Verificar"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:I,disabled:s,className:"text-sm text-muted-foreground hover:text-primary transition-colors","data-testid":"button-resend-otp",children:"¿No recibiste el código? Reenviar"})}),e.jsxs("button",{type:"button",onClick:()=>l("email"),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors mx-auto",children:[e.jsx(q,{className:"w-4 h-4"})," Cambiar email"]})]}),r==="password"&&e.jsx(S,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(j,{control:x.control,name:"password",label:"Nueva Contraseña",type:m?"text":"password"}),e.jsx("button",{type:"button",onClick:()=>T(!m),className:"absolute right-4 top-[42px] text-muted-foreground hover:text-primary transition-colors",children:m?e.jsx(A,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})})]}),e.jsx(j,{control:x.control,name:"confirmPassword",label:"Confirmar Contraseña",type:m?"text":"password"}),e.jsx(p,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-reset-password",children:s?e.jsx(g,{className:"animate-spin w-4 h-4"}):"Restablecer"})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(k,{href:"/auth/login",children:e.jsx("span",{className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Volver al Login"})})})]})}),e.jsx(C,{})]})}export{ee as default};
