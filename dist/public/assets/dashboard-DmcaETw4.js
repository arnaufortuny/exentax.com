import{a as n,j as e,P as Ea,B as pt,y as Pa,F as Aa,z as ht,A as he,U as Qt,H as _t,I as gt,J as bt,K as Ta,N as ge,w as Bt,T as ft,O as jt,Q as Gt,V as Ht,W as Nt,Y as Ia,Z as vt,_ as yt,$ as La,a0 as Wt,a1 as Yt,a2 as Jt,a3 as Fa,t as _,a4 as Zt,a5 as Xt}from"./react-vendor-DySzTZYh.js";import{u as es,N as kt,a as p,F as wt,q as h}from"./index-CIBZtyMu.js";import{b as j,a as M}from"./tanstack-Be0kG5UR.js";import{u as zt,C as o,a as be,B as s,r as Ct,s as St,t as L,l as B,v as r,I as c,m as S,n as D,o as z,p as E,q as l,D as P,w as A,x as T,y as I,z as R,A as F,E as Et}from"./ui-components-tQHy3as0.js";import{u as as,m as Re}from"./vendor-CfPiAaHv.js";import{S as ts}from"./social-login-BPOUuDnx.js";import"./i18n-BSAMEAt_.js";import"./radix-ui-CBW9IaP7.js";import"./forms-BCWHroEx.js";function Dt(G){return{pending:{label:"Pendiente",className:"bg-yellow-100 text-yellow-800"},paid:{label:"Pagado",className:"bg-blue-100 text-blue-800"},processing:{label:"En Proceso",className:"bg-purple-100 text-purple-800"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 text-cyan-800"},completed:{label:"Completado",className:"bg-green-100 text-green-800"},cancelled:{label:"Cancelado",className:"bg-red-100 text-red-700 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 text-indigo-800"},draft:{label:"Borrador",className:"bg-gray-100 text-gray-600"}}[G]||{label:G,className:"bg-gray-100 text-gray-600"}}function ss(){const{toast:G}=zt(),{data:d,isLoading:$}=M({queryKey:["/api/newsletter/status"]}),W=j({mutationFn:async k=>{await p("POST",k?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",k?{email:void 0}:void 0)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/newsletter/status"]}),G({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return $?e.jsx("div",{className:"w-10 h-6 bg-gray-100 animate-pulse rounded-full"}):e.jsx(Et,{checked:d?.isSubscribed,onCheckedChange:k=>W.mutate(k),disabled:W.isPending})}function ws(){const[,G]=as(),{user:d,isAuthenticated:$,isLoading:W}=es(),[k,Ve]=n.useState("services"),[v,Ke]=n.useState(!1),[u,w]=n.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:i}=zt(),b=d?.accountStatus==="active"||d?.accountStatus==="vip",[m,N]=n.useState(null),[rs,ds]=n.useState({open:!1,user:null}),[ns,is]=n.useState(""),[ls,cs]=n.useState(""),[os,ms]=n.useState(""),[ne,fe]=n.useState({open:!1,user:null}),[je,Oa]=n.useState(""),[Ma,qa]=n.useState(""),[Ne,ve]=n.useState({open:!1,user:null}),[Qe,$a]=n.useState(""),[_e,Ua]=n.useState(""),[Pt,xs]=n.useState("info"),[Y,ye]=n.useState({open:!1,user:null}),[Be,Ra]=n.useState(""),[Ge,Va]=n.useState(""),[Ka,Qa]=n.useState("EUR"),[V,At]=n.useState("dashboard"),[Tt,ke]=n.useState(!1),[K,J]=n.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[It,we]=n.useState(!1),[Z,Ce]=n.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[X,Se]=n.useState({open:!1,user:null}),[Lt,He]=n.useState(!1),[ee,De]=n.useState({open:!1,file:null}),[ie,_a]=n.useState("passport"),[ze,Ba]=n.useState(""),[Ga,We]=n.useState(!1),[Ha,Ye]=n.useState("form"),[Je,Ze]=n.useState(""),[H,Xe]=n.useState(""),[Ee,ea]=n.useState(""),[aa,ta]=n.useState(""),[Q,le]=n.useState({open:!1,code:null}),[ae,Pe]=n.useState({open:!1,user:null}),[Ae,sa]=n.useState(""),[ce,ra]=n.useState(""),[Wa,da]=n.useState(""),[Ya,Ja]=n.useState(!1),[Ft,na]=n.useState(!1),[oe,ia]=n.useState(""),[Za,Xa]=n.useState(!1),[et,at]=n.useState(!1),[g,q]=n.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});n.useEffect(()=>{d&&w({firstName:d.firstName||"",lastName:d.lastName||"",phone:d.phone||"",businessActivity:d.businessActivity||"",address:d.address||"",streetType:d.streetType||"",city:d.city||"",province:d.province||"",postalCode:d.postalCode||"",country:d.country||"",idNumber:d.idNumber||"",idType:d.idType||"",birthDate:d.birthDate||""})},[d]);const tt=j({mutationFn:async a=>{if(!b)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");await p("PATCH","/api/user/profile",a)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/auth/user"]}),Ke(!1),i({title:"Cambios guardados",description:"Tu información se ha actualizado correctamente"})},onError:a=>{i({title:"Error",description:a.message,variant:"destructive"})}});n.useEffect(()=>{!W&&!$&&G("/auth/login")},[$,W,G]);const{data:O,isLoading:us}=M({queryKey:["/api/orders"],enabled:$,refetchInterval:3e4,staleTime:1e4}),{data:la,isLoading:ps}=M({queryKey:["/api/messages"],enabled:$,refetchInterval:6e4,staleTime:3e4}),[Te,ca]=n.useState(null),[me,oa]=n.useState(""),st=O?.[0]?.id,{data:Ie}=M({queryKey:["/api/orders",st,"events"],enabled:!!st,refetchInterval:3e4,staleTime:1e4}),xe=j({mutationFn:async a=>{await p("POST",`/api/messages/${a}/reply`,{content:me})},onSuccess:()=>{oa(""),ca(null),h.invalidateQueries({queryKey:["/api/messages"]}),h.invalidateQueries({queryKey:["/api/admin/messages"]}),i({title:d?.isAdmin?"Respuesta enviada":"Mensaje enviado",description:d?.isAdmin?"El cliente recibirá un email con la información":"Te responderemos personalmente lo antes posible"})}}),{data:ma,isLoading:Ot}=M({queryKey:["/api/user/notifications"],enabled:$,refetchInterval:6e4,staleTime:3e4}),Mt=j({mutationFn:async a=>{await p("PATCH",`/api/user/notifications/${a}/read`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/notifications"]})}}),{data:Le}=M({queryKey:["/api/admin/orders"],enabled:!!d?.isAdmin,refetchInterval:3e4}),{data:rt}=M({queryKey:["/api/admin/users"],enabled:!!d?.isAdmin,refetchInterval:6e4}),{data:ue}=M({queryKey:["/api/admin/newsletter"],enabled:!!d?.isAdmin}),{data:y}=M({queryKey:["/api/admin/system-stats"],enabled:!!d?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:xa}=M({queryKey:["/api/admin/messages"],enabled:!!d?.isAdmin}),{data:ua,refetch:dt}=M({queryKey:["/api/admin/discount-codes"],enabled:!!d?.isAdmin}),[pa,nt]=n.useState(""),[ha,it]=n.useState(""),ga=j({mutationFn:async({subject:a,message:t})=>{await p("POST","/api/admin/newsletter/broadcast",{subject:a,message:t})},onSuccess:()=>{i({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),nt(""),it("")},onError:()=>{i({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}}),{data:qt}=M({queryKey:["/api/user/documents"],enabled:$});j({mutationFn:async a=>(await p("POST","/api/admin/documents",a)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})}});const $t=j({mutationFn:async({id:a,status:t})=>(await p("PATCH",`/api/admin/orders/${a}/status`,{status:t})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),i({title:"Estado actualizado"})}}),pe=j({mutationFn:async({appId:a,field:t,value:x})=>{await p("PATCH",`/api/admin/llc/${a}/dates`,{field:t,value:x})},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),h.invalidateQueries({queryKey:["/api/orders"]}),i({title:"Fecha actualizada"})},onError:()=>{i({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),te=j({mutationFn:async({userId:a,title:t,message:x,type:f})=>{await p("POST","/api/admin/send-note",{userId:a,title:t,message:x,type:f})},onSuccess:()=>{i({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),ve({open:!1,user:null}),$a(""),Ua("")}}),Fe=j({mutationFn:async a=>{const{id:t,...x}=a;await p("PATCH",`/api/admin/users/${t}`,x)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario actualizado"}),N(null)},onError:a=>{i({title:"Error",description:a.message,variant:"destructive"})}}),ba=j({mutationFn:async a=>{await p("DELETE",`/api/admin/users/${a}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario eliminado"}),Se({open:!1,user:null})},onError:()=>{i({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[U,Oe]=n.useState({open:!1,order:null}),[se,Me]=n.useState({open:!1,order:null}),[re,lt]=n.useState(""),[fa,ct]=n.useState("EUR"),ja=j({mutationFn:async a=>{await p("DELETE",`/api/admin/orders/${a}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:["/api/notifications"]}),h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),Oe({open:!1,order:null})},onError:()=>{i({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),Na=j({mutationFn:async({userId:a,concept:t,amount:x,currency:f})=>{await p("POST","/api/admin/invoices/create",{userId:a,concept:t,amount:x,currency:f})},onSuccess:()=>{i({title:"Factura creada",description:"La factura se ha añadido al centro de documentos del cliente"}),ye({open:!1,user:null}),Ra(""),Va(""),Qa("EUR")},onError:()=>{i({title:"Error",description:"No se pudo crear la factura",variant:"destructive"})}}),va=j({mutationFn:async a=>(await p("POST","/api/admin/users/create",a)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),ke(!1),J({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{i({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),ya=j({mutationFn:async a=>(await p("POST","/api/admin/orders/create",a)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),i({title:"Pedido creado",description:"El pedido ha sido registrado correctamente"}),we(!1),Ce({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:()=>{i({title:"Error",description:"No se pudo crear el pedido",variant:"destructive"})}}),ot=j({mutationFn:async a=>{await p("DELETE",`/api/user/documents/${a}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Documento eliminado"})},onError:a=>{i({title:"Error",description:a?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),ka=j({mutationFn:async()=>{await p("DELETE","/api/user/account")},onSuccess:()=>{i({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{i({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),wa=j({mutationFn:async()=>{await p("POST","/api/user/request-password-otp")},onSuccess:()=>{i({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),Ye("otp")},onError:a=>{i({title:"Error",description:a.message||"No se pudo enviar el código",variant:"destructive"})}}),Ca=j({mutationFn:async a=>{await p("POST","/api/user/change-password",a)},onSuccess:()=>{i({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),We(!1),Ye("form"),Ze(""),Xe(""),ea(""),ta("")},onError:a=>{i({title:"Error",description:a.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(W||!$)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(d?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(kt,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(o,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(be,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-50 dark:bg-red-950/30 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-black text-red-500",children:"!"})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 p-3 rounded-xl",children:"No puedes realizar acciones ni contactar hasta que se resuelva tu situación."}),e.jsx(s,{variant:"outline",className:"w-full font-black text-foreground h-12 rounded-full border-2",onClick:()=>p("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:"Cerrar Sesión"})]})]})]})})}),e.jsx(wt,{})]});const Ut=[{id:"services",label:"Mis Servicios",icon:Ea,mobileLabel:"Servicios"},{id:"notifications",label:"Seguimiento",icon:pt,mobileLabel:"Seguim."},{id:"messages",label:"¿Necesitas ayuda?",icon:Pa,mobileLabel:"Ayuda"},{id:"documents",label:"Documentos",icon:Aa,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:ht,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:he,mobileLabel:"Fechas"},{id:"profile",label:"Mi Perfil",icon:Qt,mobileLabel:"Perfil"},...d?.isAdmin?[{id:"admin",label:"Admin",icon:_t,mobileLabel:"Admin"}]:[]];return e.jsxs("div",{className:"min-h-screen bg-muted font-sans",children:[e.jsx(kt,{}),e.jsxs("main",{className:"pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-6 md:mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-black tracking-widest text-[10px] md:text-xs mb-1 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-2xl md:text-4xl font-black text-primary tracking-tighter leading-tight",children:["Bienvenido, ",d?.firstName||"Cliente"]}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Tu espacio privado de gestión"})]}),e.jsx(Re,{href:"/servicios#pricing",children:e.jsxs(s,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-black font-bold rounded-full px-8 h-12 transition-all flex items-center justify-center gap-2",children:[e.jsx(gt,{className:"w-5 h-5"})," Nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-1.5 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-2 md:pb-4 md:mb-8",children:Ut.map(a=>e.jsxs(s,{variant:k===a.id?"default":"outline",onClick:()=>Ve(a.id),size:"sm",className:`flex items-center gap-1.5 md:gap-2 rounded-full font-bold text-[11px] md:text-xs tracking-tight whitespace-nowrap shrink-0 ${k===a.id?"bg-accent text-primary shadow-lg shadow-accent/20":"bg-white dark:bg-zinc-900 text-muted-foreground border-0"}`,"data-testid":`button-tab-${a.id}`,children:[e.jsx(a.icon,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:a.label}),e.jsx("span",{className:"sm:hidden",children:a.mobileLabel})]},a.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[k==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Mis Servicios"}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground font-medium",children:"Gestiona tus trámites activos"})]}),!O||O.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(Ea,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-primary mb-2",children:"Ningún servicio activo"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"¡Crea tu LLC hoy mismo! Conoce nuestros packs."})]}),e.jsx(Re,{href:"/servicios#pricing",children:e.jsx(s,{className:"bg-accent text-primary font-black rounded-full px-8 py-3","data-testid":"button-view-packs",children:"Ver Packs"})})]})}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:gap-4",children:O.map(a=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden",children:[e.jsx(Ct,{className:"bg-primary/5 pb-3 md:pb-4 p-3 md:p-6",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] md:text-[10px] font-black text-accent uppercase tracking-widest mb-1",children:["Pedido: ",a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber||a.id]}),e.jsx(St,{className:"text-base md:text-lg font-black text-primary truncate",children:a.maintenanceApplication?`Mantenimiento ${a.maintenanceApplication.state||a.product?.name?.replace(" LLC","")||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"LLC pendiente"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5",children:a.application?.state||a.maintenanceApplication?.state||""})]}),e.jsx(L,{className:`${Dt(a.status).className} font-black uppercase text-[9px] md:text-[10px] shrink-0`,"data-testid":`badge-order-status-${a.id}`,children:Dt(a.status).label})]})}),e.jsxs(be,{className:"pt-4 md:pt-6 p-3 md:p-6",children:[e.jsxs("div",{className:"relative pl-5 md:pl-6 space-y-3 md:space-y-4 before:absolute before:left-1.5 md:before:left-2 before:top-2 before:bottom-2 before:w-0.5 before:bg-gray-100",children:[a.events?.slice(0,3).map((t,x)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-[1.1rem] md:-left-[1.35rem] top-1 md:top-1.5 w-2.5 h-2.5 md:w-3 md:h-3 rounded-full border-2 border-white ${x===0?"bg-accent animate-pulse":"bg-gray-300"}`}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("p",{className:`text-[11px] md:text-xs font-bold ${x===0?"text-primary":"text-muted-foreground"}`,children:t.eventType}),e.jsx("span",{className:"text-[9px] text-muted-foreground shrink-0",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground line-clamp-1",children:t.description})]},x)),!a.events?.length&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[1.35rem] top-1.5 w-3 h-3 rounded-full border-2 border-white bg-accent animate-pulse"}),e.jsx("p",{className:"text-xs font-black text-primary",children:"Pedido Recibido"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.application?.status==="submitted"||a.maintenanceApplication?.status==="submitted"?"Formulario completado.":a.application?.status==="pending"||a.maintenanceApplication?.status==="pending"?"Falta información del formulario.":a.status==="completed"||a.status==="filed"?"Proceso completado.":"Estamos procesando tu solicitud."})]})]}),a.status==="pending"&&a.application&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100 dark:border-zinc-700 flex gap-2",children:e.jsx(s,{variant:"outline",size:"sm",className:"flex-1 text-[10px] h-8 rounded-full font-black",onClick:()=>window.location.href=`/llc/formation?edit=${a.application.id}`,"data-testid":`button-modify-order-${a.id}`,children:"Modificar datos"})})]})]},a.id))})]},"services"),k==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Notificaciones"}),Ot?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},a))}):ma?.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(be,{className:"p-8 text-center",children:[e.jsx(pt,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes notificaciones"})]})}):e.jsx("div",{className:"space-y-3",children:ma?.map(a=>e.jsx(o,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${a.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(be,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[a.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",a.orderCode]}),a.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),a.type==="update"&&e.jsx("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),a.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-700 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),a.type==="action_required"&&b&&e.jsxs(s,{className:"mt-3 bg-accent text-primary font-black rounded-full text-xs px-4 gap-2",onClick:()=>{Mt.mutate(a.id),Ve("documents")},"data-testid":`button-upload-document-${a.id}`,children:[e.jsx(bt,{className:"w-3 h-3"}),"Subir Documento"]})]}),!a.isRead&&e.jsx("div",{className:"w-2 h-2 bg-accent rounded-full flex-shrink-0 mt-2"})]})})},a.id))})]},"notifications"),k==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Mis Consultas y Soporte"}),e.jsx(Re,{href:"/contacto",children:e.jsx(s,{className:"bg-accent text-primary font-black rounded-full text-xs",children:"Nueva Consulta"})})]}),e.jsx("div",{className:"space-y-4",children:!la||la.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(Ta,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no hay mensajes"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus conversaciones con soporte aparecerán aquí"})]}):la.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ca(Te?.id===a.id?null:a),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-black text-primary",children:a.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.messageId||a.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:a.content}),Te?.id===a.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",children:[e.jsx(B,{value:me,onChange:t=>oa(t.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm"}),e.jsx(s,{onClick:t=>{t.stopPropagation(),xe.mutate(a.id)},disabled:!me.trim()||xe.isPending,className:"bg-accent text-primary font-black rounded-full px-6",children:"Enviar Respuesta"})]})]},a.id))})]},"messages"),k==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight mb-6",children:"Centro de Documentación"}),ma?.some(a=>a.type==="action_required"&&!a.isRead)&&e.jsx(o,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-sm",children:"Documentos Solicitados"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Tienes solicitudes de documentos pendientes. Por favor, sube los documentos requeridos."}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async a=>{const t=a.target.files?.[0];if(!t)return;const x=new FormData;x.append("file",t);try{(await fetch("/api/user/documents/upload",{method:"POST",body:x,credentials:"include"})).ok?(i({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),h.invalidateQueries({queryKey:["/api/user/documents"]})):i({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{i({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(s,{variant:"outline",className:"rounded-full text-xs border-orange-300 text-orange-700",asChild:!0,children:e.jsxs("span",{children:[e.jsx(ge,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(o,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{const t=a.target.files?.[0];t&&(De({open:!0,file:t}),_a("passport"),Ba(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(bt,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-primary text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(s,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(ge,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"SUBIR"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:qt?.map(a=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(ge,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:a.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(a.createdAt||a.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`button-download-doc-${a.id}`,children:[e.jsx(Bt,{className:"w-3 h-3 mr-1"})," Descargar"]}),b&&e.jsx(s,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>ot.mutate(a.id),disabled:ot.isPending,"data-testid":`button-delete-doc-${a.id}`,children:e.jsx(ft,{className:"w-3 h-3"})})]})]},a.id))})]},"documents"),k==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Historial de Pagos"}),e.jsx("div",{className:"space-y-4",children:!O||O.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(ht,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no has contratado ningún servicio"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus facturas y recibos aparecerán aquí"})]}):O.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/receipt`,"_blank"),children:"Recibo"})]})]},a.id))})]},"payments"),k==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),O&&O.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:O.map(a=>{const t=a.application;if(!t)return null;const x=a.status==="cancelled",f=["pending","paid","processing"].includes(a.status),mt=["Wyoming","Delaware","WY","DE"].includes(t.state),qe=[{label:"Creación",fullLabel:"Creación de LLC",date:t.llcCreatedDate,icon:jt,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:t.agentRenewalDate,icon:Gt,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:t.irs1120DueDate,icon:Aa,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:t.irs5472DueDate,icon:Aa,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...mt?[{label:"Anual",fullLabel:`Reporte Anual ${t.state}`,date:t.annualReportDueDate,icon:Ht,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],Sa=qe.some(C=>C.date),xt=qe.filter(C=>C.date).sort((C,Da)=>new Date(C.date).getTime()-new Date(Da.date).getTime()),$e=xt.find(C=>new Date(C.date)>new Date);return e.jsxs(o,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${x?"opacity-50":""}`,children:[e.jsx(Ct,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(St,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(jt,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:t.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:t.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[x&&e.jsx(L,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),f&&e.jsx(L,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!x&&!f&&$e&&e.jsxs(L,{className:`text-[9px] md:text-[10px] ${$e.bgColor} ${$e.textColor}`,children:["Próximo: ",$e.label]})]})]})}),e.jsx(be,{className:"p-3 md:p-4",children:x?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Nt,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):f?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ia,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):Sa?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:xt.map((C,Da)=>{const Ue=new Date(C.date),ut=new Date,de=Math.ceil((Ue.getTime()-ut.getTime())/(1e3*60*60*24)),za=Ue<ut,Rt=!za&&de<=30,Vt=!za&&de<=60&&de>30,Kt=C.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${C.borderColor} ${C.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${C.textColor}`,children:[e.jsx(Kt,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:C.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Ue.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Ue.getFullYear()}),za?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):Rt?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(yt,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[de," días"]})]}):Vt?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ia,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[de," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[de," días"]})})]},Da)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(he,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},a.id)})}):e.jsxs(o,{className:"rounded-xl md:rounded-2xl border shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(he,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-3 md:mb-4"}),e.jsx("h3",{className:"text-base md:text-lg font-black text-primary mb-2",children:"Sin fechas programadas"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4",children:"Contrata tu primera LLC para ver las fechas importantes"}),e.jsx(Re,{href:"/servicios#pricing",children:e.jsxs(s,{className:"bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"})," Comenzar"]})})]})]},"calendar"),k==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-black",children:"Perfil Personal"}),b&&e.jsx(s,{variant:"ghost",size:"sm",onClick:()=>Ke(!v),"data-testid":"button-toggle-edit",children:v?"Cancelar":"Editar"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario."}),!b&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${d?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:d?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:d?.clientId||d?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${d?.accountStatus==="active"?"text-green-600":d?.accountStatus==="pending"?"text-orange-500":d?.accountStatus==="deactivated"?"text-red-600":d?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:d?.accountStatus==="active"?"Verificado":d?.accountStatus==="pending"?"En revisión":d?.accountStatus==="deactivated"?"Desactivada":d?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Nombre"}),v&&b?e.jsx(c,{value:u.firstName,onChange:a=>w({...u,firstName:a.target.value}),placeholder:"Tu nombre real",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Apellidos"}),v&&b?e.jsx(c,{value:u.lastName,onChange:a=>w({...u,lastName:a.target.value}),placeholder:"Tal y como aparecen en tu documento",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:d?.email}),d?.emailVerified?e.jsx(La,{className:"w-4 h-4 text-green-500"}):e.jsx(s,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>na(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!d?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Teléfono"}),v&&b?e.jsx(c,{value:u.phone,onChange:a=>w({...u,phone:a.target.value}),placeholder:"Para contactarte si es necesario",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de documento"}),v&&b?e.jsxs(S,{value:u.idType,onValueChange:a=>w({...u,idType:a}),children:[e.jsx(D,{className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-idtype",children:e.jsx(z,{placeholder:"DNI · NIE · Pasaporte"})}),e.jsxs(E,{children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.idType==="dni"?"DNI":d?.idType==="nie"?"NIE":d?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Número de documento"}),v&&b?e.jsx(c,{value:u.idNumber,onChange:a=>w({...u,idNumber:a.target.value}),placeholder:"Documento de identificación",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Fecha de nacimiento"}),v&&b?e.jsx(c,{type:"date",value:u.birthDate,onChange:a=>w({...u,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Actividad profesional"}),v&&b?e.jsxs(S,{value:u.businessActivity,onValueChange:a=>w({...u,businessActivity:a}),children:[e.jsx(D,{className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-activity",children:e.jsx(z,{placeholder:"A qué te dedicas"})}),e.jsxs(E,{children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección de residencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de vía"}),v&&b?e.jsxs(S,{value:u.streetType,onValueChange:a=>w({...u,streetType:a}),children:[e.jsx(D,{className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(z,{placeholder:"Calle · Avenida · Paseo · Plaza"})}),e.jsxs(E,{children:[e.jsx(l,{value:"calle",children:"Calle"}),e.jsx(l,{value:"avenida",children:"Avenida"}),e.jsx(l,{value:"paseo",children:"Paseo"}),e.jsx(l,{value:"plaza",children:"Plaza"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Dirección"}),v&&b?e.jsx(c,{value:u.address,onChange:a=>w({...u,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Ciudad"}),v&&b?e.jsx(c,{value:u.city,onChange:a=>w({...u,city:a.target.value}),placeholder:"Ciudad de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Provincia"}),v&&b?e.jsx(c,{value:u.province,onChange:a=>w({...u,province:a.target.value}),placeholder:"Provincia o región",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"C.P."}),v&&b?e.jsx(c,{value:u.postalCode,onChange:a=>w({...u,postalCode:a.target.value}),placeholder:"Código postal",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"País"}),v&&b?e.jsx(c,{value:u.country,onChange:a=>w({...u,country:a.target.value}),placeholder:"País de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:d?.country||"-"})]})]})]}),v&&b&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(s,{onClick:()=>{tt.mutate(u),Ke(!1)},className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",disabled:tt.isPending,"data-testid":"button-save-profile",children:"Guardar cambios"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto."})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(ss,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!Ga&&e.jsx(s,{variant:"outline",className:"rounded-full",onClick:()=>We(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),Ga&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-xl",children:[Ha==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Contraseña actual"}),e.jsx(c,{type:"password",value:Je,onChange:a=>Ze(a.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(c,{type:"password",value:H,onChange:a=>Xe(a.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(c,{type:"password",value:Ee,onChange:a=>ea(a.target.value),"data-testid":"input-confirm-password"})]}),H&&Ee&&H!==Ee&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(s,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{We(!1),Ze(""),Xe(""),ea("")},children:"Cancelar"}),e.jsx(s,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>wa.mutate(),disabled:!Je||!H||H!==Ee||H.length<8||wa.isPending,"data-testid":"button-request-otp",children:wa.isPending?"Enviando...":"Enviar código"})]})]}),Ha==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(Pa,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Código de verificación"}),e.jsx(c,{type:"text",value:aa,onChange:a=>ta(a.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(s,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{Ye("form"),ta("")},children:"Volver"}),e.jsx(s,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Ca.mutate({currentPassword:Je,newPassword:H,otp:aa}),disabled:aa.length!==6||Ca.isPending,"data-testid":"button-save-password",children:Ca.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(ts,{mode:"connect",googleConnected:!!d?.googleId,onSuccess:()=>h.refetchQueries({queryKey:["/api/auth/user"]})})]}),b&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(s,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>He(!0),"data-testid":"button-delete-own-account",children:[e.jsx(ft,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})},"profile"),k==="admin"&&d?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2 mb-4 md:mb-6",children:["dashboard","orders","users","calendar","newsletter","inbox","descuentos"].map(a=>e.jsxs(s,{variant:V===a?"default":"outline",onClick:()=>At(a),className:"rounded-full text-[10px] md:text-xs font-black capitalize px-2 md:px-3","data-testid":`button-admin-tab-${a}`,children:[e.jsx("span",{className:"hidden sm:inline",children:a==="dashboard"?"Métricas":a==="calendar"?"Fechas":a==="orders"?"Pedidos":a==="users"?"Clientes":a==="descuentos"?"Descuentos":a}),e.jsx("span",{className:"sm:hidden flex items-center justify-center",children:a==="dashboard"?e.jsx(Wt,{className:"w-5 h-5"}):a==="calendar"?e.jsx(he,{className:"w-5 h-5"}):a==="orders"?e.jsx(Ea,{className:"w-5 h-5"}):a==="users"?e.jsx(Yt,{className:"w-5 h-5"}):a==="newsletter"?e.jsx(Pa,{className:"w-5 h-5"}):a==="descuentos"?e.jsx(Jt,{className:"w-5 h-5"}):e.jsx(Ta,{className:"w-5 h-5"})})]},a))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>ke(!0),"data-testid":"button-create-user",children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>we(!0),"data-testid":"button-create-order",children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),V==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((y?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((y?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:y?.orderCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[y?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:y?.pendingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:y?.processingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:y?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:y?.userCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:y?.activeAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:y?.vipAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:y?.pendingAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:y?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:y?.subscriberCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:y?.totalMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:y?.pendingMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:y?.pendingDocs||0})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[10px] text-muted-foreground pt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Actualización en tiempo real cada 10 segundos"})]})]}),V==="orders"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:Le?.map(a=>{const t=a.application||a.maintenanceApplication,x=!!a.maintenanceApplication&&!a.application,f=t?.requestCode||a.invoiceNumber,qe=t?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:f}),e.jsx(L,{className:`text-[9px] ${x?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:x?"MANTENIMIENTO":"LLC"}),!qe&&e.jsx(L,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:t?.ownerFullName||`${a.user?.firstName||""} ${a.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?.ownerEmail||a.user?.email}),t?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",t?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",t?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",a.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(a.amount/100).toFixed(2),"€",a.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",a.discountCode," -",(a.discountAmount/100).toFixed(2),"€)"]})]}),t?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",t.businessCategory]}),x&&t?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",t.ein]})]}),e.jsxs(S,{value:a.status,onValueChange:Sa=>$t.mutate({id:a.id,status:Sa}),children:[e.jsx(D,{className:"w-28 h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border",children:e.jsx(z,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"paid",children:"Pagado"}),e.jsx(l,{value:"filed",children:"Presentado"}),e.jsx(l,{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${a.id}`,"_blank"),"data-testid":`btn-view-invoice-${a.id}`,children:"Ver Factura"}),e.jsx(s,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{lt(((a.amount||0)/100).toFixed(2)),ct("EUR"),Me({open:!0,order:a})},"data-testid":`btn-generate-invoice-${a.id}`,children:"Generar Factura"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Oe({open:!0,order:a}),"data-testid":`btn-delete-order-${a.id}`,children:"Eliminar"})]})]},a.id)})})}),V==="users"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:rt?.map(a=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsx(L,{variant:a.accountStatus==="active"||a.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${a.accountStatus==="deactivated"?"bg-red-100 text-red-700":a.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":a.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:a.accountStatus==="active"?"VERIFICADO":a.accountStatus==="pending"?"EN REVISIÓN":a.accountStatus==="deactivated"?"DESACTIVADA":a.accountStatus==="vip"?"VIP":"VERIFICADO"}),a.isAdmin&&e.jsx(L,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.phone&&e.jsx("span",{className:"mr-2",children:a.phone}),a.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",a.businessActivity]}),a.city&&e.jsxs("span",{children:["• ",a.city]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(r,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(S,{value:a.accountStatus||"active",onValueChange:t=>a.id&&Fe.mutate({id:a.id,accountStatus:t}),children:[e.jsx(D,{className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm",children:e.jsx(z,{})}),e.jsxs(E,{children:[e.jsx(l,{value:"active",children:"Verificado"}),e.jsx(l,{value:"pending",children:"En revisión"}),e.jsx(l,{value:"deactivated",children:"Desactivada"}),e.jsx(l,{value:"vip",children:"VIP"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>N(a),"data-testid":`button-edit-user-${a.id}`,children:"Editar"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>ve({open:!0,user:a}),"data-testid":`button-note-user-${a.id}`,children:"Mensaje"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>fe({open:!0,user:a}),"data-testid":`button-doc-user-${a.id}`,children:"Docs"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>ye({open:!0,user:a}),"data-testid":`button-invoice-user-${a.id}`,children:"Factura"}),e.jsx(s,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>Pe({open:!0,user:a}),"data-testid":`button-payment-link-${a.id}`,children:"Pago"}),e.jsx(s,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Se({open:!0,user:a}),"data-testid":`button-delete-user-${a.id}`,children:"Eliminar"})]})]},a.id))})}),V==="calendar"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(he,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[Le?.map(a=>{const t=a.application;if(!t)return null;const x=t?.requestCode||a.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:t.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",t.state]})]}),e.jsx(L,{variant:"outline",className:"text-xs w-fit",children:x})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.llcCreatedDate?new Date(t.llcCreatedDate).toISOString().split("T")[0]:"",onChange:f=>pe.mutate({appId:t.id,field:"llcCreatedDate",value:f.target.value}),"data-testid":`input-llc-created-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.agentRenewalDate?new Date(t.agentRenewalDate).toISOString().split("T")[0]:"",onChange:f=>pe.mutate({appId:t.id,field:"agentRenewalDate",value:f.target.value}),"data-testid":`input-agent-renewal-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs1120DueDate?new Date(t.irs1120DueDate).toISOString().split("T")[0]:"",onChange:f=>pe.mutate({appId:t.id,field:"irs1120DueDate",value:f.target.value}),"data-testid":`input-irs1120-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.irs5472DueDate?new Date(t.irs5472DueDate).toISOString().split("T")[0]:"",onChange:f=>pe.mutate({appId:t.id,field:"irs5472DueDate",value:f.target.value}),"data-testid":`input-irs5472-${t.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:t.annualReportDueDate?new Date(t.annualReportDueDate).toISOString().split("T")[0]:"",onChange:f=>pe.mutate({appId:t.id,field:"annualReportDueDate",value:f.target.value}),"data-testid":`input-annual-report-${t.id}`})]})]})]},a.id)}),(!Le||Le.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),V==="newsletter"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-accent/10 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Enviar a todos los suscriptores (",ue?.length||0,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{value:pa,onChange:a=>nt(a.target.value),placeholder:"Asunto del email",className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-subject"}),e.jsx(B,{value:ha,onChange:a=>it(a.target.value),placeholder:"Contenido del mensaje",rows:4,className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-message"}),e.jsx(s,{onClick:()=>ga.mutate({subject:pa,message:ha}),disabled:!pa||!ha||ga.isPending,className:"w-full rounded-full","data-testid":"button-send-broadcast",children:ga.isPending?"Enviando...":`Enviar a ${ue?.length||0} suscriptores`})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm mb-3",children:"Lista de Suscriptores"}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[ue?.map(a=>e.jsxs("div",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:a.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.subscribedAt?new Date(a.subscribedAt).toLocaleDateString("es-ES"):""})]},a.id)),(!ue||ue.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})]})}),V==="inbox"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[xa?.map(a=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>ca(Te?.id===a.id?null:a),"data-testid":`inbox-message-${a.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.email," ",a.phone&&`• ${a.phone}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:"text-[10px]",children:a.messageId||a.id}),e.jsx(L,{variant:"secondary",className:"text-[10px]",children:a.status||"pendiente"})]})]}),e.jsx("p",{className:"text-xs font-medium",children:a.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.message}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:a.replies.map(t=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${t.isAdmin?"text-accent":"text-muted-foreground"}`,children:[t.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:t.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:t.createdAt&&new Date(t.createdAt).toLocaleString("es-ES")})]},t.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.createdAt?new Date(a.createdAt).toLocaleString("es-ES"):""}),Te?.id===a.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:t=>t.stopPropagation(),children:[e.jsx(B,{value:me,onChange:t=>oa(t.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(s,{onClick:()=>xe.mutate(a.id),disabled:!me.trim()||xe.isPending,className:"bg-accent text-primary font-black rounded-full px-6","data-testid":"button-send-admin-reply",children:[xe.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},a.id)),(!xa||xa.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),V==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(s,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{q({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),le({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[ua?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${a.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.code}),e.jsx(L,{variant:a.isActive?"default":"secondary",className:"text-[10px]",children:a.isActive?"Activo":"Inactivo"}),e.jsx(L,{variant:"outline",className:"text-[10px]",children:a.discountType==="percentage"?`${a.discountValue}%`:`${(a.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",a.usedCount,a.maxUses?`/${a.maxUses}`:""," veces",a.minOrderAmount&&` | Min: ${(a.minOrderAmount/100).toFixed(2)}€`]}),(a.validFrom||a.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.validFrom&&`Desde: ${new Date(a.validFrom).toLocaleDateString("es-ES")}`,a.validFrom&&a.validUntil&&" - ",a.validUntil&&`Hasta: ${new Date(a.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{q({code:a.code,discountType:a.discountType,discountValue:a.discountValue.toString(),minOrderAmount:a.minOrderAmount?(a.minOrderAmount/100).toString():"",maxUses:a.maxUses?.toString()||"",validFrom:a.validFrom?a.validFrom.split("T")[0]:"",validUntil:a.validUntil?a.validUntil.split("T")[0]:"",isActive:a.isActive}),le({open:!0,code:a})},"data-testid":`button-edit-discount-${a.code}`,children:e.jsx(Xt,{className:"w-3 h-3"})}),e.jsx(s,{variant:"outline",size:"sm",className:`rounded-full text-xs ${a.isActive?"text-red-600":"text-green-600"}`,onClick:async()=>{try{await p("PATCH",`/api/admin/discount-codes/${a.id}`,{isActive:!a.isActive}),dt(),i({title:a.isActive?"Código desactivado":"Código activado"})}catch{i({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${a.code}`,children:a.isActive?e.jsx(Nt,{className:"w-3 h-3"}):e.jsx(vt,{className:"w-3 h-3"})})]})]},a.id)),(!ua||ua.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary mb-6 flex items-center gap-2",children:[e.jsx(Ia,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("div",{className:"space-y-5",children:O&&O.length>0?Ie&&Ie.length>0?Ie.map((a,t)=>e.jsxs("div",{className:"flex gap-4 relative",children:[t<Ie.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(La,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-black text-primary truncate",children:a.eventType}),a.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(a.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.description})]})]},a.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(La,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(yt,{className:"w-8 h-8 text-gray-200 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay pedidos activos"})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-black text-primary mb-3",children:"¿Necesitas ayuda?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Nuestro equipo de expertos está listo para resolver tus dudas."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",children:e.jsx(s,{className:"w-full bg-accent text-primary font-black rounded-full py-5",children:"Contactar Soporte"})})]})]})]})]}),d?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(P,{open:Ne.open,onOpenChange:a=>ve({open:a,user:a?Ne.user:null}),children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Enviar Mensaje al Cliente"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Título"}),e.jsx(c,{value:Qe,onChange:a=>$a(a.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:_e,onChange:a=>Ua(a.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs(F,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>ve({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>Ne.user?.id&&te.mutate({userId:Ne.user.id,title:Qe,message:_e,type:Pt}),disabled:!Qe||!_e||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-note",children:te.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(P,{open:!!m,onOpenChange:a=>!a&&N(null),children:e.jsxs(A,{className:"max-w-lg bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Editar Usuario"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),m&&e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:m.firstName||"",onChange:a=>N({...m,firstName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:m.lastName||"",onChange:a=>N({...m,lastName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{value:m.email||"",onChange:a=>N({...m,email:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:m.phone||"",onChange:a=>N({...m,phone:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo ID"}),e.jsxs(S,{value:m.idType||"",onValueChange:a=>N({...m,idType:a}),children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(z,{placeholder:"Seleccionar"})}),e.jsxs(E,{className:"rounded-xl",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Número ID"}),e.jsx(c,{value:m.idNumber||"",onChange:a=>N({...m,idNumber:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Fecha Nacimiento"}),e.jsx(c,{type:"date",value:m.birthDate||"",onChange:a=>N({...m,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Actividad de Negocio"}),e.jsxs(S,{value:m.businessActivity||"",onValueChange:a=>N({...m,businessActivity:a}),children:[e.jsx(D,{className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-edit-activity",children:e.jsx(z,{placeholder:"Seleccionar actividad"})}),e.jsxs(E,{className:"rounded-xl",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Dirección"}),e.jsx(c,{value:m.address||"",onChange:a=>N({...m,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Ciudad"}),e.jsx(c,{value:m.city||"",onChange:a=>N({...m,city:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Código Postal"}),e.jsx(c,{value:m.postalCode||"",onChange:a=>N({...m,postalCode:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Provincia"}),e.jsx(c,{value:m.province||"",onChange:a=>N({...m,province:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"País"}),e.jsx(c,{value:m.country||"",onChange:a=>N({...m,country:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(B,{value:m.internalNotes||"",onChange:a=>N({...m,internalNotes:a.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>N(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>m.id&&Fe.mutate({id:m.id,...m}),disabled:Fe.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-user",children:Fe.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})]})}),e.jsx(P,{open:X.open,onOpenChange:a=>Se({open:a,user:a?X.user:null}),children:e.jsxs(A,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(T,{children:e.jsx(I,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[X.user?.firstName," ",X.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Se({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>X.user?.id&&ba.mutate(X.user.id),disabled:ba.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:ba.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(P,{open:U.open,onOpenChange:a=>Oe({open:a,order:a?U.order:null}),children:e.jsxs(A,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(T,{children:e.jsx(I,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:U.order?.application?.requestCode||U.order?.maintenanceApplication?.requestCode||U.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",U.order?.user?.firstName," ",U.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Oe({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>U.order?.id&&ja.mutate(U.order.id),disabled:ja.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:ja.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(P,{open:se.open,onOpenChange:a=>Me({open:a,order:a?se.order:null}),children:e.jsxs(A,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(T,{children:e.jsx(I,{className:"text-xl font-black text-primary",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:se.order?.application?.requestCode||se.order?.maintenanceApplication?.requestCode||se.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",step:"0.01",value:re,onChange:a=>lt(a.target.value),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Divisa"}),e.jsxs(S,{value:fa,onValueChange:ct,children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(z,{placeholder:"Seleccionar divisa"})}),e.jsxs(E,{className:"rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR (€)"}),e.jsx(l,{value:"USD",children:"USD ($)"})]})]})]})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>Me({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full",disabled:!re||isNaN(parseFloat(re))||parseFloat(re)<=0,onClick:async()=>{try{const a=Math.round(parseFloat(re)*100);if(a<=0){i({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}await p("POST",`/api/admin/orders/${se.order?.id}/generate-invoice`,{amount:a,currency:fa}),i({title:"Factura generada",description:`Factura creada por ${re} ${fa}`}),h.invalidateQueries({queryKey:["/api/admin/orders"]}),Me({open:!1,order:null})}catch{i({title:"Error",description:"No se pudo generar la factura",variant:"destructive"})}},"data-testid":"button-confirm-generate-invoice",children:"Generar Factura"})]})]})}),e.jsx(P,{open:ne.open,onOpenChange:a=>fe({open:a,user:a?ne.user:null}),children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Solicitar Documentos"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(S,{value:je,onValueChange:Oa,children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(z,{placeholder:"Seleccionar tipo..."})}),e.jsxs(E,{className:"rounded-xl",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:Ma,onChange:a=>qa(a.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>fe({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>{if(ne.user?.id&&ne.user?.email){const t={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[je]||je;te.mutate({userId:ne.user.id,title:`Solicitud de Documento: ${t}`,message:Ma||`Por favor, sube tu ${t} a tu panel de cliente.`,type:"action_required"}),fe({open:!1,user:null}),Oa(""),qa("")}},disabled:!je||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-request-doc",children:te.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(P,{open:Y.open,onOpenChange:a=>ye({open:a,user:a?Y.user:null}),children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Crear Factura"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[Y.user?.firstName," ",Y.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Concepto"}),e.jsx(c,{value:Be,onChange:a=>Ra(a.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",value:Ge,onChange:a=>Va(a.target.value),placeholder:"739",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Moneda"}),e.jsxs(S,{value:Ka,onValueChange:Qa,children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-invoice-currency",children:e.jsx(z,{})}),e.jsxs(E,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR"}),e.jsx(l,{value:"USD",children:"USD"})]})]})]})]})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(s,{variant:"outline",onClick:()=>ye({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:()=>Y.user?.id&&Na.mutate({userId:Y.user.id,concept:Be,amount:Math.round(parseFloat(Ge)*100),currency:Ka}),disabled:!Be||!Ge||Na.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-create-invoice",children:Na.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(P,{open:Lt,onOpenChange:He,children:e.jsxs(A,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(T,{children:e.jsx(I,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>He(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{variant:"destructive",onClick:()=>ka.mutate(),disabled:ka.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:ka.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(P,{open:ee.open,onOpenChange:a=>{a||De({open:!1,file:null})},children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(T,{children:e.jsx(I,{className:"text-xl font-black text-primary",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[ee.file&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-accent"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:ee.file.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(ee.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(S,{value:ie,onValueChange:_a,children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-upload-doc-type",children:e.jsx(z,{})}),e.jsxs(E,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),ie==="other"&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Descripción del documento"}),e.jsx(B,{value:ze,onChange:a=>Ba(a.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent","data-testid":"input-upload-notes"})]})]}),e.jsxs(F,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>De({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{if(!ee.file)return;const a=new FormData;a.append("file",ee.file),a.append("documentType",ie),ie==="other"&&ze&&a.append("notes",ze);try{const t=await fetch("/api/user/documents/upload",{method:"POST",body:a,credentials:"include"});if(t.ok)i({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),h.invalidateQueries({queryKey:["/api/user/documents"]}),De({open:!1,file:null});else{const x=await t.json();i({title:"Error",description:x.message||"No se pudo subir el documento",variant:"destructive"})}}catch{i({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:ie==="other"&&!ze.trim(),className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(P,{open:Tt,onOpenChange:ke,children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Crear Nuevo Cliente"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:K.firstName,onChange:a=>J(t=>({...t,firstName:a.target.value})),placeholder:"Nombre",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:K.lastName,onChange:a=>J(t=>({...t,lastName:a.target.value})),placeholder:"Apellidos",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{type:"email",value:K.email,onChange:a=>J(t=>({...t,email:a.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:K.phone,onChange:a=>J(t=>({...t,phone:a.target.value})),placeholder:"+34 600 000 000",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Contraseña"}),e.jsx(c,{type:"password",value:K.password,onChange:a=>J(t=>({...t,password:a.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-password"})]})]}),e.jsxs(F,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>ke(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(s,{onClick:()=>va.mutate(K),disabled:va.isPending||!K.email||!K.password,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-user",children:va.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(P,{open:It,onOpenChange:we,children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:"Crear Nuevo Pedido"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Cliente"}),e.jsxs(S,{value:Z.userId,onValueChange:a=>Ce(t=>({...t,userId:a})),children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-user",children:e.jsx(z,{placeholder:"Seleccionar cliente..."})}),e.jsx(E,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:rt?.map(a=>e.jsxs(l,{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Estado (LLC)"}),e.jsxs(S,{value:Z.state,onValueChange:a=>Ce(t=>({...t,state:a})),children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-state",children:e.jsx(z,{})}),e.jsxs(E,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(l,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(l,{value:"Delaware",children:"Delaware - 1199€"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe (€)"}),e.jsx(c,{type:"number",value:Z.amount,onChange:a=>Ce(t=>({...t,amount:a.target.value})),placeholder:"739",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-order-amount"})]})]}),e.jsxs(F,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>we(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(s,{onClick:()=>ya.mutate(Z),disabled:ya.isPending||!Z.userId||!Z.amount,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-order",children:ya.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(P,{open:Q.open,onOpenChange:a=>le({open:a,code:a?Q.code:null}),children:e.jsxs(A,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto max-h-[90vh] overflow-y-auto",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black text-primary",children:Q.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:Q.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Código"}),e.jsx(c,{value:g.code,onChange:a=>q(t=>({...t,code:a.target.value.toUpperCase()})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base uppercase",disabled:!!Q.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo"}),e.jsxs(S,{value:g.discountType,onValueChange:a=>q(t=>({...t,discountType:a})),children:[e.jsx(D,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-discount-type",children:e.jsx(z,{})}),e.jsxs(E,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(l,{value:"fixed",children:"Fijo (centimos)"})]})]})]}),e.jsxs("div",{children:[e.jsxs(r,{className:"text-sm font-black text-primary mb-2 block",children:["Valor ",g.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(c,{type:"number",value:g.discountValue,onChange:a=>q(t=>({...t,discountValue:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(c,{type:"number",value:g.minOrderAmount,onChange:a=>q(t=>({...t,minOrderAmount:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Usos max."}),e.jsx(c,{type:"number",value:g.maxUses,onChange:a=>q(t=>({...t,maxUses:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Válido desde"}),e.jsx(c,{type:"date",value:g.validFrom,onChange:a=>q(t=>({...t,validFrom:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Válido hasta"}),e.jsx(c,{type:"date",value:g.validUntil,onChange:a=>q(t=>({...t,validUntil:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Et,{checked:g.isActive,onCheckedChange:a=>q(t=>({...t,isActive:a})),"data-testid":"switch-discount-active"}),e.jsx(r,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs(F,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>le({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{try{const a={code:g.code,discountType:g.discountType,discountValue:parseInt(g.discountValue),minOrderAmount:g.minOrderAmount?parseInt(g.minOrderAmount)*100:null,maxUses:g.maxUses?parseInt(g.maxUses):null,validFrom:g.validFrom||null,validUntil:g.validUntil||null,isActive:g.isActive};Q.code?(await p("PATCH",`/api/admin/discount-codes/${Q.code.id}`,a),i({title:"Código actualizado"})):(await p("POST","/api/admin/discount-codes",a),i({title:"Código creado"})),dt(),le({open:!1,code:null})}catch(a){i({title:"Error",description:a.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!g.code||!g.discountValue,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-discount",children:Q.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(P,{open:Ft,onOpenChange:a=>{na(a),a||ia("")},children:e.jsxs(A,{className:"rounded-2xl mx-4 sm:mx-auto max-w-md",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(R,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Código de verificación"}),e.jsx(c,{value:oe,onChange:a=>ia(a.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(s,{onClick:async()=>{if(!oe||oe.length<6){i({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}Xa(!0);try{(await(await p("POST","/api/auth/verify-email",{code:oe})).json()).success&&(await h.refetchQueries({queryKey:["/api/auth/user"]}),i({title:"Email verificado correctamente"}),na(!1),ia(""))}catch(a){i({title:"Código incorrecto",description:a.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{Xa(!1)}},disabled:Za||oe.length<6,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full","data-testid":"button-verify-email-code",children:Za?e.jsx(_,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(s,{variant:"link",onClick:async()=>{at(!0);try{await p("POST","/api/auth/resend-verification"),i({title:"Código enviado",description:"Revisa tu email"})}catch{i({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{at(!1)}},disabled:et,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:et?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(P,{open:ae.open,onOpenChange:a=>{Pe({open:a,user:a?ae.user:null}),a||(sa(""),ra(""),da(""))},children:e.jsxs(A,{className:"rounded-2xl mx-4 sm:mx-auto max-w-md",children:[e.jsxs(T,{children:[e.jsx(I,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(R,{children:["Envía un enlace de pago a ",ae.user?.firstName," ",ae.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Link de pago (URL)"}),e.jsx(c,{value:Ae,onChange:a=>sa(a.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Importe"}),e.jsx(c,{value:ce,onChange:a=>ra(a.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Mensaje (opcional)"}),e.jsx(B,{value:Wa,onChange:a=>da(a.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs(F,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(s,{variant:"outline",onClick:()=>Pe({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(s,{onClick:async()=>{if(!Ae||!ce){i({title:"Completa todos los campos requeridos",variant:"destructive"});return}Ja(!0);try{await p("POST","/api/admin/send-payment-link",{userId:ae.user?.id,paymentLink:Ae,amount:ce,message:Wa||`Por favor, completa el pago de ${ce} a través del siguiente enlace.`}),i({title:"Link de pago enviado",description:`Se ha enviado el link a ${ae.user?.email}`}),Pe({open:!1,user:null}),sa(""),ra(""),da("")}catch(a){i({title:"Error",description:a.message||"No se pudo enviar el link",variant:"destructive"})}finally{Ja(!1)}},disabled:Ya||!Ae||!ce,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-payment-link",children:Ya?e.jsx(_,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(wt,{})]})}export{ws as default};
