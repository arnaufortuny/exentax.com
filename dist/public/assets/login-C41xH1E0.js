import{j as e,m as x}from"./vendor-DoqeAWLV.js";import{a as n,al as y,am as v,s as N}from"./ui-DQs5cT5J.js";import{u as w,F as S,t as E,o as k,s as p}from"./form-BlFKD2RG.js";import{u as L,c as F,N as I,B as l,L as h,F as T,d as q,q as C}from"./index-BAX7s--W.js";import{F as f}from"./form-input-BxbHhqs-.js";import"./textarea-CNGMwePK.js";import"./select-Cj6dL_kI.js";import"./checkbox-CQEFQw0a.js";import"./label-anzizvNT.js";const O=k({email:p().email("Introduce un email válido"),password:p().min(1,"La contraseña es requerida")}),B={initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25,ease:[.25,.1,.25,1]}};function D(){const[,g]=L(),[d,m]=n.useState(!1),[a,j]=n.useState(!1),[i,o]=n.useState(null),{toast:u}=F(),r=w({resolver:E(O),defaultValues:{email:"",password:""}});n.useEffect(()=>{if(i){const c=setTimeout(()=>o(null),5e3);return()=>clearTimeout(c)}},[i]);const b=async c=>{m(!0),o(null);try{(await(await q("POST","/api/auth/login",c)).json()).success&&(await C.refetchQueries({queryKey:["/api/auth/user"]}),u({title:"Bienvenido de nuevo",description:"Sesión iniciada correctamente"}),g("/dashboard"))}catch(t){let s="Error al iniciar sesión";t.message?.includes("401")?s="Email o contraseña incorrectos":t.message?.includes("404")?s="Usuario no encontrado":t.message&&(s=t.message),o(s),u({title:"Error de autenticación",description:s,variant:"destructive"})}finally{m(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(I,{}),e.jsx("main",{className:"pt-24 pb-16 px-5 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs(x.div,{className:"w-full max-w-md",initial:"initial",animate:"animate",variants:B,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-black text-primary tracking-tight",children:["Iniciar ",e.jsx("span",{className:"text-accent",children:"Sesión"})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Accede a tu área de cliente"})]}),i&&e.jsx(x.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 bg-destructive/10 border border-destructive/20 rounded-xl text-center",children:e.jsx("p",{className:"text-destructive font-medium text-sm",children:i})}),e.jsxs("div",{children:[e.jsx(S,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(b),className:"space-y-5",children:[e.jsx("div",{className:"space-y-1",children:e.jsx(f,{control:r.control,name:"email",label:"Email",type:"email",inputMode:"email",placeholder:"tu@email.com"})}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(f,{control:r.control,name:"password",label:"Contraseña",type:a?"text":"password",placeholder:"Tu contraseña"}),e.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:()=>j(!a),className:"absolute right-2 top-1/2 -translate-y-1/2","aria-label":a?"Ocultar contraseña":"Mostrar contraseña","data-testid":"button-toggle-password",children:a?e.jsx(y,{className:"w-5 h-5"}):e.jsx(v,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"text-right",children:e.jsx(h,{href:"/forgot-password",children:e.jsx(l,{variant:"link",className:"text-accent p-0 h-auto","data-testid":"link-forgot-password",children:"¿Olvidaste tu contraseña?"})})}),e.jsx(l,{type:"submit",disabled:d,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full text-lg shadow-lg shadow-accent/20","data-testid":"button-login",children:d?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"animate-spin mr-2 w-5 h-5"}),"Iniciando sesión..."]}):"Iniciar Sesión"})]})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-border text-center",children:e.jsxs("p",{className:"text-muted-foreground text-sm",children:["¿No tienes cuenta?"," ",e.jsx(h,{href:"/register",children:e.jsx("span",{className:"font-black text-primary hover:text-accent transition-colors cursor-pointer","data-testid":"link-register",children:"Regístrate gratis"})})]})})]})]})}),e.jsx(T,{})]})}export{D as default};
