import{n as We,o as oe,p as ye,F as X,W as Ps,B as Ye,j as e,d as Gs,a as i,P as $a,q as vs,s as Oa,t as Ne,U as Hs,u as Ws,v as ys,w as ws,x as qa,y as ve,l as Ys,T as ks,z as Js,N as Xs,A as Cs,H as Ss,I as Ds,J as Zs,K as et,O as at,Q as Ma,m as st,k as W,V as tt,Y as rt}from"./react-core-CoXVuRuN.js";import{u as nt,a as dt,N as zs,b as g,F as Es,L as Ge,q as j}from"./index-D0uNKl9J.js";import{b as k,a as M}from"./tanstack-DmlugzsV.js";import{C as o,r as Ua,s as Ra,a as ce,P as it,u as As,B as t,t as D,l as Y,v as r,I as c,m as z,n as E,o as P,p as A,q as l,D as L,w as I,x as F,y as $,z as B,A as q,E as Ts}from"./ui-components-elp02Hq4.js";import{S as lt}from"./social-login-C7Eblpa2.js";import{u as ct}from"./i18n-DoDnFGHd.js";import"./react-dom-RP0EX8KY.js";import"./radix-ui-B9Yx-JBw.js";import"./forms-CBid_O5E.js";const ot=x=>[{id:"pending",label:x("progress.orderReceived"),icon:We,description:x("progress.orderRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:oe,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.processing"),icon:ye,description:x("progress.preparingDocs")},{id:"filed",label:x("progress.filed"),icon:X,description:x("progress.docsSent")},{id:"completed",label:x("progress.llcActive"),icon:Ye,description:x("progress.llcOperational")}],mt=x=>[{id:"pending",label:x("progress.requestReceived"),icon:We,description:x("progress.requestRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:oe,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.inProcess"),icon:ye,description:x("progress.managingRenewal")},{id:"filed",label:x("progress.filed"),icon:X,description:x("progress.docsUpdated")},{id:"completed",label:x("progress.completed"),icon:Ps,description:x("progress.maintenanceComplete")}],xt=["pending","paid","processing","filed","documents_ready","completed"];function ut({status:x,serviceName:n,state:O,requestCode:K,isMaintenance:v=!1}){const{t:U}=ct(),w=v?mt(U):ot(U),R=xt.indexOf(x),u=R>=0?Math.min((R+1)/w.length*100,100):0,C=p=>x==="cancelled"?"cancelled":R<0?"pending":p<R||p===R&&x==="completed"?"completed":p===R?"current":"pending",d={new_mexico:"New Mexico",wyoming:"Wyoming",delaware:"Delaware","New Mexico":"New Mexico",Wyoming:"Wyoming",Delaware:"Delaware"};return x==="cancelled"?e.jsxs(o,{className:"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900","data-testid":"widget-cancelled",children:[e.jsx(Ua,{className:"pb-2 p-3 md:p-4",children:e.jsxs(Ra,{className:"text-sm md:text-base flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(Gs,{className:"h-4 w-4"}),U("progress.cancelled")]})}),e.jsx(ce,{className:"p-3 pt-0 md:p-4 md:pt-0",children:e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:U("progress.cancelledMessage")})})]}):e.jsxs(o,{className:"overflow-hidden","data-testid":`widget-progress-${v?"maintenance":"llc"}`,children:[e.jsxs(Ua,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs(Ra,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[v?e.jsx(Ps,{className:"h-4 w-4 md:h-5 md:w-5 text-accent"}):e.jsx(Ye,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{className:"truncate max-w-[180px] md:max-w-none",children:n||U(v?"progress.maintenance":"progress.yourLLC")})]}),O&&e.jsx("span",{className:"text-[10px] md:text-xs bg-muted px-2 py-0.5 md:py-1 rounded-md font-medium shrink-0",children:d[O]||O})]}),K&&e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:[U("progress.reference"),": ",K]})]}),e.jsxs(ce,{className:"p-3 md:p-4 space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] md:text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:U("progress.progressLabel")}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(u),"%"]})]}),e.jsx(it,{value:u,className:"h-1.5 md:h-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[9px] md:left-[11px] top-5 md:top-6 bottom-5 md:bottom-6 w-0.5 bg-border"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:w.map((p,m)=>{const b=C(m),Va=p.icon;return e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 relative",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full border-2 transition-colors shrink-0
                    ${b==="completed"?"bg-primary border-primary text-primary-foreground":b==="current"?"bg-primary/10 border-primary text-primary animate-pulse":"bg-background border-muted-foreground/30 text-muted-foreground"}
                  `,children:b==="completed"?e.jsx(oe,{className:"h-2.5 w-2.5 md:h-3.5 md:w-3.5"}):e.jsx(Va,{className:"h-2.5 w-2.5 md:h-3 md:w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-1 md:pb-2",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium leading-tight ${b==="completed"?"text-foreground":b==="current"?"text-primary font-bold":"text-muted-foreground"}`,children:p.label}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5 leading-tight hidden sm:block",children:p.description})]})]},p.id)})})]})]})]})}function He(x){return{pending:{label:"Pendiente",className:"bg-yellow-100 text-yellow-800"},paid:{label:"Pagado",className:"bg-blue-100 text-blue-800"},processing:{label:"En Proceso",className:"bg-purple-100 text-purple-800"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 text-cyan-800"},completed:{label:"Completado",className:"bg-green-100 text-green-800"},cancelled:{label:"Cancelado",className:"bg-red-100 text-red-700 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 text-indigo-800"},draft:{label:"Borrador",className:"bg-gray-100 text-gray-600"}}[x]||{label:x,className:"bg-gray-100 text-gray-600"}}function pt(){const{toast:x}=As(),{data:n,isLoading:O}=M({queryKey:["/api/newsletter/status"]}),K=k({mutationFn:async v=>{await g("POST",v?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",v?{email:void 0}:void 0)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/newsletter/status"]}),x({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return O?e.jsx("div",{className:"w-10 h-6 bg-gray-100 animate-pulse rounded-full"}):e.jsx(Ts,{checked:n?.isSubscribed,onCheckedChange:v=>K.mutate(v),disabled:K.isPending})}function It(){const[,x]=nt(),{user:n,isAuthenticated:O,isLoading:K}=dt(),[v,U]=i.useState("services"),[w,R]=i.useState(!1),[u,C]=i.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:d}=As(),p=n?.accountStatus==="active"||n?.accountStatus==="vip",[m,b]=i.useState(null),[Va,ht]=i.useState({open:!1,user:null}),[gt,bt]=i.useState(""),[ft,jt]=i.useState(""),[Nt,vt]=i.useState(""),[me,we]=i.useState({open:!1,user:null}),[ke,Ka]=i.useState(""),[Qa,_a]=i.useState(""),[Ce,Se]=i.useState({open:!1,user:null}),[Je,Ba]=i.useState(""),[Xe,Ga]=i.useState(""),[Ls,yt]=i.useState("info"),[Z,De]=i.useState({open:!1,user:null}),[Ze,Ha]=i.useState(""),[ea,Wa]=i.useState(""),[Ya,Ja]=i.useState("EUR"),[Q,Is]=i.useState("dashboard"),[Fs,ze]=i.useState(!1),[G,ee]=i.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[$s,Ee]=i.useState(!1),[ae,Pe]=i.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[se,Ae]=i.useState({open:!1,user:null}),[Os,aa]=i.useState(!1),[te,Te]=i.useState({open:!1,file:null}),[xe,Xa]=i.useState("passport"),[Le,Za]=i.useState(""),[es,sa]=i.useState(!1),[as,ta]=i.useState("form"),[ra,na]=i.useState(""),[J,da]=i.useState(""),[Ie,ia]=i.useState(""),[la,ca]=i.useState(""),[H,ue]=i.useState({open:!1,code:null}),[re,Fe]=i.useState({open:!1,user:null}),[$e,oa]=i.useState(""),[pe,ma]=i.useState(""),[ss,xa]=i.useState(""),[ts,rs]=i.useState(!1),[qs,ua]=i.useState(!1),[he,pa]=i.useState(""),[ns,ds]=i.useState(!1),[is,ls]=i.useState(!1),[N,V]=i.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});i.useEffect(()=>{n&&C({firstName:n.firstName||"",lastName:n.lastName||"",phone:n.phone||"",businessActivity:n.businessActivity||"",address:n.address||"",streetType:n.streetType||"",city:n.city||"",province:n.province||"",postalCode:n.postalCode||"",country:n.country||"",idNumber:n.idNumber||"",idType:n.idType||"",birthDate:n.birthDate||""})},[n]);const cs=k({mutationFn:async a=>{if(!p)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");await g("PATCH","/api/user/profile",a)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/auth/user"]}),R(!1),d({title:"Cambios guardados",description:"Tu información se ha actualizado correctamente"})},onError:a=>{d({title:"Error",description:a.message,variant:"destructive"})}});i.useEffect(()=>{!K&&!O&&x("/auth/login")},[O,K,x]);const{data:h,isLoading:wt}=M({queryKey:["/api/orders"],enabled:O,refetchInterval:3e4,staleTime:1e4}),{data:ha,isLoading:kt}=M({queryKey:["/api/messages"],enabled:O,refetchInterval:6e4,staleTime:3e4}),[Oe,ga]=i.useState(null),[ge,ba]=i.useState(""),os=h?.[0]?.id,{data:qe}=M({queryKey:["/api/orders",os,"events"],enabled:!!os,refetchInterval:3e4,staleTime:1e4}),be=k({mutationFn:async a=>{await g("POST",`/api/messages/${a}/reply`,{content:ge})},onSuccess:()=>{ba(""),ga(null),j.invalidateQueries({queryKey:["/api/messages"]}),j.invalidateQueries({queryKey:["/api/admin/messages"]}),d({title:n?.isAdmin?"Respuesta enviada":"Mensaje enviado",description:n?.isAdmin?"El cliente recibirá un email con la información":"Te responderemos personalmente lo antes posible"})}}),{data:fa,isLoading:Ms}=M({queryKey:["/api/user/notifications"],enabled:O,refetchInterval:6e4,staleTime:3e4}),Us=k({mutationFn:async a=>{await g("PATCH",`/api/user/notifications/${a}/read`)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/user/notifications"]})}}),{data:Me}=M({queryKey:["/api/admin/orders"],enabled:!!n?.isAdmin,refetchInterval:3e4}),{data:ms}=M({queryKey:["/api/admin/users"],enabled:!!n?.isAdmin,refetchInterval:6e4}),{data:fe}=M({queryKey:["/api/admin/newsletter"],enabled:!!n?.isAdmin}),{data:Ue}=M({queryKey:["/api/admin/documents"],enabled:!!n?.isAdmin,refetchInterval:3e4}),{data:S}=M({queryKey:["/api/admin/system-stats"],enabled:!!n?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:ja}=M({queryKey:["/api/admin/messages"],enabled:!!n?.isAdmin}),{data:Na,refetch:xs}=M({queryKey:["/api/admin/discount-codes"],enabled:!!n?.isAdmin}),[va,us]=i.useState(""),[ya,ps]=i.useState(""),wa=k({mutationFn:async({subject:a,message:s})=>{await g("POST","/api/admin/newsletter/broadcast",{subject:a,message:s})},onSuccess:()=>{d({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),us(""),ps("")},onError:()=>{d({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}}),{data:Rs}=M({queryKey:["/api/user/documents"],enabled:O});k({mutationFn:async a=>(await g("POST","/api/admin/documents",a)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})}});const Vs=k({mutationFn:async({id:a,status:s})=>(await g("PATCH",`/api/admin/orders/${a}/status`,{status:s})).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/orders"]}),d({title:"Estado actualizado"})}}),je=k({mutationFn:async({appId:a,field:s,value:f})=>{await g("PATCH",`/api/admin/llc/${a}/dates`,{field:s,value:f})},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/orders"]}),j.invalidateQueries({queryKey:["/api/orders"]}),d({title:"Fecha actualizada"})},onError:()=>{d({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),ne=k({mutationFn:async({userId:a,title:s,message:f,type:y})=>{await g("POST","/api/admin/send-note",{userId:a,title:s,message:f,type:y})},onSuccess:()=>{d({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),Se({open:!1,user:null}),Ba(""),Ga("")}}),Re=k({mutationFn:async a=>{const{id:s,...f}=a;await g("PATCH",`/api/admin/users/${s}`,f)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario actualizado"}),b(null)},onError:a=>{d({title:"Error",description:a.message,variant:"destructive"})}}),ka=k({mutationFn:async a=>{await g("DELETE",`/api/admin/users/${a}`)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario eliminado"}),Ae({open:!1,user:null})},onError:()=>{d({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[_,Ve]=i.useState({open:!1,order:null}),[de,Ke]=i.useState({open:!1,order:null}),[ie,hs]=i.useState(""),[Ca,gs]=i.useState("EUR"),Sa=k({mutationFn:async a=>{await g("DELETE",`/api/admin/orders/${a}`)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/orders"]}),j.invalidateQueries({queryKey:["/api/orders"]}),j.invalidateQueries({queryKey:["/api/notifications"]}),j.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),Ve({open:!1,order:null})},onError:()=>{d({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),Da=k({mutationFn:async({userId:a,concept:s,amount:f,currency:y})=>{await g("POST","/api/admin/invoices/create",{userId:a,concept:s,amount:f,currency:y})},onSuccess:()=>{d({title:"Factura creada",description:"La factura se ha añadido al centro de documentos del cliente"}),De({open:!1,user:null}),Ha(""),Wa(""),Ja("EUR")},onError:()=>{d({title:"Error",description:"No se pudo crear la factura",variant:"destructive"})}}),za=k({mutationFn:async a=>(await g("POST","/api/admin/users/create",a)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/users"]}),d({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),ze(!1),ee({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{d({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),Ea=k({mutationFn:async a=>(await g("POST","/api/admin/orders/create",a)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/admin/orders"]}),d({title:"Pedido creado",description:"El pedido ha sido registrado correctamente"}),Ee(!1),Pe({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:()=>{d({title:"Error",description:"No se pudo crear el pedido",variant:"destructive"})}}),bs=k({mutationFn:async a=>{await g("DELETE",`/api/user/documents/${a}`)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/user/documents"]}),d({title:"Documento eliminado"})},onError:a=>{d({title:"Error",description:a?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),Pa=k({mutationFn:async()=>{await g("DELETE","/api/user/account")},onSuccess:()=>{d({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{d({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),Aa=k({mutationFn:async()=>{await g("POST","/api/user/request-password-otp")},onSuccess:()=>{d({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),ta("otp")},onError:a=>{d({title:"Error",description:a.message||"No se pudo enviar el código",variant:"destructive"})}}),Ta=k({mutationFn:async a=>{await g("POST","/api/user/change-password",a)},onSuccess:()=>{d({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),sa(!1),ta("form"),na(""),da(""),ia(""),ca("")},onError:a=>{d({title:"Error",description:a.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(K||!O)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(n?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(zs,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(o,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(ce,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-50 dark:bg-red-950/30 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-black text-red-500",children:"!"})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 p-3 rounded-xl",children:"No puedes realizar acciones ni contactar hasta que se resuelva tu situación."}),e.jsx(t,{variant:"outline",className:"w-full font-black text-foreground h-12 rounded-full border-2",onClick:()=>g("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:"Cerrar Sesión"})]})]})]})})}),e.jsx(Es,{})]});const Ks=[{id:"services",label:"Mis Servicios",icon:$a,mobileLabel:"Servicios"},{id:"notifications",label:"Seguimiento",icon:vs,mobileLabel:"Seguim."},{id:"messages",label:"¿Necesitas ayuda?",icon:Oa,mobileLabel:"Ayuda"},{id:"documents",label:"Documentos",icon:X,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:We,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:Ne,mobileLabel:"Fechas"},{id:"profile",label:"Mi Perfil",icon:Hs,mobileLabel:"Perfil"},...n?.isAdmin?[{id:"admin",label:"Admin",icon:Ws,mobileLabel:"Admin"}]:[]];return e.jsxs("div",{className:"min-h-screen bg-muted bg-green-gradient font-sans",children:[e.jsx(zs,{}),e.jsxs("main",{className:"pt-16 sm:pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-4 sm:mb-6 md:mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-black tracking-widest text-[10px] md:text-xs mb-0.5 md:mb-1 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-3xl md:text-4xl font-black text-primary tracking-tighter leading-tight",children:["Bienvenido, ",n?.firstName||"Cliente"]}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-sm mt-0.5 md:mt-1 font-medium",children:"Tu espacio privado de gestión"})]}),e.jsx(Ge,{href:"/servicios#pricing",children:e.jsxs(t,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-black font-bold rounded-full px-8 h-12 transition-all flex items-center justify-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5"})," Nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-1.5 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-2 md:pb-4 md:mb-8",children:Ks.map(a=>e.jsxs(t,{variant:v===a.id?"default":"outline",onClick:()=>U(a.id),size:"sm",className:`flex items-center gap-1.5 md:gap-2 rounded-full font-bold text-[11px] md:text-xs tracking-tight whitespace-nowrap shrink-0 ${v===a.id?"bg-accent text-primary shadow-lg shadow-accent/20":"bg-white dark:bg-zinc-900 text-muted-foreground border-0"}`,"data-testid":`button-tab-${a.id}`,children:[e.jsx(a.icon,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:a.label}),e.jsx("span",{className:"sm:hidden",children:a.mobileLabel})]},a.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[v==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Mis Servicios"}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground font-medium",children:"Gestiona tus trámites activos"})]}),!h||h.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx($a,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-primary mb-2",children:"Ningún servicio activo"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"¡Crea tu LLC hoy mismo! Conoce nuestros packs."})]}),e.jsx(Ge,{href:"/servicios#pricing",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full px-8 py-3","data-testid":"button-view-packs",children:"Ver Packs"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:h.filter(a=>a.status!=="cancelled"&&a.status!=="completed").slice(0,4).map(a=>e.jsx(ut,{status:a.status,serviceName:a.maintenanceApplication?`Mant. ${a.maintenanceApplication.state||a.product?.name?.replace(" LLC","")||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"Tu LLC",state:a.application?.state||a.maintenanceApplication?.state,requestCode:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber,isMaintenance:!!a.maintenanceApplication},`progress-${a.id}`))}),h.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground mb-2 md:mb-3",children:"Todos los Pedidos"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:h.map(a=>e.jsx(o,{className:"rounded-lg md:rounded-xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden","data-testid":`card-order-${a.id}`,children:e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("p",{className:"text-[9px] md:text-[10px] font-bold text-accent uppercase tracking-wider",children:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber||`#${a.id}`}),e.jsx(D,{className:`${He(a.status).className} font-bold uppercase text-[8px] md:text-[9px] px-1.5 py-0`,"data-testid":`badge-order-status-${a.id}`,children:He(a.status).label})]}),e.jsx("p",{className:"text-sm md:text-base font-bold text-primary truncate",children:a.maintenanceApplication?`Mantenimiento ${a.maintenanceApplication.state||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"LLC pendiente"}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:[a.application?.state||a.maintenanceApplication?.state||"",a.createdAt&&` · ${new Date(a.createdAt).toLocaleDateString("es-ES")}`]})]}),a.status==="pending"&&a.application&&e.jsx(t,{variant:"outline",size:"sm",className:"text-[9px] md:text-[10px] h-7 md:h-8 px-2 md:px-3 rounded-full font-bold shrink-0",onClick:()=>window.location.href=`/llc/formation?edit=${a.application.id}`,"data-testid":`button-modify-order-${a.id}`,children:"Modificar"})]})},a.id))})]})]})]},"services"),v==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Notificaciones"}),Ms?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},a))}):fa?.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(ce,{className:"p-8 text-center",children:[e.jsx(vs,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes notificaciones"})]})}):e.jsx("div",{className:"space-y-3",children:fa?.map(a=>e.jsx(o,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${a.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(ce,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[a.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",a.orderCode]}),a.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),a.type==="update"&&e.jsx("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),a.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-700 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),a.type==="action_required"&&p&&e.jsxs(t,{className:"mt-3 bg-accent text-primary font-black rounded-full text-xs px-4 gap-2",onClick:()=>{Us.mutate(a.id),U("documents")},"data-testid":`button-upload-document-${a.id}`,children:[e.jsx(ws,{className:"w-3 h-3"}),"Subir Documento"]})]}),!a.isRead&&e.jsx("div",{className:"w-2 h-2 bg-accent rounded-full flex-shrink-0 mt-2"})]})})},a.id))})]},"notifications"),v==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Mis Consultas y Soporte"}),e.jsx(Ge,{href:"/contacto",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full text-xs",children:"Nueva Consulta"})})]}),e.jsx("div",{className:"space-y-4",children:!ha||ha.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(qa,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no hay mensajes"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus conversaciones con soporte aparecerán aquí"})]}):ha.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ga(Oe?.id===a.id?null:a),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-black text-primary",children:a.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.messageId||a.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:a.content}),Oe?.id===a.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",children:[e.jsx(Y,{value:ge,onChange:s=>ba(s.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm"}),e.jsx(t,{onClick:s=>{s.stopPropagation(),be.mutate(a.id)},disabled:!ge.trim()||be.isPending,className:"bg-accent text-primary font-black rounded-full px-6",children:"Enviar Respuesta"})]})]},a.id))})]},"messages"),v==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight mb-6",children:"Centro de Documentación"}),fa?.some(a=>a.type==="action_required"&&!a.isRead)&&e.jsx(o,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-sm",children:"Documentos Solicitados"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Tienes solicitudes de documentos pendientes. Por favor, sube los documentos requeridos."}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async a=>{const s=a.target.files?.[0];if(!s)return;const f=new FormData;f.append("file",s);try{(await fetch("/api/user/documents/upload",{method:"POST",body:f,credentials:"include"})).ok?(d({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),j.invalidateQueries({queryKey:["/api/user/documents"]})):d({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{d({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(t,{variant:"outline",className:"rounded-full text-xs border-orange-300 text-orange-700",asChild:!0,children:e.jsxs("span",{children:[e.jsx(ve,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(o,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{const s=a.target.files?.[0];s&&(Te({open:!0,file:s}),Xa("passport"),Za(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(ws,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-primary text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(t,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(ve,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"SUBIR"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Rs?.map(a=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(ve,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:a.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(a.createdAt||a.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`button-download-doc-${a.id}`,children:[e.jsx(Ys,{className:"w-3 h-3 mr-1"})," Descargar"]}),p&&e.jsx(t,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>bs.mutate(a.id),disabled:bs.isPending,"data-testid":`button-delete-doc-${a.id}`,children:e.jsx(ks,{className:"w-3 h-3"})})]})]},a.id))})]},"documents"),v==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Historial de Pagos"}),e.jsx("div",{className:"space-y-4",children:!h||h.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(We,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no has contratado ningún servicio"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus facturas y recibos aparecerán aquí"})]}):h.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/receipt`,"_blank"),children:"Recibo"})]})]},a.id))})]},"payments"),v==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),h&&h.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:h.map(a=>{const s=a.application;if(!s)return null;const f=a.status==="cancelled",y=["pending","paid","processing"].includes(a.status),fs=["Wyoming","Delaware","WY","DE"].includes(s.state),Qe=[{label:"Creación",fullLabel:"Creación de LLC",date:s.llcCreatedDate,icon:Ye,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:s.agentRenewalDate,icon:Js,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:s.irs1120DueDate,icon:X,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:s.irs5472DueDate,icon:X,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...fs?[{label:"Anual",fullLabel:`Reporte Anual ${s.state}`,date:s.annualReportDueDate,icon:Xs,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],La=Qe.some(T=>T.date),js=Qe.filter(T=>T.date).sort((T,Ia)=>new Date(T.date).getTime()-new Date(Ia.date).getTime()),_e=js.find(T=>new Date(T.date)>new Date);return e.jsxs(o,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${f?"opacity-50":""}`,children:[e.jsx(Ua,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(Ra,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(Ye,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:s.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:s.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[f&&e.jsx(D,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),y&&e.jsx(D,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!f&&!y&&_e&&e.jsxs(D,{className:`text-[9px] md:text-[10px] ${_e.bgColor} ${_e.textColor}`,children:["Próximo: ",_e.label]})]})]})}),e.jsx(ce,{className:"p-3 md:p-4",children:f?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Cs,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):y?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(ye,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):La?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:js.map((T,Ia)=>{const Be=new Date(T.date),Ns=new Date,le=Math.ceil((Be.getTime()-Ns.getTime())/(1e3*60*60*24)),Fa=Be<Ns,Qs=!Fa&&le<=30,_s=!Fa&&le<=60&&le>30,Bs=T.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${T.borderColor} ${T.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${T.textColor}`,children:[e.jsx(Bs,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:T.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Be.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Be.getFullYear()}),Fa?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ss,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):Qs?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ds,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[le," días"]})]}):_s?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[le," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[le," días"]})})]},Ia)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ne,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},a.id)})}):e.jsxs(o,{className:"rounded-xl md:rounded-2xl border shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(Ne,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-3 md:mb-4"}),e.jsx("h3",{className:"text-base md:text-lg font-black text-primary mb-2",children:"Sin fechas programadas"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4",children:"Contrata tu primera LLC para ver las fechas importantes"}),e.jsx(Ge,{href:"/servicios#pricing",children:e.jsxs(t,{className:"bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",children:[e.jsx(ys,{className:"w-4 h-4 mr-2"})," Comenzar"]})})]})]},"calendar"),v==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-black",children:"Perfil Personal"}),p&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>R(!w),"data-testid":"button-toggle-edit",children:w?"Cancelar":"Editar"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario."}),!p&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${n?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${n?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:n?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:n?.clientId||n?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${n?.accountStatus==="active"?"text-green-600":n?.accountStatus==="pending"?"text-orange-500":n?.accountStatus==="deactivated"?"text-red-600":n?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:n?.accountStatus==="active"?"Verificado":n?.accountStatus==="pending"?"En revisión":n?.accountStatus==="deactivated"?"Desactivada":n?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Nombre"}),w&&p?e.jsx(c,{value:u.firstName,onChange:a=>C({...u,firstName:a.target.value}),placeholder:"Tu nombre real",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Apellidos"}),w&&p?e.jsx(c,{value:u.lastName,onChange:a=>C({...u,lastName:a.target.value}),placeholder:"Tal y como aparecen en tu documento",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:n?.email}),n?.emailVerified?e.jsx(oe,{className:"w-4 h-4 text-green-500"}):e.jsx(t,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>ua(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!n?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Teléfono"}),w&&p?e.jsx(c,{value:u.phone,onChange:a=>C({...u,phone:a.target.value}),placeholder:"Para contactarte si es necesario",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de documento"}),w&&p?e.jsxs(z,{value:u.idType,onValueChange:a=>C({...u,idType:a}),children:[e.jsx(E,{className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-idtype",children:e.jsx(P,{placeholder:"DNI · NIE · Pasaporte"})}),e.jsxs(A,{children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.idType==="dni"?"DNI":n?.idType==="nie"?"NIE":n?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Número de documento"}),w&&p?e.jsx(c,{value:u.idNumber,onChange:a=>C({...u,idNumber:a.target.value}),placeholder:"Documento de identificación",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Fecha de nacimiento"}),w&&p?e.jsx(c,{type:"date",value:u.birthDate,onChange:a=>C({...u,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Actividad profesional"}),w&&p?e.jsxs(z,{value:u.businessActivity,onValueChange:a=>C({...u,businessActivity:a}),children:[e.jsx(E,{className:"rounded-full h-11 md:h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",style:{fontSize:"16px"},"data-testid":"select-activity",children:e.jsx(P,{placeholder:"A qué te dedicas"})}),e.jsxs(A,{position:"popper",className:"max-h-[50vh]",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección de residencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de vía"}),w&&p?e.jsxs(z,{value:u.streetType,onValueChange:a=>C({...u,streetType:a}),children:[e.jsx(E,{className:"rounded-full h-11 md:h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",style:{fontSize:"16px"},"data-testid":"select-street-type",children:e.jsx(P,{placeholder:"Calle · Avenida · Paseo · Plaza"})}),e.jsxs(A,{position:"popper",className:"max-h-[50vh]",children:[e.jsx(l,{value:"calle",children:"Calle"}),e.jsx(l,{value:"avenida",children:"Avenida"}),e.jsx(l,{value:"paseo",children:"Paseo"}),e.jsx(l,{value:"plaza",children:"Plaza"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Dirección"}),w&&p?e.jsx(c,{value:u.address,onChange:a=>C({...u,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Ciudad"}),w&&p?e.jsx(c,{value:u.city,onChange:a=>C({...u,city:a.target.value}),placeholder:"Ciudad de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"Provincia"}),w&&p?e.jsx(c,{value:u.province,onChange:a=>C({...u,province:a.target.value}),placeholder:"Provincia o región",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"C.P."}),w&&p?e.jsx(c,{value:u.postalCode,onChange:a=>C({...u,postalCode:a.target.value}),placeholder:"Código postal",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs font-bold text-muted-foreground",children:"País"}),w&&p?e.jsx(c,{value:u.country,onChange:a=>C({...u,country:a.target.value}),placeholder:"País de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:n?.country||"-"})]})]})]}),w&&p&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(t,{onClick:()=>{cs.mutate(u),R(!1)},className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",disabled:cs.isPending,"data-testid":"button-save-profile",children:"Guardar cambios"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto."})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(pt,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!es&&e.jsx(t,{variant:"outline",className:"rounded-full",onClick:()=>sa(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),es&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-xl",children:[as==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Contraseña actual"}),e.jsx(c,{type:"password",value:ra,onChange:a=>na(a.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(c,{type:"password",value:J,onChange:a=>da(a.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(c,{type:"password",value:Ie,onChange:a=>ia(a.target.value),"data-testid":"input-confirm-password"})]}),J&&Ie&&J!==Ie&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{sa(!1),na(""),da(""),ia("")},children:"Cancelar"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Aa.mutate(),disabled:!ra||!J||J!==Ie||J.length<8||Aa.isPending,"data-testid":"button-request-otp",children:Aa.isPending?"Enviando...":"Enviar código"})]})]}),as==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(Oa,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Código de verificación"}),e.jsx(c,{type:"text",value:la,onChange:a=>ca(a.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{ta("form"),ca("")},children:"Volver"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Ta.mutate({currentPassword:ra,newPassword:J,otp:la}),disabled:la.length!==6||Ta.isPending,"data-testid":"button-save-password",children:Ta.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(lt,{mode:"connect",googleConnected:!!n?.googleId,onSuccess:()=>j.refetchQueries({queryKey:["/api/auth/user"]})})]}),p&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>aa(!0),"data-testid":"button-delete-own-account",children:[e.jsx(ks,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})},"profile"),v==="admin"&&n?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2 mb-4 md:mb-6",children:["dashboard","orders","users","calendar","docs","newsletter","inbox","descuentos"].map(a=>e.jsxs(t,{variant:Q===a?"default":"outline",onClick:()=>Is(a),className:"rounded-full text-[10px] md:text-xs font-black capitalize px-2 md:px-3","data-testid":`button-admin-tab-${a}`,children:[e.jsx("span",{className:"hidden sm:inline",children:a==="dashboard"?"Métricas":a==="calendar"?"Fechas":a==="orders"?"Pedidos":a==="users"?"Clientes":a==="docs"?"Documentos":a==="descuentos"?"Descuentos":a}),e.jsx("span",{className:"sm:hidden flex items-center justify-center",children:a==="dashboard"?e.jsx(Zs,{className:"w-5 h-5"}):a==="calendar"?e.jsx(Ne,{className:"w-5 h-5"}):a==="orders"?e.jsx($a,{className:"w-5 h-5"}):a==="users"?e.jsx(et,{className:"w-5 h-5"}):a==="docs"?e.jsx(X,{className:"w-5 h-5"}):a==="newsletter"?e.jsx(Oa,{className:"w-5 h-5"}):a==="descuentos"?e.jsx(at,{className:"w-5 h-5"}):e.jsx(qa,{className:"w-5 h-5"})})]},a))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>ze(!0),"data-testid":"button-create-user",children:[e.jsx(Ma,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Ee(!0),"data-testid":"button-create-order",children:[e.jsx(Ma,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),Q==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((S?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((S?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:S?.orderCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[S?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:S?.pendingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:S?.processingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:S?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:S?.userCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:S?.activeAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:S?.vipAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:S?.pendingAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:S?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:S?.subscriberCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:S?.totalMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:S?.pendingMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:S?.pendingDocs||0})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[10px] text-muted-foreground pt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Actualización en tiempo real cada 10 segundos"})]})]}),Q==="orders"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:Me?.map(a=>{const s=a.application||a.maintenanceApplication,f=!!a.maintenanceApplication&&!a.application,y=s?.requestCode||a.invoiceNumber,Qe=s?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:y}),e.jsx(D,{className:`text-[9px] ${f?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:f?"MANTENIMIENTO":"LLC"}),!Qe&&e.jsx(D,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:s?.ownerFullName||`${a.user?.firstName||""} ${a.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?.ownerEmail||a.user?.email}),s?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",s?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",s?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",a.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(a.amount/100).toFixed(2),"€",a.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",a.discountCode," -",(a.discountAmount/100).toFixed(2),"€)"]})]}),s?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",s.businessCategory]}),f&&s?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",s.ein]})]}),e.jsxs(z,{value:a.status,onValueChange:La=>Vs.mutate({id:a.id,status:La}),children:[e.jsx(E,{className:"w-28 h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border",children:e.jsx(P,{})}),e.jsxs(A,{children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"paid",children:"Pagado"}),e.jsx(l,{value:"filed",children:"Presentado"}),e.jsx(l,{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${a.id}`,"_blank"),"data-testid":`btn-view-invoice-${a.id}`,children:"Ver Factura"}),e.jsx(t,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{hs(((a.amount||0)/100).toFixed(2)),gs("EUR"),Ke({open:!0,order:a})},"data-testid":`btn-generate-invoice-${a.id}`,children:"Generar Factura"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Ve({open:!0,order:a}),"data-testid":`btn-delete-order-${a.id}`,children:"Eliminar"})]})]},a.id)})})}),Q==="users"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:ms?.map(a=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsx(D,{variant:a.accountStatus==="active"||a.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${a.accountStatus==="deactivated"?"bg-red-100 text-red-700":a.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":a.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:a.accountStatus==="active"?"VERIFICADO":a.accountStatus==="pending"?"EN REVISIÓN":a.accountStatus==="deactivated"?"DESACTIVADA":a.accountStatus==="vip"?"VIP":"VERIFICADO"}),a.isAdmin&&e.jsx(D,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.phone&&e.jsx("span",{className:"mr-2",children:a.phone}),a.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",a.businessActivity]}),a.city&&e.jsxs("span",{children:["• ",a.city]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(r,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(z,{value:a.accountStatus||"active",onValueChange:s=>a.id&&Re.mutate({id:a.id,accountStatus:s}),children:[e.jsx(E,{className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm",children:e.jsx(P,{})}),e.jsxs(A,{children:[e.jsx(l,{value:"active",children:"Verificado"}),e.jsx(l,{value:"pending",children:"En revisión"}),e.jsx(l,{value:"deactivated",children:"Desactivada"}),e.jsx(l,{value:"vip",children:"VIP"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>b(a),"data-testid":`button-edit-user-${a.id}`,children:"Editar"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>Se({open:!0,user:a}),"data-testid":`button-note-user-${a.id}`,children:"Mensaje"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>we({open:!0,user:a}),"data-testid":`button-doc-user-${a.id}`,children:"Docs"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>De({open:!0,user:a}),"data-testid":`button-invoice-user-${a.id}`,children:"Factura"}),e.jsx(t,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>Fe({open:!0,user:a}),"data-testid":`button-payment-link-${a.id}`,children:"Pago"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Ae({open:!0,user:a}),"data-testid":`button-delete-user-${a.id}`,children:"Eliminar"})]})]},a.id))})}),Q==="calendar"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[Me?.map(a=>{const s=a.application;if(!s)return null;const f=s?.requestCode||a.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:s.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",s.state]})]}),e.jsx(D,{variant:"outline",className:"text-xs w-fit",children:f})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.llcCreatedDate?new Date(s.llcCreatedDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"llcCreatedDate",value:y.target.value}),"data-testid":`input-llc-created-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.agentRenewalDate?new Date(s.agentRenewalDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"agentRenewalDate",value:y.target.value}),"data-testid":`input-agent-renewal-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs1120DueDate?new Date(s.irs1120DueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"irs1120DueDate",value:y.target.value}),"data-testid":`input-irs1120-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs5472DueDate?new Date(s.irs5472DueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"irs5472DueDate",value:y.target.value}),"data-testid":`input-irs5472-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(r,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.annualReportDueDate?new Date(s.annualReportDueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"annualReportDueDate",value:y.target.value}),"data-testid":`input-annual-report-${s.id}`})]})]})]},a.id)}),(!Me||Me.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),Q==="docs"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black text-lg",children:"Documentos de Clientes"}),e.jsxs(D,{className:"bg-accent/20 text-accent",children:[Ue?.length||0," docs"]})]}),e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[Ue?.map(a=>e.jsxs("div",{className:"py-3 flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:a.fileName}),e.jsx(D,{variant:"outline",className:`text-[9px] ${a.reviewStatus==="approved"?"bg-green-100 text-green-700":a.reviewStatus==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:a.reviewStatus==="approved"?"Aprobado":a.reviewStatus==="rejected"?"Rechazado":"Pendiente"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",a.user?.email]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.application?.companyName&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"LLC:"})," ",a.application.companyName," • "]}),e.jsx("strong",{children:"Tipo:"})," ",a.documentType||"Documento"," •",e.jsx("strong",{children:" Fecha:"})," ",a.uploadedAt?new Date(a.uploadedAt).toLocaleDateString("es-ES"):"-"]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[a.fileUrl&&e.jsx(t,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`btn-view-doc-${a.id}`,children:e.jsx(st,{className:"w-4 h-4"})}),e.jsxs(z,{value:a.reviewStatus||"pending",onValueChange:async s=>{try{await g("PATCH",`/api/admin/documents/${a.id}/review`,{reviewStatus:s}),j.invalidateQueries({queryKey:["/api/admin/documents"]}),d({title:"Estado actualizado"})}catch{d({title:"Error",variant:"destructive"})}},children:[e.jsx(E,{className:"h-8 w-24 text-[10px] rounded-full",children:e.jsx(P,{})}),e.jsxs(A,{children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"approved",children:"Aprobar"}),e.jsx(l,{value:"rejected",children:"Rechazar"})]})]})]})]},a.id)),(!Ue||Ue.length===0)&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30"}),"No hay documentos subidos por clientes"]})]})]}),Q==="newsletter"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-accent/10 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Enviar a todos los suscriptores (",fe?.length||0,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{value:va,onChange:a=>us(a.target.value),placeholder:"Asunto del email",className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-subject"}),e.jsx(Y,{value:ya,onChange:a=>ps(a.target.value),placeholder:"Contenido del mensaje",rows:4,className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-message"}),e.jsx(t,{onClick:()=>wa.mutate({subject:va,message:ya}),disabled:!va||!ya||wa.isPending,className:"w-full rounded-full","data-testid":"button-send-broadcast",children:wa.isPending?"Enviando...":`Enviar a ${fe?.length||0} suscriptores`})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm mb-3",children:"Lista de Suscriptores"}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[fe?.map(a=>e.jsxs("div",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:a.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.subscribedAt?new Date(a.subscribedAt).toLocaleDateString("es-ES"):""})]},a.id)),(!fe||fe.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})]})}),Q==="inbox"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[ja?.map(a=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>ga(Oe?.id===a.id?null:a),"data-testid":`inbox-message-${a.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.email," ",a.phone&&`• ${a.phone}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"outline",className:"text-[10px]",children:a.messageId||a.id}),e.jsx(D,{variant:"secondary",className:"text-[10px]",children:a.status||"pendiente"})]})]}),e.jsx("p",{className:"text-xs font-medium",children:a.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.message}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:a.replies.map(s=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${s.isAdmin?"text-accent":"text-muted-foreground"}`,children:[s.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:s.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:s.createdAt&&new Date(s.createdAt).toLocaleString("es-ES")})]},s.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.createdAt?new Date(a.createdAt).toLocaleString("es-ES"):""}),Oe?.id===a.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:s=>s.stopPropagation(),children:[e.jsx(Y,{value:ge,onChange:s=>ba(s.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(t,{onClick:()=>be.mutate(a.id),disabled:!ge.trim()||be.isPending,className:"bg-accent text-primary font-black rounded-full px-6","data-testid":"button-send-admin-reply",children:[be.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},a.id)),(!ja||ja.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),Q==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{V({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),ue({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(Ma,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[Na?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${a.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.code}),e.jsx(D,{variant:a.isActive?"default":"secondary",className:"text-[10px]",children:a.isActive?"Activo":"Inactivo"}),e.jsx(D,{variant:"outline",className:"text-[10px]",children:a.discountType==="percentage"?`${a.discountValue}%`:`${(a.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",a.usedCount,a.maxUses?`/${a.maxUses}`:""," veces",a.minOrderAmount&&` | Min: ${(a.minOrderAmount/100).toFixed(2)}€`]}),(a.validFrom||a.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.validFrom&&`Desde: ${new Date(a.validFrom).toLocaleDateString("es-ES")}`,a.validFrom&&a.validUntil&&" - ",a.validUntil&&`Hasta: ${new Date(a.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{V({code:a.code,discountType:a.discountType,discountValue:a.discountValue.toString(),minOrderAmount:a.minOrderAmount?(a.minOrderAmount/100).toString():"",maxUses:a.maxUses?.toString()||"",validFrom:a.validFrom?a.validFrom.split("T")[0]:"",validUntil:a.validUntil?a.validUntil.split("T")[0]:"",isActive:a.isActive}),ue({open:!0,code:a})},"data-testid":`button-edit-discount-${a.code}`,children:e.jsx(rt,{className:"w-3 h-3"})}),e.jsx(t,{variant:"outline",size:"sm",className:`rounded-full text-xs ${a.isActive?"text-red-600":"text-green-600"}`,onClick:async()=>{try{await g("PATCH",`/api/admin/discount-codes/${a.id}`,{isActive:!a.isActive}),xs(),d({title:a.isActive?"Código desactivado":"Código activado"})}catch{d({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${a.code}`,children:a.isActive?e.jsx(Cs,{className:"w-3 h-3"}):e.jsx(Ss,{className:"w-3 h-3"})})]})]},a.id)),(!Na||Na.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary mb-6 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("div",{className:"space-y-5",children:h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-zinc-800 rounded-xl p-3 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] font-bold text-accent uppercase tracking-wider mb-0.5",children:["Pedido: ",h[0]?.application?.requestCode||h[0]?.maintenanceApplication?.requestCode||h[0]?.invoiceNumber||h[0]?.id]}),e.jsx("p",{className:"text-sm font-black text-primary truncate",children:h[0]?.maintenanceApplication?`Mantenimiento ${h[0]?.maintenanceApplication?.state||""}`:h[0]?.application?.companyName?`${h[0]?.application?.companyName} LLC`:h[0]?.product?.name||"LLC"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:h[0]?.application?.state||h[0]?.maintenanceApplication?.state||""})]}),e.jsx(D,{className:`${He(h[0]?.status).className} font-bold text-[9px] shrink-0`,children:He(h[0]?.status).label})]}),e.jsxs("p",{className:"text-[9px] text-muted-foreground mt-2",children:["Creado: ",h[0]?.createdAt?new Date(h[0].createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"]})]}),qe&&qe.length>0?qe.map((a,s)=>e.jsxs("div",{className:"flex gap-4 relative",children:[s<qe.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-black text-primary truncate",children:a.eventType}),a.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(a.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.description})]})]},a.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ds,{className:"w-8 h-8 text-gray-200 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay pedidos activos"})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-black text-primary mb-3",children:"¿Necesitas ayuda?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Nuestro equipo de expertos está listo para resolver tus dudas."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",children:e.jsx(t,{className:"w-full bg-accent text-primary font-black rounded-full py-5",children:"Contactar Soporte"})})]})]})]})]}),n?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(L,{open:Ce.open,onOpenChange:a=>Se({open:a,user:a?Ce.user:null}),children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Enviar Mensaje al Cliente"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Título"}),e.jsx(c,{value:Je,onChange:a=>Ba(a.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(Y,{value:Xe,onChange:a=>Ga(a.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs(q,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Se({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>Ce.user?.id&&ne.mutate({userId:Ce.user.id,title:Je,message:Xe,type:Ls}),disabled:!Je||!Xe||ne.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-note",children:ne.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(L,{open:!!m,onOpenChange:a=>!a&&b(null),children:e.jsxs(I,{className:"sm:max-w-lg bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Editar Usuario"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),m&&e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:m.firstName||"",onChange:a=>b({...m,firstName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:m.lastName||"",onChange:a=>b({...m,lastName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{value:m.email||"",onChange:a=>b({...m,email:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:m.phone||"",onChange:a=>b({...m,phone:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo ID"}),e.jsxs(z,{value:m.idType||"",onValueChange:a=>b({...m,idType:a}),children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(P,{placeholder:"Seleccionar"})}),e.jsxs(A,{className:"rounded-xl",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Número ID"}),e.jsx(c,{value:m.idNumber||"",onChange:a=>b({...m,idNumber:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Fecha Nacimiento"}),e.jsx(c,{type:"date",value:m.birthDate||"",onChange:a=>b({...m,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Actividad de Negocio"}),e.jsxs(z,{value:m.businessActivity||"",onValueChange:a=>b({...m,businessActivity:a}),children:[e.jsx(E,{className:"rounded-full h-11 md:h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",style:{fontSize:"16px"},"data-testid":"select-edit-activity",children:e.jsx(P,{placeholder:"Seleccionar actividad"})}),e.jsxs(A,{position:"popper",className:"max-h-[50vh] rounded-xl",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Dirección"}),e.jsx(c,{value:m.address||"",onChange:a=>b({...m,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Ciudad"}),e.jsx(c,{value:m.city||"",onChange:a=>b({...m,city:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Código Postal"}),e.jsx(c,{value:m.postalCode||"",onChange:a=>b({...m,postalCode:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Provincia"}),e.jsx(c,{value:m.province||"",onChange:a=>b({...m,province:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"País"}),e.jsx(c,{value:m.country||"",onChange:a=>b({...m,country:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(Y,{value:m.internalNotes||"",onChange:a=>b({...m,internalNotes:a.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>b(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>m.id&&Re.mutate({id:m.id,...m}),disabled:Re.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-user",children:Re.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})]})}),e.jsx(L,{open:se.open,onOpenChange:a=>Ae({open:a,user:a?se.user:null}),children:e.jsxs(I,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(F,{children:e.jsx($,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[se.user?.firstName," ",se.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ae({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>se.user?.id&&ka.mutate(se.user.id),disabled:ka.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:ka.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(L,{open:_.open,onOpenChange:a=>Ve({open:a,order:a?_.order:null}),children:e.jsxs(I,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(F,{children:e.jsx($,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:_.order?.application?.requestCode||_.order?.maintenanceApplication?.requestCode||_.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",_.order?.user?.firstName," ",_.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ve({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>_.order?.id&&Sa.mutate(_.order.id),disabled:Sa.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:Sa.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(L,{open:de.open,onOpenChange:a=>Ke({open:a,order:a?de.order:null}),children:e.jsxs(I,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(F,{children:e.jsx($,{className:"text-xl font-black text-primary",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:de.order?.application?.requestCode||de.order?.maintenanceApplication?.requestCode||de.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",step:"0.01",value:ie,onChange:a=>hs(a.target.value),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Divisa"}),e.jsxs(z,{value:Ca,onValueChange:gs,children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(P,{placeholder:"Seleccionar divisa"})}),e.jsxs(A,{className:"rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR (€)"}),e.jsx(l,{value:"USD",children:"USD ($)"})]})]})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>Ke({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full",disabled:!ie||isNaN(parseFloat(ie))||parseFloat(ie)<=0,onClick:async()=>{try{const a=Math.round(parseFloat(ie)*100);if(a<=0){d({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}await g("POST",`/api/admin/orders/${de.order?.id}/generate-invoice`,{amount:a,currency:Ca}),d({title:"Factura generada",description:`Factura creada por ${ie} ${Ca}`}),j.invalidateQueries({queryKey:["/api/admin/orders"]}),Ke({open:!1,order:null})}catch{d({title:"Error",description:"No se pudo generar la factura",variant:"destructive"})}},"data-testid":"button-confirm-generate-invoice",children:"Generar Factura"})]})]})}),e.jsx(L,{open:me.open,onOpenChange:a=>we({open:a,user:a?me.user:null}),children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Solicitar Documentos"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:ke,onValueChange:Ka,children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:e.jsx(P,{placeholder:"Seleccionar tipo..."})}),e.jsxs(A,{className:"rounded-xl",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(Y,{value:Qa,onChange:a=>_a(a.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>we({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>{if(me.user?.id&&me.user?.email){const s={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[ke]||ke;ne.mutate({userId:me.user.id,title:`Solicitud de Documento: ${s}`,message:Qa||`Por favor, sube tu ${s} a tu panel de cliente.`,type:"action_required"}),we({open:!1,user:null}),Ka(""),_a("")}},disabled:!ke||ne.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-request-doc",children:ne.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(L,{open:Z.open,onOpenChange:a=>De({open:a,user:a?Z.user:null}),children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Crear Factura"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[Z.user?.firstName," ",Z.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Concepto"}),e.jsx(c,{value:Ze,onChange:a=>Ha(a.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",value:ea,onChange:a=>Wa(a.target.value),placeholder:"739",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Moneda"}),e.jsxs(z,{value:Ya,onValueChange:Ja,children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-invoice-currency",children:e.jsx(P,{})}),e.jsxs(A,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR"}),e.jsx(l,{value:"USD",children:"USD"})]})]})]})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>De({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>Z.user?.id&&Da.mutate({userId:Z.user.id,concept:Ze,amount:Math.round(parseFloat(ea)*100),currency:Ya}),disabled:!Ze||!ea||Da.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-create-invoice",children:Da.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(L,{open:Os,onOpenChange:aa,children:e.jsxs(I,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(F,{children:e.jsx($,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>aa(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>Pa.mutate(),disabled:Pa.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:Pa.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(L,{open:te.open,onOpenChange:a=>{a||Te({open:!1,file:null})},children:e.jsxs(I,{className:"max-w-[calc(100vw-2rem)] sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-auto",children:[e.jsx(F,{children:e.jsx($,{className:"text-lg sm:text-xl font-black text-primary",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[te.file&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex items-center gap-3",children:[e.jsx(ve,{className:"w-7 h-7 sm:w-8 sm:h-8 text-accent shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm truncate",children:te.file.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:[(te.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:xe,onValueChange:Xa,children:[e.jsx(E,{className:"w-full rounded-full h-11 sm:h-12 px-4 sm:px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-sm",style:{fontSize:"16px"},"data-testid":"select-upload-doc-type",children:e.jsx(P,{})}),e.jsxs(A,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl max-h-[50vh]",position:"popper",sideOffset:4,children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),xe==="other"&&e.jsxs("div",{children:[e.jsx(r,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Descripción del documento"}),e.jsx(Y,{value:Le,onChange:a=>Za(a.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent text-base",style:{fontSize:"16px"},"data-testid":"input-upload-notes"})]})]}),e.jsxs(q,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Te({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!te.file)return;const a=new FormData;a.append("file",te.file),a.append("documentType",xe),xe==="other"&&Le&&a.append("notes",Le);try{const s=await fetch("/api/user/documents/upload",{method:"POST",body:a,credentials:"include"});if(s.ok)d({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),j.invalidateQueries({queryKey:["/api/user/documents"]}),Te({open:!1,file:null});else{const f=await s.json();d({title:"Error",description:f.message||"No se pudo subir el documento",variant:"destructive"})}}catch{d({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:xe==="other"&&!Le.trim(),className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(L,{open:Fs,onOpenChange:ze,children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Crear Nuevo Cliente"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:G.firstName,onChange:a=>ee(s=>({...s,firstName:a.target.value})),placeholder:"Nombre",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:G.lastName,onChange:a=>ee(s=>({...s,lastName:a.target.value})),placeholder:"Apellidos",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{type:"email",value:G.email,onChange:a=>ee(s=>({...s,email:a.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:G.phone,onChange:a=>ee(s=>({...s,phone:a.target.value})),placeholder:"+34 600 000 000",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Contraseña"}),e.jsx(c,{type:"password",value:G.password,onChange:a=>ee(s=>({...s,password:a.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-password"})]})]}),e.jsxs(q,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ze(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(t,{onClick:()=>za.mutate(G),disabled:za.isPending||!G.email||!G.password,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-user",children:za.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(L,{open:$s,onOpenChange:Ee,children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:"Crear Nuevo Pedido"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Cliente"}),e.jsxs(z,{value:ae.userId,onValueChange:a=>Pe(s=>({...s,userId:a})),children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-user",children:e.jsx(P,{placeholder:"Seleccionar cliente..."})}),e.jsx(A,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:ms?.map(a=>e.jsxs(l,{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Estado (LLC)"}),e.jsxs(z,{value:ae.state,onValueChange:a=>Pe(s=>({...s,state:a})),children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-state",children:e.jsx(P,{})}),e.jsxs(A,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(l,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(l,{value:"Delaware",children:"Delaware - 1199€"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Importe (€)"}),e.jsx(c,{type:"number",value:ae.amount,onChange:a=>Pe(s=>({...s,amount:a.target.value})),placeholder:"739",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-order-amount"})]})]}),e.jsxs(q,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ee(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(t,{onClick:()=>Ea.mutate(ae),disabled:Ea.isPending||!ae.userId||!ae.amount,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-order",children:Ea.isPending?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(L,{open:H.open,onOpenChange:a=>ue({open:a,code:a?H.code:null}),children:e.jsxs(I,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black text-primary",children:H.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(B,{className:"text-sm text-muted-foreground",children:H.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Código"}),e.jsx(c,{value:N.code,onChange:a=>V(s=>({...s,code:a.target.value.toUpperCase()})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base uppercase",disabled:!!H.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo"}),e.jsxs(z,{value:N.discountType,onValueChange:a=>V(s=>({...s,discountType:a})),children:[e.jsx(E,{className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-discount-type",children:e.jsx(P,{})}),e.jsxs(A,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(l,{value:"fixed",children:"Fijo (centimos)"})]})]})]}),e.jsxs("div",{children:[e.jsxs(r,{className:"text-sm font-black text-primary mb-2 block",children:["Valor ",N.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(c,{type:"number",value:N.discountValue,onChange:a=>V(s=>({...s,discountValue:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(c,{type:"number",value:N.minOrderAmount,onChange:a=>V(s=>({...s,minOrderAmount:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Usos max."}),e.jsx(c,{type:"number",value:N.maxUses,onChange:a=>V(s=>({...s,maxUses:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Válido desde"}),e.jsx(c,{type:"date",value:N.validFrom,onChange:a=>V(s=>({...s,validFrom:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary mb-2 block",children:"Válido hasta"}),e.jsx(c,{type:"date",value:N.validUntil,onChange:a=>V(s=>({...s,validUntil:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ts,{checked:N.isActive,onCheckedChange:a=>V(s=>({...s,isActive:a})),"data-testid":"switch-discount-active"}),e.jsx(r,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs(q,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ue({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{try{const a={code:N.code,discountType:N.discountType,discountValue:parseInt(N.discountValue),minOrderAmount:N.minOrderAmount?parseInt(N.minOrderAmount)*100:null,maxUses:N.maxUses?parseInt(N.maxUses):null,validFrom:N.validFrom||null,validUntil:N.validUntil||null,isActive:N.isActive};H.code?(await g("PATCH",`/api/admin/discount-codes/${H.code.id}`,a),d({title:"Código actualizado"})):(await g("POST","/api/admin/discount-codes",a),d({title:"Código creado"})),xs(),ue({open:!1,code:null})}catch(a){d({title:"Error",description:a.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!N.code||!N.discountValue,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-discount",children:H.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(L,{open:qs,onOpenChange:a=>{ua(a),a||pa("")},children:e.jsxs(I,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(B,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Código de verificación"}),e.jsx(c,{value:he,onChange:a=>pa(a.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(t,{onClick:async()=>{if(!he||he.length<6){d({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}ds(!0);try{(await(await g("POST","/api/auth/verify-email",{code:he})).json()).success&&(await j.refetchQueries({queryKey:["/api/auth/user"]}),d({title:"Email verificado correctamente"}),ua(!1),pa(""))}catch(a){d({title:"Código incorrecto",description:a.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{ds(!1)}},disabled:ns||he.length<6,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full","data-testid":"button-verify-email-code",children:ns?e.jsx(W,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(t,{variant:"link",onClick:async()=>{ls(!0);try{await g("POST","/api/auth/resend-verification"),d({title:"Código enviado",description:"Revisa tu email"})}catch{d({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{ls(!1)}},disabled:is,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:is?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(L,{open:re.open,onOpenChange:a=>{Fe({open:a,user:a?re.user:null}),a||(oa(""),ma(""),xa(""))},children:e.jsxs(I,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(B,{children:["Envía un enlace de pago a ",re.user?.firstName," ",re.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Link de pago (URL)"}),e.jsx(c,{value:$e,onChange:a=>oa(a.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Importe"}),e.jsx(c,{value:pe,onChange:a=>ma(a.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-black text-primary block mb-2",children:"Mensaje (opcional)"}),e.jsx(Y,{value:ss,onChange:a=>xa(a.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Fe({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!$e||!pe){d({title:"Completa todos los campos requeridos",variant:"destructive"});return}rs(!0);try{await g("POST","/api/admin/send-payment-link",{userId:re.user?.id,paymentLink:$e,amount:pe,message:ss||`Por favor, completa el pago de ${pe} a través del siguiente enlace.`}),d({title:"Link de pago enviado",description:`Se ha enviado el link a ${re.user?.email}`}),Fe({open:!1,user:null}),oa(""),ma(""),xa("")}catch(a){d({title:"Error",description:a.message||"No se pudo enviar el link",variant:"destructive"})}finally{rs(!1)}},disabled:ts||!$e||!pe,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-payment-link",children:ts?e.jsx(W,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(Es,{})]})}export{It as default};
