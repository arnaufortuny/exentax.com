import{m as We,n as oe,o as ie,F as J,W as Ts,B as Je,j as e,d as Ws,a as i,P as $a,p as vs,q as qa,s as Ne,U as Js,t as Xs,u as Oa,v as ys,X as Ys,w as ve,x as ye,k as ws,T as ks,y as Cs,z as Zs,N as et,A as Ss,G as Ds,H as zs,I as at,J as st,K as tt,O as Ua,l as Es,i as G,Q as rt,V as dt}from"./react-core-p7YyF6vR.js";import{u as nt,a as it,N as Ps,b as g,F as As,L as we,q as b}from"./index-CCtl2xKT.js";import{b as w,a as I}from"./tanstack-DVe02hPk.js";import{C as o,n as le,o as ce,a as Q,P as lt,u as Ls,B as t,p as C,l as B,q as d,I as c,N as z,m as l,D as P,r as A,s as T,t as L,v as K,w as $,x as Is}from"./ui-components-Bqw0aieC.js";import{S as ct}from"./social-login-a7lp6-ya.js";import{u as ot}from"./i18n-CV4rwLkE.js";import"./react-dom-BHx6s4rw.js";import"./radix-ui-DeWB3EnY.js";import"./forms-CeqqJY6Z.js";const mt=x=>[{id:"pending",label:x("progress.orderReceived"),icon:We,description:x("progress.orderRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:oe,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.processing"),icon:ie,description:x("progress.preparingDocs")},{id:"filed",label:x("progress.filed"),icon:J,description:x("progress.docsSent")},{id:"completed",label:x("progress.llcActive"),icon:Je,description:x("progress.llcOperational")}],xt=x=>[{id:"pending",label:x("progress.requestReceived"),icon:We,description:x("progress.requestRegistered")},{id:"paid",label:x("progress.paymentConfirmed"),icon:oe,description:x("progress.paymentProcessed")},{id:"processing",label:x("progress.inProcess"),icon:ie,description:x("progress.managingRenewal")},{id:"filed",label:x("progress.filed"),icon:J,description:x("progress.docsUpdated")},{id:"completed",label:x("progress.completed"),icon:Ts,description:x("progress.maintenanceComplete")}],ut=["pending","paid","processing","filed","documents_ready","completed"];function pt({status:x,serviceName:r,state:F,requestCode:R,isMaintenance:v=!1}){const{t:q}=ot(),k=v?xt(q):mt(q),O=ut.indexOf(x),u=O>=0?Math.min((O+1)/k.length*100,100):0,S=p=>x==="cancelled"?"cancelled":O<0?"pending":p<O||p===O&&x==="completed"?"completed":p===O?"current":"pending",n={new_mexico:"New Mexico",wyoming:"Wyoming",delaware:"Delaware","New Mexico":"New Mexico",Wyoming:"Wyoming",Delaware:"Delaware"};return x==="cancelled"?e.jsxs(o,{className:"border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900","data-testid":"widget-cancelled",children:[e.jsx(le,{className:"pb-2 p-3 md:p-4",children:e.jsxs(ce,{className:"text-sm md:text-base flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(Ws,{className:"h-4 w-4"}),q("progress.cancelled")]})}),e.jsx(Q,{className:"p-3 pt-0 md:p-4 md:pt-0",children:e.jsx("p",{className:"text-xs md:text-sm text-red-600 dark:text-red-400",children:q("progress.cancelledMessage")})})]}):e.jsxs(o,{className:"overflow-hidden","data-testid":`widget-progress-${v?"maintenance":"llc"}`,children:[e.jsxs(le,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs(ce,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[v?e.jsx(Ts,{className:"h-4 w-4 md:h-5 md:w-5 text-accent"}):e.jsx(Je,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{className:"truncate max-w-[180px] md:max-w-none",children:r||q(v?"progress.maintenance":"progress.yourLLC")})]}),F&&e.jsx("span",{className:"text-[10px] md:text-xs bg-muted px-2 py-0.5 md:py-1 rounded-md font-medium shrink-0",children:n[F]||F})]}),R&&e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:[q("progress.reference"),": ",R]})]}),e.jsxs(Q,{className:"p-3 md:p-4 space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 md:space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] md:text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:q("progress.progressLabel")}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(u),"%"]})]}),e.jsx(lt,{value:u,className:"h-1.5 md:h-2"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-[9px] md:left-[11px] top-5 md:top-6 bottom-5 md:bottom-6 w-0.5 bg-border"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:k.map((p,m)=>{const f=S(m),Ma=p.icon;return e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 relative",children:[e.jsx("div",{className:`
                    relative z-10 flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full border-2 transition-colors shrink-0
                    ${f==="completed"?"bg-primary border-primary text-primary-foreground":f==="current"?"bg-primary/10 border-primary text-primary animate-pulse":"bg-background border-muted-foreground/30 text-muted-foreground"}
                  `,children:f==="completed"?e.jsx(oe,{className:"h-2.5 w-2.5 md:h-3.5 md:w-3.5"}):e.jsx(Ma,{className:"h-2.5 w-2.5 md:h-3 md:w-3"})}),e.jsxs("div",{className:"flex-1 min-w-0 pb-1 md:pb-2",children:[e.jsx("p",{className:`text-xs md:text-sm font-medium leading-tight ${f==="completed"?"text-foreground":f==="current"?"text-primary font-bold":"text-muted-foreground"}`,children:p.label}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5 leading-tight hidden sm:block",children:p.description})]})]},p.id)})})]})]})]})}function Be(x){return{pending:{label:"Pendiente",className:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300"},paid:{label:"Pagado",className:"bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300"},processing:{label:"En Proceso",className:"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300"},completed:{label:"Completado",className:"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"},cancelled:{label:"Cancelado",className:"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-300"},draft:{label:"Borrador",className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}[x]||{label:x,className:"bg-gray-100 dark:bg-zinc-700 text-gray-600 dark:text-gray-300"}}function ht(){const{toast:x}=Ls(),{data:r,isLoading:F}=I({queryKey:["/api/newsletter/status"]}),R=w({mutationFn:async v=>{await g("POST",v?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",v?{email:void 0}:void 0)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/newsletter/status"]}),x({title:"Preferencias actualizadas",description:"Gracias por quedarte con nosotros"})}});return F?e.jsx("div",{className:"w-10 h-6 bg-gray-100 dark:bg-zinc-700 animate-pulse rounded-full"}):e.jsx(Is,{checked:r?.isSubscribed,onCheckedChange:v=>R.mutate(v),disabled:R.isPending})}function Ft(){const[,x]=nt(),{user:r,isAuthenticated:F,isLoading:R}=it(),[v,q]=i.useState("services"),[k,O]=i.useState(!1),[u,S]=i.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:n}=Ls(),p=r?.accountStatus==="active"||r?.accountStatus==="vip",[m,f]=i.useState(null),[Ma,gt]=i.useState({open:!1,user:null}),[bt,ft]=i.useState(""),[jt,Nt]=i.useState(""),[vt,yt]=i.useState(""),[me,ke]=i.useState({open:!1,user:null}),[Ce,Ra]=i.useState(""),[Va,Ka]=i.useState(""),[Se,De]=i.useState({open:!1,user:null}),[Xe,Qa]=i.useState(""),[Ye,_a]=i.useState(""),[Fs,wt]=i.useState("info"),[X,ze]=i.useState({open:!1,user:null}),[Ze,Ha]=i.useState(""),[ea,Ga]=i.useState(""),[Ba,Wa]=i.useState("EUR"),[U,$s]=i.useState("dashboard"),[qs,Ee]=i.useState(!1),[_,Y]=i.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[Os,Pe]=i.useState(!1),[Z,Ae]=i.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[ee,Te]=i.useState({open:!1,user:null}),[Us,aa]=i.useState(!1),[ae,Le]=i.useState({open:!1,file:null}),[xe,Ja]=i.useState("passport"),[Ie,Xa]=i.useState(""),[Ya,sa]=i.useState(!1),[Za,ta]=i.useState("form"),[ra,da]=i.useState(""),[W,na]=i.useState(""),[Fe,ia]=i.useState(""),[la,ca]=i.useState(""),[H,ue]=i.useState({open:!1,code:null}),[se,$e]=i.useState({open:!1,user:null}),[qe,oa]=i.useState(""),[pe,ma]=i.useState(""),[es,xa]=i.useState(""),[as,ss]=i.useState(!1),[Ms,ua]=i.useState(!1),[he,pa]=i.useState(""),[ts,rs]=i.useState(!1),[ds,ns]=i.useState(!1),[N,M]=i.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});i.useEffect(()=>{r&&S({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",businessActivity:r.businessActivity||"",address:r.address||"",streetType:r.streetType||"",city:r.city||"",province:r.province||"",postalCode:r.postalCode||"",country:r.country||"",idNumber:r.idNumber||"",idType:r.idType||"",birthDate:r.birthDate||""})},[r]);const is=w({mutationFn:async a=>{if(!p)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");await g("PATCH","/api/user/profile",a)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/auth/user"]}),O(!1),n({title:"Cambios guardados",description:"Tu información se ha actualizado correctamente"})},onError:a=>{n({title:"Error",description:a.message,variant:"destructive"})}});i.useEffect(()=>{!R&&!F&&x("/auth/login")},[F,R,x]);const{data:h,isLoading:kt}=I({queryKey:["/api/orders"],enabled:F,refetchInterval:3e4,staleTime:1e4}),{data:ha,isLoading:Ct}=I({queryKey:["/api/messages"],enabled:F,refetchInterval:6e4,staleTime:3e4}),[Oe,ga]=i.useState(null),[ge,ba]=i.useState(""),ls=h?.[0]?.id,{data:Ue}=I({queryKey:["/api/orders",ls,"events"],enabled:!!ls,refetchInterval:3e4,staleTime:1e4}),be=w({mutationFn:async a=>{await g("POST",`/api/messages/${a}/reply`,{content:ge})},onSuccess:()=>{ba(""),ga(null),b.invalidateQueries({queryKey:["/api/messages"]}),b.invalidateQueries({queryKey:["/api/admin/messages"]}),n({title:r?.isAdmin?"Respuesta enviada":"Mensaje enviado",description:r?.isAdmin?"El cliente recibirá un email con la información":"Te responderemos personalmente lo antes posible"})}}),{data:fa,isLoading:Rs}=I({queryKey:["/api/user/notifications"],enabled:F,refetchInterval:6e4,staleTime:3e4}),Vs=w({mutationFn:async a=>{await g("PATCH",`/api/user/notifications/${a}/read`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})}}),cs=w({mutationFn:async a=>{await g("DELETE",`/api/user/notifications/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/notifications"]})}}),{data:Me}=I({queryKey:["/api/admin/orders"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:os}=I({queryKey:["/api/admin/users"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:fe}=I({queryKey:["/api/admin/newsletter"],enabled:!!r?.isAdmin}),{data:Re}=I({queryKey:["/api/admin/documents"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:ms}=I({queryKey:["/api/admin/invoices"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:D}=I({queryKey:["/api/admin/system-stats"],enabled:!!r?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:ja}=I({queryKey:["/api/admin/messages"],enabled:!!r?.isAdmin}),{data:Na,refetch:xs}=I({queryKey:["/api/admin/discount-codes"],enabled:!!r?.isAdmin}),[va,us]=i.useState(""),[ya,ps]=i.useState(""),wa=w({mutationFn:async({subject:a,message:s})=>{await g("POST","/api/admin/newsletter/broadcast",{subject:a,message:s})},onSuccess:()=>{n({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),us(""),ps("")},onError:()=>{n({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}}),{data:Ks}=I({queryKey:["/api/user/documents"],enabled:F});w({mutationFn:async a=>(await g("POST","/api/admin/documents",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})}});const Qs=w({mutationFn:async({id:a,status:s})=>(await g("PATCH",`/api/admin/orders/${a}/status`,{status:s})).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),n({title:"Estado actualizado"})}}),je=w({mutationFn:async({appId:a,field:s,value:j})=>{await g("PATCH",`/api/admin/llc/${a}/dates`,{field:s,value:j})},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),n({title:"Fecha actualizada"})},onError:()=>{n({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),te=w({mutationFn:async({userId:a,title:s,message:j,type:y})=>{await g("POST","/api/admin/send-note",{userId:a,title:s,message:j,type:y})},onSuccess:()=>{n({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),De({open:!1,user:null}),Qa(""),_a("")}}),Ve=w({mutationFn:async a=>{const{id:s,...j}=a;await g("PATCH",`/api/admin/users/${s}`,j)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario actualizado"}),f(null)},onError:a=>{n({title:"Error",description:a.message,variant:"destructive"})}}),ka=w({mutationFn:async a=>{await g("DELETE",`/api/admin/users/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario eliminado"}),Te({open:!1,user:null})},onError:()=>{n({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[V,Ke]=i.useState({open:!1,order:null}),[re,Qe]=i.useState({open:!1,order:null}),[de,hs]=i.useState(""),[Ca,gs]=i.useState("EUR"),Sa=w({mutationFn:async a=>{await g("DELETE",`/api/admin/orders/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),b.invalidateQueries({queryKey:["/api/orders"]}),b.invalidateQueries({queryKey:["/api/notifications"]}),b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),Ke({open:!1,order:null})},onError:()=>{n({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),Da=w({mutationFn:async({userId:a,concept:s,amount:j,currency:y})=>{await g("POST","/api/admin/invoices/create",{userId:a,concept:s,amount:j,currency:y})},onSuccess:()=>{n({title:"Factura creada",description:"La factura se ha añadido al centro de documentos del cliente"}),ze({open:!1,user:null}),Ha(""),Ga(""),Wa("EUR")},onError:()=>{n({title:"Error",description:"No se pudo crear la factura",variant:"destructive"})}}),za=w({mutationFn:async a=>(await g("POST","/api/admin/users/create",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),Ee(!1),Y({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{n({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),Ea=w({mutationFn:async a=>(await g("POST","/api/admin/orders/create",a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/orders"]}),n({title:"Pedido creado",description:"El pedido ha sido registrado correctamente"}),Pe(!1),Ae({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:()=>{n({title:"Error",description:"No se pudo crear el pedido",variant:"destructive"})}}),bs=w({mutationFn:async a=>{await g("DELETE",`/api/user/documents/${a}`)},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/user/documents"]}),n({title:"Documento eliminado"})},onError:a=>{n({title:"Error",description:a?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),Pa=w({mutationFn:async()=>{await g("DELETE","/api/user/account")},onSuccess:()=>{n({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{n({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),Aa=w({mutationFn:async()=>{await g("POST","/api/user/request-password-otp")},onSuccess:()=>{n({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),ta("otp")},onError:a=>{n({title:"Error",description:a.message||"No se pudo enviar el código",variant:"destructive"})}}),Ta=w({mutationFn:async a=>{await g("POST","/api/user/change-password",a)},onSuccess:()=>{n({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),sa(!1),ta("form"),da(""),na(""),ia(""),ca("")},onError:a=>{n({title:"Error",description:a.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(R||!F)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(r?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(Ps,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center px-4 py-8 sm:py-12",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(o,{className:"rounded-2xl sm:rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(Q,{className:"p-6 sm:p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-50 dark:bg-red-950/30 rounded-full flex items-center justify-center mx-auto mb-4 sm:mb-6",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-black text-red-500",children:"!"})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-black text-foreground tracking-tight mb-3 sm:mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground font-medium leading-relaxed mb-6 sm:mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-red-600 dark:text-red-400 font-medium bg-red-50 dark:bg-red-950/30 p-3 rounded-xl",children:"No puedes realizar acciones ni contactar hasta que se resuelva tu situación."}),e.jsx(t,{variant:"outline",className:"w-full font-black text-foreground h-12 rounded-full border-2",onClick:()=>g("POST","/api/logout").then(()=>window.location.href="/"),"data-testid":"button-logout",children:"Cerrar Sesión"})]})]})]})})}),e.jsx(As,{})]});const _s=[{id:"services",label:"Estado de mis trámites",icon:$a,mobileLabel:"Trámites"},{id:"notifications",label:"Seguimiento",icon:vs,mobileLabel:"Seguim."},{id:"messages",label:"Soporte",icon:qa,mobileLabel:"Soporte"},{id:"documents",label:"Documentos",icon:J,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:We,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:Ne,mobileLabel:"Fechas"},{id:"profile",label:"Mi Perfil",icon:Js,mobileLabel:"Perfil"},...r?.isAdmin?[{id:"admin",label:"Admin",icon:Xs,mobileLabel:"Admin"}]:[]];return e.jsxs("div",{className:"min-h-screen bg-muted bg-green-gradient font-sans",children:[e.jsx(Ps,{}),e.jsxs("main",{className:"pt-16 sm:pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-4 sm:mb-6 md:mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-black tracking-widest text-[10px] md:text-xs mb-0.5 md:mb-1 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-3xl md:text-4xl font-black text-primary tracking-tighter leading-tight",children:["Bienvenido, ",(r?.firstName||"Cliente").charAt(0).toUpperCase()+(r?.firstName||"Cliente").slice(1).toLowerCase()]}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-sm mt-0.5 md:mt-1 font-medium",children:"Aquí gestionas todo lo relacionado con tu LLC, de forma simple y clara."})]}),e.jsx(we,{href:"/servicios#pricing",children:e.jsxs(t,{className:"w-full md:w-auto bg-accent hover:bg-accent/90 text-black font-bold rounded-full px-8 h-12 transition-all flex items-center justify-center gap-2",children:[e.jsx(Oa,{className:"w-5 h-5"})," Constituir una nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-1.5 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-2 md:pb-4 md:mb-8",children:_s.map(a=>e.jsxs(t,{variant:v===a.id?"default":"outline",onClick:()=>q(a.id),size:"sm",className:`flex items-center gap-1 sm:gap-2 rounded-full font-bold text-[10px] sm:text-[11px] md:text-xs tracking-tight whitespace-nowrap shrink-0 ${v===a.id?"bg-accent text-primary shadow-lg shadow-accent/20":"bg-white dark:bg-zinc-900 text-muted-foreground border-0"}`,"data-testid":`button-tab-${a.id}`,children:[e.jsx(a.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:a.label}),e.jsx("span",{className:"md:hidden",children:a.mobileLabel})]},a.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[v==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Estado de mis trámites"}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground font-medium",children:"Gestiona tus trámites activos"})]}),!h||h.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx($a,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-primary mb-2",children:"Aún no tienes servicios activos"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Empieza hoy y constituye tu LLC en EE. UU. en pocos pasos."})]}),e.jsx(we,{href:"/servicios#pricing",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full px-8 py-3","data-testid":"button-view-packs",children:"Ver planes disponibles"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:h.filter(a=>a.status!=="cancelled"&&a.status!=="completed").slice(0,4).map(a=>e.jsx(pt,{status:a.status,serviceName:a.maintenanceApplication?`Mant. ${a.maintenanceApplication.state||a.product?.name?.replace(" LLC","")||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"Tu LLC",state:a.application?.state||a.maintenanceApplication?.state,requestCode:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber,isMaintenance:!!a.maintenanceApplication},`progress-${a.id}`))}),h.length>0&&e.jsxs("div",{className:"mt-4 md:mt-6",children:[e.jsx("h3",{className:"text-xs md:text-sm font-bold text-muted-foreground mb-2 md:mb-3",children:"Todos los Pedidos"}),e.jsx("div",{className:"space-y-2 md:space-y-3",children:h.map(a=>e.jsx(o,{className:"rounded-lg md:rounded-xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden","data-testid":`card-order-${a.id}`,children:e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("p",{className:"text-[9px] md:text-[10px] font-bold text-accent uppercase tracking-wider",children:a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber||`#${a.id}`}),e.jsx(C,{className:`${Be(a.status).className} font-bold uppercase text-[8px] md:text-[9px] px-1.5 py-0`,"data-testid":`badge-order-status-${a.id}`,children:Be(a.status).label})]}),e.jsx("p",{className:"text-sm md:text-base font-bold text-primary truncate",children:a.maintenanceApplication?`Mantenimiento ${a.maintenanceApplication.state||""}`:a.application?.companyName?`${a.application.companyName} LLC`:a.product?.name||"LLC pendiente"}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:[a.application?.state||a.maintenanceApplication?.state||"",a.createdAt&&` · ${new Date(a.createdAt).toLocaleDateString("es-ES")}`]})]}),a.status==="pending"&&a.application&&e.jsx(t,{variant:"outline",size:"sm",className:"text-[9px] md:text-[10px] h-7 md:h-8 px-2 md:px-3 rounded-full font-bold shrink-0",onClick:()=>window.location.href=`/llc/formation?edit=${a.application.id}`,"data-testid":`button-modify-order-${a.id}`,children:"Modificar"})]})},a.id))})]})]})]},"services"),v==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Notificaciones"}),Rs?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(a=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},a))}):fa?.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(Q,{className:"p-8 text-center",children:[e.jsx(vs,{className:"w-12 h-12 mx-auto text-gray-300 dark:text-zinc-600 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes notificaciones"})]})}):e.jsx("div",{className:"space-y-3",children:fa?.map(a=>e.jsx(o,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${a.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(Q,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[a.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",a.orderCode]}),a.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),a.type==="update"&&e.jsx("span",{className:"text-[10px] bg-accent/20 text-primary px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),a.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 dark:bg-zinc-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.message}),a.type==="action_required"&&p&&e.jsxs(t,{className:"mt-3 bg-accent text-primary font-black rounded-full text-xs px-4 gap-2",onClick:()=>{Vs.mutate(a.id),q("documents")},"data-testid":`button-upload-document-${a.id}`,children:[e.jsx(ys,{className:"w-3 h-3"}),"Subir Documento"]})]}),e.jsx(t,{variant:"ghost",size:"icon",className:"flex-shrink-0 h-8 w-8 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full",onClick:()=>cs.mutate(a.id),disabled:cs.isPending,"data-testid":`button-delete-notification-${a.id}`,children:e.jsx(Ys,{className:"w-4 h-4"})})]})})},a.id))})]},"notifications"),v==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Mis Consultas"}),e.jsx(we,{href:"/contacto",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full text-xs",children:"Nueva Consulta"})})]}),e.jsx("div",{className:"space-y-4",children:!ha||ha.length===0?e.jsxs(o,{className:"overflow-hidden","data-testid":"widget-support-empty",children:[e.jsx(le,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:e.jsxs(ce,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{children:"Centro de Soporte"})]})}),e.jsxs(Q,{className:"p-3 md:p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-muted flex items-center justify-center shrink-0",children:e.jsx(ve,{className:"w-5 h-5 md:w-6 md:h-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:"Sin conversaciones activas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tu historial de mensajes aparecerá aquí"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Te responderá una persona, no un bot"}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsxs(t,{className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-10 md:h-11",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"})," Hablar con soporte"]})})]})]})]}):ha.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ga(Oe?.id===a.id?null:a),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-black text-primary",children:a.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.messageId||a.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:a.content}),Oe?.id===a.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",children:[e.jsx(B,{value:ge,onChange:s=>ba(s.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm"}),e.jsx(t,{onClick:s=>{s.stopPropagation(),be.mutate(a.id)},disabled:!ge.trim()||be.isPending,className:"bg-accent text-primary font-black rounded-full px-6",children:"Enviar Respuesta"})]})]},a.id))})]},"messages"),v==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight mb-6",children:"Centro de Documentación"}),fa?.some(a=>a.type==="action_required"&&!a.isRead)&&e.jsx(o,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-sm",children:"Documentos Solicitados"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Tienes solicitudes de documentos pendientes. Por favor, sube los documentos requeridos."}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async a=>{const s=a.target.files?.[0];if(!s)return;const j=new FormData;j.append("file",s);try{(await fetch("/api/user/documents/upload",{method:"POST",body:j,credentials:"include"})).ok?(n({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]})):n({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{n({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(t,{variant:"outline",className:"rounded-full text-xs border-orange-300 text-orange-700",asChild:!0,children:e.jsxs("span",{children:[e.jsx(ye,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(o,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{const s=a.target.files?.[0];s&&(Le({open:!0,file:s}),Ja("passport"),Xa(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(ys,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-primary text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(t,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(ye,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"SUBIR"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ks?.map(a=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(ye,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:a.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(a.createdAt||a.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`button-download-doc-${a.id}`,children:[e.jsx(ws,{className:"w-3 h-3 mr-1"})," Descargar"]}),p&&e.jsx(t,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>bs.mutate(a.id),disabled:bs.isPending,"data-testid":`button-delete-doc-${a.id}`,children:e.jsx(ks,{className:"w-3 h-3"})})]})]},a.id))})]},"documents"),v==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Historial de Pagos"}),e.jsx("div",{className:"space-y-4",children:!h||h.length===0?e.jsxs(o,{className:"overflow-hidden","data-testid":"widget-payments-empty",children:[e.jsx(le,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:e.jsxs(ce,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{children:"Historial de Pagos"})]})}),e.jsxs(Q,{className:"p-3 md:p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-muted flex items-center justify-center shrink-0",children:e.jsx(Cs,{className:"w-5 h-5 md:w-6 md:h-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:"Sin pagos registrados"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tus facturas y recibos aparecerán aquí"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Contrata un servicio para ver tu historial"}),e.jsx(we,{href:"/servicios#pricing",children:e.jsxs(t,{className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-10 md:h-11",children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"})," Ver servicios"]})})]})]})]}):h.map(a=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",a.application?.requestCode||a.maintenanceApplication?.requestCode||a.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${a.id}/receipt`,"_blank"),children:"Recibo"})]})]},a.id))})]},"payments"),v==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),h&&h.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:h.map(a=>{const s=a.application;if(!s)return null;const j=a.status==="cancelled",y=["pending","paid","processing"].includes(a.status),fs=["Wyoming","Delaware","WY","DE"].includes(s.state),_e=[{label:"Creación",fullLabel:"Creación de LLC",date:s.llcCreatedDate,icon:Je,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:s.agentRenewalDate,icon:Zs,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:s.irs1120DueDate,icon:J,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:s.irs5472DueDate,icon:J,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...fs?[{label:"Anual",fullLabel:`Reporte Anual ${s.state}`,date:s.annualReportDueDate,icon:et,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],La=_e.some(E=>E.date),js=_e.filter(E=>E.date).sort((E,Ia)=>new Date(E.date).getTime()-new Date(Ia.date).getTime()),He=js.find(E=>new Date(E.date)>new Date);return e.jsxs(o,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${j?"opacity-50":""}`,children:[e.jsx(le,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(ce,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(Je,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:s.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:s.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[j&&e.jsx(C,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),y&&e.jsx(C,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!j&&!y&&He&&e.jsxs(C,{className:`text-[9px] md:text-[10px] ${He.bgColor} ${He.textColor}`,children:["Próximo: ",He.label]})]})]})}),e.jsx(Q,{className:"p-3 md:p-4",children:j?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ss,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):y?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(ie,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):La?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:js.map((E,Ia)=>{const Ge=new Date(E.date),Ns=new Date,ne=Math.ceil((Ge.getTime()-Ns.getTime())/(1e3*60*60*24)),Fa=Ge<Ns,Hs=!Fa&&ne<=30,Gs=!Fa&&ne<=60&&ne>30,Bs=E.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${E.borderColor} ${E.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${E.textColor}`,children:[e.jsx(Bs,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:E.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Ge.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Ge.getFullYear()}),Fa?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ds,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):Hs?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(zs,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[ne," días"]})]}):Gs?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[ne," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[ne," días"]})})]},Ia)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ne,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},a.id)})}):e.jsxs(o,{className:"overflow-hidden","data-testid":"widget-calendar-empty",children:[e.jsx(le,{className:"pb-2 md:pb-3 p-3 md:p-4 bg-primary/5",children:e.jsxs(ce,{className:"text-sm md:text-base font-bold flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),e.jsx("span",{children:"Calendario Fiscal"})]})}),e.jsxs(Q,{className:"p-3 md:p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-muted flex items-center justify-center shrink-0",children:e.jsx(ie,{className:"w-5 h-5 md:w-6 md:h-6 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:"Sin fechas programadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tus vencimientos fiscales aparecerán aquí"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Constituye tu LLC para activar el calendario"}),e.jsx(we,{href:"/servicios#pricing",children:e.jsxs(t,{className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-10 md:h-11",children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"})," Constituir mi LLC"]})})]})]})]})]},"calendar"),v==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-black",children:"Perfil Personal"}),p&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>O(!k),"data-testid":"button-toggle-edit",children:k?"Cancelar":"Editar"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Esta información nos permite acompañarte mejor y cumplir con los requisitos legales cuando sea necesario."}),!p&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${r?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${r?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:r?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:r?.clientId||r?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${r?.accountStatus==="active"?"text-green-600":r?.accountStatus==="pending"?"text-orange-500":r?.accountStatus==="deactivated"?"text-red-600":r?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:r?.accountStatus==="active"?"Verificado":r?.accountStatus==="pending"?"En revisión":r?.accountStatus==="deactivated"?"Desactivada":r?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Nombre"}),k&&p?e.jsx(c,{value:u.firstName,onChange:a=>S({...u,firstName:a.target.value}),placeholder:"Tu nombre real",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Apellidos"}),k&&p?e.jsx(c,{value:u.lastName,onChange:a=>S({...u,lastName:a.target.value}),placeholder:"Tal y como aparecen en tu documento",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:r?.email}),r?.emailVerified?e.jsx(oe,{className:"w-4 h-4 text-green-500"}):e.jsx(t,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>ua(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!r?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Teléfono"}),k&&p?e.jsx(c,{value:u.phone,onChange:a=>S({...u,phone:a.target.value}),placeholder:"Para contactarte si es necesario",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de documento"}),k&&p?e.jsxs(z,{value:u.idType,onValueChange:a=>S({...u,idType:a}),placeholder:"DNI · NIE · Pasaporte",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-idtype",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idType==="dni"?"DNI":r?.idType==="nie"?"NIE":r?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Número de documento"}),k&&p?e.jsx(c,{value:u.idNumber,onChange:a=>S({...u,idNumber:a.target.value}),placeholder:"Documento de identificación",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Fecha de nacimiento"}),k&&p?e.jsx(c,{type:"date",value:u.birthDate,onChange:a=>S({...u,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Actividad profesional"}),k&&p?e.jsxs(z,{value:u.businessActivity,onValueChange:a=>S({...u,businessActivity:a}),placeholder:"A qué te dedicas",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-activity",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección de residencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Tipo de vía"}),k&&p?e.jsxs(z,{value:u.streetType,onValueChange:a=>S({...u,streetType:a}),placeholder:"Calle · Avenida · Paseo · Plaza",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-street-type",children:[e.jsx(l,{value:"calle",children:"Calle"}),e.jsx(l,{value:"avenida",children:"Avenida"}),e.jsx(l,{value:"paseo",children:"Paseo"}),e.jsx(l,{value:"plaza",children:"Plaza"})]}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Dirección"}),k&&p?e.jsx(c,{value:u.address,onChange:a=>S({...u,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Ciudad"}),k&&p?e.jsx(c,{value:u.city,onChange:a=>S({...u,city:a.target.value}),placeholder:"Ciudad de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"Provincia"}),k&&p?e.jsx(c,{value:u.province,onChange:a=>S({...u,province:a.target.value}),placeholder:"Provincia o región",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"C.P."}),k&&p?e.jsx(c,{value:u.postalCode,onChange:a=>S({...u,postalCode:a.target.value}),placeholder:"Código postal",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs font-bold text-muted-foreground",children:"País"}),k&&p?e.jsx(c,{value:u.country,onChange:a=>S({...u,country:a.target.value}),placeholder:"País de residencia",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base"}):e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg text-sm",children:r?.country||"-"})]})]})]}),k&&p&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(t,{onClick:()=>{is.mutate(u),O(!1)},className:"w-full bg-accent hover:bg-accent/90 text-black font-bold rounded-full h-12 transition-all",disabled:is.isPending,"data-testid":"button-save-profile",children:"Guardar cambios"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Nuestro equipo revisará cualquier cambio antes de avanzar para asegurarnos de que todo esté correcto."})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(ht,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!Ya&&e.jsx(t,{variant:"outline",className:"rounded-full",onClick:()=>sa(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),Ya&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-zinc-800 rounded-xl",children:[Za==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Contraseña actual"}),e.jsx(c,{type:"password",value:ra,onChange:a=>da(a.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(c,{type:"password",value:W,onChange:a=>na(a.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(c,{type:"password",value:Fe,onChange:a=>ia(a.target.value),"data-testid":"input-confirm-password"})]}),W&&Fe&&W!==Fe&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{sa(!1),da(""),na(""),ia("")},children:"Cancelar"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Aa.mutate(),disabled:!ra||!W||W!==Fe||W.length<8||Aa.isPending,"data-testid":"button-request-otp",children:Aa.isPending?"Enviando...":"Enviar código"})]})]}),Za==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(qa,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{className:"text-xs",children:"Código de verificación"}),e.jsx(c,{type:"text",value:la,onChange:a=>ca(a.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{ta("form"),ca("")},children:"Volver"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Ta.mutate({currentPassword:ra,newPassword:W,otp:la}),disabled:la.length!==6||Ta.isPending,"data-testid":"button-save-password",children:Ta.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(ct,{mode:"connect",googleConnected:!!r?.googleId,onSuccess:()=>b.refetchQueries({queryKey:["/api/auth/user"]})})]}),p&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>aa(!0),"data-testid":"button-delete-own-account",children:[e.jsx(ks,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})},"profile"),v==="admin"&&r?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2 mb-4 md:mb-6",children:["dashboard","orders","users","facturas","calendar","docs","newsletter","inbox","descuentos"].map(a=>e.jsxs(t,{variant:U===a?"default":"outline",onClick:()=>$s(a),className:"rounded-full text-[10px] md:text-xs font-black capitalize px-2 md:px-3","data-testid":`button-admin-tab-${a}`,children:[e.jsx("span",{className:"hidden sm:inline",children:a==="dashboard"?"Métricas":a==="calendar"?"Fechas":a==="orders"?"Pedidos":a==="users"?"Clientes":a==="docs"?"Documentos":a==="descuentos"?"Descuentos":a==="facturas"?"Facturas":a}),e.jsx("span",{className:"sm:hidden flex items-center justify-center",children:a==="dashboard"?e.jsx(at,{className:"w-5 h-5"}):a==="calendar"?e.jsx(Ne,{className:"w-5 h-5"}):a==="orders"?e.jsx($a,{className:"w-5 h-5"}):a==="users"?e.jsx(st,{className:"w-5 h-5"}):a==="docs"?e.jsx(J,{className:"w-5 h-5"}):a==="newsletter"?e.jsx(qa,{className:"w-5 h-5"}):a==="descuentos"?e.jsx(tt,{className:"w-5 h-5"}):a==="facturas"?e.jsx(Cs,{className:"w-5 h-5"}):e.jsx(ve,{className:"w-5 h-5"})})]},a))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Ee(!0),"data-testid":"button-create-user",children:[e.jsx(Ua,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Pe(!0),"data-testid":"button-create-order",children:[e.jsx(Ua,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),U==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((D?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((D?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:D?.orderCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[D?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:D?.pendingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:D?.processingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:D?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:D?.userCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:D?.activeAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:D?.vipAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:D?.pendingAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:D?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:D?.subscriberCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:D?.totalMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:D?.pendingMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:D?.pendingDocs||0})]})]})]})]}),U==="orders"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:Me?.map(a=>{const s=a.application||a.maintenanceApplication,j=!!a.maintenanceApplication&&!a.application,y=s?.requestCode||a.invoiceNumber,_e=s?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:y}),e.jsx(C,{className:`text-[9px] ${j?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:j?"MANTENIMIENTO":"LLC"}),!_e&&e.jsx(C,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:s?.ownerFullName||`${a.user?.firstName||""} ${a.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?.ownerEmail||a.user?.email}),s?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",s?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",s?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",a.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(a.amount/100).toFixed(2),"€",a.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",a.discountCode," -",(a.discountAmount/100).toFixed(2),"€)"]})]}),s?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",s.businessCategory]}),j&&s?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",s.ein]})]}),e.jsxs(z,{value:a.status,onValueChange:La=>Qs.mutate({id:a.id,status:La}),className:"w-28 h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border px-3",children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"paid",children:"Pagado"}),e.jsx(l,{value:"filed",children:"Presentado"}),e.jsx(l,{value:"cancelled",children:"Cancelado"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>window.open(`/api/admin/invoice/${a.id}`,"_blank"),"data-testid":`btn-view-invoice-${a.id}`,children:"Ver Factura"}),e.jsx(t,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>{hs(((a.amount||0)/100).toFixed(2)),gs("EUR"),Qe({open:!0,order:a})},"data-testid":`btn-generate-invoice-${a.id}`,children:"Generar Factura"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Ke({open:!0,order:a}),"data-testid":`btn-delete-order-${a.id}`,children:"Eliminar"})]})]},a.id)})})}),U==="users"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:os?.map(a=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsx(C,{variant:a.accountStatus==="active"||a.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${a.accountStatus==="deactivated"?"bg-red-100 text-red-700":a.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":a.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:a.accountStatus==="active"?"VERIFICADO":a.accountStatus==="pending"?"EN REVISIÓN":a.accountStatus==="deactivated"?"DESACTIVADA":a.accountStatus==="vip"?"VIP":"VERIFICADO"}),a.isAdmin&&e.jsx(C,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.phone&&e.jsx("span",{className:"mr-2",children:a.phone}),a.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",a.businessActivity]}),a.city&&e.jsxs("span",{children:["• ",a.city]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(d,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(z,{value:a.accountStatus||"active",onValueChange:s=>a.id&&Ve.mutate({id:a.id,accountStatus:s}),className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm px-3",children:[e.jsx(l,{value:"active",children:"Verificado"}),e.jsx(l,{value:"pending",children:"En revisión"}),e.jsx(l,{value:"deactivated",children:"Desactivada"}),e.jsx(l,{value:"vip",children:"VIP"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>f(a),"data-testid":`button-edit-user-${a.id}`,children:"Editar"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>De({open:!0,user:a}),"data-testid":`button-note-user-${a.id}`,children:"Mensaje"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>ke({open:!0,user:a}),"data-testid":`button-doc-user-${a.id}`,children:"Docs"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs",onClick:()=>ze({open:!0,user:a}),"data-testid":`button-invoice-user-${a.id}`,children:"Factura"}),e.jsx(t,{size:"sm",className:"rounded-full text-xs bg-accent hover:bg-accent/90 text-black",onClick:()=>$e({open:!0,user:a}),"data-testid":`button-payment-link-${a.id}`,children:"Pago"}),e.jsx(t,{size:"sm",variant:"outline",className:"rounded-full text-xs text-red-600 border-red-200",onClick:()=>Te({open:!0,user:a}),"data-testid":`button-delete-user-${a.id}`,children:"Eliminar"})]})]},a.id))})}),U==="calendar"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[Me?.map(a=>{const s=a.application;if(!s)return null;const j=s?.requestCode||a.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50 dark:bg-zinc-800/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:s.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",s.state]})]}),e.jsx(C,{variant:"outline",className:"text-xs w-fit",children:j})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.llcCreatedDate?new Date(s.llcCreatedDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"llcCreatedDate",value:y.target.value}),"data-testid":`input-llc-created-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.agentRenewalDate?new Date(s.agentRenewalDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"agentRenewalDate",value:y.target.value}),"data-testid":`input-agent-renewal-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs1120DueDate?new Date(s.irs1120DueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"irs1120DueDate",value:y.target.value}),"data-testid":`input-irs1120-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.irs5472DueDate?new Date(s.irs5472DueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"irs5472DueDate",value:y.target.value}),"data-testid":`input-irs5472-${s.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(d,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:s.annualReportDueDate?new Date(s.annualReportDueDate).toISOString().split("T")[0]:"",onChange:y=>je.mutate({appId:s.id,field:"annualReportDueDate",value:y.target.value}),"data-testid":`input-annual-report-${s.id}`})]})]})]},a.id)}),(!Me||Me.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),U==="docs"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black text-lg",children:"Documentos de Clientes"}),e.jsxs(C,{className:"bg-accent/20 text-accent",children:[Re?.length||0," docs"]})]}),e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[Re?.map(a=>e.jsxs("div",{className:"py-3 flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-bold text-sm truncate",children:a.fileName}),e.jsx(C,{variant:"outline",className:`text-[9px] ${a.reviewStatus==="approved"?"bg-green-100 text-green-700":a.reviewStatus==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"}`,children:a.reviewStatus==="approved"?"Aprobado":a.reviewStatus==="rejected"?"Rechazado":"Pendiente"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," • ",a.user?.email]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.application?.companyName&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"LLC:"})," ",a.application.companyName," • "]}),e.jsx("strong",{children:"Tipo:"})," ",a.documentType||"Documento"," •",e.jsx("strong",{children:" Fecha:"})," ",a.uploadedAt?new Date(a.uploadedAt).toLocaleDateString("es-ES"):"-"]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[a.fileUrl&&e.jsx(t,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>window.open(a.fileUrl,"_blank"),"data-testid":`btn-view-doc-${a.id}`,children:e.jsx(Es,{className:"w-4 h-4"})}),e.jsxs(z,{value:a.reviewStatus||"pending",onValueChange:async s=>{try{await g("PATCH",`/api/admin/documents/${a.id}/review`,{reviewStatus:s}),b.invalidateQueries({queryKey:["/api/admin/documents"]}),n({title:"Estado actualizado"})}catch{n({title:"Error",variant:"destructive"})}},className:"h-8 w-24 text-[10px] rounded-full px-2",children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"approved",children:"Aprobar"}),e.jsx(l,{value:"rejected",children:"Rechazar"})]})]})]},a.id)),(!Re||Re.length===0)&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground/30"}),"No hay documentos subidos por clientes"]})]})]}),U==="newsletter"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 rounded-xl border border-border",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Enviar a todos los suscriptores (",fe?.length||0,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{value:va,onChange:a=>us(a.target.value),placeholder:"Asunto del email",className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-subject"}),e.jsx(B,{value:ya,onChange:a=>ps(a.target.value),placeholder:"Contenido del mensaje",rows:4,className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-message"}),e.jsx(t,{onClick:()=>wa.mutate({subject:va,message:ya}),disabled:!va||!ya||wa.isPending,className:"w-full rounded-full","data-testid":"button-send-broadcast",children:wa.isPending?"Enviando...":`Enviar a ${fe?.length||0} suscriptores`})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm mb-3",children:"Lista de Suscriptores"}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[fe?.map(a=>e.jsxs("div",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:a.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:a.subscribedAt?new Date(a.subscribedAt).toLocaleDateString("es-ES"):""})]},a.id)),(!fe||fe.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})]})}),U==="inbox"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[ja?.map(a=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>ga(Oe?.id===a.id?null:a),"data-testid":`inbox-message-${a.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-sm",children:[a.firstName," ",a.lastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.email," ",a.phone&&`• ${a.phone}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",className:"text-[10px]",children:a.messageId||a.id}),e.jsx(C,{variant:"secondary",className:"text-[10px]",children:a.status||"pendiente"})]})]}),e.jsx("p",{className:"text-xs font-medium",children:a.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.message}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:a.replies.map(s=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${s.isAdmin?"text-accent":"text-muted-foreground"}`,children:[s.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:s.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:s.createdAt&&new Date(s.createdAt).toLocaleString("es-ES")})]},s.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.createdAt?new Date(a.createdAt).toLocaleString("es-ES"):""}),Oe?.id===a.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:s=>s.stopPropagation(),children:[e.jsx(B,{value:ge,onChange:s=>ba(s.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(t,{onClick:()=>be.mutate(a.id),disabled:!ge.trim()||be.isPending,className:"bg-accent text-primary font-black rounded-full px-6","data-testid":"button-send-admin-reply",children:[be.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},a.id)),(!ja||ja.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),U==="facturas"&&e.jsxs("div",{className:"space-y-4","data-testid":"admin-facturas-section",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h3",{className:"text-sm font-bold",children:"Facturas para Contabilidad"})}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:[ms?.length===0&&e.jsx("p",{className:"p-4 text-sm text-muted-foreground text-center",children:"No hay facturas generadas"}),ms?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`invoice-row-${a.id}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.fileName||`Factura ${a.order?.invoiceNumber}`}),e.jsx(C,{variant:a.order?.status==="paid"||a.order?.status==="completed"?"default":"secondary",className:"text-[10px]",children:a.order?.status==="paid"?"Pagada":a.order?.status==="completed"?"Completada":a.order?.status==="pending"?"Pendiente":a.order?.status||"N/A"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName," (",a.user?.email,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Importe: ",a.order?.amount?(a.order.amount/100).toFixed(2)+(a.order.currency==="USD"?" $":" €"):"N/A"," | Fecha: ",a.createdAt?new Date(a.createdAt).toLocaleDateString("es-ES"):"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>window.open(a.fileUrl||`/api/orders/${a.orderId}/invoice`,"_blank"),"data-testid":`button-view-invoice-${a.id}`,children:[e.jsx(Es,{className:"w-3 h-3 mr-1"})," Ver"]}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{const s=document.createElement("a");s.href=a.fileUrl||`/api/orders/${a.orderId}/invoice`,s.download=`Factura-${a.order?.invoiceNumber||a.id}.pdf`,s.click()},"data-testid":`button-download-invoice-${a.id}`,children:[e.jsx(ws,{className:"w-3 h-3 mr-1"})," Descargar"]})]})]},a.id))]})})]}),U==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{M({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),ue({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(Ua,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[Na?.map(a=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${a.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:a.code}),e.jsx(C,{variant:a.isActive?"default":"secondary",className:"text-[10px]",children:a.isActive?"Activo":"Inactivo"}),e.jsx(C,{variant:"outline",className:"text-[10px]",children:a.discountType==="percentage"?`${a.discountValue}%`:`${(a.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",a.usedCount,a.maxUses?`/${a.maxUses}`:""," veces",a.minOrderAmount&&` | Min: ${(a.minOrderAmount/100).toFixed(2)}€`]}),(a.validFrom||a.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[a.validFrom&&`Desde: ${new Date(a.validFrom).toLocaleDateString("es-ES")}`,a.validFrom&&a.validUntil&&" - ",a.validUntil&&`Hasta: ${new Date(a.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{M({code:a.code,discountType:a.discountType,discountValue:a.discountValue.toString(),minOrderAmount:a.minOrderAmount?(a.minOrderAmount/100).toString():"",maxUses:a.maxUses?.toString()||"",validFrom:a.validFrom?a.validFrom.split("T")[0]:"",validUntil:a.validUntil?a.validUntil.split("T")[0]:"",isActive:a.isActive}),ue({open:!0,code:a})},"data-testid":`button-edit-discount-${a.code}`,children:e.jsx(dt,{className:"w-3 h-3"})}),e.jsx(t,{variant:"outline",size:"sm",className:`rounded-full text-xs ${a.isActive?"text-red-600":"text-green-600"}`,onClick:async()=>{try{await g("PATCH",`/api/admin/discount-codes/${a.id}`,{isActive:!a.isActive}),xs(),n({title:a.isActive?"Código desactivado":"Código activado"})}catch{n({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${a.code}`,children:a.isActive?e.jsx(Ss,{className:"w-3 h-3"}):e.jsx(Ds,{className:"w-3 h-3"})})]})]},a.id)),(!Na||Na.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"El progreso de tu LLC, paso a paso"})]}),e.jsx("div",{className:"space-y-5",children:h&&h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-zinc-800 rounded-xl p-3 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] font-bold text-accent uppercase tracking-wider mb-0.5",children:["Pedido: ",h[0]?.application?.requestCode||h[0]?.maintenanceApplication?.requestCode||h[0]?.invoiceNumber||h[0]?.id]}),e.jsx("p",{className:"text-sm font-black text-primary truncate",children:h[0]?.maintenanceApplication?`Mantenimiento ${h[0]?.maintenanceApplication?.state||""}`:h[0]?.application?.companyName?`${h[0]?.application?.companyName} LLC`:h[0]?.product?.name||"LLC"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:h[0]?.application?.state||h[0]?.maintenanceApplication?.state||""})]}),e.jsx(C,{className:`${Be(h[0]?.status).className} font-bold text-[9px] shrink-0`,children:Be(h[0]?.status).label})]}),e.jsxs("p",{className:"text-[9px] text-muted-foreground mt-2",children:["Creado: ",h[0]?.createdAt?new Date(h[0].createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"-"]})]}),Ue&&Ue.length>0?Ue.map((a,s)=>e.jsxs("div",{className:"flex gap-4 relative",children:[s<Ue.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-black text-primary truncate",children:a.eventType}),a.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(a.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:a.description})]})]},a.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx(oe,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(zs,{className:"w-8 h-8 text-gray-200 dark:text-zinc-600 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay trámites en curso"}),e.jsx("p",{className:"text-[10px] text-muted-foreground/70 mt-1",children:"Cuando contrates un servicio, aquí podrás seguir todo el proceso."})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-black text-primary mb-3",children:"¿Hablamos?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Nuestro equipo está disponible para ayudarte en cualquier momento."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",children:e.jsx(t,{className:"w-full bg-accent text-primary font-black rounded-full py-5",children:"Hablar con soporte"})})]})]})]})]}),r?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(P,{open:Se.open,onOpenChange:a=>De({open:a,user:a?Se.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Enviar Mensaje al Cliente"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Título"}),e.jsx(c,{value:Xe,onChange:a=>Qa(a.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:Ye,onChange:a=>_a(a.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>De({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>Se.user?.id&&te.mutate({userId:Se.user.id,title:Xe,message:Ye,type:Fs}),disabled:!Xe||!Ye||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-note",children:te.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(P,{open:!!m,onOpenChange:a=>!a&&f(null),children:e.jsxs(A,{className:"sm:max-w-lg bg-white dark:bg-zinc-900 rounded-2xl max-h-[85vh]",children:[e.jsxs(T,{className:"flex-shrink-0",children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Editar Usuario"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),m&&e.jsxs("div",{className:"space-y-3 pt-2 overflow-y-auto flex-1 pr-1",style:{maxHeight:"calc(85vh - 180px)"},children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:m.firstName||"",onChange:a=>f({...m,firstName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:m.lastName||"",onChange:a=>f({...m,lastName:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{value:m.email||"",onChange:a=>f({...m,email:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:m.phone||"",onChange:a=>f({...m,phone:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo ID"}),e.jsxs(z,{value:m.idType||"",onValueChange:a=>f({...m,idType:a}),placeholder:"Seleccionar",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Número ID"}),e.jsx(c,{value:m.idNumber||"",onChange:a=>f({...m,idNumber:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Fecha Nacimiento"}),e.jsx(c,{type:"date",value:m.birthDate||"",onChange:a=>f({...m,birthDate:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Actividad de Negocio"}),e.jsxs(z,{value:m.businessActivity||"",onValueChange:a=>f({...m,businessActivity:a}),placeholder:"Seleccionar actividad",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-edit-activity",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Dirección"}),e.jsx(c,{value:m.address||"",onChange:a=>f({...m,address:a.target.value}),placeholder:"Calle y número",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Ciudad"}),e.jsx(c,{value:m.city||"",onChange:a=>f({...m,city:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Código Postal"}),e.jsx(c,{value:m.postalCode||"",onChange:a=>f({...m,postalCode:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Provincia"}),e.jsx(c,{value:m.province||"",onChange:a=>f({...m,province:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"País"}),e.jsx(c,{value:m.country||"",onChange:a=>f({...m,country:a.target.value}),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(B,{value:m.internalNotes||"",onChange:a=>f({...m,internalNotes:a.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]})]}),m&&e.jsxs($,{className:"flex-col sm:flex-row gap-3 pt-4 border-t border-border flex-shrink-0",children:[e.jsx(t,{variant:"outline",onClick:()=>f(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>m.id&&Ve.mutate({id:m.id,...m}),disabled:Ve.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-user",children:Ve.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})}),e.jsx(P,{open:ee.open,onOpenChange:a=>Te({open:a,user:a?ee.user:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[ee.user?.firstName," ",ee.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Te({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>ee.user?.id&&ka.mutate(ee.user.id),disabled:ka.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:ka.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(P,{open:V.open,onOpenChange:a=>Ke({open:a,order:a?V.order:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:V.order?.application?.requestCode||V.order?.maintenanceApplication?.requestCode||V.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",V.order?.user?.firstName," ",V.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ke({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>V.order?.id&&Sa.mutate(V.order.id),disabled:Sa.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:Sa.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(P,{open:re.open,onOpenChange:a=>Qe({open:a,order:a?re.order:null}),children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-primary",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:re.order?.application?.requestCode||re.order?.maintenanceApplication?.requestCode||re.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",step:"0.01",value:de,onChange:a=>hs(a.target.value),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Divisa"}),e.jsxs(z,{value:Ca,onValueChange:gs,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"EUR",children:"EUR (€)"}),e.jsx(l,{value:"USD",children:"USD ($)"})]})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>Qe({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full",disabled:!de||isNaN(parseFloat(de))||parseFloat(de)<=0,onClick:async()=>{try{const a=Math.round(parseFloat(de)*100);if(a<=0){n({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}await g("POST",`/api/admin/orders/${re.order?.id}/generate-invoice`,{amount:a,currency:Ca}),n({title:"Factura generada",description:`Factura creada por ${de} ${Ca}`}),b.invalidateQueries({queryKey:["/api/admin/orders"]}),Qe({open:!1,order:null})}catch{n({title:"Error",description:"No se pudo generar la factura",variant:"destructive"})}},"data-testid":"button-confirm-generate-invoice",children:"Generar Factura"})]})]})}),e.jsx(P,{open:me.open,onOpenChange:a=>ke({open:a,user:a?me.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Solicitar Documentos"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:Ce,onValueChange:Ra,placeholder:"Seleccionar tipo...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:Va,onChange:a=>Ka(a.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>ke({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>{if(me.user?.id&&me.user?.email){const s={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[Ce]||Ce;te.mutate({userId:me.user.id,title:`Solicitud de Documento: ${s}`,message:Va||`Por favor, sube tu ${s} a tu panel de cliente.`,type:"action_required"}),ke({open:!1,user:null}),Ra(""),Ka("")}},disabled:!Ce||te.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-request-doc",children:te.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(P,{open:X.open,onOpenChange:a=>ze({open:a,user:a?X.user:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Factura"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 dark:bg-zinc-800 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[X.user?.firstName," ",X.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Concepto"}),e.jsx(c,{value:Ze,onChange:a=>Ha(a.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",value:ea,onChange:a=>Ga(a.target.value),placeholder:"739",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Moneda"}),e.jsxs(z,{value:Ba,onValueChange:Wa,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-invoice-currency",children:[e.jsx(l,{value:"EUR",children:"EUR"}),e.jsx(l,{value:"USD",children:"USD"})]})]})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>ze({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>X.user?.id&&Da.mutate({userId:X.user.id,concept:Ze,amount:Math.round(parseFloat(ea)*100),currency:Ba}),disabled:!Ze||!ea||Da.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-create-invoice",children:Da.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(P,{open:Us,onOpenChange:aa,children:e.jsxs(A,{className:"sm:max-w-sm bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>aa(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>Pa.mutate(),disabled:Pa.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:Pa.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(P,{open:ae.open,onOpenChange:a=>{a||Le({open:!1,file:null})},children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsx(T,{children:e.jsx(L,{className:"text-lg sm:text-xl font-black text-primary",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[ae.file&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg flex items-center gap-3",children:[e.jsx(ye,{className:"w-7 h-7 sm:w-8 sm:h-8 text-accent shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm truncate",children:ae.file.name}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:[(ae.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(z,{value:xe,onValueChange:Ja,className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-upload-doc-type",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]}),xe==="other"&&e.jsxs("div",{children:[e.jsx(d,{className:"text-xs sm:text-sm font-black text-primary mb-2 block",children:"Descripción del documento"}),e.jsx(B,{value:Ie,onChange:a=>Xa(a.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent text-base",style:{fontSize:"16px"},"data-testid":"input-upload-notes"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Le({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!ae.file)return;const a=new FormData;a.append("file",ae.file),a.append("documentType",xe),xe==="other"&&Ie&&a.append("notes",Ie);try{const s=await fetch("/api/user/documents/upload",{method:"POST",body:a,credentials:"include"});if(s.ok)n({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),b.invalidateQueries({queryKey:["/api/user/documents"]}),Le({open:!1,file:null});else{const j=await s.json();n({title:"Error",description:j.message||"No se pudo subir el documento",variant:"destructive"})}}catch{n({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:xe==="other"&&!Ie.trim(),className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(P,{open:qs,onOpenChange:Ee,children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Cliente"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:_.firstName,onChange:a=>Y(s=>({...s,firstName:a.target.value})),placeholder:"Nombre",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:_.lastName,onChange:a=>Y(s=>({...s,lastName:a.target.value})),placeholder:"Apellidos",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{type:"email",value:_.email,onChange:a=>Y(s=>({...s,email:a.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:_.phone,onChange:a=>Y(s=>({...s,phone:a.target.value})),placeholder:"+34 600 000 000",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Contraseña"}),e.jsx(c,{type:"password",value:_.password,onChange:a=>Y(s=>({...s,password:a.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-create-user-password"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ee(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(t,{onClick:()=>za.mutate(_),disabled:za.isPending||!_.email||!_.password,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-user",children:za.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(P,{open:Os,onOpenChange:Pe,children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Pedido"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Cliente"}),e.jsx(z,{value:Z.userId,onValueChange:a=>Ae(s=>({...s,userId:a})),placeholder:"Seleccionar cliente...",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-user",children:os?.map(a=>e.jsxs(l,{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Estado (LLC)"}),e.jsxs(z,{value:Z.state,onValueChange:a=>Ae(s=>({...s,state:a})),placeholder:"Seleccionar estado",className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-order-state",children:[e.jsx(l,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(l,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(l,{value:"Delaware",children:"Delaware - 1199€"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Importe (€)"}),e.jsx(c,{type:"number",value:Z.amount,onChange:a=>Ae(s=>({...s,amount:a.target.value})),placeholder:"739",className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-order-amount"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Pe(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(t,{onClick:()=>Ea.mutate(Z),disabled:Ea.isPending||!Z.userId||!Z.amount,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-order",children:Ea.isPending?e.jsx(G,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(P,{open:H.open,onOpenChange:a=>ue({open:a,code:a?H.code:null}),children:e.jsxs(A,{className:"sm:max-w-md bg-white dark:bg-zinc-900 rounded-2xl",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:H.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(K,{className:"text-sm text-muted-foreground",children:H.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Código"}),e.jsx(c,{value:N.code,onChange:a=>M(s=>({...s,code:a.target.value.toUpperCase()})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base uppercase",disabled:!!H.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo"}),e.jsxs(z,{value:N.discountType,onValueChange:a=>M(s=>({...s,discountType:a})),className:"w-full rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800","data-testid":"select-discount-type",children:[e.jsx(l,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(l,{value:"fixed",children:"Fijo (centimos)"})]})]}),e.jsxs("div",{children:[e.jsxs(d,{className:"text-sm font-black text-primary mb-2 block",children:["Valor ",N.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(c,{type:"number",value:N.discountValue,onChange:a=>M(s=>({...s,discountValue:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(c,{type:"number",value:N.minOrderAmount,onChange:a=>M(s=>({...s,minOrderAmount:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Usos max."}),e.jsx(c,{type:"number",value:N.maxUses,onChange:a=>M(s=>({...s,maxUses:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Válido desde"}),e.jsx(c,{type:"date",value:N.validFrom,onChange:a=>M(s=>({...s,validFrom:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary mb-2 block",children:"Válido hasta"}),e.jsx(c,{type:"date",value:N.validUntil,onChange:a=>M(s=>({...s,validUntil:a.target.value})),className:"rounded-full h-12 px-5 border-2 border-gray-200 dark:border-zinc-700 focus:border-accent bg-white dark:bg-zinc-800 transition-all font-medium text-foreground text-base","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Is,{checked:N.isActive,onCheckedChange:a=>M(s=>({...s,isActive:a})),"data-testid":"switch-discount-active"}),e.jsx(d,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs($,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ue({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{try{const a={code:N.code,discountType:N.discountType,discountValue:parseInt(N.discountValue),minOrderAmount:N.minOrderAmount?parseInt(N.minOrderAmount)*100:null,maxUses:N.maxUses?parseInt(N.maxUses):null,validFrom:N.validFrom||null,validUntil:N.validUntil||null,isActive:N.isActive};H.code?(await g("PATCH",`/api/admin/discount-codes/${H.code.id}`,a),n({title:"Código actualizado"})):(await g("POST","/api/admin/discount-codes",a),n({title:"Código creado"})),xs(),ue({open:!1,code:null})}catch(a){n({title:"Error",description:a.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!N.code||!N.discountValue,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-discount",children:H.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(P,{open:Ms,onOpenChange:a=>{ua(a),a||pa("")},children:e.jsxs(A,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(K,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary block mb-2",children:"Código de verificación"}),e.jsx(c,{value:he,onChange:a=>pa(a.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(t,{onClick:async()=>{if(!he||he.length<6){n({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}rs(!0);try{(await(await g("POST","/api/auth/verify-email",{code:he})).json()).success&&(await b.refetchQueries({queryKey:["/api/auth/user"]}),n({title:"Email verificado correctamente"}),ua(!1),pa(""))}catch(a){n({title:"Código incorrecto",description:a.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{rs(!1)}},disabled:ts||he.length<6,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full","data-testid":"button-verify-email-code",children:ts?e.jsx(G,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(t,{variant:"link",onClick:async()=>{ns(!0);try{await g("POST","/api/auth/resend-verification"),n({title:"Código enviado",description:"Revisa tu email"})}catch{n({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{ns(!1)}},disabled:ds,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:ds?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(P,{open:se.open,onOpenChange:a=>{$e({open:a,user:a?se.user:null}),a||(oa(""),ma(""),xa(""))},children:e.jsxs(A,{className:"rounded-2xl sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(L,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(K,{children:["Envía un enlace de pago a ",se.user?.firstName," ",se.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary block mb-2",children:"Link de pago (URL)"}),e.jsx(c,{value:qe,onChange:a=>oa(a.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary block mb-2",children:"Importe"}),e.jsx(c,{value:pe,onChange:a=>ma(a.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-black text-primary block mb-2",children:"Mensaje (opcional)"}),e.jsx(B,{value:es,onChange:a=>xa(a.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>$e({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!qe||!pe){n({title:"Completa todos los campos requeridos",variant:"destructive"});return}ss(!0);try{await g("POST","/api/admin/send-payment-link",{userId:se.user?.id,paymentLink:qe,amount:pe,message:es||`Por favor, completa el pago de ${pe} a través del siguiente enlace.`}),n({title:"Link de pago enviado",description:`Se ha enviado el link a ${se.user?.email}`}),$e({open:!1,user:null}),oa(""),ma(""),xa("")}catch(a){n({title:"Error",description:a.message||"No se pudo enviar el link",variant:"destructive"})}finally{ss(!1)}},disabled:as||!qe||!pe,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-payment-link",children:as?e.jsx(G,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(As,{})]})}export{Ft as default};
