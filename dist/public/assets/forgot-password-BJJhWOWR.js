import{a as c,j as e,x as V,t as j,af as A,F as B,H as G}from"./react-vendor-0u4i6o3R.js";import{a as w,t as N}from"./forms-soYwKzaw.js";import{m as y}from"./vendor-CcWLwBcD.js";import{N as k,F as C,a as b}from"./index-CLIhc-sl.js";import{u as H,B as u,F as S,G as q,H as z,J as n}from"./ui-components-C65bcPfg.js";import{F as g}from"./form-input-CdSK3oz0.js";import{o as P,s as v}from"./validation-D376FIhw.js";import"./tanstack-BGyfl4P4.js";import"./i18n-CerrjaX-.js";import"./radix-ui-CJuqdRty.js";const J=P({email:v().email("Email inválido")}),M=P({password:v().min(8,"La contraseña debe tener al menos 8 caracteres"),confirmPassword:v()}).refine(s=>s.password===s.confirmPassword,{message:"Las contraseñas no coinciden",path:["confirmPassword"]});function ee(){const[s,i]=c.useState(!1),[r,l]=c.useState("email"),[h,E]=c.useState(""),[d,F]=c.useState(""),[m,O]=c.useState(!1),{toast:t}=H(),f=w({resolver:N(J),defaultValues:{email:""}}),x=w({resolver:N(M),defaultValues:{password:"",confirmPassword:""}}),T=async o=>{i(!0);try{const a=await b("POST","/api/password-reset/send-otp",o);if(a.ok)E(o.email),l("otp"),t({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación"});else{const p=await a.json();t({title:"Error",description:p.message||"No se pudo enviar el código",variant:"destructive"})}}catch{t({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{i(!1)}},L=async()=>{if(d.length!==6){t({title:"Error",description:"Ingresa el código de 6 dígitos",variant:"destructive"});return}l("password")},R=async o=>{i(!0);try{const a=await b("POST","/api/password-reset/confirm",{email:h,otp:d,newPassword:o.password}),p=await a.json();a.ok&&p.success?l("success"):t({title:"Error",description:p.message||"Código inválido o expirado",variant:"destructive"})}catch(a){t({title:"Error",description:a.message||"No se pudo restablecer la contraseña",variant:"destructive"})}finally{i(!1)}},I=async()=>{i(!0);try{(await b("POST","/api/password-reset/send-otp",{email:h})).ok?t({title:"Código reenviado",description:"Revisa tu email"}):t({title:"Error",description:"No se pudo reenviar el código",variant:"destructive"})}catch{t({title:"Error",description:"No se pudo reenviar el código",variant:"destructive"})}finally{i(!1)}};return r==="success"?e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(k,{}),e.jsx("main",{className:"pt-24 pb-16 px-5 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(V,{className:"w-8 h-8 text-primary"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-black text-primary tracking-tight mb-4",children:["Contraseña ",e.jsx("span",{className:"text-accent",children:"Actualizada"})]}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Tu contraseña ha sido restablecida correctamente."}),e.jsx(y,{href:"/login",children:e.jsx(u,{className:"rounded-full px-8 font-black bg-accent text-primary","data-testid":"button-go-to-login",children:"Iniciar Sesión"})})]})}),e.jsx(C,{})]}):e.jsxs("div",{className:"min-h-screen bg-background font-sans",children:[e.jsx(k,{}),e.jsx("main",{className:"pt-20 md:pt-24 pb-12 md:pb-16 px-4 sm:px-6 flex flex-col items-center justify-center min-h-[80vh]",children:e.jsxs("div",{className:"w-full max-w-sm md:max-w-md",children:[e.jsxs("div",{className:"text-center mb-5 md:mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-black text-primary tracking-tight",children:["Recuperar ",e.jsx("span",{className:"text-accent",children:"Contrasena"})]}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-sm md:text-base",children:[r==="email"&&"Te enviaremos un codigo",r==="otp"&&"Ingresa el codigo",r==="password"&&"Nueva contrasena"]})]}),r==="email"&&e.jsx(S,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(T),className:"space-y-6",children:[e.jsx(g,{control:f.control,name:"email",label:"Email",type:"email",inputMode:"email"}),e.jsx(u,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-send-otp",children:s?e.jsx(j,{className:"animate-spin w-4 h-4"}):"Enviar Codigo"})]})}),r==="otp"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Código enviado a: ",e.jsx("strong",{children:h})]}),e.jsx(q,{maxLength:6,value:d,onChange:F,"data-testid":"input-otp",children:e.jsxs(z,{children:[e.jsx(n,{index:0}),e.jsx(n,{index:1}),e.jsx(n,{index:2}),e.jsx(n,{index:3}),e.jsx(n,{index:4}),e.jsx(n,{index:5})]})})]}),e.jsx(u,{onClick:L,disabled:s||d.length!==6,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-verify-otp",children:s?e.jsx(j,{className:"animate-spin w-4 h-4"}):"Verificar"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:I,disabled:s,className:"text-sm text-muted-foreground hover:text-primary transition-colors","data-testid":"button-resend-otp",children:"¿No recibiste el código? Reenviar"})}),e.jsxs("button",{type:"button",onClick:()=>l("email"),className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors mx-auto",children:[e.jsx(A,{className:"w-4 h-4"})," Cambiar email"]})]}),r==="password"&&e.jsx(S,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(g,{control:x.control,name:"password",label:"Nueva Contraseña",type:m?"text":"password"}),e.jsx("button",{type:"button",onClick:()=>O(!m),className:"absolute right-4 top-[42px] text-muted-foreground hover:text-primary transition-colors",children:m?e.jsx(B,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx(g,{control:x.control,name:"confirmPassword",label:"Confirmar Contraseña",type:m?"text":"password"}),e.jsx(u,{type:"submit",disabled:s,className:"w-full bg-accent text-primary font-black h-11 md:h-12 rounded-full text-sm md:text-base shadow-lg shadow-accent/20 active:scale-95 transition-all","data-testid":"button-reset-password",children:s?e.jsx(j,{className:"animate-spin w-4 h-4"}):"Restablecer"})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(y,{href:"/login",children:e.jsx("span",{className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Volver al Login"})})})]})}),e.jsx(C,{})]})}export{ee as default};
