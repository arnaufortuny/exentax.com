import{a as d,j as e,Z as Ls,_ as Fs,$ as ba,y as Ve,a0 as ge,Q as zs,J as be,U as _a,a1 as Ba,a2 as ja,Y as fa,A as Os,a3 as de,w as Ga,W as Ke,N as Na,a4 as Ha,a5 as Wa,a6 as va,a7 as Ms,a8 as ya,x as $s,a9 as Ya,aa as Ja,ab as Za,ac as Qe,ad as wa,t as _,ae as Xa}from"./react-vendor-0u4i6o3R.js";import{u as et,N as ka,a as p,F as Ca,q as h}from"./index-CLIhc-sl.js";import{b as f,a as M}from"./tanstack-BGyfl4P4.js";import{u as Pa,C as o,a as je,B as t,r as Sa,s as Da,t as F,k as B,v as n,I as c,m as S,n as D,o as E,p as P,q as l,D as A,w as T,x as I,y as L,z as R,A as z,E as Aa}from"./ui-components-C65bcPfg.js";import{u as st,m as _e}from"./vendor-CcWLwBcD.js";import{S as at}from"./social-login-D1vIkujT.js";import"./i18n-CerrjaX-.js";import"./radix-ui-CJuqdRty.js";import"./forms-soYwKzaw.js";function Ea(G){return{pending:{label:"Pendiente",className:"bg-yellow-100 text-yellow-800"},paid:{label:"Pagado",className:"bg-blue-100 text-blue-800"},processing:{label:"En Proceso",className:"bg-purple-100 text-purple-800"},documents_ready:{label:"Docs. Listos",className:"bg-cyan-100 text-cyan-800"},completed:{label:"Completado",className:"bg-green-100 text-green-800"},cancelled:{label:"Cancelado",className:"bg-red-100 text-red-700 font-black"},filed:{label:"Presentado",className:"bg-indigo-100 text-indigo-800"},draft:{label:"Borrador",className:"bg-gray-100 text-gray-600"}}[G]||{label:G,className:"bg-gray-100 text-gray-600"}}function tt(){const{toast:G}=Pa(),{data:r,isLoading:U}=M({queryKey:["/api/newsletter/status"]}),W=f({mutationFn:async w=>{await p("POST",w?"/api/newsletter/subscribe":"/api/newsletter/unsubscribe",w?{email:void 0}:void 0)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/newsletter/status"]}),G({title:"Preferencia actualizada",description:"Tu suscripción ha sido actualizada correctamente."})}});return U?e.jsx("div",{className:"w-10 h-6 bg-gray-100 animate-pulse rounded-full"}):e.jsx(Aa,{checked:r?.isSubscribed,onCheckedChange:w=>W.mutate(w),disabled:W.isPending})}function kt(){const[,G]=st(),{user:r,isAuthenticated:U,isLoading:W}=et(),[w,Be]=d.useState("services"),[v,Ge]=d.useState(!1),[u,k]=d.useState({firstName:"",lastName:"",phone:"",businessActivity:"",address:"",streetType:"",city:"",province:"",postalCode:"",country:"",idNumber:"",idType:"",birthDate:""}),{toast:i}=Pa(),b=r?.accountStatus==="active"||r?.accountStatus==="vip",[m,N]=d.useState(null),[nt,rt]=d.useState({open:!1,user:null}),[dt,it]=d.useState(""),[lt,ct]=d.useState(""),[ot,mt]=d.useState(""),[ie,fe]=d.useState({open:!1,user:null}),[Ne,Us]=d.useState(""),[qs,Rs]=d.useState(""),[ve,ye]=d.useState({open:!1,user:null}),[He,Vs]=d.useState(""),[We,Ks]=d.useState(""),[Ta,xt]=d.useState("info"),[Y,we]=d.useState({open:!1,user:null}),[Ye,Qs]=d.useState(""),[Je,_s]=d.useState(""),[Bs,Gs]=d.useState("EUR"),[V,Ia]=d.useState("dashboard"),[La,ke]=d.useState(!1),[K,J]=d.useState({firstName:"",lastName:"",email:"",phone:"",password:""}),[Fa,Ce]=d.useState(!1),[Z,Se]=d.useState({userId:"",productId:"1",amount:"",state:"New Mexico"}),[X,De]=d.useState({open:!1,user:null}),[za,Ze]=d.useState(!1),[ee,Ee]=d.useState({open:!1,file:null}),[le,Hs]=d.useState("passport"),[Pe,Ws]=d.useState(""),[Ys,Xe]=d.useState(!1),[Js,es]=d.useState("form"),[ss,as]=d.useState(""),[H,ts]=d.useState(""),[Ae,ns]=d.useState(""),[rs,ds]=d.useState(""),[Q,ce]=d.useState({open:!1,code:null}),[se,Te]=d.useState({open:!1,user:null}),[Ie,is]=d.useState(""),[oe,ls]=d.useState(""),[Zs,cs]=d.useState(""),[Xs,ea]=d.useState(!1),[Oa,os]=d.useState(!1),[me,ms]=d.useState(""),[sa,aa]=d.useState(!1),[ta,na]=d.useState(!1),[g,$]=d.useState({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0});d.useEffect(()=>{r&&k({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",businessActivity:r.businessActivity||"",address:r.address||"",streetType:r.streetType||"",city:r.city||"",province:r.province||"",postalCode:r.postalCode||"",country:r.country||"",idNumber:r.idNumber||"",idType:r.idType||"",birthDate:r.birthDate||""})},[r]);const ra=f({mutationFn:async s=>{if(!b)throw new Error("No puedes modificar tus datos en el estado actual de tu cuenta.");await p("PATCH","/api/user/profile",s)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/auth/user"]}),Ge(!1),i({title:"Perfil actualizado"})},onError:s=>{i({title:"Error",description:s.message,variant:"destructive"})}});d.useEffect(()=>{!W&&!U&&G("/login")},[U,W,G]);const{data:O,isLoading:ut}=M({queryKey:["/api/orders"],enabled:U,refetchInterval:3e4,staleTime:1e4}),{data:xs,isLoading:pt}=M({queryKey:["/api/messages"],enabled:U,refetchInterval:6e4,staleTime:3e4}),[Le,us]=d.useState(null),[xe,ps]=d.useState(""),da=O?.[0]?.id,{data:Fe}=M({queryKey:["/api/orders",da,"events"],enabled:!!da,refetchInterval:3e4,staleTime:1e4}),ue=f({mutationFn:async s=>{await p("POST",`/api/messages/${s}/reply`,{content:xe})},onSuccess:()=>{ps(""),us(null),h.invalidateQueries({queryKey:["/api/messages"]}),h.invalidateQueries({queryKey:["/api/admin/messages"]}),i({title:"Respuesta enviada",description:r?.isAdmin?"El cliente recibirá una notificación por email.":"Tu mensaje ha sido registrado."})}}),{data:hs,isLoading:Ma}=M({queryKey:["/api/user/notifications"],enabled:U,refetchInterval:6e4,staleTime:3e4}),$a=f({mutationFn:async s=>{await p("PATCH",`/api/user/notifications/${s}/read`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/notifications"]})}}),{data:ze}=M({queryKey:["/api/admin/orders"],enabled:!!r?.isAdmin,refetchInterval:3e4}),{data:ia}=M({queryKey:["/api/admin/users"],enabled:!!r?.isAdmin,refetchInterval:6e4}),{data:pe}=M({queryKey:["/api/admin/newsletter"],enabled:!!r?.isAdmin}),{data:y}=M({queryKey:["/api/admin/system-stats"],enabled:!!r?.isAdmin,refetchInterval:1e4,staleTime:5e3}),{data:gs}=M({queryKey:["/api/admin/messages"],enabled:!!r?.isAdmin}),{data:bs,refetch:la}=M({queryKey:["/api/admin/discount-codes"],enabled:!!r?.isAdmin}),[js,ca]=d.useState(""),[fs,oa]=d.useState(""),Ns=f({mutationFn:async({subject:s,message:a})=>{await p("POST","/api/admin/newsletter/broadcast",{subject:s,message:a})},onSuccess:()=>{i({title:"Emails enviados",description:"Se ha enviado a todos los suscriptores del newsletter"}),ca(""),oa("")},onError:()=>{i({title:"Error",description:"No se pudieron enviar los emails",variant:"destructive"})}}),{data:Ua}=M({queryKey:["/api/user/documents"],enabled:U});f({mutationFn:async s=>(await p("POST","/api/admin/documents",s)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Documento subido",description:"El cliente ya puede verlo en su panel."})}});const qa=f({mutationFn:async({id:s,status:a})=>(await p("PATCH",`/api/admin/orders/${s}/status`,{status:a})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),i({title:"Estado actualizado"})}}),he=f({mutationFn:async({appId:s,field:a,value:x})=>{await p("PATCH",`/api/admin/llc/${s}/dates`,{field:a,value:x})},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),h.invalidateQueries({queryKey:["/api/orders"]}),i({title:"Fecha actualizada"})},onError:()=>{i({title:"Error",description:"No se pudo actualizar la fecha",variant:"destructive"})}}),ae=f({mutationFn:async({userId:s,title:a,message:x,type:j})=>{await p("POST","/api/admin/send-note",{userId:s,title:a,message:x,type:j})},onSuccess:()=>{i({title:"Nota enviada",description:"El cliente recibirá notificación y email"}),ye({open:!1,user:null}),Vs(""),Ks("")}}),Oe=f({mutationFn:async s=>{const{id:a,...x}=s;await p("PATCH",`/api/admin/users/${a}`,x)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario actualizado"}),N(null)},onError:s=>{i({title:"Error",description:s.message,variant:"destructive"})}}),vs=f({mutationFn:async s=>{await p("DELETE",`/api/admin/users/${s}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario eliminado"}),De({open:!1,user:null})},onError:()=>{i({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),[q,Me]=d.useState({open:!1,order:null}),[te,$e]=d.useState({open:!1,order:null}),[ne,ma]=d.useState(""),[ys,xa]=d.useState("EUR"),ws=f({mutationFn:async s=>{await p("DELETE",`/api/admin/orders/${s}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:["/api/notifications"]}),h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Pedido eliminado",description:"El pedido y sus datos asociados han sido eliminados."}),Me({open:!1,order:null})},onError:()=>{i({title:"Error",description:"No se pudo eliminar el pedido",variant:"destructive"})}}),ks=f({mutationFn:async({userId:s,concept:a,amount:x,currency:j})=>{await p("POST","/api/admin/invoices/create",{userId:s,concept:a,amount:x,currency:j})},onSuccess:()=>{i({title:"Factura creada",description:"La factura se ha añadido al centro de documentos del cliente"}),we({open:!1,user:null}),Qs(""),_s(""),Gs("EUR")},onError:()=>{i({title:"Error",description:"No se pudo crear la factura",variant:"destructive"})}}),Cs=f({mutationFn:async s=>(await p("POST","/api/admin/users/create",s)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/users"]}),i({title:"Usuario creado",description:"El usuario ha sido registrado correctamente"}),ke(!1),J({firstName:"",lastName:"",email:"",phone:"",password:""})},onError:()=>{i({title:"Error",description:"No se pudo crear el usuario",variant:"destructive"})}}),Ss=f({mutationFn:async s=>(await p("POST","/api/admin/orders/create",s)).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/admin/orders"]}),i({title:"Pedido creado",description:"El pedido ha sido registrado correctamente"}),Ce(!1),Se({userId:"",productId:"1",amount:"",state:"New Mexico"})},onError:()=>{i({title:"Error",description:"No se pudo crear el pedido",variant:"destructive"})}}),ua=f({mutationFn:async s=>{await p("DELETE",`/api/user/documents/${s}`)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/user/documents"]}),i({title:"Documento eliminado"})},onError:s=>{i({title:"Error",description:s?.message||"No se pudo eliminar el documento",variant:"destructive"})}}),Ds=f({mutationFn:async()=>{await p("DELETE","/api/user/account")},onSuccess:()=>{i({title:"Cuenta eliminada",description:"Tu cuenta ha sido eliminada correctamente."}),window.location.href="/"},onError:()=>{i({title:"Error",description:"No se pudo eliminar la cuenta",variant:"destructive"})}}),Es=f({mutationFn:async()=>{await p("POST","/api/user/request-password-otp")},onSuccess:()=>{i({title:"Código enviado",description:"Revisa tu email para obtener el código de verificación."}),es("otp")},onError:s=>{i({title:"Error",description:s.message||"No se pudo enviar el código",variant:"destructive"})}}),Ps=f({mutationFn:async s=>{await p("POST","/api/user/change-password",s)},onSuccess:()=>{i({title:"Contraseña actualizada",description:"Tu contraseña ha sido cambiada correctamente."}),Xe(!1),es("form"),as(""),ts(""),ns(""),ds("")},onError:s=>{i({title:"Error",description:s.message||"No se pudo cambiar la contraseña",variant:"destructive"})}});if(W||!U)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-accent border-t-transparent rounded-full animate-spin"})});if(r?.accountStatus==="deactivated")return e.jsxs("div",{className:"min-h-screen bg-muted font-sans flex flex-col",children:[e.jsx(ka,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full",children:e.jsxs(o,{className:"rounded-[2rem] border-0 shadow-2xl overflow-hidden bg-white dark:bg-zinc-900",children:[e.jsx("div",{className:"bg-red-500 h-2 w-full"}),e.jsxs(je,{className:"p-8 md:p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ls,{className:"w-10 h-10 text-red-500"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-black text-primary tracking-tight mb-4",children:"Tu cuenta ha sido desactivada"}),e.jsx("p",{className:"text-muted-foreground font-medium leading-relaxed mb-8",children:"Revisa tu email, deberías haber recibido una nota de nuestro equipo con más información. No puedes enviar formularios ni solicitudes mientras tu cuenta esté desactivada."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(t,{className:"w-full bg-accent text-primary font-black rounded-full h-11 md:h-12 shadow-lg shadow-accent/20",children:"Contactar Soporte"})}),e.jsx(t,{variant:"ghost",className:"w-full font-black text-muted-foreground",onClick:()=>p("POST","/api/logout").then(()=>window.location.href="/"),children:"Cerrar Sesión"})]})]})]})})}),e.jsx(Ca,{})]});const Ra=[{id:"services",label:"Mis Servicios",icon:Fs,mobileLabel:"Servicios"},{id:"notifications",label:"Seguimiento",icon:ba,mobileLabel:"Seguim."},{id:"messages",label:"¿Necesitas ayuda?",icon:Ve,mobileLabel:"Ayuda"},{id:"documents",label:"Documentos",icon:ge,mobileLabel:"Docs"},{id:"payments",label:"Pagos",icon:zs,mobileLabel:"Pagos"},{id:"calendar",label:"Calendario",icon:be,mobileLabel:"Fechas"},{id:"profile",label:"Mi Perfil",icon:_a,mobileLabel:"Perfil"},...r?.isAdmin?[{id:"admin",label:"Admin",icon:Ba,mobileLabel:"Admin"}]:[]];return e.jsxs("div",{className:"min-h-screen bg-muted font-sans",children:[e.jsx(ka,{}),e.jsxs("main",{className:"pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto",children:[e.jsx("header",{className:"mb-6 md:mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-accent font-black tracking-widest text-[10px] md:text-xs mb-1 uppercase",children:"Área de Clientes"}),e.jsxs("h1",{className:"text-2xl md:text-4xl font-black text-primary tracking-tighter leading-tight",children:["Bienvenido, ",r?.firstName||"Cliente"]}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Tu espacio privado de gestión"})]}),e.jsx(_e,{href:"/servicios#pricing",children:e.jsxs(t,{className:"w-full md:w-auto bg-accent text-primary font-black rounded-full px-5 md:px-8 h-10 md:h-12 transition-all shadow-xl shadow-primary/20 flex items-center justify-center gap-2 text-sm md:text-base",children:[e.jsx(ja,{className:"w-5 h-5"})," Nueva LLC"]})})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-3 mb-6 gap-1.5 no-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:gap-2 md:pb-4 md:mb-8",children:Ra.map(s=>e.jsxs(t,{variant:w===s.id?"default":"outline",onClick:()=>Be(s.id),size:"sm",className:`flex items-center gap-1.5 md:gap-2 rounded-full font-bold text-[11px] md:text-xs tracking-tight whitespace-nowrap shrink-0 ${w===s.id?"bg-accent text-primary shadow-lg shadow-accent/20":"bg-white dark:bg-zinc-900 text-muted-foreground border-0"}`,"data-testid":`button-tab-${s.id}`,children:[e.jsx(s.icon,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.mobileLabel})]},s.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6 order-1",children:[w==="services"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Mis Servicios"}),e.jsx("p",{className:"text-[11px] md:text-xs text-muted-foreground font-medium",children:"Gestiona tus trámites activos"})]}),!O||O.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm bg-white dark:bg-zinc-900 p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center",children:e.jsx(Fs,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-primary mb-2",children:"Ningún servicio activo"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"¡Crea tu LLC hoy mismo! Conoce nuestros packs."})]}),e.jsx(_e,{href:"/servicios#pricing",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full px-8 py-3","data-testid":"button-view-packs",children:"Ver Packs"})})]})}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:gap-4",children:O.map(s=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm hover:shadow-md transition-shadow bg-white dark:bg-zinc-900 overflow-hidden",children:[e.jsx(Sa,{className:"bg-primary/5 pb-3 md:pb-4 p-3 md:p-6",children:e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[9px] md:text-[10px] font-black text-accent uppercase tracking-widest mb-1",children:["Pedido: ",s.application?.requestCode||s.maintenanceApplication?.requestCode||s.invoiceNumber||s.id]}),e.jsx(Da,{className:"text-base md:text-lg font-black text-primary truncate",children:s.maintenanceApplication?`Mantenimiento ${s.maintenanceApplication.state||s.product?.name?.replace(" LLC","")||""}`:s.application?.companyName?`${s.application.companyName} LLC`:s.product?.name||"LLC pendiente"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-0.5",children:s.application?.state||s.maintenanceApplication?.state||""})]}),e.jsx(F,{className:`${Ea(s.status).className} font-black uppercase text-[9px] md:text-[10px] shrink-0`,"data-testid":`badge-order-status-${s.id}`,children:Ea(s.status).label})]})}),e.jsxs(je,{className:"pt-4 md:pt-6 p-3 md:p-6",children:[e.jsxs("div",{className:"relative pl-5 md:pl-6 space-y-3 md:space-y-4 before:absolute before:left-1.5 md:before:left-2 before:top-2 before:bottom-2 before:w-0.5 before:bg-gray-100",children:[s.events?.slice(0,3).map((a,x)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-[1.1rem] md:-left-[1.35rem] top-1 md:top-1.5 w-2.5 h-2.5 md:w-3 md:h-3 rounded-full border-2 border-white ${x===0?"bg-accent animate-pulse":"bg-gray-300"}`}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("p",{className:`text-[11px] md:text-xs font-bold ${x===0?"text-primary":"text-muted-foreground"}`,children:a.eventType}),e.jsx("span",{className:"text-[9px] text-muted-foreground shrink-0",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground line-clamp-1",children:a.description})]},x)),!s.events?.length&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[1.35rem] top-1.5 w-3 h-3 rounded-full border-2 border-white bg-accent animate-pulse"}),e.jsx("p",{className:"text-xs font-black text-primary",children:"Pedido Recibido"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.application?.status==="submitted"||s.maintenanceApplication?.status==="submitted"?"Formulario completado.":s.application?.status==="pending"||s.maintenanceApplication?.status==="pending"?"Falta información del formulario.":s.status==="completed"||s.status==="filed"?"Proceso completado.":"Estamos procesando tu solicitud."})]})]}),s.status==="pending"&&s.application&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-50 flex gap-2",children:e.jsx(t,{variant:"outline",size:"sm",className:"flex-1 text-[10px] h-8 rounded-full font-black",onClick:()=>window.location.href=`/llc/formation?edit=${s.application.id}`,"data-testid":`button-modify-order-${s.id}`,children:"MODIFICAR DATOS"})})]})]},s.id))})]},"services"),w==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Notificaciones"}),Ma?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-24 bg-muted rounded-2xl animate-pulse"},s))}):hs?.length===0?e.jsx(o,{className:"rounded-2xl border-0 shadow-sm",children:e.jsxs(je,{className:"p-8 text-center",children:[e.jsx(ba,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No tienes notificaciones"})]})}):e.jsx("div",{className:"space-y-3",children:hs?.map(s=>e.jsx(o,{className:`rounded-2xl border-0 shadow-sm transition-all hover:shadow-md ${s.isRead?"":"bg-accent/5 border-l-4 border-l-accent"}`,children:e.jsx(je,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[s.orderCode&&e.jsxs("span",{className:"text-[10px] bg-primary/10 text-primary px-2 py-1 rounded-full font-black",children:["Pedido: ",s.orderCode]}),s.type==="action_required"&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-2 py-1 rounded-full font-black",children:"ACCIÓN REQUERIDA"}),s.type==="update"&&e.jsx("span",{className:"text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-black",children:"ACTUALIZACIÓN"}),s.type==="info"&&e.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-700 px-2 py-1 rounded-full font-black",children:"INFORMACIÓN"}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("h3",{className:"font-black text-sm md:text-base",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.message}),s.type==="action_required"&&b&&e.jsxs(t,{className:"mt-3 bg-accent text-primary font-black rounded-full text-xs px-4 gap-2",onClick:()=>{$a.mutate(s.id),Be("documents")},"data-testid":`button-upload-document-${s.id}`,children:[e.jsx(fa,{className:"w-3 h-3"}),"Subir Documento"]})]}),!s.isRead&&e.jsx("div",{className:"w-2 h-2 bg-accent rounded-full flex-shrink-0 mt-2"})]})})},s.id))})]},"notifications"),w==="messages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Mis Consultas y Soporte"}),e.jsx(_e,{href:"/contacto",children:e.jsx(t,{className:"bg-accent text-primary font-black rounded-full text-xs",children:"Nueva Consulta"})})]}),e.jsx("div",{className:"space-y-4",children:!xs||xs.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(Os,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no hay mensajes"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus conversaciones con soporte aparecerán aquí"})]}):xs.map(s=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 bg-white dark:bg-zinc-900 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>us(Le?.id===s.id?null:s),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-4 h-4 text-accent"}),e.jsx("h4",{className:"font-black text-primary",children:s.subject||"Sin asunto"})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.messageId||s.id})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:s.content}),Le?.id===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-4",children:[e.jsx(B,{value:xe,onChange:a=>ps(a.target.value),placeholder:"Escribe tu respuesta...",className:"rounded-xl min-h-[80px] text-sm"}),e.jsx(t,{onClick:a=>{a.stopPropagation(),ue.mutate(s.id)},disabled:!xe.trim()||ue.isPending,className:"bg-accent text-primary font-black rounded-full px-6",children:"Enviar Respuesta"})]})]},s.id))})]},"messages"),w==="documents"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight mb-6",children:"Centro de Documentación"}),hs?.some(s=>s.type==="action_required"&&!s.isRead)&&e.jsx(o,{className:"rounded-xl border-2 border-orange-200 bg-orange-50 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-orange-800 text-sm",children:"Documentos Solicitados"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"Tienes solicitudes de documentos pendientes. Por favor, sube los documentos requeridos."}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async s=>{const a=s.target.files?.[0];if(!a)return;const x=new FormData;x.append("file",a);try{(await fetch("/api/user/documents/upload",{method:"POST",body:x,credentials:"include"})).ok?(i({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),h.invalidateQueries({queryKey:["/api/user/documents"]})):i({title:"Error",description:"No se pudo subir el documento",variant:"destructive"})}catch{i({title:"Error",description:"Error de conexión",variant:"destructive"})}},"data-testid":"input-upload-document"}),e.jsx(t,{variant:"outline",className:"rounded-full text-xs border-orange-300 text-orange-700",asChild:!0,children:e.jsxs("span",{children:[e.jsx(de,{className:"w-3 h-3 mr-1"})," Subir Documento"]})})]})})]})]})}),e.jsx(o,{className:"rounded-2xl border-2 border-dashed border-accent/50 bg-accent/5 p-4 md:p-6 mb-4",children:e.jsxs("label",{className:"cursor-pointer w-full block",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:s=>{const a=s.target.files?.[0];a&&(Ee({open:!0,file:a}),Hs("passport"),Ws(""))},"data-testid":"input-upload-new-document"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-accent/20 flex items-center justify-center shrink-0",children:e.jsx(fa,{className:"w-7 h-7 md:w-8 md:h-8 text-accent"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-black text-primary text-base md:text-lg",children:"Subir Documento"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"PDF, JPG o PNG (máx. 10MB)"})]}),e.jsxs(t,{size:"lg",className:"rounded-full font-black bg-accent text-primary shrink-0",children:[e.jsx(de,{className:"w-5 h-5 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"SUBIR"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ua?.map(s=>e.jsxs(o,{className:"rounded-xl md:rounded-2xl border-0 shadow-sm p-4 md:p-6 flex flex-col items-center text-center bg-white dark:bg-zinc-900",children:[e.jsx(de,{className:"w-10 h-10 md:w-12 md:h-12 text-accent mb-3"}),e.jsx("h3",{className:"font-bold text-primary mb-1 text-xs md:text-sm line-clamp-2",children:s.fileName}),e.jsx("p",{className:"text-[9px] md:text-[10px] text-muted-foreground mb-3",children:new Date(s.createdAt||s.uploadedAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full font-bold flex-1 text-[10px] md:text-xs",onClick:()=>window.open(s.fileUrl,"_blank"),"data-testid":`button-download-doc-${s.id}`,children:[e.jsx(Ga,{className:"w-3 h-3 mr-1"})," Descargar"]}),b&&e.jsx(t,{variant:"outline",size:"icon",className:"rounded-full text-red-500 shrink-0",onClick:()=>ua.mutate(s.id),disabled:ua.isPending,"data-testid":`button-delete-doc-${s.id}`,children:e.jsx(Ke,{className:"w-3 h-3"})})]})]},s.id))})]},"documents"),w==="payments"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-primary tracking-tight",children:"Historial de Pagos"}),e.jsx("div",{className:"space-y-4",children:!O||O.length===0?e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(zs,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Todavía no has contratado ningún servicio"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Tus facturas y recibos aparecerán aquí"})]}):O.map(s=>e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-6 flex justify-between items-center bg-white dark:bg-zinc-900",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-xs md:text-sm",children:["Factura ",s.application?.requestCode||s.maintenanceApplication?.requestCode||s.invoiceNumber]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${s.id}/invoice`,"_blank"),children:"Factura"}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(`/api/orders/${s.id}/receipt`,"_blank"),children:"Recibo"})]})]},s.id))})]},"payments"),w==="calendar"&&e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 md:mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-2xl font-black text-primary tracking-tight",children:"Calendario Fiscal"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium",children:"Fechas importantes y vencimientos de tu LLC"})]})}),O&&O.length>0?e.jsx("div",{className:"space-y-4 md:space-y-6",children:O.map(s=>{const a=s.application;if(!a)return null;const x=s.status==="cancelled",j=["pending","paid","processing"].includes(s.status),pa=["Wyoming","Delaware","WY","DE"].includes(a.state),Ue=[{label:"Creación",fullLabel:"Creación de LLC",date:a.llcCreatedDate,icon:Na,bgColor:"bg-accent/10",textColor:"text-accent",borderColor:"border-accent/20"},{label:"Agente",fullLabel:"Renovación Agente Registrado",date:a.agentRenewalDate,icon:Ha,bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",borderColor:"border-blue-200 dark:border-blue-800"},{label:"IRS 1120",fullLabel:"Formulario IRS 1120",date:a.irs1120DueDate,icon:ge,bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",borderColor:"border-orange-200 dark:border-orange-800"},{label:"IRS 5472",fullLabel:"Formulario IRS 5472",date:a.irs5472DueDate,icon:ge,bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",borderColor:"border-red-200 dark:border-red-800"},...pa?[{label:"Anual",fullLabel:`Reporte Anual ${a.state}`,date:a.annualReportDueDate,icon:Wa,bgColor:"bg-purple-50 dark:bg-purple-900/20",textColor:"text-purple-600 dark:text-purple-400",borderColor:"border-purple-200 dark:border-purple-800"}]:[]],As=Ue.some(C=>C.date),ha=Ue.filter(C=>C.date).sort((C,Ts)=>new Date(C.date).getTime()-new Date(Ts.date).getTime()),qe=ha.find(C=>new Date(C.date)>new Date);return e.jsxs(o,{className:`rounded-xl md:rounded-2xl border shadow-sm bg-white dark:bg-zinc-900 overflow-hidden ${x?"opacity-50":""}`,children:[e.jsx(Sa,{className:"p-3 md:p-4 pb-2 md:pb-3 border-b bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs(Da,{className:"text-sm md:text-base font-black flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-accent/10 flex items-center justify-center shrink-0",children:e.jsx(Na,{className:"w-4 h-4 md:w-5 md:h-5 text-accent"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm md:text-base",children:a.companyName||"LLC en proceso"}),e.jsx("span",{className:"text-[10px] md:text-xs font-normal text-muted-foreground",children:a.state})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[x&&e.jsx(F,{variant:"destructive",className:"text-[9px] md:text-[10px]",children:"Cancelada"}),j&&e.jsx(F,{className:"text-[9px] md:text-[10px] bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"En revisión"}),!x&&!j&&qe&&e.jsxs(F,{className:`text-[9px] md:text-[10px] ${qe.bgColor} ${qe.textColor}`,children:["Próximo: ",qe.label]})]})]})}),e.jsx(je,{className:"p-3 md:p-4",children:x?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(va,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-red-300 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Esta LLC fue cancelada"})]}):j?e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(Ms,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-yellow-400 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Tu LLC está en proceso"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground mt-1",children:"Las fechas aparecerán cuando esté activa"})]}):As?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:ha.map((C,Ts)=>{const Re=new Date(C.date),ga=new Date,re=Math.ceil((Re.getTime()-ga.getTime())/(1e3*60*60*24)),Is=Re<ga,Va=!Is&&re<=30,Ka=!Is&&re<=60&&re>30,Qa=C.icon;return e.jsxs("div",{className:`relative p-3 md:p-4 rounded-lg md:rounded-xl border ${C.borderColor} ${C.bgColor} transition-all hover:shadow-md`,children:[e.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 mb-2 ${C.textColor}`,children:[e.jsx(Qa,{className:"w-3.5 h-3.5 md:w-4 md:h-4"}),e.jsx("span",{className:"font-bold text-[10px] md:text-xs truncate",children:C.label})]}),e.jsx("div",{className:"font-black text-xs md:text-sm text-foreground",children:Re.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:Re.getFullYear()}),Is?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(ya,{className:"w-3 h-3 text-green-500"}),e.jsx("span",{className:"text-[9px] md:text-[10px] text-green-600 dark:text-green-400 font-medium",children:"Completado"})]}):Va?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ls,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-red-600 dark:text-red-400 font-bold",children:[re," días"]})]}):Ka?e.jsxs("div",{className:"mt-1.5 md:mt-2 flex items-center gap-1",children:[e.jsx(Ms,{className:"w-3 h-3 text-orange-500"}),e.jsxs("span",{className:"text-[9px] md:text-[10px] text-orange-600 dark:text-orange-400 font-medium",children:[re," días"]})]}):e.jsx("div",{className:"mt-1.5 md:mt-2",children:e.jsxs("span",{className:"text-[9px] md:text-[10px] text-muted-foreground",children:[re," días"]})})]},Ts)})}):e.jsxs("div",{className:"text-center py-6 md:py-8",children:[e.jsx(be,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-2 md:mb-3"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Fechas pendientes de configuración"})]})})]},s.id)})}):e.jsxs(o,{className:"rounded-xl md:rounded-2xl border shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900 text-center",children:[e.jsx(be,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto text-muted-foreground/30 mb-3 md:mb-4"}),e.jsx("h3",{className:"text-base md:text-lg font-black text-primary mb-2",children:"Sin fechas programadas"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-4",children:"Contrata tu primera LLC para ver las fechas importantes"}),e.jsx(_e,{href:"/servicios#pricing",children:e.jsxs(t,{className:"bg-accent text-primary font-black rounded-full h-10 md:h-11 text-sm",children:[e.jsx(ja,{className:"w-4 h-4 mr-2"})," Comenzar"]})})]})]},"calendar"),w==="profile"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(o,{className:"rounded-[1.5rem] md:rounded-[2rem] border-0 shadow-sm p-6 md:p-8 bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-black",children:"Información Personal"}),b&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>Ge(!v),"data-testid":"button-toggle-edit",children:v?"Cancelar":"Editar"})]}),!b&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${r?.accountStatus==="pending"?"bg-orange-50 border border-orange-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${r?.accountStatus==="pending"?"text-orange-700":"text-red-700"}`,children:r?.accountStatus==="pending"?"Tu cuenta está en revisión. No puedes modificar tu perfil hasta que sea verificada.":"Tu cuenta ha sido desactivada. No puedes modificar tu perfil ni enviar solicitudes."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"ID Cliente"}),e.jsx("p",{className:"text-lg font-black font-mono",children:r?.clientId||r?.id?.slice(0,8).toUpperCase()})]}),e.jsxs("div",{className:"p-4 bg-accent/5 rounded-xl border border-accent/10",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-muted-foreground mb-1",children:"Estado"}),e.jsx("p",{className:`text-lg font-black ${r?.accountStatus==="active"?"text-green-600":r?.accountStatus==="pending"?"text-orange-500":r?.accountStatus==="deactivated"?"text-red-600":r?.accountStatus==="vip"?"text-yellow-600":"text-green-600"}`,children:r?.accountStatus==="active"?"Verificado":r?.accountStatus==="pending"?"En revisión":r?.accountStatus==="deactivated"?"Desactivada":r?.accountStatus==="vip"?"VIP":"Verificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Nombre"}),v&&b?e.jsx(c,{value:u.firstName,onChange:s=>k({...u,firstName:s.target.value}),"data-testid":"input-firstname"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.firstName||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Apellido"}),v&&b?e.jsx(c,{value:u.lastName,onChange:s=>k({...u,lastName:s.target.value}),"data-testid":"input-lastname"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.lastName||"-"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Email"}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg flex justify-between items-center text-sm",children:[e.jsx("span",{children:r?.email}),r?.emailVerified?e.jsx($s,{className:"w-4 h-4 text-green-500"}):e.jsx(t,{variant:"link",size:"sm",className:"text-accent p-0 h-auto text-xs font-black",onClick:()=>os(!0),"data-testid":"button-verify-email",children:"Verificar email"})]}),!r?.emailVerified&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Tu cuenta está en revisión hasta que verifiques tu email."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Teléfono"}),v&&b?e.jsx(c,{value:u.phone,onChange:s=>k({...u,phone:s.target.value}),"data-testid":"input-phone"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.phone||"No proporcionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Tipo de Documento"}),v&&b?e.jsxs(S,{value:u.idType,onValueChange:s=>k({...u,idType:s}),children:[e.jsx(D,{className:"bg-white dark:bg-zinc-900","data-testid":"select-idtype",children:e.jsx(E,{placeholder:"Seleccionar"})}),e.jsxs(P,{children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.idType==="dni"?"DNI":r?.idType==="nie"?"NIE":r?.idType==="passport"?"Pasaporte":"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Número de Documento"}),v&&b?e.jsx(c,{value:u.idNumber,onChange:s=>k({...u,idNumber:s.target.value}),placeholder:"Ej: 12345678A","data-testid":"input-idnumber"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.idNumber||"No proporcionado"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Fecha de Nacimiento"}),v&&b?e.jsx(c,{type:"date",value:u.birthDate,onChange:s=>k({...u,birthDate:s.target.value}),"data-testid":"input-birthdate"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.birthDate||"No proporcionado"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Actividad de Negocio"}),v&&b?e.jsxs(S,{value:u.businessActivity,onValueChange:s=>k({...u,businessActivity:s}),children:[e.jsx(D,{className:"bg-white dark:bg-zinc-900","data-testid":"select-activity",children:e.jsx(E,{placeholder:"Seleccionar actividad"})}),e.jsxs(P,{children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.businessActivity||"No proporcionado"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-bold text-sm mb-3",children:"Dirección"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Tipo de Vía"}),v&&b?e.jsxs(S,{value:u.streetType,onValueChange:s=>k({...u,streetType:s}),children:[e.jsx(D,{className:"bg-white dark:bg-zinc-900",children:e.jsx(E,{placeholder:"Seleccionar"})}),e.jsxs(P,{children:[e.jsx(l,{value:"calle",children:"Calle"}),e.jsx(l,{value:"avenida",children:"Avenida"}),e.jsx(l,{value:"paseo",children:"Paseo"}),e.jsx(l,{value:"plaza",children:"Plaza"})]})]}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.streetType||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Dirección"}),v&&b?e.jsx(c,{value:u.address,onChange:s=>k({...u,address:s.target.value}),placeholder:"Nombre de la calle y número"}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.address||"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Ciudad"}),v&&b?e.jsx(c,{value:u.city,onChange:s=>k({...u,city:s.target.value})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.city||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"Provincia"}),v&&b?e.jsx(c,{value:u.province,onChange:s=>k({...u,province:s.target.value})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.province||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"C.P."}),v&&b?e.jsx(c,{value:u.postalCode,onChange:s=>k({...u,postalCode:s.target.value})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.postalCode||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{children:"País"}),v&&b?e.jsx(c,{value:u.country,onChange:s=>k({...u,country:s.target.value})}):e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm",children:r?.country||"-"})]})]})]}),v&&b&&e.jsx(t,{onClick:()=>{ra.mutate(u),Ge(!1)},className:"w-full bg-accent text-primary font-black rounded-full mt-4",disabled:ra.isPending,"data-testid":"button-save-profile",children:"Guardar Cambios"})]}),e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Suscripción Newsletter"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recibe noticias y consejos para tu LLC."})]}),e.jsx(tt,{})]})}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contraseña de acceso."})]}),!Ys&&e.jsx(t,{variant:"outline",className:"rounded-full",onClick:()=>Xe(!0),"data-testid":"button-show-password-form",children:"Cambiar"})]}),Ys&&e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-xl",children:[Js==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Contraseña actual"}),e.jsx(c,{type:"password",value:ss,onChange:s=>as(s.target.value),"data-testid":"input-current-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Nueva contraseña"}),e.jsx(c,{type:"password",value:H,onChange:s=>ts(s.target.value),"data-testid":"input-new-password"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Confirmar nueva contraseña"}),e.jsx(c,{type:"password",value:Ae,onChange:s=>ns(s.target.value),"data-testid":"input-confirm-password"})]}),H&&Ae&&H!==Ae&&e.jsx("p",{className:"text-xs text-red-500",children:"Las contraseñas no coinciden"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{Xe(!1),as(""),ts(""),ns("")},children:"Cancelar"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Es.mutate(),disabled:!ss||!H||H!==Ae||H.length<8||Es.isPending,"data-testid":"button-request-otp",children:Es.isPending?"Enviando...":"Enviar código"})]})]}),Js==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center pb-2",children:[e.jsx(Ve,{className:"w-8 h-8 mx-auto text-accent mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ingresa el código de 6 dígitos enviado a tu email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{className:"text-xs",children:"Código de verificación"}),e.jsx(c,{type:"text",value:rs,onChange:s=>ds(s.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-mono",maxLength:6,inputMode:"numeric","data-testid":"input-password-otp"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(t,{variant:"outline",className:"rounded-full flex-1",onClick:()=>{es("form"),ds("")},children:"Volver"}),e.jsx(t,{className:"bg-accent text-primary font-black rounded-full flex-1",onClick:()=>Ps.mutate({currentPassword:ss,newPassword:H,otp:rs}),disabled:rs.length!==6||Ps.isPending,"data-testid":"button-save-password",children:Ps.isPending?"Guardando...":"Confirmar"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-primary",children:"Cuentas Conectadas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vincula tus cuentas sociales para iniciar sesion mas rapido."})]})}),e.jsx(at,{mode:"connect",googleConnected:!!r?.googleId,onSuccess:()=>h.refetchQueries({queryKey:["/api/auth/user"]})})]}),b&&e.jsx("div",{className:"mt-8 pt-8 border-t",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-red-600 text-sm",children:"Eliminar Cuenta"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Esta acción es irreversible. Se eliminarán todos tus datos."})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"border-red-200 text-red-600 rounded-full shrink-0",onClick:()=>Ze(!0),"data-testid":"button-delete-own-account",children:[e.jsx(Ke,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})})]})},"profile"),w==="admin"&&r?.isAdmin&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2 mb-4 md:mb-6",children:["dashboard","orders","users","calendar","newsletter","inbox","descuentos"].map(s=>e.jsxs(t,{variant:V===s?"default":"outline",onClick:()=>Ia(s),className:"rounded-full text-[10px] md:text-xs font-black capitalize px-2 md:px-3","data-testid":`button-admin-tab-${s}`,children:[e.jsx("span",{className:"hidden sm:inline",children:s==="dashboard"?"Métricas":s==="calendar"?"Fechas":s==="orders"?"Pedidos":s==="users"?"Clientes":s==="descuentos"?"Descuentos":s}),e.jsx("span",{className:"sm:hidden flex items-center justify-center",children:s==="dashboard"?e.jsx(Ya,{className:"w-5 h-5"}):s==="calendar"?e.jsx(be,{className:"w-5 h-5"}):s==="orders"?e.jsx(Fs,{className:"w-5 h-5"}):s==="users"?e.jsx(Ja,{className:"w-5 h-5"}):s==="newsletter"?e.jsx(Ve,{className:"w-5 h-5"}):s==="descuentos"?e.jsx(Za,{className:"w-5 h-5"}):e.jsx(Os,{className:"w-5 h-5"})})]},s))}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>ke(!0),"data-testid":"button-create-user",children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Cliente"}),e.jsx("span",{className:"sm:hidden",children:"Cliente"})]}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>Ce(!0),"data-testid":"button-create-order",children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo Pedido"}),e.jsx("span",{className:"sm:hidden",children:"Pedido"})]})]}),V==="dashboard"&&e.jsxs("div",{className:"space-y-4 md:space-y-6","data-testid":"admin-dashboard-metrics",children:[e.jsxs("div",{"data-testid":"section-sales",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-sales",children:"Ventas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Ventas"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-sales",children:((y?.totalSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendiente Cobro"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-sales",children:((y?.pendingSales||0)/100).toLocaleString("es-ES",{style:"currency",currency:"EUR"})})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pedidos Totales"}),e.jsx("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-orders",children:y?.orderCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Conversión"}),e.jsxs("p",{className:"text-lg md:text-2xl font-black text-green-600 dark:text-green-500","data-testid":"stat-conversion",children:[y?.conversionRate||0,"%"]})]})]})]}),e.jsxs("div",{"data-testid":"section-orders",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-orders",children:"Estado de Pedidos"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-orders",children:y?.pendingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Proceso"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-processing-orders",children:y?.processingOrders||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Completados"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-completed-orders",children:y?.completedOrders||0})]})]})]}),e.jsxs("div",{"data-testid":"section-crm",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-crm",children:"Clientes (CRM)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Total Usuarios"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-users",children:y?.userCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Activos"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-active-users",children:y?.activeAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"VIP"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-vip-users",children:y?.vipAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"En Revisión"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-accounts",children:y?.pendingAccounts||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Desactivadas"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-deactivated-users",children:y?.deactivatedAccounts||0})]})]})]}),e.jsxs("div",{"data-testid":"section-communications",children:[e.jsx("h3",{className:"text-sm font-bold mb-3","data-testid":"heading-communications",children:"Comunicaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3",children:[e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Suscriptores Newsletter"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-subscribers",children:y?.subscriberCount||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Totales"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-total-messages",children:y?.totalMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Mensajes Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-messages",children:y?.pendingMessages||0})]}),e.jsxs(o,{className:"p-3 md:p-4 rounded-xl border-0 shadow-sm bg-gradient-to-br from-green-50 to-white dark:from-green-950/20 dark:to-background",children:[e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"Docs Pendientes"}),e.jsx("p",{className:"text-xl md:text-3xl font-black text-green-600 dark:text-green-500","data-testid":"stat-pending-docs",children:y?.pendingDocs||0})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[10px] text-muted-foreground pt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Actualización en tiempo real cada 10 segundos"})]})]}),V==="orders"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:ze?.map(s=>{const a=s.application||s.maintenanceApplication,x=!!s.maintenanceApplication&&!s.application,j=a?.requestCode||s.invoiceNumber,Ue=a?.status==="submitted";return e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("p",{className:"font-black text-sm",children:j}),e.jsx(F,{className:`text-[9px] ${x?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:x?"MANTENIMIENTO":"LLC"}),!Ue&&e.jsx(F,{className:"text-[9px] bg-orange-100 text-orange-700",children:"FORMULARIO INCOMPLETO"})]}),e.jsx("p",{className:"text-xs font-semibold",children:a?.ownerFullName||`${s.user?.firstName||""} ${s.user?.lastName||""}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?.ownerEmail||s.user?.email}),a?.ownerPhone&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.ownerPhone}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("strong",{children:"Empresa:"})," ",a?.companyName||"No especificada"," • ",e.jsx("strong",{children:"Estado:"})," ",a?.state||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Producto:"})," ",s.product?.name," • ",e.jsx("strong",{children:"Monto:"})," ",(s.amount/100).toFixed(2),"€",s.discountCode&&e.jsxs("span",{className:"text-green-600 ml-2",children:["(Descuento: ",s.discountCode," -",(s.discountAmount/100).toFixed(2),"€)"]})]}),a?.businessCategory&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Categoría:"})," ",a.businessCategory]}),x&&a?.ein&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"EIN:"})," ",a.ein]})]}),e.jsxs(S,{value:s.status,onValueChange:As=>qa.mutate({id:s.id,status:As}),children:[e.jsx(D,{className:"w-28 h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border",children:e.jsx(E,{})}),e.jsxs(P,{children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"paid",children:"Pagado"}),e.jsx(l,{value:"filed",children:"Presentado"}),e.jsx(l,{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full",onClick:()=>window.open(`/api/admin/invoice/${s.id}`,"_blank"),"data-testid":`btn-view-invoice-${s.id}`,children:[e.jsx(ge,{className:"w-3 h-3 mr-1"})," Ver Factura"]}),e.jsxs(t,{size:"sm",variant:"default",className:"rounded-full bg-accent text-primary",onClick:()=>{ma(((s.amount||0)/100).toFixed(2)),xa("EUR"),$e({open:!0,order:s})},"data-testid":`btn-generate-invoice-${s.id}`,children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"})," Generar Factura"]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full text-red-600 border-red-200",onClick:()=>Me({open:!0,order:s}),"data-testid":`btn-delete-order-${s.id}`,children:[e.jsx(Ke,{className:"w-3 h-3 mr-1"})," Eliminar"]})]})]},s.id)})})}),V==="users"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsx("div",{className:"divide-y",children:ia?.map(s=>e.jsxs("div",{className:"p-3 md:p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-black text-sm",children:[s.firstName," ",s.lastName]}),e.jsx(F,{variant:s.accountStatus==="active"||s.accountStatus==="vip"?"default":"secondary",className:`text-[9px] ${s.accountStatus==="deactivated"?"bg-red-100 text-red-700":s.accountStatus==="vip"?"bg-yellow-100 text-yellow-700":s.accountStatus==="pending"?"bg-orange-100 text-orange-700":""}`,children:s.accountStatus==="active"?"VERIFICADO":s.accountStatus==="pending"?"EN REVISIÓN":s.accountStatus==="deactivated"?"DESACTIVADA":s.accountStatus==="vip"?"VIP":"VERIFICADO"}),s.isAdmin&&e.jsx(F,{className:"text-[9px] bg-purple-100 text-purple-700",children:"ADMIN"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[s.phone&&e.jsx("span",{className:"mr-2",children:s.phone}),s.businessActivity&&e.jsxs("span",{className:"mr-2",children:["• ",s.businessActivity]}),s.city&&e.jsxs("span",{children:["• ",s.city]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(n,{className:"text-[10px] text-muted-foreground mb-1 block",children:"Estado de cuenta"}),e.jsxs(S,{value:s.accountStatus||"active",onValueChange:a=>s.id&&Oe.mutate({id:s.id,accountStatus:a}),children:[e.jsx(D,{className:"w-full h-9 rounded-full text-xs bg-white dark:bg-zinc-900 border shadow-sm",children:e.jsx(E,{})}),e.jsxs(P,{children:[e.jsx(l,{value:"active",children:"Verificado"}),e.jsx(l,{value:"pending",children:"En revisión"}),e.jsx(l,{value:"deactivated",children:"Desactivada"}),e.jsx(l,{value:"vip",children:"VIP"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 w-full md:w-auto",children:[e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1",onClick:()=>N(s),"data-testid":`button-edit-user-${s.id}`,children:[e.jsx(wa,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Editar"})]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1",onClick:()=>ye({open:!0,user:s}),"data-testid":`button-note-user-${s.id}`,children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Mensaje"})]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1",onClick:()=>fe({open:!0,user:s}),"data-testid":`button-doc-user-${s.id}`,children:[e.jsx(de,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Docs"})]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1",onClick:()=>we({open:!0,user:s}),"data-testid":`button-invoice-user-${s.id}`,children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Factura"})]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1 text-accent border-accent/30",onClick:()=>Te({open:!0,user:s}),"data-testid":`button-payment-link-${s.id}`,children:[e.jsx(zs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Pago"})]}),e.jsxs(t,{size:"sm",variant:"outline",className:"rounded-full flex flex-col md:flex-row items-center justify-center gap-0.5 md:gap-1 text-red-600 border-red-200",onClick:()=>De({open:!0,user:s}),"data-testid":`button-delete-user-${s.id}`,children:[e.jsx(Ke,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[9px] md:text-[10px]",children:"Eliminar"})]})]})]},s.id))})}),V==="calendar"&&e.jsxs(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6 overflow-hidden",children:[e.jsxs("h4",{className:"font-black text-base md:text-lg mb-4 md:mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 md:w-8 md:h-8 rounded-xl bg-accent/20 flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 md:w-4 md:h-4 text-accent"})}),e.jsx("span",{children:"Gestión de Fechas Fiscales"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[ze?.map(s=>{const a=s.application;if(!a)return null;const x=a?.requestCode||s.invoiceNumber;return e.jsxs("div",{className:"border-2 rounded-2xl p-4 md:p-5 bg-gray-50/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-base md:text-lg",children:a.companyName||"LLC pendiente"}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground",children:[s.user?.firstName," ",s.user?.lastName," • ",a.state]})]}),e.jsx(F,{variant:"outline",className:"text-xs w-fit",children:x})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Creación LLC"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:a.llcCreatedDate?new Date(a.llcCreatedDate).toISOString().split("T")[0]:"",onChange:j=>he.mutate({appId:a.id,field:"llcCreatedDate",value:j.target.value}),"data-testid":`input-llc-created-${a.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Renovación Agente"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:a.agentRenewalDate?new Date(a.agentRenewalDate).toISOString().split("T")[0]:"",onChange:j=>he.mutate({appId:a.id,field:"agentRenewalDate",value:j.target.value}),"data-testid":`input-agent-renewal-${a.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 1120"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:a.irs1120DueDate?new Date(a.irs1120DueDate).toISOString().split("T")[0]:"",onChange:j=>he.mutate({appId:a.id,field:"irs1120DueDate",value:j.target.value}),"data-testid":`input-irs1120-${a.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"IRS 5472"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:a.irs5472DueDate?new Date(a.irs5472DueDate).toISOString().split("T")[0]:"",onChange:j=>he.mutate({appId:a.id,field:"irs5472DueDate",value:j.target.value}),"data-testid":`input-irs5472-${a.id}`})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-2 md:p-3 rounded-lg md:rounded-xl border col-span-2",children:[e.jsx(n,{className:"text-[10px] md:text-xs font-bold text-muted-foreground mb-1 block truncate",children:"Reporte Anual"}),e.jsx(c,{type:"date",className:"h-8 md:h-10 text-xs md:text-sm px-2 md:px-3",defaultValue:a.annualReportDueDate?new Date(a.annualReportDueDate).toISOString().split("T")[0]:"",onChange:j=>he.mutate({appId:a.id,field:"annualReportDueDate",value:j.target.value}),"data-testid":`input-annual-report-${a.id}`})]})]})]},s.id)}),(!ze||ze.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay pedidos con LLCs para gestionar"})]})]}),V==="newsletter"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-4 md:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-accent/10 p-4 rounded-xl",children:[e.jsxs("h4",{className:"font-black text-sm mb-3",children:["Enviar a todos los suscriptores (",pe?.length||0,")"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{value:js,onChange:s=>ca(s.target.value),placeholder:"Asunto del email",className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-subject"}),e.jsx(B,{value:fs,onChange:s=>oa(s.target.value),placeholder:"Contenido del mensaje",rows:4,className:"bg-white dark:bg-zinc-900","data-testid":"input-broadcast-message"}),e.jsx(t,{onClick:()=>Ns.mutate({subject:js,message:fs}),disabled:!js||!fs||Ns.isPending,className:"w-full rounded-full","data-testid":"button-send-broadcast",children:Ns.isPending?"Enviando...":`Enviar a ${pe?.length||0} suscriptores`})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm mb-3",children:"Lista de Suscriptores"}),e.jsxs("div",{className:"divide-y max-h-80 overflow-y-auto",children:[pe?.map(s=>e.jsxs("div",{className:"py-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s.email}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.subscribedAt?new Date(s.subscribedAt).toLocaleDateString("es-ES"):""})]},s.id)),(!pe||pe.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No hay suscriptores"})]})]})]})}),V==="inbox"&&e.jsx(o,{className:"rounded-2xl border-0 shadow-sm p-0 overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[gs?.map(s=>e.jsxs("div",{className:"p-4 space-y-2 hover:bg-accent/5 cursor-pointer transition-colors",onClick:()=>us(Le?.id===s.id?null:s),"data-testid":`inbox-message-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-black text-sm",children:[s.firstName," ",s.lastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.email," ",s.phone&&`• ${s.phone}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"outline",className:"text-[10px]",children:s.messageId||s.id}),e.jsx(F,{variant:"secondary",className:"text-[10px]",children:s.status||"pendiente"})]})]}),e.jsx("p",{className:"text-xs font-medium",children:s.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.message}),s.replies&&s.replies.length>0&&e.jsx("div",{className:"pl-4 border-l-2 border-accent/30 space-y-2 mt-3",children:s.replies.map(a=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:`font-semibold ${a.isAdmin?"text-accent":"text-muted-foreground"}`,children:[a.isAdmin?"Admin":"Cliente",":"]}),e.jsx("span",{className:"ml-2",children:a.content}),e.jsx("span",{className:"text-[10px] text-muted-foreground ml-2",children:a.createdAt&&new Date(a.createdAt).toLocaleString("es-ES")})]},a.id))}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.createdAt?new Date(s.createdAt).toLocaleString("es-ES"):""}),Le?.id===s.id&&e.jsxs("div",{className:"space-y-2 pt-3 border-t mt-2",onClick:a=>a.stopPropagation(),children:[e.jsx(B,{value:xe,onChange:a=>ps(a.target.value),placeholder:"Escribe tu respuesta al cliente...",className:"rounded-xl min-h-[80px] text-sm","data-testid":"input-admin-reply"}),e.jsxs(t,{onClick:()=>ue.mutate(s.id),disabled:!xe.trim()||ue.isPending,className:"bg-accent text-primary font-black rounded-full px-6","data-testid":"button-send-admin-reply",children:[ue.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(Xa,{className:"w-4 h-4 mr-2"}),"Enviar respuesta"]})]})]},s.id)),(!gs||gs.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay mensajes"})]})}),V==="descuentos"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Códigos de Descuento"}),e.jsxs(t,{variant:"outline",size:"sm",className:"rounded-full text-xs font-semibold",onClick:()=>{$({code:"",discountType:"percentage",discountValue:"",minOrderAmount:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0}),ce({open:!0,code:null})},"data-testid":"button-create-discount-code",children:[e.jsx(Qe,{className:"w-3 h-3 mr-1"})," Nuevo Código"]})]}),e.jsx(o,{className:"rounded-2xl border-0 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"divide-y",children:[bs?.map(s=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3","data-testid":`discount-code-${s.code}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-black text-sm",children:s.code}),e.jsx(F,{variant:s.isActive?"default":"secondary",className:"text-[10px]",children:s.isActive?"Activo":"Inactivo"}),e.jsx(F,{variant:"outline",className:"text-[10px]",children:s.discountType==="percentage"?`${s.discountValue}%`:`${(s.discountValue/100).toFixed(2)}€`})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Usado: ",s.usedCount,s.maxUses?`/${s.maxUses}`:""," veces",s.minOrderAmount&&` | Min: ${(s.minOrderAmount/100).toFixed(2)}€`]}),(s.validFrom||s.validUntil)&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[s.validFrom&&`Desde: ${new Date(s.validFrom).toLocaleDateString("es-ES")}`,s.validFrom&&s.validUntil&&" - ",s.validUntil&&`Hasta: ${new Date(s.validUntil).toLocaleDateString("es-ES")}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>{$({code:s.code,discountType:s.discountType,discountValue:s.discountValue.toString(),minOrderAmount:s.minOrderAmount?(s.minOrderAmount/100).toString():"",maxUses:s.maxUses?.toString()||"",validFrom:s.validFrom?s.validFrom.split("T")[0]:"",validUntil:s.validUntil?s.validUntil.split("T")[0]:"",isActive:s.isActive}),ce({open:!0,code:s})},"data-testid":`button-edit-discount-${s.code}`,children:e.jsx(wa,{className:"w-3 h-3"})}),e.jsx(t,{variant:"outline",size:"sm",className:`rounded-full text-xs ${s.isActive?"text-red-600":"text-green-600"}`,onClick:async()=>{try{await p("PATCH",`/api/admin/discount-codes/${s.id}`,{isActive:!s.isActive}),la(),i({title:s.isActive?"Código desactivado":"Código activado"})}catch{i({title:"Error",variant:"destructive"})}},"data-testid":`button-toggle-discount-${s.code}`,children:s.isActive?e.jsx(va,{className:"w-3 h-3"}):e.jsx(ya,{className:"w-3 h-3"})})]})]},s.id)),(!bs||bs.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No hay códigos de descuento"})]})})]})]},"admin")]}),e.jsxs("div",{className:"space-y-6 md:gap-8 order-2 lg:order-2",children:[e.jsxs("section",{className:"bg-white dark:bg-zinc-900 p-6 md:p-8 rounded-[2rem] shadow-sm",children:[e.jsxs("h3",{className:"text-lg md:text-xl font-black tracking-tight text-primary mb-6 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-accent"})," Seguimiento"]}),e.jsx("div",{className:"space-y-5",children:O&&O.length>0?Fe&&Fe.length>0?Fe.map((s,a)=>e.jsxs("div",{className:"flex gap-4 relative",children:[a<Fe.length-1&&e.jsx("div",{className:"absolute left-3 top-6 w-0.5 h-8 bg-gray-100"}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center shrink-0 z-10 bg-accent text-primary",children:e.jsx($s,{className:"w-3 h-3"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"text-xs md:text-sm font-black text-primary truncate",children:s.eventType}),s.createdAt&&e.jsx("span",{className:"text-[9px] text-muted-foreground whitespace-nowrap",children:new Date(s.createdAt).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.description})]})]},s.id)):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent flex items-center justify-center",children:e.jsx($s,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-xs font-black",children:"Pedido Recibido"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Verificación de Datos"})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ls,{className:"w-8 h-8 text-gray-200 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No hay pedidos activos"})]})})]}),e.jsxs("section",{className:"bg-accent/10 p-6 md:p-8 rounded-[2rem] border-2 border-accent/20",children:[e.jsx("h3",{className:"text-base font-black text-primary mb-3",children:"¿Necesitas ayuda?"}),e.jsx("p",{className:"text-xs text-primary/70 mb-5 leading-relaxed",children:"Nuestro equipo de expertos está listo para resolver tus dudas."}),e.jsx("a",{href:"https://wa.me/34614916910",target:"_blank",rel:"noopener noreferrer",children:e.jsx(t,{className:"w-full bg-accent text-primary font-black rounded-full py-5",children:"Contactar Soporte"})})]})]})]})]}),r?.isAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(A,{open:ve.open,onOpenChange:s=>ye({open:s,user:s?ve.user:null}),children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Enviar Mensaje al Cliente"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"El cliente recibirá notificación en su panel y email"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Título"}),e.jsx(c,{value:He,onChange:s=>Vs(s.target.value),placeholder:"Título del mensaje",className:"w-full rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-note-title"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:We,onChange:s=>Ks(s.target.value),placeholder:"Escribe tu mensaje...",rows:4,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-note-message"})]})]}),e.jsxs(z,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ye({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>ve.user?.id&&ae.mutate({userId:ve.user.id,title:He,message:We,type:Ta}),disabled:!He||!We||ae.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-note",children:ae.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Enviar Mensaje"})]})]})}),e.jsx(A,{open:!!m,onOpenChange:s=>!s&&N(null),children:e.jsxs(T,{className:"max-w-lg bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Editar Usuario"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Modifica los datos del cliente"})]}),m&&e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:m.firstName||"",onChange:s=>N({...m,firstName:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-firstname"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:m.lastName||"",onChange:s=>N({...m,lastName:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{value:m.email||"",onChange:s=>N({...m,email:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-email"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:m.phone||"",onChange:s=>N({...m,phone:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-phone"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo ID"}),e.jsxs(S,{value:m.idType||"",onValueChange:s=>N({...m,idType:s}),children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200",children:e.jsx(E,{placeholder:"Seleccionar"})}),e.jsxs(P,{className:"rounded-xl",children:[e.jsx(l,{value:"dni",children:"DNI"}),e.jsx(l,{value:"nie",children:"NIE"}),e.jsx(l,{value:"passport",children:"Pasaporte"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Número ID"}),e.jsx(c,{value:m.idNumber||"",onChange:s=>N({...m,idNumber:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-idnumber"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Fecha Nacimiento"}),e.jsx(c,{type:"date",value:m.birthDate||"",onChange:s=>N({...m,birthDate:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-birthdate"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Actividad de Negocio"}),e.jsxs(S,{value:m.businessActivity||"",onValueChange:s=>N({...m,businessActivity:s}),children:[e.jsx(D,{className:"bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-edit-activity",children:e.jsx(E,{placeholder:"Seleccionar actividad"})}),e.jsxs(P,{className:"rounded-xl",children:[e.jsx(l,{value:"ecommerce",children:"E-commerce"}),e.jsx(l,{value:"dropshipping",children:"Dropshipping"}),e.jsx(l,{value:"consulting",children:"Consultoría"}),e.jsx(l,{value:"marketing",children:"Marketing Digital"}),e.jsx(l,{value:"software",children:"Desarrollo de Software"}),e.jsx(l,{value:"trading",children:"Trading / Inversiones"}),e.jsx(l,{value:"freelance",children:"Freelance"}),e.jsx(l,{value:"other",children:"Otra"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Dirección"}),e.jsx(c,{value:m.address||"",onChange:s=>N({...m,address:s.target.value}),placeholder:"Calle y número",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Ciudad"}),e.jsx(c,{value:m.city||"",onChange:s=>N({...m,city:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-city"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Código Postal"}),e.jsx(c,{value:m.postalCode||"",onChange:s=>N({...m,postalCode:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-postal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Provincia"}),e.jsx(c,{value:m.province||"",onChange:s=>N({...m,province:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-province"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"País"}),e.jsx(c,{value:m.country||"",onChange:s=>N({...m,country:s.target.value}),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-edit-country"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Notas Internas (solo admin)"}),e.jsx(B,{value:m.internalNotes||"",onChange:s=>N({...m,internalNotes:s.target.value}),rows:2,className:"rounded-xl border-gray-200 focus:border-accent","data-testid":"input-edit-notes"})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>N(null),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>m.id&&Oe.mutate({id:m.id,...m}),disabled:Oe.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-user",children:Oe.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Guardar Cambios"})]})]})]})}),e.jsx(A,{open:X.open,onOpenChange:s=>De({open:s,user:s?X.user:null}),children:e.jsxs(T,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(I,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Usuario"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar a ",e.jsxs("strong",{children:[X.user?.firstName," ",X.user?.lastName]}),"?"]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer."})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>De({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>X.user?.id&&vs.mutate(X.user.id),disabled:vs.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete",children:vs.isPending?"Eliminando...":"Eliminar"})]})]})}),e.jsx(A,{open:q.open,onOpenChange:s=>Me({open:s,order:s?q.order:null}),children:e.jsxs(T,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(I,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Pedido"})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Estás seguro de que deseas eliminar el pedido ",e.jsx("strong",{children:q.order?.application?.requestCode||q.order?.maintenanceApplication?.requestCode||q.order?.invoiceNumber}),"?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Cliente: ",q.order?.user?.firstName," ",q.order?.user?.lastName]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción eliminará el pedido, la solicitud LLC asociada y todos los documentos relacionados."})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Me({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>q.order?.id&&ws.mutate(q.order.id),disabled:ws.isPending,className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-confirm-delete-order",children:ws.isPending?"Eliminando...":"Eliminar Pedido"})]})]})}),e.jsx(A,{open:te.open,onOpenChange:s=>$e({open:s,order:s?te.order:null}),children:e.jsxs(T,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(I,{children:e.jsx(L,{className:"text-xl font-black text-primary",children:"Generar Factura"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pedido: ",e.jsx("strong",{children:te.order?.application?.requestCode||te.order?.maintenanceApplication?.requestCode||te.order?.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",step:"0.01",value:ne,onChange:s=>ma(s.target.value),className:"rounded-full border-gray-200 focus:border-accent h-11",placeholder:"739.00","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Divisa"}),e.jsxs(S,{value:ys,onValueChange:xa,children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200",children:e.jsx(E,{placeholder:"Seleccionar divisa"})}),e.jsxs(P,{className:"rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR (€)"}),e.jsx(l,{value:"USD",children:"USD ($)"})]})]})]})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>$e({open:!1,order:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full",disabled:!ne||isNaN(parseFloat(ne))||parseFloat(ne)<=0,onClick:async()=>{try{const s=Math.round(parseFloat(ne)*100);if(s<=0){i({title:"Error",description:"El importe debe ser mayor que 0",variant:"destructive"});return}await p("POST",`/api/admin/orders/${te.order?.id}/generate-invoice`,{amount:s,currency:ys}),i({title:"Factura generada",description:`Factura creada por ${ne} ${ys}`}),h.invalidateQueries({queryKey:["/api/admin/orders"]}),$e({open:!1,order:null})}catch{i({title:"Error",description:"No se pudo generar la factura",variant:"destructive"})}},"data-testid":"button-confirm-generate-invoice",children:"Generar Factura"})]})]})}),e.jsx(A,{open:ie.open,onOpenChange:s=>fe({open:s,user:s?ie.user:null}),children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Solicitar Documentos"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Solicita documentos al cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(S,{value:Ne,onValueChange:Us,children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200",children:e.jsx(E,{placeholder:"Seleccionar tipo..."})}),e.jsxs(P,{className:"rounded-xl",children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Mensaje"}),e.jsx(B,{value:qs,onChange:s=>Rs(s.target.value),placeholder:"Mensaje para el cliente",rows:3,className:"w-full rounded-xl border-gray-200 focus:border-accent","data-testid":"input-doc-message"})]})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>fe({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>{if(ie.user?.id&&ie.user?.email){const a={passport:"Pasaporte / Documento de Identidad",address_proof:"Prueba de Domicilio",tax_id:"Identificación Fiscal (NIF/CIF)",other:"Documento Adicional"}[Ne]||Ne;ae.mutate({userId:ie.user.id,title:`Solicitud de Documento: ${a}`,message:qs||`Por favor, sube tu ${a} a tu panel de cliente.`,type:"action_required"}),fe({open:!1,user:null}),Us(""),Rs("")}},disabled:!Ne||ae.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-request-doc",children:ae.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Solicitar Documento"})]})]})}),e.jsx(A,{open:Y.open,onOpenChange:s=>we({open:s,user:s?Y.user:null}),children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Factura"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Genera una factura para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground bg-gray-50 p-3 rounded-xl",children:["Cliente: ",e.jsxs("strong",{children:[Y.user?.firstName," ",Y.user?.lastName]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Concepto"}),e.jsx(c,{value:Ye,onChange:s=>Qs(s.target.value),placeholder:"Ej: Servicio de consultoría",className:"w-full rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-invoice-concept"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe"}),e.jsx(c,{type:"number",value:Je,onChange:s=>_s(s.target.value),placeholder:"739",className:"w-full rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-invoice-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Moneda"}),e.jsxs(S,{value:Bs,onValueChange:Gs,children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-invoice-currency",children:e.jsx(E,{})}),e.jsxs(P,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"EUR",children:"EUR"}),e.jsx(l,{value:"USD",children:"USD"})]})]})]})]})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3 mt-6",children:[e.jsx(t,{variant:"outline",onClick:()=>we({open:!1,user:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:()=>Y.user?.id&&ks.mutate({userId:Y.user.id,concept:Ye,amount:Math.round(parseFloat(Je)*100),currency:Bs}),disabled:!Ye||!Je||ks.isPending,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-create-invoice",children:ks.isPending?"Creando...":"Crear Factura"})]})]})})]}),e.jsx(A,{open:za,onOpenChange:Ze,children:e.jsxs(T,{className:"max-w-sm bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(I,{children:e.jsx(L,{className:"text-xl font-black text-red-600",children:"Eliminar Mi Cuenta"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"¿Estás seguro de que deseas eliminar tu cuenta permanentemente?"}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Esta acción no se puede deshacer. Todos tus datos serán eliminados."})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ze(!1),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{variant:"destructive",onClick:()=>Ds.mutate(),disabled:Ds.isPending,className:"rounded-full font-black","data-testid":"button-confirm-delete-account",children:Ds.isPending?"Eliminando...":"Eliminar Mi Cuenta"})]})]})}),e.jsx(A,{open:ee.open,onOpenChange:s=>{s||Ee({open:!1,file:null})},children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsx(I,{children:e.jsx(L,{className:"text-xl font-black text-primary",children:"Subir Documento"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[ee.file&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg flex items-center gap-3",children:[e.jsx(de,{className:"w-8 h-8 text-accent"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:ee.file.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(ee.file.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo de documento"}),e.jsxs(S,{value:le,onValueChange:Hs,children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-upload-doc-type",children:e.jsx(E,{})}),e.jsxs(P,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(l,{value:"passport",children:"Pasaporte / Documento de Identidad"}),e.jsx(l,{value:"address_proof",children:"Prueba de Domicilio"}),e.jsx(l,{value:"tax_id",children:"Identificación Fiscal (NIF/CIF)"}),e.jsx(l,{value:"other",children:"Otro Documento"})]})]})]}),le==="other"&&e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Descripción del documento"}),e.jsx(B,{value:Pe,onChange:s=>Ws(s.target.value),placeholder:"Describe el tipo de documento que estás subiendo...",className:"min-h-[80px] rounded-xl border-gray-200 focus:border-accent","data-testid":"input-upload-notes"})]})]}),e.jsxs(z,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ee({open:!1,file:null}),className:"w-full sm:w-auto rounded-full font-black",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!ee.file)return;const s=new FormData;s.append("file",ee.file),s.append("documentType",le),le==="other"&&Pe&&s.append("notes",Pe);try{const a=await fetch("/api/user/documents/upload",{method:"POST",body:s,credentials:"include"});if(a.ok)i({title:"Documento subido",description:"Tu documento ha sido enviado correctamente."}),h.invalidateQueries({queryKey:["/api/user/documents"]}),Ee({open:!1,file:null});else{const x=await a.json();i({title:"Error",description:x.message||"No se pudo subir el documento",variant:"destructive"})}}catch{i({title:"Error",description:"Error de conexión",variant:"destructive"})}},disabled:le==="other"&&!Pe.trim(),className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-upload",children:"Subir Documento"})]})]})}),e.jsx(A,{open:La,onOpenChange:ke,children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Cliente"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Completa los datos del nuevo cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Nombre"}),e.jsx(c,{value:K.firstName,onChange:s=>J(a=>({...a,firstName:s.target.value})),placeholder:"Nombre",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-create-user-firstname"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Apellidos"}),e.jsx(c,{value:K.lastName,onChange:s=>J(a=>({...a,lastName:s.target.value})),placeholder:"Apellidos",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-create-user-lastname"})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Email"}),e.jsx(c,{type:"email",value:K.email,onChange:s=>J(a=>({...a,email:s.target.value})),placeholder:"email@ejemplo.com",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-create-user-email"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Teléfono"}),e.jsx(c,{value:K.phone,onChange:s=>J(a=>({...a,phone:s.target.value})),placeholder:"+34 600 000 000",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-create-user-phone"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Contraseña"}),e.jsx(c,{type:"password",value:K.password,onChange:s=>J(a=>({...a,password:s.target.value})),placeholder:"Mínimo 8 caracteres",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-create-user-password"})]})]}),e.jsxs(z,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ke(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-user",children:"Cancelar"}),e.jsx(t,{onClick:()=>Cs.mutate(K),disabled:Cs.isPending||!K.email||!K.password,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-user",children:Cs.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Crear Cliente"})]})]})}),e.jsx(A,{open:Fa,onOpenChange:Ce,children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:"Crear Nuevo Pedido"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:"Configura el pedido para el cliente"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Cliente"}),e.jsxs(S,{value:Z.userId,onValueChange:s=>Se(a=>({...a,userId:s})),children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-order-user",children:e.jsx(E,{placeholder:"Seleccionar cliente..."})}),e.jsx(P,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:ia?.map(s=>e.jsxs(l,{value:s.id,children:[s.firstName," ",s.lastName," (",s.email,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Estado (LLC)"}),e.jsxs(S,{value:Z.state,onValueChange:s=>Se(a=>({...a,state:s})),children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-order-state",children:e.jsx(E,{})}),e.jsxs(P,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"New Mexico",children:"New Mexico - 739€"}),e.jsx(l,{value:"Wyoming",children:"Wyoming - 899€"}),e.jsx(l,{value:"Delaware",children:"Delaware - 1199€"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Importe (€)"}),e.jsx(c,{type:"number",value:Z.amount,onChange:s=>Se(a=>({...a,amount:s.target.value})),placeholder:"739",className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-order-amount"})]})]}),e.jsxs(z,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Ce(!1),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-create-order",children:"Cancelar"}),e.jsx(t,{onClick:()=>Ss.mutate(Z),disabled:Ss.isPending||!Z.userId||!Z.amount,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-confirm-create-order",children:Ss.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):"Crear Pedido"})]})]})}),e.jsx(A,{open:Q.open,onOpenChange:s=>ce({open:s,code:s?Q.code:null}),children:e.jsxs(T,{className:"max-w-md bg-white dark:bg-zinc-900 rounded-2xl mx-4 sm:mx-auto max-h-[90vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black text-primary",children:Q.code?"Editar Código de Descuento":"Nuevo Código de Descuento"}),e.jsx(R,{className:"text-sm text-muted-foreground",children:Q.code?"Modifica los datos del código":"Configura un nuevo código de descuento"})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Código"}),e.jsx(c,{value:g.code,onChange:s=>$(a=>({...a,code:s.target.value.toUpperCase()})),className:"rounded-full border-gray-200 focus:border-accent h-11 uppercase",disabled:!!Q.code,"data-testid":"input-discount-code"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Tipo"}),e.jsxs(S,{value:g.discountType,onValueChange:s=>$(a=>({...a,discountType:s})),children:[e.jsx(D,{className:"w-full bg-white dark:bg-zinc-900 rounded-full h-11 border-gray-200","data-testid":"select-discount-type",children:e.jsx(E,{})}),e.jsxs(P,{className:"bg-white dark:bg-zinc-900 z-[9999] rounded-xl",children:[e.jsx(l,{value:"percentage",children:"Porcentaje (%)"}),e.jsx(l,{value:"fixed",children:"Fijo (centimos)"})]})]})]}),e.jsxs("div",{children:[e.jsxs(n,{className:"text-sm font-black text-primary mb-2 block",children:["Valor ",g.discountType==="percentage"?"(%)":"(centimos)"]}),e.jsx(c,{type:"number",value:g.discountValue,onChange:s=>$(a=>({...a,discountValue:s.target.value})),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-discount-value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Pedido min. (EUR)"}),e.jsx(c,{type:"number",value:g.minOrderAmount,onChange:s=>$(a=>({...a,minOrderAmount:s.target.value})),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-discount-min-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Usos max."}),e.jsx(c,{type:"number",value:g.maxUses,onChange:s=>$(a=>({...a,maxUses:s.target.value})),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-discount-max-uses"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Válido desde"}),e.jsx(c,{type:"date",value:g.validFrom,onChange:s=>$(a=>({...a,validFrom:s.target.value})),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-discount-valid-from"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary mb-2 block",children:"Válido hasta"}),e.jsx(c,{type:"date",value:g.validUntil,onChange:s=>$(a=>({...a,validUntil:s.target.value})),className:"rounded-full border-gray-200 focus:border-accent h-11","data-testid":"input-discount-valid-until"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Aa,{checked:g.isActive,onCheckedChange:s=>$(a=>({...a,isActive:s})),"data-testid":"switch-discount-active"}),e.jsx(n,{className:"text-sm font-semibold",children:"Código activo"})]})]}),e.jsxs(z,{className:"mt-6 flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>ce({open:!1,code:null}),className:"w-full sm:w-auto rounded-full font-black","data-testid":"button-cancel-discount",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{try{const s={code:g.code,discountType:g.discountType,discountValue:parseInt(g.discountValue),minOrderAmount:g.minOrderAmount?parseInt(g.minOrderAmount)*100:null,maxUses:g.maxUses?parseInt(g.maxUses):null,validFrom:g.validFrom||null,validUntil:g.validUntil||null,isActive:g.isActive};Q.code?(await p("PATCH",`/api/admin/discount-codes/${Q.code.id}`,s),i({title:"Código actualizado"})):(await p("POST","/api/admin/discount-codes",s),i({title:"Código creado"})),la(),ce({open:!1,code:null})}catch(s){i({title:"Error",description:s.message||"No se pudo guardar el código",variant:"destructive"})}},disabled:!g.code||!g.discountValue,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-save-discount",children:Q.code?"Guardar Cambios":"Crear Código"})]})]})}),e.jsx(A,{open:Oa,onOpenChange:s=>{os(s),s||ms("")},children:e.jsxs(T,{className:"rounded-2xl mx-4 sm:mx-auto max-w-md",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black",children:"Verifica tu correo electrónico"}),e.jsx(R,{children:"Te hemos enviado un código de verificación para confirmar tu email"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Código de verificación"}),e.jsx(c,{value:me,onChange:s=>ms(s.target.value.replace(/\D/g,"")),className:"rounded-full text-center text-2xl font-black border-gray-200 focus:border-accent tracking-[0.5em]",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code","data-testid":"input-email-verification-code"})]}),e.jsx(t,{onClick:async()=>{if(!me||me.length<6){i({title:"Introduce el código de 6 dígitos",variant:"destructive"});return}aa(!0);try{(await(await p("POST","/api/auth/verify-email",{code:me})).json()).success&&(await h.refetchQueries({queryKey:["/api/auth/user"]}),i({title:"Email verificado correctamente"}),os(!1),ms(""))}catch(s){i({title:"Código incorrecto",description:s.message||"Inténtalo de nuevo o solicita un nuevo código",variant:"destructive"})}finally{aa(!1)}},disabled:sa||me.length<6,size:"lg",className:"w-full bg-accent text-primary font-black rounded-full","data-testid":"button-verify-email-code",children:sa?e.jsx(_,{className:"animate-spin"}):"Verificar mi email"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"¿No has recibido el código?"}),e.jsx(t,{variant:"link",onClick:async()=>{na(!0);try{await p("POST","/api/auth/resend-verification"),i({title:"Código enviado",description:"Revisa tu email"})}catch{i({title:"Error",description:"No se pudo enviar el código",variant:"destructive"})}finally{na(!1)}},disabled:ta,className:"text-accent p-0 h-auto","data-testid":"button-resend-verification-code",children:ta?"Enviando...":"Reenviar código"})]})]})]})}),e.jsx(A,{open:se.open,onOpenChange:s=>{Te({open:s,user:s?se.user:null}),s||(is(""),ls(""),cs(""))},children:e.jsxs(T,{className:"rounded-2xl mx-4 sm:mx-auto max-w-md",children:[e.jsxs(I,{children:[e.jsx(L,{className:"text-xl font-black",children:"Enviar Link de Pago"}),e.jsxs(R,{children:["Envía un enlace de pago a ",se.user?.firstName," ",se.user?.lastName]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Link de pago (URL)"}),e.jsx(c,{value:Ie,onChange:s=>is(s.target.value),placeholder:"https://...",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-url"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Importe"}),e.jsx(c,{value:oe,onChange:s=>ls(s.target.value),placeholder:"Ej: 739€",className:"rounded-full border-gray-200 focus:border-accent","data-testid":"input-payment-link-amount"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-black text-primary block mb-2",children:"Mensaje (opcional)"}),e.jsx(B,{value:Zs,onChange:s=>cs(s.target.value),placeholder:"Mensaje adicional para el cliente...",className:"rounded-xl border-gray-200 focus:border-accent resize-none",rows:3,"data-testid":"input-payment-link-message"})]})]}),e.jsxs(z,{className:"flex-col sm:flex-row gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>Te({open:!1,user:null}),className:"w-full sm:w-auto rounded-full",children:"Cancelar"}),e.jsx(t,{onClick:async()=>{if(!Ie||!oe){i({title:"Completa todos los campos requeridos",variant:"destructive"});return}ea(!0);try{await p("POST","/api/admin/send-payment-link",{userId:se.user?.id,paymentLink:Ie,amount:oe,message:Zs||`Por favor, completa el pago de ${oe} a través del siguiente enlace.`}),i({title:"Link de pago enviado",description:`Se ha enviado el link a ${se.user?.email}`}),Te({open:!1,user:null}),is(""),ls(""),cs("")}catch(s){i({title:"Error",description:s.message||"No se pudo enviar el link",variant:"destructive"})}finally{ea(!1)}},disabled:Xs||!Ie||!oe,className:"w-full sm:w-auto bg-accent text-primary font-black rounded-full","data-testid":"button-send-payment-link",children:Xs?e.jsx(_,{className:"animate-spin"}):"Enviar Link de Pago"})]})]})}),e.jsx(Ca,{})]})}export{kt as default};
